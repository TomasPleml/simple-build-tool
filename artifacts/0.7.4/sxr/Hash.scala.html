<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>Hash.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> xsbt

<span class="keyword">import</span> java.io.{ByteArrayInputStream, File, InputStream}

<span class="keyword">object</span> <a title="object xsbt.Hash" id="12405">Hash</a>
{
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="74658">BufferSize</a> = <span title="Int(8192)" class="int">8192</span>
	<span class="keyword">def</span> <a title="(Array[Byte])String" id="74660">toHex</a>(<a title="Array[Byte]" id="74668">bytes</a>: <span title="Array[Byte]">Array</span>[Byte]): <span title="String">String</span> =
	{
		<span class="keyword">val</span> <a title="StringBuilder" id="74669">buffer</a> = <a title="(Int)StringBuilder" id="17853" class="keyword">new</a> <a title="StringBuilder" id="1383">StringBuilder</a>(<a href="#74668" title="Array[Byte]">bytes</a>.<span title="=&gt; Int">length</span> <a title="(Int)Int" id="3097">*</a> <span title="Int(2)" class="int">2</span>)
		<span class="keyword">for</span>(<a title="((Int) =&gt; Unit)Unit" id="74709">i</a> &lt;- <span title="implicit scala.Predef.intWrapper : (Int)scala.runtime.RichInt" class="int">0</span> <span title="(Int)Range">until</span> <a href="#74668" title="Array[Byte]">bytes</a>.<span title="=&gt; Int">length</span>)
		{
			<span class="keyword">val</span> <a title="Byte" id="74710">b</a> = <a href="#74668" title="(Int)Byte" id="17312">bytes</a>(<a href="#74709" title="Int">i</a>)
			<span class="keyword">val</span> <a title="Int" id="74711">bi</a>: <span title="Int">Int</span> = <span title="Int" class="keyword">if</span>(<a href="#74710" title="Byte">b</a> <span title="(Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span>) <a href="#74710" title="Byte">b</a> <a title="(Int)Int" id="2768">+</a> <span title="Int(256)" class="int">256</span> <span class="keyword">else</span> <a href="#74710" title="implicit scala.Predef.byte2int : (Byte)Int" id="6284">b</a>
			<a href="#74669" title="StringBuilder">buffer</a> <span title="(Char)StringBuilder">append</span> <a href="#74665" title="(Byte)Char">toHex</a>((<a href="#74711" title="Int">bi</a> <a title="(Int)Int" id="3040">&gt;&gt;&gt;</a> <span title="Int(4)" class="int">4</span>).<span title="Byte">asInstanceOf</span>[<span title="Byte">Byte</span>])
			<a href="#74669" title="StringBuilder">buffer</a> <span title="(Char)StringBuilder">append</span> <a href="#74665" title="(Byte)Char">toHex</a>((<a href="#74711" title="Int">bi</a> <span title="(Int)Int">&amp;</span> <span title="Int(15)" class="int">0x0F</span>).<span title="Byte">asInstanceOf</span>[<span title="Byte">Byte</span>])
		}
		<a href="#74669" title="StringBuilder">buffer</a>.<a title="()String" id="17904">toString</a>
	}
	<span class="keyword">def</span> <a title="(String)Array[Byte]" id="74661">fromHex</a>(<a title="String" id="74743">hex</a>: <span title="String">String</span>): <span title="Array[Byte]">Array</span>[Byte] =
	{
		<span title="(Boolean,Any)Unit">require</span>((<a href="#74743" title="String">hex</a>.<span title="()Int">length</span> <span title="(Int)Int">&amp;</span> <span title="Int(1)" class="int">1</span>) <a title="(Int)Boolean" id="3089">==</a> <span title="Int(0)" class="int">0</span>, <span title="java.lang.String(&quot;Hex string must have length 2n.&quot;)" class="string">&quot;Hex string must have length 2n.&quot;</span>)
		<span class="keyword">val</span> <a title="Array[Byte]" id="74744">array</a> = <span title="Array[Byte]" class="keyword">new</span> <span title="Array[Byte]">Array</span>[Byte](<a href="#74743" title="String">hex</a>.<span title="()Int">length</span> <span title="(Int)Int">&gt;&gt;</span> <span title="Int(1)" class="int">1</span>)
		<span class="keyword">for</span>(<a title="((Int) =&gt; Unit)Unit" id="74766">i</a> &lt;- <span title="implicit scala.Predef.intWrapper : (Int)scala.runtime.RichInt" class="int">0</span> <span title="(Int)Range">until</span> <a href="#74743" title="String">hex</a>.<span title="()Int">length</span> <a title="(Int)Range" id="74688">by</a> <span title="Int(2)" class="int">2</span>)
		{
			<span class="keyword">val</span> <a title="Char" id="74767">c1</a> = <a href="#74743" title="String">hex</a>.<span title="(Int)Char">charAt</span>(<a href="#74766" title="Int">i</a>)
			<span class="keyword">val</span> <a title="Char" id="74768">c2</a> = <a href="#74743" title="String">hex</a>.<span title="(Int)Char">charAt</span>(<a href="#74766" title="Int">i</a><span title="(Int)Int">+</span><span title="Int(1)" class="int">1</span>)
			<a href="#74744" title="Array[Byte]">array</a>(<a href="#74766" title="Int">i</a> <span title="(Int)Int">&gt;&gt;</span> <span title="Int(1)" class="int">1</span>) = ((<a href="#74666" title="(Char)Int">fromHex</a>(<a href="#74767" title="Char">c1</a>) <a title="(Int)Int" id="3038">&lt;&lt;</a> <span title="Int(4)" class="int">4</span>) <a title="(Int)Int" id="3100">|</a> <a href="#74666" title="(Char)Int">fromHex</a>(<a href="#74768" title="Char">c2</a>)).<span title="Byte">asInstanceOf</span>[<span title="Byte">Byte</span>]
		}
		<a href="#74744" title="Array[Byte]">array</a>
	}
	<span class="comment">/** Calculates the SHA-1 hash of the given String.*/</span>
	<span class="keyword">def</span> <a title="(String)Array[Byte]" id="74662">apply</a>(<a title="String" id="74793">s</a>: <span title="String">String</span>): <span title="Array[Byte]">Array</span>[Byte] = <a href="#74664" title="(java.io.InputStream)Array[Byte]">apply</a>(<span title="java.io.ByteArrayInputStream" class="keyword">new</span> <a title="java.io.ByteArrayInputStream" id="3506">ByteArrayInputStream</a>(<a href="#74793" title="String">s</a>.<a title="(java.lang.String)Array[Byte]" id="5775">getBytes</a>(<span title="java.lang.String(&quot;UTF-8&quot;)" class="string">&quot;UTF-8&quot;</span>)))
	<span class="comment">/** Calculates the SHA-1 hash of the given file.*/</span>
	<span class="keyword">def</span> <a title="(java.io.File)Array[Byte]" id="74663">apply</a>(<a title="java.io.File" id="74796">file</a>: <a title="java.io.File" id="3620">File</a>): <span title="Array[Byte]">Array</span>[Byte] = <a href="OpenResource.scala.html#12807" title="object xsbt.OpenResource">OpenResource</a>.<a href="OpenResource.scala.html#36918" title="(java.io.File)((java.io.FileInputStream) =&gt; Array[Byte])Array[Byte]">fileInputStream</a>(<a href="#74796" title="java.io.File">file</a>)(<a href="#74664" title="(java.io.InputStream)Array[Byte]">apply</a>)
	<span class="comment">/** Calculates the SHA-1 hash of the given stream, closing it when finished.*/</span>
	<span class="keyword">def</span> <a title="(java.io.InputStream)Array[Byte]" id="74664">apply</a>(<a title="java.io.InputStream" id="74795">stream</a>: <a title="java.io.InputStream" id="3695">InputStream</a>): <span title="Array[Byte]">Array</span>[Byte] =
	{
		<span class="keyword">import</span> java.security.{MessageDigest, DigestInputStream}
		<span class="keyword">val</span> <a title="java.security.MessageDigest" id="74819">digest</a> = <a title="object java.security.MessageDigest" id="4611">MessageDigest</a>.<a title="(java.lang.String)java.security.MessageDigest" id="74824">getInstance</a>(<span title="java.lang.String(&quot;SHA&quot;)" class="string">&quot;SHA&quot;</span>)
		<span class="keyword">try</span>
		{
			<span class="keyword">val</span> <a title="java.security.DigestInputStream" id="74896">dis</a> = <span title="java.security.DigestInputStream" class="keyword">new</span> <a title="java.security.DigestInputStream" id="4901">DigestInputStream</a>(<a href="#74795" title="java.io.InputStream">stream</a>, <a href="#74819" title="java.security.MessageDigest">digest</a>)
			<span class="keyword">val</span> <a title="Array[Byte]" id="74897">buffer</a> = <span title="Array[Byte]" class="keyword">new</span> <span title="Array[Byte]">Array</span>[Byte](<a href="#74658" title="=&gt; Int">BufferSize</a>)
			<a href="#74898" title="Unit" class="keyword">while</a>(<a href="#74896" title="java.security.DigestInputStream">dis</a>.<a title="(Array[Byte])Int" id="36984">read</a>(<a href="#74897" title="Array[Byte]">buffer</a>) <a title="(Int)Boolean" id="3094">&gt;=</a> <span title="Int(0)" class="int">0</span>) <span title="Unit">{</span>}
			<a href="#74896" title="java.security.DigestInputStream">dis</a>.<a title="()Unit" id="36988">close</a>()
			<a href="#74819" title="java.security.MessageDigest">digest</a>.<a title="()Array[Byte]" id="74832">digest</a>
		}
		<span class="keyword">finally</span> { <a href="#74795" title="java.io.InputStream">stream</a>.<a title="()Unit" id="29926">close</a>() }
	}

	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(Byte)Char" id="74665">toHex</a>(<a title="Byte" id="74737">b</a>: <span title="Byte">Byte</span>): <span title="Char">Char</span> =
	{
		<span title="(Boolean,Any)Unit">require</span>(<a href="#74737" title="Byte">b</a> <a title="(Int)Boolean" id="2767">&gt;=</a> <span title="Int(0)" class="int">0</span> <span title="(Boolean)Boolean">&amp;&amp;</span> <a href="#74737" title="Byte">b</a> <a title="(Int)Boolean" id="2765">&lt;=</a> <span title="Int(15)" class="int">15</span>, <span title="java.lang.String(&quot;Byte &quot;)" class="string">&quot;Byte &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74737" title="Byte">b</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; was not between 0 and 15&quot;)" class="string">&quot; was not between 0 and 15&quot;</span>)
		<span title="Char" class="keyword">if</span>(<a href="#74737" title="Byte">b</a> <span title="(Int)Boolean">&lt;</span> <span title="Int(10)" class="int">10</span>)
			(<span title="Char('0')" class="char">'0'</span>.<span title="Int">asInstanceOf</span>[<span title="Int">Int</span>] <a title="(Byte)Int" id="3053">+</a> <a href="#74737" title="Byte">b</a>).<span title="Char">asInstanceOf</span>[<span title="Char">Char</span>]
		<span class="keyword">else</span>
			(<span title="Char('a')" class="char">'a'</span>.<span title="Int">asInstanceOf</span>[<span title="Int">Int</span>] <span title="(Int)Int">+</span> (<a href="#74737" title="Byte">b</a><a title="(Int)Int" id="2769">-</a><span title="Int(10)" class="int">10</span>)).<span title="Char">asInstanceOf</span>[<span title="Char">Char</span>]
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(Char)Int" id="74666">fromHex</a>(<a title="Char" id="74789">c</a>: <span title="Char">Char</span>): <span title="Int">Int</span> =
	{
		<span class="keyword">val</span> <a title="Int" id="74933">b</a> =
			<span title="Int" class="keyword">if</span>(<a href="#74789" title="Char">c</a> <span title="(Char)Boolean">&gt;=</span> <span title="Char('0')" class="char">'0'</span> <span title="(Boolean)Boolean">&amp;&amp;</span> <a href="#74789" title="Char">c</a> <span title="(Char)Boolean">&lt;=</span> <span title="Char('9')" class="char">'9'</span>)
				(<a href="#74789" title="Char">c</a> <span title="(Char)Int">-</span> <span title="Char('0')" class="char">'0'</span>)
			<span class="keyword">else</span> <span title="Int" class="keyword">if</span>(<a href="#74789" title="Char">c</a> <span title="(Char)Boolean">&gt;=</span> <span title="Char('a')" class="char">'a'</span> <span title="(Boolean)Boolean">&amp;&amp;</span> <a href="#74789" title="Char">c</a> <span title="(Char)Boolean">&lt;=</span> <span title="Char('f')" class="char">'f'</span>)
				(<a href="#74789" title="Char">c</a> <span title="(Char)Int">-</span> <span title="Char('a')" class="char">'a'</span>) <span title="(Int)Int">+</span> <span title="Int(10)" class="int">10</span>
			<span class="keyword">else</span> <span title="Int" class="keyword">if</span>(<a href="#74789" title="Char">c</a> <span title="(Char)Boolean">&gt;=</span> <span title="Char('A')" class="char">'A'</span> <span title="(Boolean)Boolean">&amp;&amp;</span> <a href="#74789" title="Char">c</a> <span title="(Char)Boolean">&lt;=</span> <span title="Char('F')" class="char">'F'</span>)
				(<a href="#74789" title="Char">c</a> <span title="(Char)Int">-</span> <span title="Char('A')" class="char">'A'</span>) <span title="(Int)Int">+</span> <span title="Int(10)" class="int">10</span>
			<span class="keyword">else</span>
				<span title="Nothing" class="keyword">throw</span> <a title="(java.lang.String)java.lang.RuntimeException" id="19700" class="keyword">new</a> <a title="java.lang.RuntimeException" id="6061">RuntimeException</a>(<span title="java.lang.String(&quot;Invalid hex character: '&quot;)" class="string">&quot;Invalid hex character: '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74789" title="Char">c</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;'.&quot;)" class="string">&quot;'.&quot;</span>)
		<a href="#74933" title="Int">b</a>
	}
}
        </pre>
    </body>
</html>