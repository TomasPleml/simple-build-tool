<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/impl/TestStatusReporter.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt.impl
<span class="keyword">import</span> sbt._

<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> scala.collection.mutable.{HashMap, Map}

<span class="comment">/** Only intended to be used once per instance. */</span>
<span class="keyword">private</span>[sbt] <span class="keyword">class</span> <a title="class TestStatusReporter extends java.lang.Object with sbt.TestsListener with ScalaObject" id="13858">TestStatusReporter</a>(<a title="sbt.Path" id="81317">path</a>: <a href="../Path.scala.html#10200" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="81318">log</a>: <a href="../Logger.scala.html#11865" title="sbt.Logger">Logger</a>) <span class="keyword">extends</span> <a href="../TestReportListener.scala.html#9189" title="sbt.TestsListener">TestsListener</a>
{
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[String,Long]" id="81308">succeeded</a>: <span title="scala.collection.mutable.Map[String,Long]">Map</span>[String, Long] = <a href="#13610" title="object sbt.impl.TestStatus">TestStatus</a>.<a href="#86274" title="(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]">read</a>(<a href="#81317" title="sbt.Path">path</a>, <a href="#81318" title="sbt.Logger">log</a>)

	<span class="keyword">def</span> <a title="=&gt; Unit" id="81309">doInit</a> <span title="Unit">{</span>}
	<span class="keyword">def</span> <a title="(String)Unit" id="81310">startGroup</a>(<a title="String" id="86280">name</a>: <span title="String">String</span>) { <a href="#81307" title="=&gt; scala.collection.mutable.Map[String,Long]">succeeded</a> <a title="(String)Option[Long]" id="24517">removeKey</a> <a href="#86280" title="String">name</a> }
	<span class="keyword">def</span> <a title="(sbt.TestEvent)Unit" id="81311">testEvent</a>(<a title="sbt.TestEvent" id="86281">event</a>: <a href="../TestReportListener.scala.html#9387" title="sbt.TestEvent">TestEvent</a>) <span title="Unit">{</span>}
	<span class="keyword">def</span> <a title="(String,Throwable)Unit" id="81312">endGroup</a>(<a title="String" id="86282">name</a>: <span title="String">String</span>, <a title="Throwable" id="86283">t</a>: <span title="Throwable">Throwable</span>) <span title="Unit">{</span>}
	<span class="keyword">def</span> <a title="(String,sbt.Result.Value)Unit" id="81313">endGroup</a>(<a title="String" id="86284">name</a>: <span title="String">String</span>, <a title="sbt.Result.Value" id="86285">result</a>: Result.<span title="sbt.Result.Value">Value</span>)
	{
		<span title="Unit" class="keyword">if</span>(<a href="#86285" title="sbt.Result.Value">result</a> <a title="(AnyRef)Boolean" id="3457">==</a> <a href="../TestFramework.scala.html#11677" title="object sbt.Result">Result</a>.<a href="../TestFramework.scala.html#32442" title="=&gt; sbt.Result.Value">Passed</a>)
			<a href="#81307" title="=&gt; scala.collection.mutable.Map[String,Long]">succeeded</a>(<a href="#86284" title="String">name</a>) = <a title="object java.lang.System" id="1831">System</a>.<a title="()Long" id="34076">currentTimeMillis</a>
	}
	<span class="keyword">def</span> <a title="(sbt.Result.Value)Unit" id="81314">doComplete</a>(<a title="sbt.Result.Value" id="86287">finalResult</a>: Result.<span title="sbt.Result.Value">Value</span>) { <a href="#81316" title="()Unit">complete</a>() }
	<span class="keyword">def</span> <a title="(Throwable)Unit" id="81315">doComplete</a>(<a title="Throwable" id="86288">t</a>: <span title="Throwable">Throwable</span>) { <a href="#81316" title="()Unit">complete</a>() }
	
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="81316">complete</a>()
	{
		<a href="#13610" title="object sbt.impl.TestStatus">TestStatus</a>.<a href="#86275" title="(scala.collection.mutable.Map[String,Long],String,sbt.Path,sbt.Logger)Unit">write</a>(<a href="#81307" title="=&gt; scala.collection.mutable.Map[String,Long]">succeeded</a>, <span title="java.lang.String(&quot;Successful Tests&quot;)" class="string">&quot;Successful Tests&quot;</span>, <a href="#81317" title="sbt.Path">path</a>, <a href="#81318" title="sbt.Logger">log</a>)
	}
}

<span class="keyword">private</span>[sbt] <span class="keyword">class</span> <a title="class TestQuickFilter extends java.lang.Object with (String) =&gt; Boolean with NotNull with ScalaObject" id="13813">TestQuickFilter</a>(<a title="sbt.CompileAnalysis" id="81296">testAnalysis</a>: <a href="../Analysis.scala.html#6999" title="sbt.CompileAnalysis">CompileAnalysis</a>, <a title="Boolean" id="81297">failedOnly</a>: <a title="Boolean" id="2115">Boolean</a>, <a title="sbt.Path" id="81298">path</a>: <a href="../Path.scala.html#10200" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="81299">log</a>: <a href="../Logger.scala.html#11865" title="sbt.Logger">Logger</a>) <span class="keyword">extends</span> (String =&gt; Boolean) <span class="keyword">with</span> <a title="NotNull" id="189">NotNull</a>
{
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[String,Long]" id="81292">exclude</a> = <a href="#13610" title="object sbt.impl.TestStatus">TestStatus</a>.<a href="#86274" title="(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]">read</a>(<a href="#81298" title="sbt.Path">path</a>, <a href="#81299" title="sbt.Logger">log</a>)
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[String,sbt.Path]" id="81294">map</a> = <a href="#81296" title="sbt.CompileAnalysis">testAnalysis</a>.<a href="../Analysis.scala.html#27240" title="=&gt; scala.collection.mutable.Map[String,sbt.Path]">testSourceMap</a>
	<span class="keyword">def</span> <a title="(String)Boolean" id="81295">apply</a>(<a title="String" id="86299">test</a>: <span title="String">String</span>) =
		<a href="#81291" title="=&gt; scala.collection.mutable.Map[String,Long]">exclude</a>.<a title="(String)Option[Long]" id="24557">get</a>(<a href="#86299" title="String">test</a>) <span title="Boolean" class="keyword">match</span>
		{
			<span title="Boolean(true)" class="keyword">case</span> <span title="object None">None</span> =&gt; <span title="Boolean(true)" class="keyword">true</span> <span class="comment">// include because this test has not been run or did not succeed</span>
			<span title="Boolean" class="keyword">case</span> Some(<a title="Long" id="86301">lastSuccessTime</a>) =&gt; <span class="comment">// succeeded the last time it was run</span>
				<span title="Boolean" class="keyword">if</span>(<a href="#81297" title="Boolean">failedOnly</a>)
					<span title="Boolean(false)" class="keyword">false</span> <span class="comment">// don't include because the last time succeeded</span>
				<span class="keyword">else</span>
					<a href="#81296" title="sbt.CompileAnalysis">testAnalysis</a>.<a href="../Analysis.scala.html#27173" title="(sbt.Path)Option[scala.collection.mutable.Set[sbt.Path]]">products</a>(<a href="#81293" title="(String)sbt.Path" id="24561">map</a>(<a href="#86299" title="String">test</a>)) <span title="Boolean" class="keyword">match</span>
					{
						<span title="Boolean(true)" class="keyword">case</span> <span title="object None">None</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
						<span title="Boolean" class="keyword">case</span> Some(<a title="scala.collection.mutable.Set[sbt.Path]" id="86309">products</a>) =&gt; <a href="#86309" title="scala.collection.mutable.Set[sbt.Path]">products</a>.<a title="((sbt.Path) =&gt; Boolean)Boolean" id="16283">exists</a>(<a href="#86301" title="Long">lastSuccessTime</a> <a title="(Long)Boolean" id="3215">&lt;=</a> <a href="#86311" title="sbt.Path">_</a>.<a href="../Path.scala.html#18073" title="=&gt; Long">lastModified</a>) <span class="comment">// include if the test is newer than the last run</span>
					}
		}
}
<span class="keyword">private</span> <span class="keyword">object</span> <a title="object sbt.impl.TestStatus" id="13610">TestStatus</a>
{
	<span class="keyword">import</span> java.util.Properties
	<span class="keyword">def</span> <a title="(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]" id="86274">read</a>(<a title="sbt.Path" id="86277">path</a>: <a href="../Path.scala.html#10200" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="86278">log</a>: <a href="../Logger.scala.html#11865" title="sbt.Logger">Logger</a>): <span title="scala.collection.mutable.Map[String,Long]">Map</span>[String, Long] =
	{
		<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,Long]" id="86314">map</a> = <span title="scala.collection.mutable.HashMap[String,Long]" class="keyword">new</span> <a title="scala.collection.mutable.HashMap[String,Long]" id="15927">HashMap</a>[String, Long]
		<span class="keyword">val</span> <a title="java.util.Properties" id="86315">properties</a> = <span title="java.util.Properties" class="keyword">new</span> <span title="java.util.Properties">Properties</span>
		<a href="#86276" title="(Option[String],String,sbt.Logger)Unit">logError</a>(<a href="MapUtilities.scala.html#13643" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="MapUtilities.scala.html#56563" title="(java.util.Properties,sbt.Path,sbt.Logger)Option[String]">load</a>(<a href="#86315" title="java.util.Properties">properties</a>, <a href="#86277" title="sbt.Path">path</a>, <a href="#86278" title="sbt.Logger">log</a>), <span title="java.lang.String(&quot;loading&quot;)" class="string">&quot;loading&quot;</span>, <a href="#86278" title="sbt.Logger">log</a>)
		<span class="keyword">for</span>(<a title="((String) =&gt; Unit)Unit" id="86326">test</a> &lt;- <a href="MapUtilities.scala.html#13643" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="MapUtilities.scala.html#56564" title="(java.util.Properties)Iterable[String]">propertyNames</a>(<a href="#86315" title="java.util.Properties">properties</a>))
			<a href="#86314" title="scala.collection.mutable.HashMap[String,Long]">map</a>.<a title="(String,Long)Option[Long]" id="24518">put</a>(<a href="#86326" title="String">test</a>, <a href="#86315" title="java.util.Properties">properties</a>.<a title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString" id="56444">getProperty</a>(<a href="#86326" title="String">test</a>).<a title="=&gt; Long" id="17241">toLong</a>)
		<a href="#86314" title="scala.collection.mutable.HashMap[String,Long]">map</a>
	}
	<span class="keyword">def</span> <a title="(scala.collection.mutable.Map[String,Long],String,sbt.Path,sbt.Logger)Unit" id="86275">write</a>(<a title="scala.collection.mutable.Map[String,Long]" id="86289">map</a>: <span title="scala.collection.mutable.Map[String,Long]">Map</span>[String, Long], <a title="String" id="86290">label</a>: <span title="String">String</span>, <a title="sbt.Path" id="86291">path</a>: <a href="../Path.scala.html#10200" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="86292">log</a>: <a href="../Logger.scala.html#11865" title="sbt.Logger">Logger</a>)
	{
		<span class="keyword">val</span> <a title="java.util.Properties" id="86332">properties</a> = <span title="java.util.Properties" class="keyword">new</span> <span title="java.util.Properties">Properties</span>
		<span class="keyword">for</span>( <a href="#86339" title="(((String, Long)) =&gt; Unit)Unit" id="16275">(</a><a title="String" id="86344">test</a>, <a title="Long" id="86345">lastSuccessTime</a>) &lt;- <a href="#86289" title="scala.collection.mutable.Map[String,Long]">map</a>)
			<a href="#86332" title="java.util.Properties">properties</a>.<a title="(java.lang.String,java.lang.String)java.lang.Object" id="56437">setProperty</a>(<a href="#86344" title="String">test</a>, <a href="#86345" title="Long">lastSuccessTime</a>.<a title="()java.lang.String" id="3448">toString</a>)
		<a href="#86276" title="(Option[String],String,sbt.Logger)Unit">logError</a>(<a href="MapUtilities.scala.html#13643" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="MapUtilities.scala.html#56562" title="(java.util.Properties,String,sbt.Path,sbt.Logger)Option[String]">write</a>(<a href="#86332" title="java.util.Properties">properties</a>, <a href="#86290" title="String">label</a>, <a href="#86291" title="sbt.Path">path</a>, <a href="#86292" title="sbt.Logger">log</a>), <span title="java.lang.String(&quot;writing&quot;)" class="string">&quot;writing&quot;</span>, <a href="#86292" title="sbt.Logger">log</a>)
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(Option[String],String,sbt.Logger)Unit" id="86276">logError</a>(<a title="Option[String]" id="86322">result</a>: <a title="Option[String]" id="897">Option</a>[String], <a title="String" id="86323">action</a>: <span title="String">String</span>, <a title="sbt.Logger" id="86324">log</a>: <a href="../Logger.scala.html#11865" title="sbt.Logger">Logger</a>)
	{
		<a href="#86322" title="Option[String]">result</a>.<a title="((String) =&gt; Unit)Unit" id="19239">foreach</a>(<a title="String" id="86347">msg</a> =&gt; <a href="#86324" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#19736" title="(=&gt; String)Unit">error</a>(<span title="java.lang.String(&quot;Error &quot;)" class="string">&quot;Error &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#86323" title="String">action</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; test status: &quot;)" class="string">&quot; test status: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#86347" title="String">msg</a>))
	}
}
        </pre>
    </body>
</html>