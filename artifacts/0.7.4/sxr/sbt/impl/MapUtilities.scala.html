<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/impl/MapUtilities.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2008, 2009 Mark Harrah
 */</span>

<span class="keyword">package</span> sbt.impl
<span class="keyword">import</span> sbt._

<span class="keyword">import</span> java.util.Properties
<span class="keyword">import</span> java.io.{File, FileInputStream, FileOutputStream, InputStream, OutputStream}
<span class="keyword">import</span> scala.collection.mutable.{HashMap, HashSet, ListBuffer, Map, Set}

<span class="keyword">private</span>[sbt] <span class="keyword">object</span> <a title="object sbt.impl.PropertiesUtilities" id="13643">PropertiesUtilities</a>
{
	<span class="keyword">def</span> <a title="(java.util.Properties,String,sbt.Path,sbt.Logger)Option[String]" id="56562">write</a>(<a title="java.util.Properties" id="56565">properties</a>: <span title="java.util.Properties">Properties</span>, <a title="String" id="56566">label</a>: <span title="String">String</span>, <a title="sbt.Path" id="56567">to</a>: <a href="../Path.scala.html#10200" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="56568">log</a>: <a href="../Logger.scala.html#11865" title="sbt.Logger">Logger</a>) =
		<a href="../FileUtilities.scala.html#9085" title="object sbt.FileUtilities">FileUtilities</a>.<a href="../FileUtilities.scala.html#15518" title="(java.io.File,sbt.Logger)((java.io.OutputStream) =&gt; Option[String])Option[String]">writeStream</a>(<a href="#56567" title="sbt.Path">to</a>.<a href="../Path.scala.html#18076" title="=&gt; java.io.File">asFile</a>, <a href="#56568" title="sbt.Logger">log</a>)(<a title="java.io.OutputStream" id="56575">output</a> =&gt; { <a href="#56565" title="java.util.Properties">properties</a>.<a title="(java.io.OutputStream,java.lang.String)Unit" id="56440">store</a>(<a href="#56575" title="java.io.OutputStream">output</a>, <a href="#56566" title="String">label</a>); <span title="object None">None</span> })
	<span class="keyword">def</span> <a title="(java.util.Properties,sbt.Path,sbt.Logger)Option[String]" id="56563">load</a>(<a title="java.util.Properties" id="58730">properties</a>: <span title="java.util.Properties">Properties</span>, <a title="sbt.Path" id="58731">from</a>: <a href="../Path.scala.html#10200" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="58732">log</a>: <a href="../Logger.scala.html#11865" title="sbt.Logger">Logger</a>): <span title="Option[String]">Option</span>[String] =
	{
		<span class="keyword">val</span> <a title="java.io.File" id="58733">file</a> = <a href="#58731" title="sbt.Path">from</a>.<a href="../Path.scala.html#18076" title="=&gt; java.io.File">asFile</a>
		<span title="Option[String]" class="keyword">if</span>(<a href="#58733" title="java.io.File">file</a>.<a title="()Boolean" id="16232">exists</a>)
			<a href="../FileUtilities.scala.html#9085" title="object sbt.FileUtilities">FileUtilities</a>.<a href="../FileUtilities.scala.html#15520" title="(java.io.File,sbt.Logger)((java.io.InputStream) =&gt; Option[String])Option[String]">readStream</a>(<a href="#58733" title="java.io.File">file</a>, <a href="#58732" title="sbt.Logger">log</a>)( <a title="java.io.InputStream" id="58742">input</a> =&gt; { <a href="#58730" title="java.util.Properties">properties</a>.<a title="(java.io.InputStream)Unit" id="56438">load</a>(<a href="#58742" title="java.io.InputStream">input</a>); <span title="object None">None</span> })
		<span class="keyword">else</span>
			<span title="object None">None</span>
	}
	<span class="keyword">def</span> <a title="(java.util.Properties)Iterable[String]" id="56564">propertyNames</a>(<a title="java.util.Properties" id="58743">properties</a>: <span title="java.util.Properties">Properties</span>): <span title="Iterable[String]">Iterable</span>[String] =
		wrap.<a href="../wrap/Wrappers.scala.html#14270" title="object sbt.wrap.Wrappers">Wrappers</a>.<a href="../wrap/Wrappers.scala.html#18254" title="(java.util.Enumeration[?0])List[?0]">toList</a>(<a href="#58743" title="java.util.Properties">properties</a>.<a title="()java.util.Enumeration[_]" id="56447">propertyNames</a>).<span title="((?0) =&gt; java.lang.String)List[java.lang.String]">map</span>(<a href="#58760" title="?0">_</a>.<a title="()java.lang.String" id="3448">toString</a>)
}

<span class="keyword">private</span>[sbt] <span class="keyword">object</span> <a title="object sbt.impl.MapUtilities" id="13835">MapUtilities</a>
{
	<span class="keyword">def</span> <a title="[Key, Value](scala.collection.mutable.Map[Key,Value],String,sbt.Path,sbt.Logger)(implicit sbt.Format[Key],sbt.Format[Value])Option[String]" id="27097">write</a>[<a title="&gt;: Nothing &lt;: Any" id="27100">Key</a>, <a title="&gt;: Nothing &lt;: Any" id="27101">Value</a>](<a title="scala.collection.mutable.Map[Key,Value]" id="58762">map</a>: <span title="scala.collection.mutable.Map[Key,Value]">Map</span>[Key, Value], <a title="String" id="58763">label</a>: <span title="String">String</span>, <a title="sbt.Path" id="58764">to</a>: <a href="../Path.scala.html#10200" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="58765">log</a>: <a href="../Logger.scala.html#11865" title="sbt.Logger">Logger</a>)(<span class="keyword">implicit</span> <a title="sbt.Format[Key]" id="58766">keyFormat</a>: <a href="../Format.scala.html#9792" title="sbt.Format[Key]">Format</a>[Key], <a title="sbt.Format[Value]" id="58767">valueFormat</a>: <a href="../Format.scala.html#9792" title="sbt.Format[Value]">Format</a>[Value]): <span title="Option[String]">Option</span>[String] =
	{
		<span class="keyword">val</span> <a title="java.util.Properties" id="58768">properties</a> = <span title="java.util.Properties" class="keyword">new</span> <span title="java.util.Properties">Properties</span>
		<a href="#58762" title="scala.collection.mutable.Map[Key,Value]">map</a> <span title="(((Key, Value)) =&gt; Unit)Unit">foreach</span> { <a title="(Key, Value)" id="58776">pair</a> =&gt; <a href="#58768" title="java.util.Properties">properties</a>.<a title="(java.lang.String,java.lang.String)java.lang.Object" id="56437">setProperty</a>(<a href="#58766" title="sbt.Format[Key]">keyFormat</a>.<a href="../Format.scala.html#16541" title="(Key)String">toString</a>(<a href="#58776" title="(Key, Value)">pair</a>.<a title="=&gt; Key" id="17794">_1</a>), <a href="#58767" title="sbt.Format[Value]">valueFormat</a>.<a href="../Format.scala.html#16541" title="(Value)String">toString</a>(<a href="#58776" title="(Key, Value)">pair</a>.<a title="=&gt; Value" id="17796">_2</a>)) }
		<a href="#13643" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="#56562" title="(java.util.Properties,String,sbt.Path,sbt.Logger)Option[String]">write</a>(<a href="#58768" title="java.util.Properties">properties</a>, <a href="#58763" title="String">label</a>, <a href="#58764" title="sbt.Path">to</a>, <a href="#58765" title="sbt.Logger">log</a>)
	}
	<span class="keyword">def</span> <a title="[Key, Value](scala.collection.mutable.Map[Key,Value],sbt.Path,sbt.Logger)(implicit sbt.Format[Key],sbt.Format[Value])Option[String]" id="27102">read</a>[<a title="&gt;: Nothing &lt;: Any" id="27105">Key</a>, <a title="&gt;: Nothing &lt;: Any" id="27106">Value</a>](<a title="scala.collection.mutable.Map[Key,Value]" id="48347">map</a>: <span title="scala.collection.mutable.Map[Key,Value]">Map</span>[Key, Value], <a title="sbt.Path" id="48348">from</a>: <a href="../Path.scala.html#10200" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="48349">log</a>: <a href="../Logger.scala.html#11865" title="sbt.Logger">Logger</a>)(<span class="keyword">implicit</span> <a title="sbt.Format[Key]" id="48350">keyFormat</a>: <a href="../Format.scala.html#9792" title="sbt.Format[Key]">Format</a>[Key], <a title="sbt.Format[Value]" id="48351">valueFormat</a>: <a href="../Format.scala.html#9792" title="sbt.Format[Value]">Format</a>[Value]): <span title="Option[String]">Option</span>[String] =
	{
		<a href="#48347" title="scala.collection.mutable.Map[Key,Value]">map</a>.<a title="()Unit" id="24522">clear</a>
		<span class="keyword">val</span> <a title="java.util.Properties" id="58779">properties</a> = <span title="java.util.Properties" class="keyword">new</span> <span title="java.util.Properties">Properties</span>
		<a href="#13643" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="#56563" title="(java.util.Properties,sbt.Path,sbt.Logger)Option[String]">load</a>(<a href="#58779" title="java.util.Properties">properties</a>, <a href="#48348" title="sbt.Path">from</a>, <a href="#48349" title="sbt.Logger">log</a>) <a title="(=&gt; Option[String])Option[String]" id="19240">orElse</a>
		{
			<span class="keyword">for</span>(<a title="((String) =&gt; Unit)Unit" id="58788">name</a> &lt;- <a href="#13643" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="#56564" title="(java.util.Properties)Iterable[String]">propertyNames</a>(<a href="#58779" title="java.util.Properties">properties</a>))
				<a href="#48347" title="scala.collection.mutable.Map[Key,Value]">map</a>.<span title="(Key,Value)Option[Value]">put</span>( <a href="#48350" title="sbt.Format[Key]">keyFormat</a>.<a href="../Format.scala.html#16542" title="(String)Key">fromString</a>(<a href="#58788" title="String">name</a>), <a href="#48351" title="sbt.Format[Value]">valueFormat</a>.<a href="../Format.scala.html#16542" title="(String)Value">fromString</a>(<a href="#58779" title="java.util.Properties">properties</a>.<a title="(java.lang.String)java.lang.String" id="56444">getProperty</a>(<a href="#58788" title="String">name</a>)))
			<span title="object None">None</span>
		}
	}
	<span class="keyword">def</span> <a title="(String,sbt.Path,sbt.Logger)scala.collection.Map[String,String]" id="27107">readStrings</a>(<a title="String" id="56407">label</a>: <span title="String">String</span>, <a title="sbt.Path" id="56408">envBackingPath</a>: <a href="../Path.scala.html#10200" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="56409">log</a>: <a href="../Logger.scala.html#11865" title="sbt.Logger">Logger</a>): scala.collection.<a title="scala.collection.Map[String,String]" id="15624">Map</a>[String, String] =
	{
		<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,String]" id="58790">map</a> = <span title="scala.collection.mutable.HashMap[String,String]" class="keyword">new</span> <a title="scala.collection.mutable.HashMap[String,String]" id="15927">HashMap</a>[String, String]
		<span class="keyword">for</span>(<a title="((String) =&gt; Unit)Unit" id="58796">errorMsg</a> &lt;- <a href="#27102" title="(scala.collection.mutable.Map[String,String],sbt.Path,sbt.Logger)(implicit sbt.Format[String],sbt.Format[String])Option[String]">read</a>(<a href="#58790" title="scala.collection.mutable.HashMap[String,String]">map</a>, <a href="#56408" title="sbt.Path">envBackingPath</a>, <a href="#56409" title="sbt.Logger">log</a>))
			<a href="#56409" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#19736" title="(=&gt; String)Unit">error</a>(<span title="java.lang.String(&quot;Error loading properties from &quot;)" class="string">&quot;Error loading properties from &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#56407" title="String">label</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; : &quot;)" class="string">&quot; : &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58796" title="String">errorMsg</a>)
		<a href="#58790" title="scala.collection.mutable.HashMap[String,String]">map</a>.<a title="=&gt; scala.collection.Map[String,String]" id="24528">readOnly</a>
	}
	<span class="keyword">def</span> <a title="[Key, Value](scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]])Iterable[Value]" id="27108">all</a>[<a title="&gt;: Nothing &lt;: Any" id="27111">Key</a>, <a title="&gt;: Nothing &lt;: Any" id="27112">Value</a>](<a title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]" id="28861">map</a>: <span title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">Map</span>[Key, Set[Value]]): <span title="Iterable[Value]">Iterable</span>[Value] =
		<a href="#28861" title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">map</a>.<a title="=&gt; Iterator[scala.collection.mutable.Set[Value]]" id="24566">values</a>.<span title="=&gt; List[scala.collection.mutable.Set[Value]]">toList</span>.<a title="((scala.collection.mutable.Set[Value]) =&gt; Iterable[Value])List[Value]" id="17984">flatMap</a>(<a title="scala.collection.mutable.Set[Value]" id="58801">set</a> =&gt; <a href="#58801" title="scala.collection.mutable.Set[Value]">set</a>.<a title="=&gt; List[Value]" id="16304">toList</a>)
	
	<span class="keyword">def</span> <a title="[Key, Value](scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]])Iterable[(Key, scala.collection.Set[Value])]" id="27113">readOnlyIterable</a>[<a title="&gt;: Nothing &lt;: Any" id="27116">Key</a>, <a title="&gt;: Nothing &lt;: Any" id="27117">Value</a>](<a title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]" id="29644">i</a>: <span title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">Map</span>[Key, Set[Value]]): <span title="Iterable[(Key, scala.collection.Set[Value])]">Iterable</span>[(Key, scala.collection.Set[Value])] =
		<span class="keyword">for</span>( <a href="#58804" title="(((Key, scala.collection.mutable.Set[Value])) =&gt; (Key, scala.collection.Set[Value]))List[(Key, scala.collection.Set[Value])]" id="17968">(</a><a title="Key" id="58811">key</a>, <a title="scala.collection.mutable.Set[Value]" id="58812">set</a>) &lt;- <a href="#29644" title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">i</a>.<a title="=&gt; Iterator[(Key, scala.collection.mutable.Set[Value])]" id="16265">elements</a>.<span title="=&gt; List[(Key, scala.collection.mutable.Set[Value])]">toList</span>) <span class="keyword">yield</span> <a title="(Key,scala.collection.Set[Value])(Key, scala.collection.Set[Value])" id="1327">(</a><a href="#58811" title="Key">key</a>, wrap.<a href="../wrap/Wrappers.scala.html#14270" title="object sbt.wrap.Wrappers">Wrappers</a>.<a href="../wrap/Wrappers.scala.html#18262" title="(scala.collection.mutable.Set[Value])scala.collection.Set[Value]">readOnly</a>(<a href="#58812" title="scala.collection.mutable.Set[Value]">set</a>))<span class="comment">//.readOnly)</span>
		
	<span class="keyword">def</span> <a title="[Key, Value](Key,scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]])Unit" id="27118">mark</a>[<a title="&gt;: Nothing &lt;: Any" id="27121">Key</a>, <a title="&gt;: Nothing &lt;: Any" id="27122">Value</a>](<a title="Key" id="58845">source</a>: <a href="#27121" title="Key">Key</a>, <a title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]" id="58846">map</a>: <span title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">Map</span>[Key, Set[Value]])
	{
		<span title="Unit" class="keyword">if</span>(<a title="=&gt; Boolean" id="2695">!</a><a href="#58846" title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">map</a>.<a title="(Key)Boolean" id="24562">contains</a>(<a href="#58845" title="Key">source</a>))
			<a href="#58846" title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">map</a>.<span title="(Key,scala.collection.mutable.Set[Value])Option[scala.collection.mutable.Set[Value]]">put</span>(<a href="#58845" title="Key">source</a>, <span title="scala.collection.mutable.HashSet[Value]" class="keyword">new</span> <span title="scala.collection.mutable.HashSet[Value]">HashSet</span>[Value])
	}
	<span class="keyword">def</span> <a title="[Key, Value](Key,Value,scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]])Unit" id="27123">add</a>[<a title="&gt;: Nothing &lt;: Any" id="27126">Key</a>, <a title="&gt;: Nothing &lt;: Any" id="27127">Value</a>](<a title="Key" id="34601">key</a>: <a href="#27126" title="Key">Key</a>, <a title="Value" id="34602">value</a>: <a href="#27127" title="Value">Value</a>, <a title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]" id="34603">map</a>: <span title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">Map</span>[Key, Set[Value]]): <a title="Unit" id="2114">Unit</a> =
		<a href="#34603" title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">map</a>.<a title="(Key,=&gt; scala.collection.mutable.Set[Value])scala.collection.mutable.Set[Value]" id="24523">getOrElseUpdate</a>(<a href="#34601" title="Key">key</a>, <span title="scala.collection.mutable.HashSet[Value]" class="keyword">new</span> <span title="scala.collection.mutable.HashSet[Value]">HashSet</span>[Value]) <a title="(Value)scala.collection.mutable.Set[Value]" id="18125">+</a> <a href="#34602" title="Value">value</a>
}
        </pre>
    </body>
</html>