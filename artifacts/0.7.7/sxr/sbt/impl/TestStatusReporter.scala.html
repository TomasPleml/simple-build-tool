<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/impl/TestStatusReporter.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt.impl
<span class="keyword">import</span> sbt._

<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> scala.collection.mutable.{HashMap, Map}

<span class="comment">/** Only intended to be used once per instance. */</span>
<span class="keyword">private</span>[sbt] <span class="keyword">class</span> <a title="class TestStatusReporter extends java.lang.Object with sbt.TestsListener with ScalaObject" id="14719">TestStatusReporter</a>(<a title="sbt.Path" id="60883">path</a>: <a href="../Path.scala.html#11861" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="60884">log</a>: <a href="../Logger.scala.html#13532" title="sbt.Logger">Logger</a>) <span class="keyword">extends</span> <a href="../TestReportListener.scala.html#10820" title="sbt.TestsListener">TestsListener</a>
{
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[String,Long]" id="60874">succeeded</a>: <span title="scala.collection.mutable.Map[String,Long]">Map</span>[String, Long] = <a href="#14471" title="object sbt.impl.TestStatus">TestStatus</a>.<a href="#87755" title="(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]">read</a>(<a href="#60883" title="sbt.Path">path</a>, <a href="#60884" title="sbt.Logger">log</a>)

	<span class="keyword">def</span> <a title="=&gt; Unit" id="60875">doInit</a> <span title="Unit">{</span>}
	<span class="keyword">def</span> <a title="(String)Unit" id="60876">startGroup</a>(<a title="String" id="87761">name</a>: <span title="String">String</span>) { <a href="#60873" title="=&gt; scala.collection.mutable.Map[String,Long]">succeeded</a> <a title="(String)Option[Long]" id="38004">removeKey</a> <a href="#87761" title="String">name</a> }
	<span class="keyword">def</span> <a title="(sbt.TestEvent)Unit" id="60877">testEvent</a>(<a title="sbt.TestEvent" id="87762">event</a>: <a href="../TestReportListener.scala.html#11021" title="sbt.TestEvent">TestEvent</a>) <span title="Unit">{</span>}
	<span class="keyword">def</span> <a title="(String,Throwable)Unit" id="60878">endGroup</a>(<a title="String" id="87763">name</a>: <span title="String">String</span>, <a title="Throwable" id="87764">t</a>: <span title="Throwable">Throwable</span>) <span title="Unit">{</span>}
	<span class="keyword">def</span> <a title="(String,sbt.Result.Value)Unit" id="60879">endGroup</a>(<a title="String" id="87765">name</a>: <span title="String">String</span>, <a title="sbt.Result.Value" id="87766">result</a>: Result.<span title="sbt.Result.Value">Value</span>)
	{
		<span title="Unit" class="keyword">if</span>(<a href="#87766" title="sbt.Result.Value">result</a> <a title="(AnyRef)Boolean" id="3448">==</a> <a href="../TestFramework.scala.html#13338" title="object sbt.Result">Result</a>.<a href="../TestFramework.scala.html#78439" title="=&gt; sbt.Result.Value">Passed</a>)
			<a href="#60873" title="=&gt; scala.collection.mutable.Map[String,Long]">succeeded</a>(<a href="#87765" title="String">name</a>) = <a title="object java.lang.System" id="1825">System</a>.<a title="()Long" id="18311">currentTimeMillis</a>
	}
	<span class="keyword">def</span> <a title="(sbt.Result.Value)Unit" id="60880">doComplete</a>(<a title="sbt.Result.Value" id="87768">finalResult</a>: Result.<span title="sbt.Result.Value">Value</span>) { <a href="#60882" title="()Unit">complete</a>() }
	<span class="keyword">def</span> <a title="(Throwable)Unit" id="60881">doComplete</a>(<a title="Throwable" id="87769">t</a>: <span title="Throwable">Throwable</span>) { <a href="#60882" title="()Unit">complete</a>() }
	
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="60882">complete</a>()
	{
		<a href="#14471" title="object sbt.impl.TestStatus">TestStatus</a>.<a href="#87756" title="(scala.collection.mutable.Map[String,Long],String,sbt.Path,sbt.Logger)Unit">write</a>(<a href="#60873" title="=&gt; scala.collection.mutable.Map[String,Long]">succeeded</a>, <span title="java.lang.String(&quot;Successful Tests&quot;)" class="string">&quot;Successful Tests&quot;</span>, <a href="#60883" title="sbt.Path">path</a>, <a href="#60884" title="sbt.Logger">log</a>)
	}
}

<span class="keyword">private</span>[sbt] <span class="keyword">class</span> <a title="class TestQuickFilter extends java.lang.Object with (String) =&gt; Boolean with NotNull with ScalaObject" id="14671">TestQuickFilter</a>(<a title="sbt.CompileAnalysis" id="60854">testAnalysis</a>: <a href="../Analysis.scala.html#8627" title="sbt.CompileAnalysis">CompileAnalysis</a>, <a title="Boolean" id="60855">failedOnly</a>: <a title="Boolean" id="2106">Boolean</a>, <a title="sbt.Path" id="60856">path</a>: <a href="../Path.scala.html#11861" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="60857">log</a>: <a href="../Logger.scala.html#13532" title="sbt.Logger">Logger</a>) <span class="keyword">extends</span> (String =&gt; Boolean) <span class="keyword">with</span> <a title="NotNull" id="189">NotNull</a>
{
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[String,Long]" id="60850">exclude</a> = <a href="#14471" title="object sbt.impl.TestStatus">TestStatus</a>.<a href="#87755" title="(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]">read</a>(<a href="#60856" title="sbt.Path">path</a>, <a href="#60857" title="sbt.Logger">log</a>)
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[String,sbt.Path]" id="60852">map</a> = <a href="#60854" title="sbt.CompileAnalysis">testAnalysis</a>.<a href="../Analysis.scala.html#53432" title="=&gt; scala.collection.mutable.Map[String,sbt.Path]">testSourceMap</a>
	<span class="keyword">def</span> <a title="(String)Boolean" id="60853">apply</a>(<a title="String" id="87779">test</a>: <span title="String">String</span>) =
		<a href="#60849" title="=&gt; scala.collection.mutable.Map[String,Long]">exclude</a>.<a title="(String)Option[Long]" id="38037">get</a>(<a href="#87779" title="String">test</a>) <span title="Boolean" class="keyword">match</span>
		{
			<span title="Boolean(true)" class="keyword">case</span> <span title="object None">None</span> =&gt; <span title="Boolean(true)" class="keyword">true</span> <span class="comment">// include because this test has not been run or did not succeed</span>
			<span title="Boolean" class="keyword">case</span> Some(<a title="Long" id="87781">lastSuccessTime</a>) =&gt; <span class="comment">// succeeded the last time it was run</span>
				<span title="Boolean" class="keyword">if</span>(<a href="#60855" title="Boolean">failedOnly</a>)
					<span title="Boolean(false)" class="keyword">false</span> <span class="comment">// don't include because the last time succeeded</span>
				<span class="keyword">else</span>
					<a href="#60854" title="sbt.CompileAnalysis">testAnalysis</a>.<a href="../Analysis.scala.html#52091" title="(sbt.Path)Option[scala.collection.mutable.Set[sbt.Path]]">products</a>(<a href="#60851" title="(String)sbt.Path" id="38041">map</a>(<a href="#87779" title="String">test</a>)) <span title="Boolean" class="keyword">match</span>
					{
						<span title="Boolean(true)" class="keyword">case</span> <span title="object None">None</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
						<span title="Boolean" class="keyword">case</span> Some(<a title="scala.collection.mutable.Set[sbt.Path]" id="87786">products</a>) =&gt; <a href="#87786" title="scala.collection.mutable.Set[sbt.Path]">products</a>.<a title="((sbt.Path) =&gt; Boolean)Boolean" id="16150">exists</a>(<a href="#87781" title="Long">lastSuccessTime</a> <a title="(Long)Boolean" id="3206">&lt;=</a> <a href="#87788" title="sbt.Path">_</a>.<a href="../Path.scala.html#52346" title="=&gt; Long">lastModified</a>) <span class="comment">// include if the test is newer than the last run</span>
					}
		}
}
<span class="keyword">private</span> <span class="keyword">object</span> <a title="object sbt.impl.TestStatus" id="14471">TestStatus</a>
{
	<span class="keyword">import</span> java.util.Properties
	<span class="keyword">def</span> <a title="(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]" id="87755">read</a>(<a title="sbt.Path" id="87758">path</a>: <a href="../Path.scala.html#11861" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="87759">log</a>: <a href="../Logger.scala.html#13532" title="sbt.Logger">Logger</a>): <span title="scala.collection.mutable.Map[String,Long]">Map</span>[String, Long] =
	{
		<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,Long]" id="87791">map</a> = <span title="scala.collection.mutable.HashMap[String,Long]" class="keyword">new</span> <a title="scala.collection.mutable.HashMap[String,Long]" id="20417">HashMap</a>[String, Long]
		<span class="keyword">val</span> <a title="java.util.Properties" id="87792">properties</a> = <span title="java.util.Properties" class="keyword">new</span> <span title="java.util.Properties">Properties</span>
		<a href="#87757" title="(Option[String],String,sbt.Logger)Unit">logError</a>(<a href="MapUtilities.scala.html#14504" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="MapUtilities.scala.html#63192" title="(java.util.Properties,sbt.Path,sbt.Logger)Option[String]">load</a>(<a href="#87792" title="java.util.Properties">properties</a>, <a href="#87758" title="sbt.Path">path</a>, <a href="#87759" title="sbt.Logger">log</a>), <span title="java.lang.String(&quot;loading&quot;)" class="string">&quot;loading&quot;</span>, <a href="#87759" title="sbt.Logger">log</a>)
		<span class="keyword">for</span>(<a title="((String) =&gt; Unit)Unit" id="87803">test</a> &lt;- <a href="MapUtilities.scala.html#14504" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="MapUtilities.scala.html#63193" title="(java.util.Properties)Iterable[String]">propertyNames</a>(<a href="#87792" title="java.util.Properties">properties</a>))
			<a href="#87791" title="scala.collection.mutable.HashMap[String,Long]">map</a>.<a title="(String,Long)Option[Long]" id="38005">put</a>(<a href="#87803" title="String">test</a>, <a href="#87792" title="java.util.Properties">properties</a>.<a title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString" id="40387">getProperty</a>(<a href="#87803" title="String">test</a>).<a title="=&gt; Long" id="17524">toLong</a>)
		<a href="#87791" title="scala.collection.mutable.HashMap[String,Long]">map</a>
	}
	<span class="keyword">def</span> <a title="(scala.collection.mutable.Map[String,Long],String,sbt.Path,sbt.Logger)Unit" id="87756">write</a>(<a title="scala.collection.mutable.Map[String,Long]" id="87770">map</a>: <span title="scala.collection.mutable.Map[String,Long]">Map</span>[String, Long], <a title="String" id="87771">label</a>: <span title="String">String</span>, <a title="sbt.Path" id="87772">path</a>: <a href="../Path.scala.html#11861" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="87773">log</a>: <a href="../Logger.scala.html#13532" title="sbt.Logger">Logger</a>)
	{
		<span class="keyword">val</span> <a title="java.util.Properties" id="87809">properties</a> = <span title="java.util.Properties" class="keyword">new</span> <span title="java.util.Properties">Properties</span>
		<span class="keyword">for</span>( <a href="#87816" title="(((String, Long)) =&gt; Unit)Unit" id="16142">(</a><a title="String" id="87821">test</a>, <a title="Long" id="87822">lastSuccessTime</a>) &lt;- <a href="#87770" title="scala.collection.mutable.Map[String,Long]">map</a>)
			<a href="#87809" title="java.util.Properties">properties</a>.<a title="(java.lang.String,java.lang.String)java.lang.Object" id="40378">setProperty</a>(<a href="#87821" title="String">test</a>, <a href="#87822" title="Long">lastSuccessTime</a>.<a title="()java.lang.String" id="3439">toString</a>)
		<a href="#87757" title="(Option[String],String,sbt.Logger)Unit">logError</a>(<a href="MapUtilities.scala.html#14504" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="MapUtilities.scala.html#63191" title="(java.util.Properties,String,sbt.Path,sbt.Logger)Option[String]">write</a>(<a href="#87809" title="java.util.Properties">properties</a>, <a href="#87771" title="String">label</a>, <a href="#87772" title="sbt.Path">path</a>, <a href="#87773" title="sbt.Logger">log</a>), <span title="java.lang.String(&quot;writing&quot;)" class="string">&quot;writing&quot;</span>, <a href="#87773" title="sbt.Logger">log</a>)
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(Option[String],String,sbt.Logger)Unit" id="87757">logError</a>(<a title="Option[String]" id="87799">result</a>: <a title="Option[String]" id="897">Option</a>[String], <a title="String" id="87800">action</a>: <span title="String">String</span>, <a title="sbt.Logger" id="87801">log</a>: <a href="../Logger.scala.html#13532" title="sbt.Logger">Logger</a>)
	{
		<a href="#87799" title="Option[String]">result</a>.<a title="((String) =&gt; Unit)Unit" id="30538">foreach</a>(<a title="String" id="87824">msg</a> =&gt; <a href="#87801" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#52377" title="(=&gt; String)Unit">error</a>(<span title="java.lang.String(&quot;Error &quot;)" class="string">&quot;Error &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#87800" title="String">action</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; test status: &quot;)" class="string">&quot; test status: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#87824" title="String">msg</a>))
	}
}
        </pre>
    </body>
</html>