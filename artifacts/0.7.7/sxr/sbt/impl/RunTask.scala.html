<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/impl/RunTask.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009  Mark Harrah
 */</span>
 <span class="keyword">package</span> sbt.impl
 <span class="keyword">import</span> sbt._

<span class="keyword">import</span> scala.collection.{immutable, mutable}
<span class="keyword">import</span> scala.collection.Map
<span class="keyword">import</span> sbt.wrap.Wrappers.identityMap

<span class="keyword">private</span>[sbt] <span class="keyword">object</span> <a title="object sbt.impl.RunTask" id="14486">RunTask</a>
{
	<span class="keyword">final</span> <span class="keyword">type</span> <a title="sbt.Project#Task" id="75314">Task</a> = Project#<a href="../TaskManager.scala.html#53833" title="sbt.Project#Task">Task</a>
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="75315">apply</a>(<a title="sbt.impl.RunTask.Task" id="75328">root</a>: <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="75329">rootName</a>: <span title="String">String</span>): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]]  = <a href="#75316" title="(sbt.impl.RunTask.Task,String,Boolean)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">apply</a>(<a href="#75328" title="sbt.impl.RunTask.Task">root</a>, <a href="#75329" title="String">rootName</a>, <span title="Boolean(true)" class="keyword">true</span>)
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String,Boolean)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="75316">apply</a>(<a title="sbt.impl.RunTask.Task" id="75325">root</a>: <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="75326">rootName</a>: <span title="String">String</span>, <a title="Boolean" id="75327">parallelExecution</a>: <a title="Boolean" id="2106">Boolean</a>): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]] =
		<a href="#75317" title="(sbt.impl.RunTask.Task,String,Int)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">apply</a>(<a href="#75325" title="sbt.impl.RunTask.Task">root</a>, <a href="#75326" title="String">rootName</a>, <span title="Int" class="keyword">if</span>(<a href="#75327" title="Boolean">parallelExecution</a>) <a title="object java.lang.Runtime" id="1690">Runtime</a>.<a title="()java.lang.Runtime" id="60921">getRuntime</a>.<a title="()Int" id="60933">availableProcessors</a> <span class="keyword">else</span> <span title="Int(1)" class="int">1</span>)
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String,Int)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="75317">apply</a>(<a title="sbt.impl.RunTask.Task" id="75320">root</a>: <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="75321">rootName</a>: <span title="String">String</span>, <a title="Int" id="75322">maximumTasks</a>: <span title="Int">Int</span>): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]]  = (<span title="sbt.impl.RunTask" class="keyword">new</span> <a href="#14485" title="sbt.impl.RunTask">RunTask</a>(<a href="#75320" title="sbt.impl.RunTask.Task">root</a>, <a href="#75321" title="String">rootName</a>, <a href="#75322" title="Int">maximumTasks</a>)).<a href="#87244" title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">run</a>()
}
<span class="keyword">import</span> RunTask._
<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class RunTask extends java.lang.Object with NotNull with ScalaObject" id="14485">RunTask</a>(<a title="sbt.impl.RunTask.Task" id="87286">root</a>: <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="87287">rootName</a>: <span title="String">String</span>, <a title="Int" id="87288">maximumTasks</a>: <span title="Int">Int</span>) <span class="keyword">extends</span> <a title="NotNull" id="189">NotNull</a>
{
	<a title="(Boolean)Unit" id="6479">require</a>(<a href="#87288" title="Int">maximumTasks</a> <span title="(Int)Boolean">&gt;=</span> <span title="Int(1)" class="int">1</span>)
	<span class="keyword">def</span> <a title="=&gt; Boolean" id="87242">parallel</a> = <a href="#87288" title="Int">maximumTasks</a> <a title="(Int)Boolean" id="3084">&gt;</a> <span title="Int(1)" class="int">1</span>
	<span class="keyword">def</span> <a title="=&gt; Boolean" id="87243">multiProject</a> = <a href="#87277" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>.<a title="=&gt; Int" id="18160">size</a> <span title="(Int)Boolean">&gt;=</span> <span title="Int(2)" class="int">2</span>
	<span class="keyword">def</span> <a title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="87244">run</a>(): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]]  =
	{
		<span class="keyword">try</span>
		{
			<a href="#87245" title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">runTasksExceptRoot</a>() <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">match</span>
			{
				<span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">case</span> <span title="object Nil">Nil</span> =&gt;
					<span class="keyword">val</span> <a title="Option[String]" id="87449">result</a> = <a href="#87253" title="(sbt.impl.RunTask.Task,String)Option[String]">runTask</a>(<a href="#87286" title="sbt.impl.RunTask.Task">root</a>, <a href="#87287" title="String">rootName</a>)
					<a href="#87449" title="Option[String]">result</a>.<span title="((String) =&gt; sbt.WorkFailure[sbt.impl.RunTask.Task])Option[sbt.WorkFailure[sbt.impl.RunTask.Task]]">map</span>( <a title="String" id="87454">errorMessage</a> =&gt; <a href="../ParallelRunner.scala.html#72385" title="(sbt.impl.RunTask.Task,String)sbt.WorkFailure[sbt.impl.RunTask.Task]">WorkFailure</a>(<a href="#87286" title="sbt.impl.RunTask.Task">root</a>, <span title="java.lang.String(&quot;Error running &quot;)" class="string">&quot;Error running &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#87287" title="String">rootName</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#87454" title="String">errorMessage</a>) ).<a title="=&gt; List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="30542">toList</a>
				<span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">case</span> <a title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="87460">failures</a> =&gt; <a href="#87460" title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">failures</a>
			}
		}
		<span class="keyword">finally</span>
		{
			<span class="keyword">for</span>(<a title="((sbt.Project#ManagerType) =&gt; Unit)Unit" id="87462">project</a> &lt;- <a href="#87277" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>; <a title="((String) =&gt; Unit)Unit" id="87464">saveError</a> &lt;- <a href="#87462" title="sbt.Project#ManagerType">project</a>.<a href="../Environment.scala.html#54318" title="()Option[String]">saveEnvironment</a>)
				<a href="#87462" title="sbt.Project#ManagerType">project</a>.<a href="../Project.scala.html#53842" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#52376" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;Could not save properties for project &quot;)" class="string">&quot;Could not save properties for project &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#87462" title="sbt.Project#ManagerType">project</a>.<a href="../Project.scala.html#53848" title="=&gt; String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#87464" title="String">saveError</a>)
		}
	}
	<span class="comment">// This runs all tasks except the root.task.</span>
	<span class="comment">// It uses a buffered logger in record mode to ensure that all output for a given task is consecutive</span>
	<span class="comment">// it ignores the root task so that the root task may be run with buffering disabled so that the output</span>
	<span class="comment">// occurs without delay.</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="87245">runTasksExceptRoot</a>() =
		<a href="../ParallelRunner.scala.html#8445" title="object sbt.ParallelRunner">ParallelRunner</a>.<a href="../ParallelRunner.scala.html#72279" title="(sbt.impl.RunTask.Task,(sbt.impl.RunTask.Task) =&gt; String,(sbt.impl.RunTask.Task) =&gt; Option[String],Int,(sbt.impl.RunTask.Task) =&gt; sbt.Logger)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">run</a>(<a href="#87273" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>, <a href="#87265" title="(sbt.impl.RunTask.Task)String">expandedTaskName</a>, <a href="#87247" title="(sbt.impl.RunTask.Task)Option[String]">runIfNotRoot</a>, <a href="#87288" title="Int">maximumTasks</a>, (<a title="sbt.impl.RunTask.Task" id="87442">t</a>: <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>) =&gt; <a href="#87442" title="sbt.impl.RunTask.Task">t</a>.<a href="../TaskManager.scala.html#55203" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#53842" title="=&gt; sbt.Logger">log</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="((sbt.BufferedLogger) =&gt; Unit)Unit" id="87246">withBuffered</a>(<a title="(sbt.BufferedLogger) =&gt; Unit" id="87466">f</a>: BufferedLogger =&gt; Unit)
	{
		<span class="keyword">for</span>(<a title="((sbt.BufferedLogger) =&gt; Unit)Unit" id="87468">buffered</a> &lt;- <a href="#87279" title="=&gt; List[sbt.BufferedLogger]">bufferedLoggers</a>)
			<a href="../Control.scala.html#13545" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#53226" title="(=&gt; Unit)Unit">trap</a>(<a href="#87466" title="(sbt.BufferedLogger)Unit" id="16113">f</a>(<a href="#87468" title="sbt.BufferedLogger">buffered</a>))
	}
	<span class="comment">/** Will be called in its own thread. Runs the given task if it is not the root task.*/</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Option[String]" id="87247">runIfNotRoot</a>(<a title="sbt.impl.RunTask.Task" id="87438">action</a>: <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>): <span title="Option[String]">Option</span>[String] =
	{
		<span title="Option[String]" class="keyword">if</span>(<a href="#87252" title="(sbt.impl.RunTask.Task)Boolean">isRoot</a>(<a href="#87438" title="sbt.impl.RunTask.Task">action</a>))
			<span title="object None">None</span>
		<span class="keyword">else</span>
			<a href="#87253" title="(sbt.impl.RunTask.Task,String)Option[String]">runTask</a>(<a href="#87438" title="sbt.impl.RunTask.Task">action</a>, <a href="#87265" title="(sbt.impl.RunTask.Task)String">expandedTaskName</a>(<a href="#87438" title="sbt.impl.RunTask.Task">action</a>))
	}
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="87248">headerStart</a> = <span title="object java.lang.System">System</span>.<span title="(java.lang.String,java.lang.String)java.lang.String">getProperty</span>(<span title="java.lang.String(&quot;sbt.start.delimiter&quot;)" class="string">&quot;sbt.start.delimiter&quot;</span>, <span title="java.lang.String(&quot;==&quot;)" class="string">&quot;==&quot;</span>)
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="87250">headerEnd</a> = <span title="object java.lang.System">System</span>.<span title="(java.lang.String,java.lang.String)java.lang.String">getProperty</span>(<span title="java.lang.String(&quot;sbt.end.delimiter&quot;)" class="string">&quot;sbt.end.delimiter&quot;</span>, <span title="java.lang.String(&quot;==&quot;)" class="string">&quot;==&quot;</span>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Boolean" id="87252">isRoot</a>(<a title="sbt.impl.RunTask.Task" id="87471">t</a>: <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>) = <a href="#87471" title="sbt.impl.RunTask.Task">t</a> <span title="(AnyRef)Boolean">==</span> <a href="#87273" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>
	<span class="comment">/** Will be called in its own thread except for the root task. */</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String)Option[String]" id="87253">runTask</a>(<a title="sbt.impl.RunTask.Task" id="87450">action</a>: <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="87451">actionName</a>: <span title="String">String</span>): <span title="Option[String]">Option</span>[String] =
	{
		<span class="keyword">val</span> <a title="java.lang.String" id="87474">label</a> = <span title="java.lang.String" class="keyword">if</span>(<a href="#87243" title="=&gt; Boolean">multiProject</a>) (<a href="#87450" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#55203" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#53848" title="=&gt; String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; / &quot;)" class="string">&quot; / &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#87451" title="String">actionName</a>) <span class="keyword">else</span> <a href="#87451" title="String">actionName</a>
		<span class="keyword">def</span> <a title="(sbt.ControlEvent.Value,String,String)Unit" id="87475">banner</a>(<a title="sbt.ControlEvent.Value" id="87480">event</a>: ControlEvent.<a title="sbt.ControlEvent.Value" id="34036">Value</a>, <a title="String" id="87481">firstSeparator</a>: <span title="String">String</span>, <a title="String" id="87482">secondSeparator</a>: <span title="String">String</span>) =
			<a href="../Control.scala.html#13545" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#53226" title="(=&gt; Unit)Unit">trap</a>(<a href="#87450" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#55203" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#53842" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#52380" title="(sbt.ControlEvent.Value,=&gt; String)Unit">control</a>(<a href="#87480" title="sbt.ControlEvent.Value">event</a>, <a href="#87481" title="String">firstSeparator</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#87474" title="java.lang.String">label</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#87482" title="String">secondSeparator</a>))
		<span class="keyword">val</span> <a title="Boolean" id="87476">buffered</a> = <a href="#87242" title="=&gt; Boolean">parallel</a> <a title="(Boolean)Boolean" id="2690">&amp;&amp;</a> <a title="=&gt; Boolean" id="2686">!</a><a href="#87252" title="(sbt.impl.RunTask.Task)Boolean">isRoot</a>(<a href="#87450" title="sbt.impl.RunTask.Task">action</a>)
		<span title="Unit" class="keyword">if</span>(<a href="#87476" title="Boolean">buffered</a>)
			<a href="#87475" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#12201" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#67648" title="=&gt; sbt.ControlEvent.Value">Start</a>, <span title="java.lang.String(&quot;\012  &quot;)" class="string">&quot;\n  &quot;</span>, <span title="java.lang.String(&quot;...&quot;)" class="string">&quot;...&quot;</span>)
		<span class="keyword">def</span> <a title="()Option[String]" id="87477">doRun</a>() =
		{
			<a href="#87475" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#12201" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#67650" title="=&gt; sbt.ControlEvent.Value">Header</a>, <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#87248" title="=&gt; java.lang.String">headerStart</a>, <a href="#87248" title="=&gt; java.lang.String">headerStart</a>)
			<span class="keyword">try</span> { <a href="#87450" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#55211" title="=&gt; Option[String]">invoke</a> }
			<span class="keyword">catch</span> { <span title="Some[java.lang.String]" class="keyword">case</span> <a title="Exception" id="87488">e</a>: <a title="Exception" id="2067">Exception</a> =&gt; <a href="#87450" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#55203" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#53842" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#52372" title="(=&gt; Throwable)Unit">trace</a>(<a href="#87488" title="Exception">e</a>); <span title="(java.lang.String)Some[java.lang.String]">Some</span>(<a href="#87488" title="Exception">e</a>.<a title="()java.lang.String" id="18029">toString</a>) }
			<span class="keyword">finally</span> { <a href="#87475" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#12201" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#67652" title="=&gt; sbt.ControlEvent.Value">Finish</a>, <a href="#87250" title="=&gt; java.lang.String">headerEnd</a>, <a href="#87250" title="=&gt; java.lang.String">headerEnd</a>) }
		}
		
		<span title="Option[String]" class="keyword">if</span>(<a href="#87476" title="Boolean">buffered</a>)
			<a href="#87254" title="(sbt.impl.RunTask.Task,=&gt; Option[String])Option[String]">bufferLogging</a>(<a href="#87450" title="sbt.impl.RunTask.Task">action</a>, <a href="#87477" title="()Option[String]">doRun</a>())
		<span class="keyword">else</span>
			<a href="#87477" title="()Option[String]">doRun</a>()
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](sbt.impl.RunTask.Task,=&gt; T)T" id="87254">bufferLogging</a>[<a title="&gt;: Nothing &lt;: Any" id="87256">T</a>](<a title="sbt.impl.RunTask.Task" id="87495">action</a>: <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>, <a title="=&gt; T" id="87496">f</a>: =&gt; T) =
		<a href="#87285" title="(sbt.Project)Option[sbt.BufferedLogger]">bufferedLogger</a>(<a href="#87495" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#55203" title="=&gt; sbt.Project#ManagerType">manager</a>) <span title="T" class="keyword">match</span>
		{
			<span title="T" class="keyword">case</span> <a id="1">Some</a>(<a title="sbt.BufferedLogger" id="87500">buffered</a>) =&gt; <a href="#87500" title="sbt.BufferedLogger">buffered</a>.<a href="../Logger.scala.html#67894" title="(=&gt; T)T">buffer</a> { <a href="#87496" title="=&gt; T">f</a> }
			<span title="T" class="keyword">case</span> <span title="object None">None</span> =&gt; <a href="#87496" title="=&gt; T">f</a>
		}
	
	<span class="comment">/* Most of the following is for implicitly adding dependencies (see the expand method)*/</span>
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.Project,Iterable[sbt.Project]]" id="87257">projectDependencyCache</a> = <a href="../wrap/Wrappers.scala.html#52443" title="sbt.wrap.MutableMapWrapper[sbt.Project,Iterable[sbt.Project]]">identityMap</a>[<a href="../Project.scala.html#9290" title="sbt.Project">Project</a>, <a title="Iterable[sbt.Project]" id="372">Iterable</a>[Project]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)Iterable[sbt.Project]" id="87259">dependencies</a>(<a title="sbt.Project" id="87503">project</a>: <a href="../Project.scala.html#9290" title="sbt.Project">Project</a>) = <a href="#87257" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.Project,Iterable[sbt.Project]]">projectDependencyCache</a>.<a href="../wrap/Wrappers.scala.html#67941" title="(sbt.Project,=&gt; Iterable[sbt.Project])Iterable[sbt.Project]">getOrElseUpdate</a>(<a href="#87503" title="sbt.Project">project</a>, <a href="#87503" title="sbt.Project">project</a>.<a href="../Dag.scala.html#54236" title="=&gt; List[sbt.Project]">topologicalSort</a>.<a title="(Int)List[sbt.Project]" id="15720">dropRight</a>(<span title="Int(1)" class="int">1</span>))

	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]" id="87260">expandedCache</a> = <a href="../wrap/Wrappers.scala.html#52443" title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]">identityMap</a>[<a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>, <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="87262">expanded</a>(<a title="sbt.impl.RunTask.Task" id="87505">task</a>: <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a> = <a href="#87260" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]">expandedCache</a>.<a href="../wrap/Wrappers.scala.html#67941" title="(sbt.impl.RunTask.Task,=&gt; sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">getOrElseUpdate</a>(<a href="#87505" title="sbt.impl.RunTask.Task">task</a>, <a href="#87282" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expandImpl</a>(<a href="#87505" title="sbt.impl.RunTask.Task">task</a>))

	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]" id="87263">expandedTaskNameCache</a> = <a href="../wrap/Wrappers.scala.html#52443" title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]">identityMap</a>[<a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>, <span title="String">String</span>]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)String" id="87265">expandedTaskName</a>(<a title="sbt.impl.RunTask.Task" id="87425">task</a>: <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>) =
		<span title="String" class="keyword">if</span>(<a href="#87425" title="sbt.impl.RunTask.Task">task</a> <span title="(AnyRef)Boolean">==</span> <a href="#87273" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>)
			<a href="#87287" title="String">rootName</a>
		<span class="keyword">else</span>
			<a href="#87263" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]">expandedTaskNameCache</a>.<a href="../wrap/Wrappers.scala.html#67926" title="(sbt.impl.RunTask.Task,=&gt; String)String">getOrElse</a>(<a href="#87425" title="sbt.impl.RunTask.Task">task</a>, <a href="#87425" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#55204" title="=&gt; String">name</a>)

	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]" id="87266">nameToTaskCache</a> = <a href="../wrap/Wrappers.scala.html#52443" title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]">identityMap</a>[<a href="../Project.scala.html#9290" title="sbt.Project">Project</a>, <span title="scala.collection.Map[String,sbt.impl.RunTask.Task]">Map</span>[String, Task]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]" id="87268">nameToTaskMap</a>(<a title="sbt.Project" id="87507">project</a>: <a href="../Project.scala.html#9290" title="sbt.Project">Project</a>): <span title="scala.collection.Map[String,sbt.impl.RunTask.Task]">Map</span>[String, Task] = <a href="#87266" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]">nameToTaskCache</a>.<a href="../wrap/Wrappers.scala.html#67941" title="(sbt.Project,=&gt; scala.collection.Map[String,sbt.impl.RunTask.Task])scala.collection.Map[String,sbt.impl.RunTask.Task]">getOrElseUpdate</a>(<a href="#87507" title="sbt.Project">project</a>, <a href="#87507" title="sbt.Project">project</a>.<a href="../Project.scala.html#53854" title="=&gt; scala.collection.Map[String,project.ManagedTask]">tasks</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project,String)Option[sbt.impl.RunTask.Task]" id="87269">taskForName</a>(<a title="sbt.Project" id="87508">project</a>: <a href="../Project.scala.html#9290" title="sbt.Project">Project</a>, <a title="String" id="87509">name</a>: <span title="String">String</span>): <span title="Option[sbt.impl.RunTask.Task]">Option</span>[Task] = <a href="#87268" title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]">nameToTaskMap</a>(<a href="#87508" title="sbt.Project">project</a>).<span title="(String)Option[sbt.impl.RunTask.Task]">get</span>(<a href="#87509" title="String">name</a>)
	
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]" id="87270">taskNameCache</a> = <a href="../wrap/Wrappers.scala.html#52443" title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]">identityMap</a>[<a href="../Project.scala.html#9290" title="sbt.Project">Project</a>, <span title="scala.collection.Map[sbt.impl.RunTask.Task,String]">Map</span>[Task, String]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Option[String]" id="87272">taskName</a>(<a title="sbt.impl.RunTask.Task" id="87510">task</a>: <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>) =
	{
		<span class="keyword">val</span> <a title="sbt.Project#ManagerType" id="87512">project</a> = <a href="#87510" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#55203" title="=&gt; sbt.Project#ManagerType">manager</a>
		<a href="#87270" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]">taskNameCache</a>.<a href="../wrap/Wrappers.scala.html#67941" title="(sbt.Project,=&gt; scala.collection.Map[sbt.impl.RunTask.Task,String])scala.collection.Map[sbt.impl.RunTask.Task,String]">getOrElseUpdate</a>(<a href="#87512" title="sbt.Project#ManagerType">project</a>, <a href="#87284" title="(sbt.Project)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]">taskNameMap</a>(<a href="#87512" title="sbt.Project#ManagerType">project</a>)).<span title="(sbt.impl.RunTask.Task)Option[String]">get</span>(<a href="#87510" title="sbt.impl.RunTask.Task">task</a>)
	}
	
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.impl.RunTask.Task" id="87273">expandedRoot</a> = <a href="#87281" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expand</a>(<a href="#87286" title="sbt.impl.RunTask.Task">root</a>)
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="List[sbt.Project#ManagedTask]" id="87275">allTasks</a> = <a href="#87273" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>.<a href="../Dag.scala.html#54236" title="=&gt; List[sbt.Project#ManagedTask]">topologicalSort</a>
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Project#ManagerType]" id="87277">allProjects</a> = <a title="(sbt.Project#ManagerType*)scala.collection.immutable.Set[sbt.Project#ManagerType]" id="6470">Set</a>(<a href="#87275" title="=&gt; List[sbt.Project#ManagedTask]">allTasks</a>.<span title="((sbt.Project#ManagedTask) =&gt; sbt.Project#ManagerType)List[sbt.Project#ManagerType]">map</span>(<a href="#87402" title="sbt.Project#ManagedTask">_</a>.<a href="../TaskManager.scala.html#55203" title="=&gt; sbt.Project#ManagerType">manager</a>).<span title="=&gt; Seq[sbt.Project#ManagerType]">toSeq</span> : _*)
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="List[sbt.BufferedLogger]" id="87279">bufferedLoggers</a> = <span title="List[sbt.BufferedLogger]" class="keyword">if</span>(<a href="#87242" title="=&gt; Boolean">parallel</a>) <a href="#87277" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>.<span title="=&gt; List[sbt.Project#ManagerType]">toList</span>.<a title="((sbt.Project#ManagerType) =&gt; Iterable[sbt.BufferedLogger])List[sbt.BufferedLogger]" id="15748">flatMap</a>(<a href="#87285" title="(Option[sbt.BufferedLogger])Iterable[sbt.BufferedLogger]">bufferedLogger</a>) <span class="keyword">else</span> <span title="object Nil">Nil</span>
	
	<span class="comment">/** Adds implicit dependencies, which are tasks with the same name in the project dependencies
	* of the enclosing project of the task.*/</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="87281">expand</a>(<a title="sbt.impl.RunTask.Task" id="87394">root</a>: <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a> = <a href="#87262" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expanded</a>(<a href="#87394" title="sbt.impl.RunTask.Task">root</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="87282">expandImpl</a>(<a title="sbt.impl.RunTask.Task" id="87506">task</a>: <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#53833" title="sbt.impl.RunTask.Task">Task</a> =
	{
		<span class="keyword">val</span> <a title="Option[String]" id="87522">nameOption</a> = <a href="#87272" title="(sbt.impl.RunTask.Task)Option[String]">taskName</a>(<a href="#87506" title="sbt.impl.RunTask.Task">task</a>)
		<span class="keyword">val</span> <a title="List[sbt.Project#ManagedTask]" id="87523">explicitDependencies</a> = <a href="#87506" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#55196" title="=&gt; List[sbt.Project#ManagedTask]">dependencies</a>
		<span class="keyword">val</span> <a title="Iterable[sbt.impl.RunTask.Task]" id="87524">implicitDependencies</a> = <a href="#87522" title="Option[String]">nameOption</a>.<span title="((String) =&gt; Iterable[sbt.impl.RunTask.Task])Option[Iterable[sbt.impl.RunTask.Task]]">map</span>(<a title="String" id="87537">name</a> =&gt; <a href="#87259" title="(sbt.Project)Iterable[sbt.Project]">dependencies</a>(<a href="#87506" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#55203" title="=&gt; sbt.Project#ManagerType">manager</a>).<a title="((sbt.Project) =&gt; Iterable[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]" id="16140">flatMap</a>(<a href="#87283" title="(Option[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]">noninteractiveTask</a>(<a href="#87537" title="String">name</a>)) ).<a title="(=&gt; Iterable[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]" id="30531">getOrElse</a>(<span title="object Nil">Nil</span>)
		<span class="keyword">val</span> <a title="scala.collection.mutable.Set[sbt.Project#ManagedTask]" id="87525">allDependencies</a> = mutable.<a title="(sbt.Project#ManagedTask*)scala.collection.mutable.Set[sbt.Project#ManagedTask]" id="20235">HashSet</a>( (<a href="#87523" title="List[sbt.Project#ManagedTask]">explicitDependencies</a> <a title="(Iterable[sbt.Project#ManagedTask])List[sbt.Project#ManagedTask]" id="15706">++</a> <a href="#87524" title="Iterable[sbt.impl.RunTask.Task]">implicitDependencies</a>).<span title="=&gt; Seq[sbt.Project#ManagedTask]">toSeq</span>  : _* )
		<span class="keyword">val</span> <a title="sbt.Project#Task" id="87526">expandedTask</a> = <a href="#87506" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#55209" title="((List[_184.ManagedTask])_184.Task) forSome { val _184: sbt.Project }">setDependencies</a>(<a href="#87525" title="scala.collection.mutable.Set[sbt.Project#ManagedTask]">allDependencies</a>.<span title="=&gt; List[sbt.Project#ManagedTask]">toList</span>.<span title="((sbt.Project#ManagedTask) =&gt; sbt.impl.RunTask.Task)List[sbt.impl.RunTask.Task]">map</span>(<a href="#87262" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expanded</a>))
		<a href="#87522" title="Option[String]">nameOption</a>.<span title="((String) =&gt; Unit)Unit">foreach</span>(<a title="String" id="87570">name</a> =&gt; <a href="#87263" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]">expandedTaskNameCache</a>(<a href="#87526" title="sbt.Project#Task">expandedTask</a>) = <a href="#87570" title="String">name</a>)
		<a href="#87526" title="sbt.Project#Task">expandedTask</a>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String)(sbt.Project)Option[sbt.impl.RunTask.Task]" id="87283">noninteractiveTask</a>(<a title="String" id="87541">name</a>: <span title="String">String</span>)(<a title="sbt.Project" id="87542">project</a>: <a href="../Project.scala.html#9290" title="sbt.Project">Project</a>): <span title="Option[sbt.impl.RunTask.Task]">Option</span>[Task] =
		<a href="#87269" title="(sbt.Project,String)Option[sbt.impl.RunTask.Task]">taskForName</a>(<a href="#87542" title="sbt.Project">project</a>, <a href="#87541" title="String">name</a>) <a title="((sbt.impl.RunTask.Task) =&gt; Option[sbt.impl.RunTask.Task])Option[sbt.impl.RunTask.Task]" id="30535">flatMap</a> { <a title="sbt.impl.RunTask.Task" id="87573">task</a> =&gt;
			<span title="Option[sbt.impl.RunTask.Task]" class="keyword">if</span>(<a href="#87573" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#55198" title="=&gt; Boolean">interactive</a>)
			{
				<a href="#87542" title="sbt.Project">project</a>.<a href="../Project.scala.html#53842" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#52374" title="(=&gt; String)Unit">debug</a>(<span title="java.lang.String(&quot;Not including task &quot;)" class="string">&quot;Not including task &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#87541" title="String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; in project &quot;)" class="string">&quot; in project &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#87542" title="sbt.Project">project</a>.<a href="../Project.scala.html#53848" title="=&gt; String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: interactive tasks can only be run directly.&quot;)" class="string">&quot;: interactive tasks can only be run directly.&quot;</span>)
				<span title="object None">None</span>
			}
			<span class="keyword">else</span>
				<span title="(sbt.impl.RunTask.Task)Some[sbt.impl.RunTask.Task]">Some</span>(<a href="#87573" title="sbt.impl.RunTask.Task">task</a>)
		}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]" id="87284">taskNameMap</a>(<a title="sbt.Project" id="87515">project</a>: <a href="../Project.scala.html#9290" title="sbt.Project">Project</a>) = mutable.<a title="((sbt.impl.RunTask.Task, String)*)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]" id="20220">Map</a>(<a href="#87268" title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]">nameToTaskMap</a>(<a href="#87515" title="sbt.Project">project</a>).<a title="(((String, sbt.impl.RunTask.Task)) =&gt; (sbt.impl.RunTask.Task, String))Iterable[(sbt.impl.RunTask.Task, String)]" id="16138">map</a>(<a href="#87521" title="(String, sbt.impl.RunTask.Task)">_</a>.<a title="=&gt; (sbt.impl.RunTask.Task, String)" id="17998">swap</a>).<a title="=&gt; Seq[(sbt.impl.RunTask.Task, String)]" id="16172">toSeq</a> : _*)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)Option[sbt.BufferedLogger]" id="87285">bufferedLogger</a>(<a title="sbt.Project" id="87411">project</a>: <a href="../Project.scala.html#9290" title="sbt.Project">Project</a>): <span title="Option[sbt.BufferedLogger]">Option</span>[BufferedLogger] =
		<a href="#87411" title="sbt.Project">project</a>.<a href="../Project.scala.html#53842" title="=&gt; sbt.Logger">log</a> <span title="Option[sbt.BufferedLogger]" class="keyword">match</span>
		{
			<span title="Some[sbt.BufferedLogger]" class="keyword">case</span> <a title="sbt.BufferedLogger" id="87576">buffered</a>: <a href="../Logger.scala.html#8060" title="sbt.BufferedLogger">BufferedLogger</a> =&gt; <span title="(sbt.BufferedLogger)Some[sbt.BufferedLogger]">Some</span>(<a href="#87576" title="sbt.BufferedLogger">buffered</a>)
			<span title="None.type" class="keyword">case</span> _ =&gt; <span title="object None">None</span>
		}
}
        </pre>
    </body>
</html>