<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/Update.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2010 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="comment">/** A trait that provides a task for updating sbt.  */</span>
<span class="keyword">trait</span> <a title="trait UpdateSbt extends java.lang.Object with sbt.Project with ScalaObject" id="10497">UpdateSbt</a> <span class="keyword">extends</span> <a href="Project.scala.html#9291" title="sbt.Project">Project</a>
{
	<span class="comment">/** The first argument is the version to update to and is mandatory.
	* The second argument is the location of the launcher jar.  If omitted, the launcher used to launch the currently running instance of sbt is used.*/</span>
	<span class="keyword">lazy</span> <span class="keyword">val</span> <a title="UpdateSbt.this.MethodTask" id="79563">sbtUpdate</a> = <a href="TaskManager.scala.html#50839" title="((Array[String]) =&gt; UpdateSbt.this.ManagedTask)UpdateSbt.this.MethodTask">task</a> { <a title="Array[String]" id="79572">args</a> =&gt; <a href="TaskManager.scala.html#50837" title="(=&gt; Option[String])UpdateSbt.this.Task">task</a> { (<a href="#79594" title="(Array[String])Option[String]" class="keyword">new</a> <a href="#10263" title="sbt.Update">Update</a>(<a href="#10497" title="sbt.UpdateSbt" class="keyword">this</a>))(<a href="#79572" title="Array[String]">args</a>) } } <a href="TaskManager.scala.html#52187" title="(String)UpdateSbt.this.MethodTask">describedAs</a>(<span title="java.lang.String(&quot;Updates the version of sbt used to build this project and updates the launcher jar.&quot;)" class="string">&quot;Updates the version of sbt used to build this project and updates the launcher jar.&quot;</span>)
}

<span class="keyword">import</span> java.io.{File, InputStream, IOException}
<span class="keyword">import</span> java.net.{HttpURLConnection, URL}
<span class="keyword">import</span> HttpURLConnection.{HTTP_NOT_FOUND , HTTP_OK}
<span class="keyword">import</span> SimpleReader.readLine
<span class="keyword">import</span> xsbt.FileUtilities.{classLocationFile, copyFile, readLines, transfer, unzip, withTemporaryDirectory, write, zip}
<span class="keyword">import</span> xsbt.PathMapper.relativeTo
<span class="keyword">import</span> xsbt.Paths._
<span class="keyword">import</span> xsbt.OpenResource.{fileOutputStream, urlInputStream}

<span class="keyword">private</span> <span class="keyword">class</span> <a title="class Update extends java.lang.Object with ScalaObject" id="10263">Update</a>(<a title="sbt.Project" id="79614">project</a>: <a href="Project.scala.html#9291" title="sbt.Project">Project</a>)
{
	<span class="keyword">val</span> <a title="sbt.ProjectInfo" id="79585">info</a> = <a href="#79614" title="sbt.Project">project</a>.<a href="Project.scala.html#50857" title="=&gt; sbt.ProjectInfo">info</a>
	<span class="keyword">val</span> <a title="xsbti.AppProvider" id="79587">app</a> = <a href="#79585" title="=&gt; sbt.ProjectInfo">info</a>.<a href="ProjectInfo.scala.html#52147" title="=&gt; xsbti.AppProvider">app</a>
	<span class="keyword">val</span> <a title="sbt.Logger" id="79589">log</a> = <a href="#79614" title="sbt.Project">project</a>.<a href="Project.scala.html#50852" title="=&gt; sbt.Logger">log</a>
	
	<span class="comment">/** The location of the jar used to launch the currently running instance of sbt.*/</span>
	<span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.io.File" id="79592">launcherJar</a> = <a href="../FileUtilities.scala.html#18224" title="(implicit scala.reflect.Manifest[xsbti.AppProvider])java.io.File" id="2655">classLocationFile</a>[xsbti.<a href="../xsbti/AppProvider.java.html#7628" title="xsbti.AppProvider">AppProvider</a>]
	<span class="comment">/** A temporary jar file to use in the given directory. */</span>
	<span class="keyword">def</span> <a title="(java.io.File)java.io.File" id="79593">tempJar</a>(<a title="java.io.File" id="79702">dir</a>: <span title="java.io.File">File</span>) = <a href="../Paths.scala.html#20622" title="implicit xsbt.Paths.fileToPath : (java.io.File)xsbt.Path">dir</a> <a href="../Paths.scala.html#20670" title="(String)java.io.File">/</a> <a href="#79591" title="=&gt; java.io.File">launcherJar</a>.<span title="()java.lang.String">getName</span>
		
	<span class="comment">/** Implementation of the sbt-update task: reads arguments and hands off to the other `apply`.*/</span>
	<span class="keyword">def</span> <a title="(Array[String])Option[String]" id="79594">apply</a>(<a title="Array[String]" id="79688">args</a>: <a title="Array[String]" id="1036">Array</a>[String]): <span title="Option[String]">Option</span>[String] =
		<a href="#79688" title="Array[String]">args</a> <span title="Option[String]" class="keyword">match</span>
		{
			<span title="Option[String]" class="keyword">case</span> <a href="#79727" title="(Array[String])Option[Seq[String]]">Array</a>(<a title="String" id="79730">version</a>) <span class="keyword">if</span> <a href="#79595" title="(String)Boolean">validVersion</a>(<a href="#79730" title="String">version</a>) =&gt; <a href="#79596" title="(String,Option[java.io.File])Option[String]">apply</a>(<a href="#79730" title="String">version</a>, <span title="object None">None</span>)
			<span title="Option[String]" class="keyword">case</span> <a href="#79752" title="(Array[String])Option[Seq[String]]">Array</a>(<a title="String" id="79755">version</a>, <a title="String" id="79756">temporaryJar</a>) <span class="keyword">if</span> <a href="#79595" title="(String)Boolean">validVersion</a>(<a href="#79755" title="String">version</a>) =&gt; <a href="#79596" title="(String,Option[java.io.File])Option[String]">apply</a>(<a href="#79755" title="String">version</a>, <span title="(java.io.File)Some[java.io.File]">Some</span>(<span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span>(<a href="#79756" title="String">temporaryJar</a>) <a title="()java.io.File" id="16765">getAbsoluteFile</a>))
			<span title="Some[java.lang.String]" class="keyword">case</span> _ =&gt; <span title="(java.lang.String)Some[java.lang.String]">Some</span>(<span title="java.lang.String(&quot;Expected '&lt;version&gt;' or '&lt;version&gt; &lt;new-launcher-file&gt;', got '&quot;)" class="string">&quot;Expected '&lt;version&gt;' or '&lt;version&gt; &lt;new-launcher-file&gt;', got '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#79688" title="Array[String]">args</a>.<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span>) <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;'&quot;)" class="string">&quot;'&quot;</span>)
		}

	<span class="keyword">def</span> <a title="(String)Boolean" id="79595">validVersion</a>(<a title="String" id="79731">version</a>: <span title="String">String</span>) = <span title="=&gt; Boolean">!</span><a href="#79731" title="String">version</a>.<span title="()java.lang.String">trim</span>.<span title="()Boolean">isEmpty</span>

	<span class="comment">/** Implementation of the sbt-update task after arguments have checked.  Gives user a chance to cancel and continues with `doUpdate`.*/</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Option[String]" id="79596">apply</a>(<a title="String" id="79617">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="79618">temporaryJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="Option[String]">Option</span>[String] =
	{
		<a href="LineReader.scala.html#57225" title="(String)Option[java.lang.String]">readLine</a>(<span title="java.lang.String(&quot;Updating the sbt version requires a restart.  Continue? (Y/n) &quot;)" class="string">&quot;Updating the sbt version requires a restart.  Continue? (Y/n) &quot;</span>) <span title="Option[String]" class="keyword">match</span>
		{
			<span title="Option[String]" class="keyword">case</span> Some(<a title="java.lang.String" id="79775">line</a>) <span class="keyword">if</span>(<a href="#79606" title="(String)Boolean">isYes</a>(<a href="#79775" title="java.lang.String">line</a>)) =&gt; <a href="#79597" title="(String,Option[java.io.File])Option[String]">doUpdate</a>(<a href="#79617" title="String">version</a>, <a href="#79618" title="Option[java.io.File]">temporaryJar</a>)
			<span title="Some[java.lang.String]" class="keyword">case</span> _ =&gt; <span title="(java.lang.String)Some[java.lang.String]">Some</span>(<span title="java.lang.String(&quot;Update declined.&quot;)" class="string">&quot;Update declined.&quot;</span>)
		}
	}
	<span class="comment">/** Implementation of the sbt-update task: high-level control after initial verification.*/</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Option[String]" id="79597">doUpdate</a>(<a title="String" id="79784">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="79785">temporaryJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="Option[String]">Option</span>[String] =
	{
		<a href="#79599" title="(String)Unit">retrieveNewVersion</a>(<a href="#79784" title="String">version</a>)
		<a href="#79589" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#49385" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Version is valid.  Setting 'sbt.version' to &quot;)" class="string">&quot;Version is valid.  Setting 'sbt.version' to &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#79784" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;...&quot;)" class="string">&quot;...&quot;</span>)
		<a href="#79598" title="(String)Unit">setNewVersion</a>(<a href="#79784" title="String">version</a>)

		<a href="#79589" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#49385" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;'sbt.version' updated.&quot;)" class="string">&quot;'sbt.version' updated.&quot;</span>)
		<span title="Unit" class="keyword">if</span>(<a href="#79785" title="Option[java.io.File]">temporaryJar</a>.<span title="=&gt; Boolean">isDefined</span> <span title="(Boolean)Boolean">||</span> <a href="#79600" title="(String)Boolean">updateInPlace</a>(<a href="#79784" title="String">version</a>))
		{
			<a href="#79589" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#49385" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Downloading new launcher ...&quot;)" class="string">&quot;Downloading new launcher ...&quot;</span>)
			
			<span title="Unit" class="keyword">if</span>(<a href="#79604" title="(String,Option[java.io.File])Boolean">downloadLauncher</a>(<a href="#79784" title="String">version</a>, <a href="#79785" title="Option[java.io.File]">temporaryJar</a>))
				<a href="#79589" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#49385" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Downloaded launcher.&quot;)" class="string">&quot;Downloaded launcher.&quot;</span>)
			<span class="keyword">else</span>
				<a href="#79602" title="(String,Option[java.io.File])Unit">tryUpdateLauncher</a>(<a href="#79784" title="String">version</a>, <a href="#79785" title="Option[java.io.File]">temporaryJar</a>)
		}
		<span class="keyword">else</span>
			<a href="#79589" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#49385" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Launcher update declined.&quot;)" class="string">&quot;Launcher update declined.&quot;</span>)

		<a href="#79589" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#49385" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Please restart sbt.&quot;)" class="string">&quot;Please restart sbt.&quot;</span>)
		<a title="object java.lang.System" id="1829">System</a>.<a title="(Int)Unit" id="18127">exit</a>(<span title="Int(0)" class="int">0</span>)
		<span title="object None">None</span>
	}
	<span class="comment">/** Updates 'sbt.version' in `project/build.properties`.*/</span>
	<span class="keyword">def</span> <a title="(String)Unit" id="79598">setNewVersion</a>(<a title="String" id="79789">version</a>: <span title="String">String</span>)
	{
		<a href="#79614" title="sbt.Project">project</a>.<a href="Project.scala.html#50914" title="=&gt; Update.this.project.Property[String]">sbtVersion</a>() = <a href="#79789" title="String">version</a>
		<a href="#79614" title="sbt.Project">project</a>.<a href="Environment.scala.html#51328" title="()Option[String]">saveEnvironment</a>()
	}
	<span class="comment">/** Retrieves the given `version` of sbt in order to verify the version is valid.*/</span>
	<span class="keyword">def</span> <a title="(String)Unit" id="79599">retrieveNewVersion</a>(<a title="String" id="79787">version</a>: <span title="String">String</span>)
	{
		<span class="keyword">val</span> <a title="xsbti.ApplicationID" id="79803">newAppID</a> = <a href="#79613" title="(xsbti.ApplicationID,String)xsbti.ApplicationID">changeVersion</a>(<a href="#79587" title="=&gt; xsbti.AppProvider">app</a>.<a href="../xsbti/AppProvider.java.html#52560" title="()xsbti.ApplicationID">id</a>, <a href="#79787" title="String">version</a>)
		<a href="#79589" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#49385" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Checking repositories for sbt &quot;)" class="string">&quot;Checking repositories for sbt &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#79787" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; ...&quot;)" class="string">&quot; ...&quot;</span>)
		<a href="#79587" title="=&gt; xsbti.AppProvider">app</a>.<a href="../xsbti/AppProvider.java.html#52559" title="()xsbti.ScalaProvider">scalaProvider</a>.<a href="../xsbti/ScalaProvider.java.html#22348" title="(xsbti.ApplicationID)xsbti.AppProvider">app</a>(<a href="#79803" title="xsbti.ApplicationID">newAppID</a>)
	}
	<span class="comment">/** Asks the user whether the current launcher should be overrwritten.  Called when no file is explicitly specified as an argument. */</span>
	<span class="keyword">def</span> <a title="(String)Boolean" id="79600">updateInPlace</a>(<a title="String" id="79791">version</a>: <span title="String">String</span>) =
	{
		<span class="keyword">val</span> <a title="Option[java.lang.String]" id="79793">input</a> = <a href="LineReader.scala.html#57225" title="(String)Option[java.lang.String]">readLine</a>(<span title="java.lang.String(&quot; The current launcher (&quot;)" class="string">&quot; The current launcher (&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#79591" title="=&gt; java.io.File">launcherJar</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;) will be updated in place.  Continue? (Y/n) &quot;)" class="string">&quot;) will be updated in place.  Continue? (Y/n) &quot;</span>)
		<a href="#79601" title="(Option[String])Boolean">isYes</a>(<a href="#79793" title="Option[java.lang.String]">input</a>)
	}
	<span class="keyword">def</span> <a title="(Option[String])Boolean" id="79601">isYes</a>(<a title="Option[String]" id="79783">line</a>: <span title="Option[String]">Option</span>[String]): <span title="Boolean">Boolean</span> = <a href="#79783" title="Option[String]">line</a>.<a title="((String) =&gt; Boolean)Option[String]" id="30335">filter</a>(<a href="#79606" title="(String)Boolean">isYes</a>).<span title="=&gt; Boolean">isDefined</span>
	
	<span class="comment">/** Updates the launcher as in `updateLauncher` but performs various checks and logging around it. */</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Unit" id="79602">tryUpdateLauncher</a>(<a title="String" id="79799">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="79800">temporaryJar</a>: <span title="Option[java.io.File]">Option</span>[File])
	{
		<a href="#79589" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#49386" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;No launcher found for '&quot;)" class="string">&quot;No launcher found for '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#79799" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;'&quot;)" class="string">&quot;'&quot;</span>)
		<span class="keyword">def</span> <a title="=&gt; java.lang.String" id="79812">promptStart</a> = <span title="java.lang.String" class="keyword">if</span>(<a href="#79800" title="Option[java.io.File]">temporaryJar</a>.<span title="=&gt; Boolean">isDefined</span>) <span title="java.lang.String(&quot; Copy current launcher but with &quot;)" class="string">&quot; Copy current launcher but with &quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot; Modify current launcher to use &quot;)" class="string">&quot; Modify current launcher to use &quot;</span>
		<span class="keyword">val</span> <a title="Option[java.lang.String]" id="79813">input</a> = <a href="LineReader.scala.html#57225" title="(String)Option[java.lang.String]">readLine</a>(<a href="#79812" title="=&gt; java.lang.String">promptStart</a> <span title="(Any)java.lang.String">+</span> <a href="#79799" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; as the default for new projects? (Y/n) &quot;)" class="string">&quot; as the default for new projects? (Y/n) &quot;</span>)
		<span class="keyword">val</span> <a title="Boolean" id="79814">updated</a> = <a href="#79601" title="(Option[String])Boolean">isYes</a>(<a href="#79813" title="Option[java.lang.String]">input</a>)
		<span title="Unit" class="keyword">if</span>(<a href="#79814" title="Boolean">updated</a>) <a href="#79607" title="(String,Option[java.io.File])Unit">updateLauncher</a>(<a href="#79799" title="String">version</a>, <a href="#79800" title="Option[java.io.File]">temporaryJar</a>)
		
		<span class="keyword">def</span> <a title="=&gt; java.lang.String" id="79815">extra</a> =  <span title="java.lang.String" class="keyword">if</span>(<a href="#79800" title="Option[java.io.File]">temporaryJar</a>.<span title="=&gt; Boolean">isDefined</span>) <span title="java.lang.String(&quot; at &quot;)" class="string">&quot; at &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#79800" title="Option[java.io.File]">temporaryJar</a>.<a title="=&gt; java.io.File" id="30326">get</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span>
		<a href="#79589" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#49385" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String" class="keyword">if</span>(<a href="#79814" title="Boolean">updated</a>) <span title="java.lang.String(&quot;Launcher updated&quot;)" class="string">&quot;Launcher updated&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#79815" title="=&gt; java.lang.String">extra</a> <span class="keyword">else</span> <span title="java.lang.String(&quot;Launcher not updated.&quot;)" class="string">&quot;Launcher not updated.&quot;</span>)
	}
	<span class="comment">/** The jar to copy/download to.  If `userJar` is not defined, it is a temporary file in `tmpDir` that should then be moved to the current launcher file.
	* If it is defined and is a directory, the jar is defined in that directory.  If it is a file, that file is returned. */</span>
	<span class="keyword">def</span> <a title="(java.io.File,Option[java.io.File])java.io.File" id="79603">targetJar</a>(<a title="java.io.File" id="79826">tmpDir</a>: <span title="java.io.File">File</span>, <a title="Option[java.io.File]" id="79827">userJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="java.io.File">File</span> = 
		<a href="#79827" title="Option[java.io.File]">userJar</a> <span title="java.io.File" class="keyword">match</span> { <span title="java.io.File" class="keyword">case</span> Some(<a title="java.io.File" id="79828">file</a>) =&gt; <span title="java.io.File" class="keyword">if</span>(<a href="#79828" title="java.io.File">file</a>.<a title="()Boolean" id="16773">isDirectory</a>) <a href="#79593" title="(java.io.File)java.io.File">tempJar</a>(<a href="#79828" title="java.io.File">file</a>) <span class="keyword">else</span> <a href="#79828" title="java.io.File">file</a>; <span title="java.io.File" class="keyword">case</span> <span title="object None">None</span> =&gt; <a href="#79593" title="(java.io.File)java.io.File">tempJar</a>(<a href="#79826" title="java.io.File">tmpDir</a>) }
		
	<span class="comment">/** Gets the given `version` of the launcher from Google Code.  If `userProvidedJar` is defined,
	* this updated launcher is downloaded there, otherwise it overwrites the current launcher. */</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Boolean" id="79604">downloadLauncher</a>(<a title="String" id="79796">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="79797">userProvidedJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="Boolean">Boolean</span> =
	{
		<span class="keyword">def</span> <a title="(java.io.File)Boolean" id="79829">getLauncher</a>(<a title="java.io.File" id="79830">tmp</a>: <span title="java.io.File">File</span>): <span title="Boolean">Boolean</span> =
		{
			<span class="keyword">val</span> <a title="java.io.File" id="79831">temporaryJar</a> = <a href="#79603" title="(java.io.File,Option[java.io.File])java.io.File">targetJar</a>(<a href="#79830" title="java.io.File">tmp</a>, <a href="#79797" title="Option[java.io.File]">userProvidedJar</a>)
			<a href="#79831" title="java.io.File">temporaryJar</a>.<a title="()java.io.File" id="16761">getParentFile</a>.<a title="()Boolean" id="16787">mkdirs</a>()
			<span class="keyword">val</span> <a title="java.net.URL" id="79832">url</a> = <a href="#79605" title="(String)java.net.URL">launcherURL</a>(<a href="#79796" title="String">version</a>)
			<span class="keyword">val</span> <a title="java.net.HttpURLConnection" id="79833">connection</a> = <a href="#79832" title="java.net.URL">url</a>.<a title="()java.net.URLConnection" id="19082">openConnection</a>.<a title="java.net.HttpURLConnection" id="3446">asInstanceOf</a>[<a title="java.net.HttpURLConnection" id="4626">HttpURLConnection</a>]
			<a href="#79833" title="java.net.HttpURLConnection">connection</a>.<a title="(Boolean)Unit" id="79668">setInstanceFollowRedirects</a>(<span title="Boolean(false)" class="keyword">false</span>)
			
			<span class="keyword">def</span> <a title="(java.io.InputStream)Unit" id="79834">download</a>(<a title="java.io.InputStream" id="79918">in</a>: <span title="java.io.InputStream">InputStream</span>): <span title="Unit">Unit</span> = <a href="../OpenResource.scala.html#79926" title="(java.io.File)((java.io.FileOutputStream) =&gt; Unit)Unit">fileOutputStream</a>(<span title="Boolean(false)" class="keyword">false</span>)(<a href="#79831" title="java.io.File">temporaryJar</a>) { <a title="java.io.FileOutputStream" id="79964">out</a> =&gt; <a href="../FileUtilities.scala.html#18240" title="(java.io.InputStream,java.io.OutputStream)Unit">transfer</a>(<a href="#79918" title="java.io.InputStream">in</a>, <a href="#79964" title="java.io.FileOutputStream">out</a>) }
			<span class="keyword">def</span> <a title="(java.io.InputStream)Boolean" id="79835">checkAndRetrieve</a>(<a title="java.io.InputStream" id="79967">in</a>: <span title="java.io.InputStream">InputStream</span>): <span title="Boolean">Boolean</span> =  (<a href="#79833" title="java.net.HttpURLConnection">connection</a>.<span title="()Int">getResponseCode</span> <span title="(Int)Boolean">==</span> <span title="Int(200)">HTTP_OK</span>) <span title="(Boolean)Boolean">&amp;&amp;</span> { <a href="#79834" title="(java.io.InputStream)Unit">download</a>(<a href="#79967" title="java.io.InputStream">in</a>); <span title="Boolean(true)" class="keyword">true</span> }
			<span class="keyword">def</span> <a title="(java.io.IOException)Boolean" id="79836">handleError</a>(<a title="java.io.IOException" id="79970">e</a>: <span title="java.io.IOException">IOException</span>) = <span title="Boolean" class="keyword">if</span>(<a href="#79833" title="java.net.HttpURLConnection">connection</a>.<span title="()Int">getResponseCode</span> <span title="(Int)Boolean">==</span> <span title="Int(404)">HTTP_NOT_FOUND</span> ) <span title="Boolean(false)" class="keyword">false</span> <span class="keyword">else</span> <span title="Nothing" class="keyword">throw</span> <a href="#79970" title="java.io.IOException">e</a>
			<span class="keyword">def</span> <a title="()Boolean" id="79837">retrieve</a>() =
			{
				<span class="keyword">val</span> <a title="java.io.InputStream" id="79978">in</a> = <a href="#79833" title="java.net.HttpURLConnection">connection</a>.<a title="()java.io.InputStream" id="79887">getInputStream</a>
				<span class="keyword">try</span> { <a href="#79835" title="(java.io.InputStream)Boolean">checkAndRetrieve</a>(<a href="#79978" title="java.io.InputStream">in</a>) } <span class="keyword">finally</span> { <a href="#79978" title="java.io.InputStream">in</a>.<a title="()Unit" id="20700">close</a>() }
			}
			
			<span class="keyword">val</span> <a title="Boolean" id="79838">success</a> = <span class="keyword">try</span> { <a href="#79837" title="()Boolean">retrieve</a>() } <span class="keyword">catch</span> { <span title="Boolean" class="keyword">case</span> <a title="java.io.IOException" id="79979">e</a>: <span title="java.io.IOException">IOException</span> =&gt; <a href="#79836" title="(java.io.IOException)Boolean">handleError</a>(<a href="#79979" title="java.io.IOException">e</a>)} <span class="keyword">finally</span> { <a href="#79833" title="java.net.HttpURLConnection">connection</a>.<a title="()Unit" id="79675">disconnect</a>() }
			<span title="Unit" class="keyword">if</span>(<a href="#79838" title="Boolean">success</a> <span title="(Boolean)Boolean">&amp;&amp;</span> <a href="#79797" title="Option[java.io.File]">userProvidedJar</a>.<span title="=&gt; Boolean">isEmpty</span>)
				<a href="#79608" title="(java.io.File,java.io.File)Unit">move</a>(<a href="#79831" title="java.io.File">temporaryJar</a>, <a href="#79591" title="=&gt; java.io.File">launcherJar</a>)
			<a href="#79838" title="Boolean">success</a>
		}
		<a href="../FileUtilities.scala.html#18243" title="((java.io.File) =&gt; Boolean)Boolean">withTemporaryDirectory</a>(<a href="#79829" title="(java.io.File)Boolean">getLauncher</a>)
	}
	<span class="comment">/** The location of the launcher for the given version, if it exists. */</span>
	<span class="keyword">def</span> <a title="(String)java.net.URL" id="79605">launcherURL</a>(<a title="String" id="79839">version</a>: <span title="String">String</span>): <span title="java.net.URL">URL</span> =
		<a title="(java.lang.String)java.net.URL" id="19061" class="keyword">new</a> <span title="java.net.URL">URL</span>(<span title="java.lang.String(&quot;http://simple-build-tool.googlecode.com/files/sbt-launch-&quot;)" class="string">&quot;http://simple-build-tool.googlecode.com/files/sbt-launch-&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#79839" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.jar&quot;)" class="string">&quot;.jar&quot;</span>)
		
	<span class="comment">/** True iff the given user input is empty, 'y' or 'yes' (case-insensitive).*/</span>
	<span class="keyword">def</span> <a title="(String)Boolean" id="79606">isYes</a>(<a title="String" id="79777">line</a>: <span title="String">String</span>) =
	{
		<span class="keyword">val</span> <a title="java.lang.String" id="79779">lower</a> = <a href="#79777" title="String">line</a>.<a title="()java.lang.String" id="6400">toLowerCase</a>
		<a href="#79779" title="java.lang.String">lower</a>.<span title="()Boolean">isEmpty</span> <span title="(Boolean)Boolean">||</span> <a href="#79779" title="java.lang.String">lower</a> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;y&quot;)" class="string">&quot;y&quot;</span> <span title="(Boolean)Boolean">||</span> <a href="#79779" title="java.lang.String">lower</a> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;yes&quot;)" class="string">&quot;yes&quot;</span>
	}
	<span class="comment">/** Copies the current launcher but with the default 'sbt.version' set to `version`.  If `userProvidedJar` is defined,
	* the updated launcher is copied there, otherwise the copy overwrites the current  launcher. */</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Unit" id="79607">updateLauncher</a>(<a title="String" id="79818">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="79819">userProvidedJar</a>: <span title="Option[java.io.File]">Option</span>[File])
	{
		<span class="keyword">def</span> <a title="(java.io.File,java.io.File)Unit" id="79986">makeUpdated</a>(<a title="java.io.File" id="79988">base</a>: <span title="java.io.File">File</span>, <a title="java.io.File" id="79989">newJar</a>: <span title="java.io.File">File</span>)
		{
			<span class="keyword">val</span> <a title="Set[java.io.File]" id="79990">files</a> = <a href="../FileUtilities.scala.html#18236" title="(java.io.File,java.io.File)Set[java.io.File]">unzip</a>(<a href="#79591" title="=&gt; java.io.File">launcherJar</a>, <a href="#79988" title="java.io.File">base</a>)
			<a href="#79609" title="(Iterable[java.io.File],String)Unit">updateBootProperties</a>(<a href="#79990" title="Set[java.io.File]">files</a>, <a href="#79818" title="String">version</a>)
			<a href="../FileUtilities.scala.html#18255" title="(Iterable[(java.io.File, String)],java.io.File)Unit">zip</a>(<a href="../PathMapper.scala.html#20969" title="(Set[java.io.File])Iterable[(java.io.File, String)]">relativeTo</a>(<a href="#79988" title="java.io.File">base</a>)( <a href="#79990" title="Set[java.io.File]">files</a> ), <a href="#79989" title="java.io.File">newJar</a>)
		}
		<span class="keyword">def</span> <a title="(java.io.File)Unit" id="79987">updateLauncher</a>(<a title="java.io.File" id="80015">tmp</a>: <span title="java.io.File">File</span>)
		{
			<span class="keyword">val</span> <a title="java.io.File" id="80016">basePath</a> = <a href="../Paths.scala.html#20622" title="implicit xsbt.Paths.fileToPath : (java.io.File)xsbt.Path">tmp</a> <a href="../Paths.scala.html#20670" title="(String)java.io.File">/</a> <span title="java.lang.String(&quot;launcher-jar&quot;)" class="string">&quot;launcher-jar&quot;</span>
			<span class="keyword">val</span> <a title="java.io.File" id="80017">temporaryJar</a> = <a href="#79603" title="(java.io.File,Option[java.io.File])java.io.File">targetJar</a>(<a href="#80015" title="java.io.File">tmp</a>, <a href="#79819" title="Option[java.io.File]">userProvidedJar</a>)
			<a href="#79986" title="(java.io.File,java.io.File)Unit">makeUpdated</a>(<a href="#80016" title="java.io.File">basePath</a>, <a href="#80017" title="java.io.File">temporaryJar</a>)
			<span title="Unit" class="keyword">if</span>(<a href="#79819" title="Option[java.io.File]">userProvidedJar</a>.<span title="=&gt; Boolean">isEmpty</span>)
				<a href="#79608" title="(java.io.File,java.io.File)Unit">move</a>(<a href="#80017" title="java.io.File">temporaryJar</a>, <a href="#79591" title="=&gt; java.io.File">launcherJar</a>)
		}

		<a href="../FileUtilities.scala.html#18243" title="((java.io.File) =&gt; Unit)Unit">withTemporaryDirectory</a>(<a href="#79987" title="(java.io.File)Unit">updateLauncher</a>)
	}
	
	<span class="comment">/** Copies the `src` file to the `dest` file, preferably by renaming.  The `src` file may or may not be removed.*/</span>
	<span class="keyword">def</span> <a title="(java.io.File,java.io.File)Unit" id="79608">move</a>(<a title="java.io.File" id="79980">src</a>: <span title="java.io.File">File</span>, <a title="java.io.File" id="79981">dest</a>: <span title="java.io.File">File</span>)
	{
		<span class="keyword">val</span> <a title="Boolean" id="80025">renameSuccess</a> = <a href="#79980" title="java.io.File">src</a> <a title="(java.io.File)Boolean" id="16788">renameTo</a> <a href="#79981" title="java.io.File">dest</a>
		<span title="Unit" class="keyword">if</span>(<span title="=&gt; Boolean">!</span><a href="#80025" title="Boolean">renameSuccess</a>)
			<a href="../FileUtilities.scala.html#18264" title="(java.io.File,java.io.File)Unit">copyFile</a>(<a href="#79980" title="java.io.File">src</a>, <a href="#79981" title="java.io.File">dest</a>)
	}
	
	<span class="comment">/** Updates the default value used for 'sbt.version' in the 'sbt.boot.properties' file in the launcher `files` to be `version`.*/</span>
	<span class="keyword">def</span> <a title="(Iterable[java.io.File],String)Unit" id="79609">updateBootProperties</a>(<a title="Iterable[java.io.File]" id="79999">files</a>: <a title="Iterable[java.io.File]" id="376">Iterable</a>[File], <a title="String" id="80000">version</a>: <span title="String">String</span>): <span title="Unit">Unit</span> =
		<a href="#79999" title="Iterable[java.io.File]">files</a>.<a title="((java.io.File) =&gt; Boolean)Option[java.io.File]" id="15955">find</a>(<a href="#80029" title="java.io.File">_</a>.<span title="()java.lang.String">getName</span> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;sbt.boot.properties&quot;)" class="string">&quot;sbt.boot.properties&quot;</span>).<a title="((java.io.File) =&gt; Unit)Unit" id="30336">foreach</a>(<a href="#79610" title="(String)(java.io.File)Unit">updateBootProperties</a>(<a href="#80000" title="String">version</a>))
	<span class="comment">/** Updates the default value used for 'sbt.version' in the given `file` to be `version`.*/</span>
	<span class="keyword">def</span> <a title="(String)(java.io.File)Unit" id="79610">updateBootProperties</a>(<a title="String" id="79993">version</a>: <span title="String">String</span>)(<a title="java.io.File" id="79994">file</a>: <span title="java.io.File">File</span>)
	{
		<span class="keyword">val</span> <a title="List[java.lang.String]" id="80036">newContent</a> = <a href="../FileUtilities.scala.html#18278" title="(java.io.File)List[String]">readLines</a>(<a href="#79994" title="java.io.File">file</a>) <a title="((String) =&gt; java.lang.String)List[java.lang.String]" id="15531">map</a> <a href="#79611" title="(String)(String)java.lang.String">updateSbtVersion</a>(<a href="#79993" title="String">version</a>)
		<a href="../FileUtilities.scala.html#18266" title="(java.io.File,String)Unit">write</a>(<a href="#79994" title="java.io.File">file</a>, <a href="#80036" title="List[java.lang.String]">newContent</a>.<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>))
	}
	
	<span class="comment">/** If the given `line` is the 'sbt.version' configuration, update it to use the `newVersion`.*/</span>
	<span class="keyword">def</span> <a title="(String)(String)java.lang.String" id="79611">updateSbtVersion</a>(<a title="String" id="80040">newVersion</a>: <span title="String">String</span>)(<a title="String" id="80041">line</a>: <span title="String">String</span>) =
		<span title="java.lang.String" class="keyword">if</span>(<a href="#80041" title="String">line</a>.<span title="()java.lang.String">trim</span>.<a title="(java.lang.String)Boolean" id="6374">startsWith</a>(<span title="java.lang.String(&quot;sbt.version&quot;)" class="string">&quot;sbt.version&quot;</span>)) <a href="#79612" title="(String)java.lang.String">sbtVersion</a>(<a href="#80040" title="String">newVersion</a>) <span class="keyword">else</span> <a href="#80041" title="String">line</a>
		
	<span class="comment">/** The configuration line that defines the 'sbt.version' property, using the provided `version` for defaults.*/</span>
	<span class="keyword">def</span> <a title="(String)java.lang.String" id="79612">sbtVersion</a>(<a title="String" id="80044">version</a>: <span title="String">String</span>) =
		<span title="java.lang.String(&quot; sbt.version: quick=set(&quot;)" class="string">&quot; sbt.version: quick=set(&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#80044" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;), new=prompt(sbt version)[&quot;)" class="string">&quot;), new=prompt(sbt version)[&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#80044" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;], fill=prompt(sbt version)[&quot;)" class="string">&quot;], fill=prompt(sbt version)[&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#80044" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span>
	
	<span class="comment">/** Copies the given ApplicationID but with the specified version.*/</span>
	<span class="keyword">def</span> <a title="(xsbti.ApplicationID,String)xsbti.ApplicationID" id="79613">changeVersion</a>(<a title="xsbti.ApplicationID" id="79804">appID</a>: xsbti.<a href="../xsbti/ApplicationID.java.html#7637" title="xsbti.ApplicationID">ApplicationID</a>, <a title="String" id="79805">versionA</a>: <span title="String">String</span>): xsbti.<a href="../xsbti/ApplicationID.java.html#7637" title="xsbti.ApplicationID">ApplicationID</a> =
		<a title="template $anon extends java.lang.Object with xsbti.ApplicationID" id="80050" class="keyword">new</a> xsbti.<a href="../xsbti/ApplicationID.java.html#7637" title="xsbti.ApplicationID">ApplicationID</a> {
			<span class="keyword">def</span> <a title="()java.lang.String" id="80052">groupID</a> = <a href="#79804" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#66112" title="()java.lang.String">groupID</a>
			<span class="keyword">def</span> <a title="()java.lang.String" id="80053">name</a> = <a href="#79804" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#66113" title="()java.lang.String">name</a>
			<span class="keyword">def</span> <a title="()String" id="80054">version</a> = <a href="#79805" title="String">versionA</a>
			<span class="keyword">def</span> <a title="()java.lang.String" id="80055">mainClass</a> = <a href="#79804" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#66115" title="()java.lang.String">mainClass</a>
			<span class="keyword">def</span> <a title="()Array[java.lang.String]" id="80056">mainComponents</a> = <a href="#79804" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#66116" title="()Array[java.lang.String]">mainComponents</a>
			<span class="keyword">def</span> <a title="()Boolean" id="80057">crossVersioned</a> = <a href="#79804" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#66117" title="()Boolean">crossVersioned</a>
			<span class="keyword">def</span> <a title="()Array[java.io.File]" id="80058">classpathExtra</a> = <a href="#79804" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#66118" title="()Array[java.io.File]">classpathExtra</a>
		}
}

        </pre>
    </body>
</html>