<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/Update.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2010 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="comment">/** A trait that provides a task for updating sbt.  */</span>
<span class="keyword">trait</span> <a title="trait UpdateSbt extends java.lang.Object with sbt.Project with ScalaObject" id="8862">UpdateSbt</a> <span class="keyword">extends</span> <a href="Project.scala.html#7665" title="sbt.Project">Project</a>
{
	<span class="comment">/** The first argument is the version to update to and is mandatory.
	* The second argument is the location of the launcher jar.  If omitted, the launcher used to launch the currently running instance of sbt is used.*/</span>
	<span class="keyword">lazy</span> <span class="keyword">val</span> <a title="UpdateSbt.this.MethodTask" id="75173">sbtUpdate</a> = <a href="TaskManager.scala.html#14808" title="((Array[String]) =&gt; UpdateSbt.this.ManagedTask)UpdateSbt.this.MethodTask">task</a> { <a title="Array[String]" id="75182">args</a> =&gt; <a href="TaskManager.scala.html#14806" title="(=&gt; Option[String])UpdateSbt.this.Task">task</a> { (<a href="#75204" title="(Array[String])Option[String]" class="keyword">new</a> <a href="#8643" title="sbt.Update">Update</a>(<a href="#8862" title="sbt.UpdateSbt" class="keyword">this</a>))(<a href="#75182" title="Array[String]">args</a>) } } <a href="TaskManager.scala.html#19214" title="(String)UpdateSbt.this.MethodTask">describedAs</a>(<span title="java.lang.String(&quot;Updates the version of sbt used to build this project and updates the launcher jar.&quot;)" class="string">&quot;Updates the version of sbt used to build this project and updates the launcher jar.&quot;</span>)
}

<span class="keyword">import</span> java.io.{File, InputStream, IOException}
<span class="keyword">import</span> java.net.{HttpURLConnection, URL}
<span class="keyword">import</span> HttpURLConnection.{HTTP_NOT_FOUND , HTTP_OK}
<span class="keyword">import</span> SimpleReader.readLine
<span class="keyword">import</span> xsbt.FileUtilities.{classLocationFile, copyFile, readLines, transfer, unzip, withTemporaryDirectory, write, zip}
<span class="keyword">import</span> xsbt.PathMapper.relativeTo
<span class="keyword">import</span> xsbt.Paths._
<span class="keyword">import</span> xsbt.OpenResource.{fileOutputStream, urlInputStream}

<span class="keyword">private</span> <span class="keyword">class</span> <a title="class Update extends java.lang.Object with ScalaObject" id="8643">Update</a>(<a title="sbt.Project" id="75224">project</a>: <a href="Project.scala.html#7665" title="sbt.Project">Project</a>)
{
	<span class="keyword">val</span> <a title="sbt.ProjectInfo" id="75195">info</a> = <a href="#75224" title="sbt.Project">project</a>.<a href="Project.scala.html#14826" title="=&gt; sbt.ProjectInfo">info</a>
	<span class="keyword">val</span> <a title="xsbti.AppProvider" id="75197">app</a> = <a href="#75195" title="=&gt; sbt.ProjectInfo">info</a>.<a href="ProjectInfo.scala.html#19174" title="=&gt; xsbti.AppProvider">app</a>
	<span class="keyword">val</span> <a title="sbt.Logger" id="75199">log</a> = <a href="#75224" title="sbt.Project">project</a>.<a href="Project.scala.html#14821" title="=&gt; sbt.Logger">log</a>
	
	<span class="comment">/** The location of the jar used to launch the currently running instance of sbt.*/</span>
	<span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.io.File" id="75202">launcherJar</a> = <a href="../FileUtilities.scala.html#32052" title="(implicit scala.reflect.Manifest[xsbti.AppProvider])java.io.File" id="2660">classLocationFile</a>[xsbti.<a href="../xsbti/AppProvider.java.html#5875" title="xsbti.AppProvider">AppProvider</a>]
	<span class="comment">/** A temporary jar file to use in the given directory. */</span>
	<span class="keyword">def</span> <a title="(java.io.File)java.io.File" id="75203">tempJar</a>(<a title="java.io.File" id="75311">dir</a>: <span title="java.io.File">File</span>) = <a href="../Paths.scala.html#47948" title="implicit xsbt.Paths.fileToPath : (java.io.File)xsbt.Path">dir</a> <a href="../Paths.scala.html#47998" title="(String)java.io.File">/</a> <a href="#75201" title="=&gt; java.io.File">launcherJar</a>.<span title="()java.lang.String">getName</span>
		
	<span class="comment">/** Implementation of the sbt-update task: reads arguments and hands off to the other `apply`.*/</span>
	<span class="keyword">def</span> <a title="(Array[String])Option[String]" id="75204">apply</a>(<a title="Array[String]" id="75298">args</a>: <a title="Array[String]" id="1032">Array</a>[String]): <span title="Option[String]">Option</span>[String] =
		<a href="#75298" title="Array[String]">args</a> <span title="Option[String]" class="keyword">match</span>
		{
			<span title="Option[String]" class="keyword">case</span> <a href="#75317" title="(Array[String])Option[Seq[String]]">Array</a>(<a title="String" id="75320">version</a>) <span class="keyword">if</span> <a href="#75205" title="(String)Boolean">validVersion</a>(<a href="#75320" title="String">version</a>) =&gt; <a href="#75206" title="(String,Option[java.io.File])Option[String]">apply</a>(<a href="#75320" title="String">version</a>, <span title="object None">None</span>)
			<span title="Option[String]" class="keyword">case</span> <a href="#75349" title="(Array[String])Option[Seq[String]]">Array</a>(<a title="String" id="75352">version</a>, <a title="String" id="75353">temporaryJar</a>) <span class="keyword">if</span> <a href="#75205" title="(String)Boolean">validVersion</a>(<a href="#75352" title="String">version</a>) =&gt; <a href="#75206" title="(String,Option[java.io.File])Option[String]">apply</a>(<a href="#75352" title="String">version</a>, <span title="(java.io.File)Some[java.io.File]">Some</span>(<span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span>(<a href="#75353" title="String">temporaryJar</a>) <a title="()java.io.File" id="16225">getAbsoluteFile</a>))
			<span title="Some[java.lang.String]" class="keyword">case</span> _ =&gt; <span title="(java.lang.String)Some[java.lang.String]">Some</span>(<span title="java.lang.String(&quot;Expected '&lt;version&gt;' or '&lt;version&gt; &lt;new-launcher-file&gt;', got '&quot;)" class="string">&quot;Expected '&lt;version&gt;' or '&lt;version&gt; &lt;new-launcher-file&gt;', got '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#75298" title="Array[String]">args</a>.<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span>) <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;'&quot;)" class="string">&quot;'&quot;</span>)
		}

	<span class="keyword">def</span> <a title="(String)Boolean" id="75205">validVersion</a>(<a title="String" id="75321">version</a>: <span title="String">String</span>) = <span title="=&gt; Boolean">!</span><a href="#75321" title="String">version</a>.<span title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString">trim</span>.<span title="=&gt; Boolean">isEmpty</span>

	<span class="comment">/** Implementation of the sbt-update task after arguments have checked.  Gives user a chance to cancel and continues with `doUpdate`.*/</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Option[String]" id="75206">apply</a>(<a title="String" id="75227">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="75228">temporaryJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="Option[String]">Option</span>[String] =
	{
		<a href="LineReader.scala.html#43845" title="(String)Option[java.lang.String]">readLine</a>(<span title="java.lang.String(&quot;Updating the sbt version requires a restart.  Continue? (Y/n) &quot;)" class="string">&quot;Updating the sbt version requires a restart.  Continue? (Y/n) &quot;</span>) <span title="Option[String]" class="keyword">match</span>
		{
			<span title="Option[String]" class="keyword">case</span> Some(<a title="java.lang.String" id="75372">line</a>) <span class="keyword">if</span>(<a href="#75216" title="(String)Boolean">isYes</a>(<a href="#75372" title="java.lang.String">line</a>)) =&gt; <a href="#75207" title="(String,Option[java.io.File])Option[String]">doUpdate</a>(<a href="#75227" title="String">version</a>, <a href="#75228" title="Option[java.io.File]">temporaryJar</a>)
			<span title="Some[java.lang.String]" class="keyword">case</span> _ =&gt; <span title="(java.lang.String)Some[java.lang.String]">Some</span>(<span title="java.lang.String(&quot;Update declined.&quot;)" class="string">&quot;Update declined.&quot;</span>)
		}
	}
	<span class="comment">/** Implementation of the sbt-update task: high-level control after initial verification.*/</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Option[String]" id="75207">doUpdate</a>(<a title="String" id="75388">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="75389">temporaryJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="Option[String]">Option</span>[String] =
	{
		<a href="#75209" title="(String)Unit">retrieveNewVersion</a>(<a href="#75388" title="String">version</a>)
		<a href="#75199" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19734" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Version is valid.  Setting 'sbt.version' to &quot;)" class="string">&quot;Version is valid.  Setting 'sbt.version' to &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#75388" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;...&quot;)" class="string">&quot;...&quot;</span>)
		<a href="#75208" title="(String)Unit">setNewVersion</a>(<a href="#75388" title="String">version</a>)

		<a href="#75199" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19734" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;'sbt.version' updated.&quot;)" class="string">&quot;'sbt.version' updated.&quot;</span>)
		<span title="Unit" class="keyword">if</span>(<a href="#75389" title="Option[java.io.File]">temporaryJar</a>.<span title="=&gt; Boolean">isDefined</span> <span title="(Boolean)Boolean">||</span> <a href="#75210" title="(String)Boolean">updateInPlace</a>(<a href="#75388" title="String">version</a>))
		{
			<a href="#75199" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19734" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Downloading new launcher ...&quot;)" class="string">&quot;Downloading new launcher ...&quot;</span>)
			
			<span title="Unit" class="keyword">if</span>(<a href="#75214" title="(String,Option[java.io.File])Boolean">downloadLauncher</a>(<a href="#75388" title="String">version</a>, <a href="#75389" title="Option[java.io.File]">temporaryJar</a>))
				<a href="#75199" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19734" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Downloaded launcher.&quot;)" class="string">&quot;Downloaded launcher.&quot;</span>)
			<span class="keyword">else</span>
				<a href="#75212" title="(String,Option[java.io.File])Unit">tryUpdateLauncher</a>(<a href="#75388" title="String">version</a>, <a href="#75389" title="Option[java.io.File]">temporaryJar</a>)
		}
		<span class="keyword">else</span>
			<a href="#75199" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19734" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Launcher update declined.&quot;)" class="string">&quot;Launcher update declined.&quot;</span>)

		<a href="#75199" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19734" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Please restart sbt.&quot;)" class="string">&quot;Please restart sbt.&quot;</span>)
		<a title="object java.lang.System" id="1831">System</a>.<a title="(Int)Unit" id="34090">exit</a>(<span title="Int(0)" class="int">0</span>)
		<span title="object None">None</span>
	}
	<span class="comment">/** Updates 'sbt.version' in `project/build.properties`.*/</span>
	<span class="keyword">def</span> <a title="(String)Unit" id="75208">setNewVersion</a>(<a title="String" id="75393">version</a>: <span title="String">String</span>)
	{
		<a href="#75224" title="sbt.Project">project</a>.<a href="Project.scala.html#14883" title="=&gt; Update.this.project.Property[String]">sbtVersion</a>() = <a href="#75393" title="String">version</a>
		<a href="#75224" title="sbt.Project">project</a>.<a href="Environment.scala.html#15012" title="()Option[String]">saveEnvironment</a>()
	}
	<span class="comment">/** Retrieves the given `version` of sbt in order to verify the version is valid.*/</span>
	<span class="keyword">def</span> <a title="(String)Unit" id="75209">retrieveNewVersion</a>(<a title="String" id="75391">version</a>: <span title="String">String</span>)
	{
		<span class="keyword">val</span> <a title="xsbti.ApplicationID" id="75407">newAppID</a> = <a href="#75223" title="(xsbti.ApplicationID,String)xsbti.ApplicationID">changeVersion</a>(<a href="#75197" title="=&gt; xsbti.AppProvider">app</a>.<a href="../xsbti/AppProvider.java.html#23140" title="()xsbti.ApplicationID">id</a>, <a href="#75391" title="String">version</a>)
		<a href="#75199" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19734" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Checking repositories for sbt &quot;)" class="string">&quot;Checking repositories for sbt &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#75391" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; ...&quot;)" class="string">&quot; ...&quot;</span>)
		<a href="#75197" title="=&gt; xsbti.AppProvider">app</a>.<a href="../xsbti/AppProvider.java.html#23139" title="()xsbti.ScalaProvider">scalaProvider</a>.<a href="../xsbti/ScalaProvider.java.html#23152" title="(xsbti.ApplicationID)xsbti.AppProvider">app</a>(<a href="#75407" title="xsbti.ApplicationID">newAppID</a>)
	}
	<span class="comment">/** Asks the user whether the current launcher should be overrwritten.  Called when no file is explicitly specified as an argument. */</span>
	<span class="keyword">def</span> <a title="(String)Boolean" id="75210">updateInPlace</a>(<a title="String" id="75395">version</a>: <span title="String">String</span>) =
	{
		<span class="keyword">val</span> <a title="Option[java.lang.String]" id="75397">input</a> = <a href="LineReader.scala.html#43845" title="(String)Option[java.lang.String]">readLine</a>(<span title="java.lang.String(&quot; The current launcher (&quot;)" class="string">&quot; The current launcher (&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#75201" title="=&gt; java.io.File">launcherJar</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;) will be updated in place.  Continue? (Y/n) &quot;)" class="string">&quot;) will be updated in place.  Continue? (Y/n) &quot;</span>)
		<a href="#75211" title="(Option[String])Boolean">isYes</a>(<a href="#75397" title="Option[java.lang.String]">input</a>)
	}
	<span class="keyword">def</span> <a title="(Option[String])Boolean" id="75211">isYes</a>(<a title="Option[String]" id="75387">line</a>: <span title="Option[String]">Option</span>[String]): <span title="Boolean">Boolean</span> = <a href="#75387" title="Option[String]">line</a>.<a title="((String) =&gt; Boolean)Option[String]" id="19238">filter</a>(<a href="#75216" title="(String)Boolean">isYes</a>).<span title="=&gt; Boolean">isDefined</span>
	
	<span class="comment">/** Updates the launcher as in `updateLauncher` but performs various checks and logging around it. */</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Unit" id="75212">tryUpdateLauncher</a>(<a title="String" id="75403">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="75404">temporaryJar</a>: <span title="Option[java.io.File]">Option</span>[File])
	{
		<a href="#75199" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19735" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;No launcher found for '&quot;)" class="string">&quot;No launcher found for '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#75403" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;'&quot;)" class="string">&quot;'&quot;</span>)
		<span class="keyword">def</span> <a title="=&gt; java.lang.String" id="75416">promptStart</a> = <span title="java.lang.String" class="keyword">if</span>(<a href="#75404" title="Option[java.io.File]">temporaryJar</a>.<span title="=&gt; Boolean">isDefined</span>) <span title="java.lang.String(&quot; Copy current launcher but with &quot;)" class="string">&quot; Copy current launcher but with &quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot; Modify current launcher to use &quot;)" class="string">&quot; Modify current launcher to use &quot;</span>
		<span class="keyword">val</span> <a title="Option[java.lang.String]" id="75417">input</a> = <a href="LineReader.scala.html#43845" title="(String)Option[java.lang.String]">readLine</a>(<a href="#75416" title="=&gt; java.lang.String">promptStart</a> <span title="(Any)java.lang.String">+</span> <a href="#75403" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; as the default for new projects? (Y/n) &quot;)" class="string">&quot; as the default for new projects? (Y/n) &quot;</span>)
		<span class="keyword">val</span> <a title="Boolean" id="75418">updated</a> = <a href="#75211" title="(Option[String])Boolean">isYes</a>(<a href="#75417" title="Option[java.lang.String]">input</a>)
		<span title="Unit" class="keyword">if</span>(<a href="#75418" title="Boolean">updated</a>) <a href="#75217" title="(String,Option[java.io.File])Unit">updateLauncher</a>(<a href="#75403" title="String">version</a>, <a href="#75404" title="Option[java.io.File]">temporaryJar</a>)
		
		<span class="keyword">def</span> <a title="=&gt; java.lang.String" id="75419">extra</a> =  <span title="java.lang.String" class="keyword">if</span>(<a href="#75404" title="Option[java.io.File]">temporaryJar</a>.<span title="=&gt; Boolean">isDefined</span>) <span title="java.lang.String(&quot; at &quot;)" class="string">&quot; at &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#75404" title="Option[java.io.File]">temporaryJar</a>.<a title="=&gt; java.io.File" id="19229">get</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span>
		<a href="#75199" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19734" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String" class="keyword">if</span>(<a href="#75418" title="Boolean">updated</a>) <span title="java.lang.String(&quot;Launcher updated&quot;)" class="string">&quot;Launcher updated&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#75419" title="=&gt; java.lang.String">extra</a> <span class="keyword">else</span> <span title="java.lang.String(&quot;Launcher not updated.&quot;)" class="string">&quot;Launcher not updated.&quot;</span>)
	}
	<span class="comment">/** The jar to copy/download to.  If `userJar` is not defined, it is a temporary file in `tmpDir` that should then be moved to the current launcher file.
	* If it is defined and is a directory, the jar is defined in that directory.  If it is a file, that file is returned. */</span>
	<span class="keyword">def</span> <a title="(java.io.File,Option[java.io.File])java.io.File" id="75213">targetJar</a>(<a title="java.io.File" id="75430">tmpDir</a>: <span title="java.io.File">File</span>, <a title="Option[java.io.File]" id="75431">userJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="java.io.File">File</span> = 
		<a href="#75431" title="Option[java.io.File]">userJar</a> <span title="java.io.File" class="keyword">match</span> { <span title="java.io.File" class="keyword">case</span> Some(<a title="java.io.File" id="75432">file</a>) =&gt; <span title="java.io.File" class="keyword">if</span>(<a href="#75432" title="java.io.File">file</a>.<a title="()Boolean" id="16233">isDirectory</a>) <a href="#75203" title="(java.io.File)java.io.File">tempJar</a>(<a href="#75432" title="java.io.File">file</a>) <span class="keyword">else</span> <a href="#75432" title="java.io.File">file</a>; <span title="java.io.File" class="keyword">case</span> <span title="object None">None</span> =&gt; <a href="#75203" title="(java.io.File)java.io.File">tempJar</a>(<a href="#75430" title="java.io.File">tmpDir</a>) }
		
	<span class="comment">/** Gets the given `version` of the launcher from Google Code.  If `userProvidedJar` is defined,
	* this updated launcher is downloaded there, otherwise it overwrites the current launcher. */</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Boolean" id="75214">downloadLauncher</a>(<a title="String" id="75400">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="75401">userProvidedJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="Boolean">Boolean</span> =
	{
		<span class="keyword">def</span> <a title="(java.io.File)Boolean" id="75433">getLauncher</a>(<a title="java.io.File" id="75434">tmp</a>: <span title="java.io.File">File</span>): <span title="Boolean">Boolean</span> =
		{
			<span class="keyword">val</span> <a title="java.io.File" id="75435">temporaryJar</a> = <a href="#75213" title="(java.io.File,Option[java.io.File])java.io.File">targetJar</a>(<a href="#75434" title="java.io.File">tmp</a>, <a href="#75401" title="Option[java.io.File]">userProvidedJar</a>)
			<a href="#75435" title="java.io.File">temporaryJar</a>.<a title="()java.io.File" id="16221">getParentFile</a>.<a title="()Boolean" id="16247">mkdirs</a>()
			<span class="keyword">val</span> <a title="java.net.URL" id="75436">url</a> = <a href="#75215" title="(String)java.net.URL">launcherURL</a>(<a href="#75400" title="String">version</a>)
			<span class="keyword">val</span> <a title="java.net.HttpURLConnection" id="75437">connection</a> = <a href="#75436" title="java.net.URL">url</a>.<a title="()java.net.URLConnection" id="25444">openConnection</a>.<a title="java.net.HttpURLConnection" id="3451">asInstanceOf</a>[<a title="java.net.HttpURLConnection" id="4534">HttpURLConnection</a>]
			<a href="#75437" title="java.net.HttpURLConnection">connection</a>.<a title="(Boolean)Unit" id="75278">setInstanceFollowRedirects</a>(<span title="Boolean(false)" class="keyword">false</span>)
			
			<span class="keyword">def</span> <a title="(java.io.InputStream)Unit" id="75438">download</a>(<a title="java.io.InputStream" id="75511">in</a>: <span title="java.io.InputStream">InputStream</span>): <span title="Unit">Unit</span> = <a href="../OpenResource.scala.html#36918" title="(java.io.File)((java.io.FileOutputStream) =&gt; Unit)Unit">fileOutputStream</a>(<span title="Boolean(false)" class="keyword">false</span>)(<a href="#75435" title="java.io.File">temporaryJar</a>) { <a title="java.io.FileOutputStream" id="75514">out</a> =&gt; <a href="../FileUtilities.scala.html#32068" title="(java.io.InputStream,java.io.OutputStream)Unit">transfer</a>(<a href="#75511" title="java.io.InputStream">in</a>, <a href="#75514" title="java.io.FileOutputStream">out</a>) }
			<span class="keyword">def</span> <a title="(java.io.InputStream)Boolean" id="75439">checkAndRetrieve</a>(<a title="java.io.InputStream" id="75515">in</a>: <span title="java.io.InputStream">InputStream</span>): <span title="Boolean">Boolean</span> =  (<a href="#75437" title="java.net.HttpURLConnection">connection</a>.<span title="()Int">getResponseCode</span> <span title="(Int)Boolean">==</span> <span title="Int(200)">HTTP_OK</span>) <span title="(Boolean)Boolean">&amp;&amp;</span> { <a href="#75438" title="(java.io.InputStream)Unit">download</a>(<a href="#75515" title="java.io.InputStream">in</a>); <span title="Boolean(true)" class="keyword">true</span> }
			<span class="keyword">def</span> <a title="(java.io.IOException)Boolean" id="75440">handleError</a>(<a title="java.io.IOException" id="75518">e</a>: <span title="java.io.IOException">IOException</span>) = <span title="Boolean" class="keyword">if</span>(<a href="#75437" title="java.net.HttpURLConnection">connection</a>.<span title="()Int">getResponseCode</span> <span title="(Int)Boolean">==</span> <span title="Int(404)">HTTP_NOT_FOUND</span> ) <span title="Boolean(false)" class="keyword">false</span> <span class="keyword">else</span> <span title="Nothing" class="keyword">throw</span> <a href="#75518" title="java.io.IOException">e</a>
			<span class="keyword">def</span> <a title="()Boolean" id="75441">retrieve</a>() =
			{
				<span class="keyword">val</span> <a title="java.io.InputStream" id="75523">in</a> = <a href="#75437" title="java.net.HttpURLConnection">connection</a>.<a title="()java.io.InputStream" id="75480">getInputStream</a>
				<span class="keyword">try</span> { <a href="#75439" title="(java.io.InputStream)Boolean">checkAndRetrieve</a>(<a href="#75523" title="java.io.InputStream">in</a>) } <span class="keyword">finally</span> { <a href="#75523" title="java.io.InputStream">in</a>.<a title="()Unit" id="29926">close</a>() }
			}
			
			<span class="keyword">val</span> <a title="Boolean" id="75442">success</a> = <span class="keyword">try</span> { <a href="#75441" title="()Boolean">retrieve</a>() } <span class="keyword">catch</span> { <span title="Boolean" class="keyword">case</span> <a title="java.io.IOException" id="75524">e</a>: <span title="java.io.IOException">IOException</span> =&gt; <a href="#75440" title="(java.io.IOException)Boolean">handleError</a>(<a href="#75524" title="java.io.IOException">e</a>)} <span class="keyword">finally</span> { <a href="#75437" title="java.net.HttpURLConnection">connection</a>.<a title="()Unit" id="75285">disconnect</a>() }
			<span title="Unit" class="keyword">if</span>(<a href="#75442" title="Boolean">success</a> <span title="(Boolean)Boolean">&amp;&amp;</span> <a href="#75401" title="Option[java.io.File]">userProvidedJar</a>.<span title="=&gt; Boolean">isEmpty</span>)
				<a href="#75218" title="(java.io.File,java.io.File)Unit">move</a>(<a href="#75435" title="java.io.File">temporaryJar</a>, <a href="#75201" title="=&gt; java.io.File">launcherJar</a>)
			<a href="#75442" title="Boolean">success</a>
		}
		<a href="../FileUtilities.scala.html#32071" title="((java.io.File) =&gt; Boolean)Boolean">withTemporaryDirectory</a>(<a href="#75433" title="(java.io.File)Boolean">getLauncher</a>)
	}
	<span class="comment">/** The location of the launcher for the given version, if it exists. */</span>
	<span class="keyword">def</span> <a title="(String)java.net.URL" id="75215">launcherURL</a>(<a title="String" id="75443">version</a>: <span title="String">String</span>): <span title="java.net.URL">URL</span> =
		<a title="(java.lang.String)java.net.URL" id="25423" class="keyword">new</a> <span title="java.net.URL">URL</span>(<span title="java.lang.String(&quot;http://simple-build-tool.googlecode.com/files/sbt-launch-&quot;)" class="string">&quot;http://simple-build-tool.googlecode.com/files/sbt-launch-&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#75443" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.jar&quot;)" class="string">&quot;.jar&quot;</span>)
		
	<span class="comment">/** True iff the given user input is empty, 'y' or 'yes' (case-insensitive).*/</span>
	<span class="keyword">def</span> <a title="(String)Boolean" id="75216">isYes</a>(<a title="String" id="75374">line</a>: <span title="String">String</span>) =
	{
		<span class="keyword">val</span> <a title="java.lang.String" id="75376">lower</a> = <a href="#75374" title="String">line</a>.<a title="()java.lang.String" id="5812">toLowerCase</a>
		<a href="#75376" title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString">lower</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(Boolean)Boolean">||</span> <a href="#75376" title="java.lang.String">lower</a> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;y&quot;)" class="string">&quot;y&quot;</span> <span title="(Boolean)Boolean">||</span> <a href="#75376" title="java.lang.String">lower</a> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;yes&quot;)" class="string">&quot;yes&quot;</span>
	}
	<span class="comment">/** Copies the current launcher but with the default 'sbt.version' set to `version`.  If `userProvidedJar` is defined,
	* the updated launcher is copied there, otherwise the copy overwrites the current  launcher. */</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Unit" id="75217">updateLauncher</a>(<a title="String" id="75422">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="75423">userProvidedJar</a>: <span title="Option[java.io.File]">Option</span>[File])
	{
		<span class="keyword">def</span> <a title="(java.io.File,java.io.File)Unit" id="75544">makeUpdated</a>(<a title="java.io.File" id="75546">base</a>: <span title="java.io.File">File</span>, <a title="java.io.File" id="75547">newJar</a>: <span title="java.io.File">File</span>)
		{
			<span class="keyword">val</span> <a title="Set[java.io.File]" id="75548">files</a> = <a href="../FileUtilities.scala.html#32064" title="(java.io.File,java.io.File)Set[java.io.File]">unzip</a>(<a href="#75201" title="=&gt; java.io.File">launcherJar</a>, <a href="#75546" title="java.io.File">base</a>)
			<a href="#75219" title="(Iterable[java.io.File],String)Unit">updateBootProperties</a>(<a href="#75548" title="Set[java.io.File]">files</a>, <a href="#75422" title="String">version</a>)
			<a href="../FileUtilities.scala.html#32083" title="(Iterable[(java.io.File, String)],java.io.File)Unit">zip</a>(<a href="../PathMapper.scala.html#31999" title="(Set[java.io.File])Iterable[(java.io.File, String)]">relativeTo</a>(<a href="#75546" title="java.io.File">base</a>)( <a href="#75548" title="Set[java.io.File]">files</a> ), <a href="#75547" title="java.io.File">newJar</a>)
		}
		<span class="keyword">def</span> <a title="(java.io.File)Unit" id="75545">updateLauncher</a>(<a title="java.io.File" id="75571">tmp</a>: <span title="java.io.File">File</span>)
		{
			<span class="keyword">val</span> <a title="java.io.File" id="75572">basePath</a> = <a href="../Paths.scala.html#47948" title="implicit xsbt.Paths.fileToPath : (java.io.File)xsbt.Path">tmp</a> <a href="../Paths.scala.html#47998" title="(String)java.io.File">/</a> <span title="java.lang.String(&quot;launcher-jar&quot;)" class="string">&quot;launcher-jar&quot;</span>
			<span class="keyword">val</span> <a title="java.io.File" id="75573">temporaryJar</a> = <a href="#75213" title="(java.io.File,Option[java.io.File])java.io.File">targetJar</a>(<a href="#75571" title="java.io.File">tmp</a>, <a href="#75423" title="Option[java.io.File]">userProvidedJar</a>)
			<a href="#75544" title="(java.io.File,java.io.File)Unit">makeUpdated</a>(<a href="#75572" title="java.io.File">basePath</a>, <a href="#75573" title="java.io.File">temporaryJar</a>)
			<span title="Unit" class="keyword">if</span>(<a href="#75423" title="Option[java.io.File]">userProvidedJar</a>.<span title="=&gt; Boolean">isEmpty</span>)
				<a href="#75218" title="(java.io.File,java.io.File)Unit">move</a>(<a href="#75573" title="java.io.File">temporaryJar</a>, <a href="#75201" title="=&gt; java.io.File">launcherJar</a>)
		}

		<a href="../FileUtilities.scala.html#32071" title="((java.io.File) =&gt; Unit)Unit">withTemporaryDirectory</a>(<a href="#75545" title="(java.io.File)Unit">updateLauncher</a>)
	}
	
	<span class="comment">/** Copies the `src` file to the `dest` file, preferably by renaming.  The `src` file may or may not be removed.*/</span>
	<span class="keyword">def</span> <a title="(java.io.File,java.io.File)Unit" id="75218">move</a>(<a title="java.io.File" id="75525">src</a>: <span title="java.io.File">File</span>, <a title="java.io.File" id="75526">dest</a>: <span title="java.io.File">File</span>)
	{
		<span class="keyword">val</span> <a title="Boolean" id="75581">renameSuccess</a> = <a href="#75525" title="java.io.File">src</a> <a title="(java.io.File)Boolean" id="16248">renameTo</a> <a href="#75526" title="java.io.File">dest</a>
		<span title="Unit" class="keyword">if</span>(<span title="=&gt; Boolean">!</span><a href="#75581" title="Boolean">renameSuccess</a>)
			<a href="../FileUtilities.scala.html#32092" title="(java.io.File,java.io.File)Unit">copyFile</a>(<a href="#75525" title="java.io.File">src</a>, <a href="#75526" title="java.io.File">dest</a>)
	}
	
	<span class="comment">/** Updates the default value used for 'sbt.version' in the 'sbt.boot.properties' file in the launcher `files` to be `version`.*/</span>
	<span class="keyword">def</span> <a title="(Iterable[java.io.File],String)Unit" id="75219">updateBootProperties</a>(<a title="Iterable[java.io.File]" id="75557">files</a>: <a title="Iterable[java.io.File]" id="372">Iterable</a>[File], <a title="String" id="75558">version</a>: <span title="String">String</span>): <span title="Unit">Unit</span> =
		<a href="#75557" title="Iterable[java.io.File]">files</a>.<a title="((java.io.File) =&gt; Boolean)Option[java.io.File]" id="16284">find</a>(<a href="#75583" title="java.io.File">_</a>.<span title="()java.lang.String">getName</span> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;sbt.boot.properties&quot;)" class="string">&quot;sbt.boot.properties&quot;</span>).<a title="((java.io.File) =&gt; Unit)Unit" id="19239">foreach</a>(<a href="#75220" title="(String)(java.io.File)Unit">updateBootProperties</a>(<a href="#75558" title="String">version</a>))
	<span class="comment">/** Updates the default value used for 'sbt.version' in the given `file` to be `version`.*/</span>
	<span class="keyword">def</span> <a title="(String)(java.io.File)Unit" id="75220">updateBootProperties</a>(<a title="String" id="75551">version</a>: <span title="String">String</span>)(<a title="java.io.File" id="75552">file</a>: <span title="java.io.File">File</span>)
	{
		<span class="keyword">val</span> <a title="List[java.lang.String]" id="75590">newContent</a> = <a href="../FileUtilities.scala.html#32106" title="(java.io.File)List[String]">readLines</a>(<a href="#75552" title="java.io.File">file</a>) <a title="((String) =&gt; java.lang.String)List[java.lang.String]" id="17963">map</a> <a href="#75221" title="(String)(String)java.lang.String">updateSbtVersion</a>(<a href="#75551" title="String">version</a>)
		<a href="../FileUtilities.scala.html#32094" title="(java.io.File,String)Unit">write</a>(<a href="#75552" title="java.io.File">file</a>, <a href="#75590" title="List[java.lang.String]">newContent</a>.<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>))
	}
	
	<span class="comment">/** If the given `line` is the 'sbt.version' configuration, update it to use the `newVersion`.*/</span>
	<span class="keyword">def</span> <a title="(String)(String)java.lang.String" id="75221">updateSbtVersion</a>(<a title="String" id="75594">newVersion</a>: <span title="String">String</span>)(<a title="String" id="75595">line</a>: <span title="String">String</span>) =
		<span title="java.lang.String" class="keyword">if</span>(<a href="#75595" title="String">line</a>.<span title="()java.lang.String">trim</span>.<a title="(java.lang.String)Boolean" id="5786">startsWith</a>(<span title="java.lang.String(&quot;sbt.version&quot;)" class="string">&quot;sbt.version&quot;</span>)) <a href="#75222" title="(String)java.lang.String">sbtVersion</a>(<a href="#75594" title="String">newVersion</a>) <span class="keyword">else</span> <a href="#75595" title="String">line</a>
		
	<span class="comment">/** The configuration line that defines the 'sbt.version' property, using the provided `version` for defaults.*/</span>
	<span class="keyword">def</span> <a title="(String)java.lang.String" id="75222">sbtVersion</a>(<a title="String" id="75598">version</a>: <span title="String">String</span>) =
		<span title="java.lang.String(&quot; sbt.version: quick=set(&quot;)" class="string">&quot; sbt.version: quick=set(&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#75598" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;), new=prompt(sbt version)[&quot;)" class="string">&quot;), new=prompt(sbt version)[&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#75598" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;], fill=prompt(sbt version)[&quot;)" class="string">&quot;], fill=prompt(sbt version)[&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#75598" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span>
	
	<span class="comment">/** Copies the given ApplicationID but with the specified version.*/</span>
	<span class="keyword">def</span> <a title="(xsbti.ApplicationID,String)xsbti.ApplicationID" id="75223">changeVersion</a>(<a title="xsbti.ApplicationID" id="75408">appID</a>: xsbti.<a href="../xsbti/ApplicationID.java.html#5887" title="xsbti.ApplicationID">ApplicationID</a>, <a title="String" id="75409">versionA</a>: <span title="String">String</span>): xsbti.<a href="../xsbti/ApplicationID.java.html#5887" title="xsbti.ApplicationID">ApplicationID</a> =
		<a title="template $anon extends java.lang.Object with xsbti.ApplicationID" id="75604" class="keyword">new</a> xsbti.<a href="../xsbti/ApplicationID.java.html#5887" title="xsbti.ApplicationID">ApplicationID</a> {
			<span class="keyword">def</span> <a title="()java.lang.String" id="75606">groupID</a> = <a href="#75408" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#30979" title="()java.lang.String">groupID</a>
			<span class="keyword">def</span> <a title="()java.lang.String" id="75607">name</a> = <a href="#75408" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#30980" title="()java.lang.String">name</a>
			<span class="keyword">def</span> <a title="()String" id="75608">version</a> = <a href="#75409" title="String">versionA</a>
			<span class="keyword">def</span> <a title="()java.lang.String" id="75609">mainClass</a> = <a href="#75408" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#30982" title="()java.lang.String">mainClass</a>
			<span class="keyword">def</span> <a title="()Array[java.lang.String]" id="75610">mainComponents</a> = <a href="#75408" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#30983" title="()Array[java.lang.String]">mainComponents</a>
			<span class="keyword">def</span> <a title="()Boolean" id="75611">crossVersioned</a> = <a href="#75408" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#30984" title="()Boolean">crossVersioned</a>
			<span class="keyword">def</span> <a title="()Array[java.io.File]" id="75612">classpathExtra</a> = <a href="#75408" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#30985" title="()Array[java.io.File]">classpathExtra</a>
		}
}

        </pre>
    </body>
</html>