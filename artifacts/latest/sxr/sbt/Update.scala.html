<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/Update.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2010 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="comment">/** A trait that provides a task for updating sbt.  */</span>
<span class="keyword">trait</span> <a title="trait UpdateSbt extends java.lang.Object with sbt.Project with ScalaObject" id="10496">UpdateSbt</a> <span class="keyword">extends</span> <a href="Project.scala.html#9290" title="sbt.Project">Project</a>
{
	<span class="comment">/** The first argument is the version to update to and is mandatory.
	* The second argument is the location of the launcher jar.  If omitted, the launcher used to launch the currently running instance of sbt is used.*/</span>
	<span class="keyword">lazy</span> <span class="keyword">val</span> <a title="UpdateSbt.this.MethodTask" id="82700">sbtUpdate</a> = <a href="TaskManager.scala.html#53829" title="((Array[String]) =&gt; UpdateSbt.this.ManagedTask)UpdateSbt.this.MethodTask">task</a> { <a title="Array[String]" id="82709">args</a> =&gt; <a href="TaskManager.scala.html#53827" title="(=&gt; Option[String])UpdateSbt.this.Task">task</a> { (<a href="#82731" title="(Array[String])Option[String]" class="keyword">new</a> <a href="#10262" title="sbt.Update">Update</a>(<a href="#10496" title="sbt.UpdateSbt" class="keyword">this</a>))(<a href="#82709" title="Array[String]">args</a>) } } <a href="TaskManager.scala.html#55177" title="(String)UpdateSbt.this.MethodTask">describedAs</a>(<span title="java.lang.String(&quot;Updates the version of sbt used to build this project and updates the launcher jar.&quot;)" class="string">&quot;Updates the version of sbt used to build this project and updates the launcher jar.&quot;</span>)
}

<span class="keyword">import</span> java.io.{File, InputStream, IOException}
<span class="keyword">import</span> java.net.{HttpURLConnection, URL}
<span class="keyword">import</span> HttpURLConnection.{HTTP_NOT_FOUND , HTTP_OK}
<span class="keyword">import</span> SimpleReader.readLine
<span class="keyword">import</span> xsbt.FileUtilities.{classLocationFile, copyFile, readLines, transfer, unzip, withTemporaryDirectory, write, zip}
<span class="keyword">import</span> xsbt.PathMapper.relativeTo
<span class="keyword">import</span> xsbt.Paths._
<span class="keyword">import</span> xsbt.OpenResource.{fileOutputStream, urlInputStream}

<span class="keyword">private</span> <span class="keyword">class</span> <a title="class Update extends java.lang.Object with ScalaObject" id="10262">Update</a>(<a title="sbt.Project" id="82751">project</a>: <a href="Project.scala.html#9290" title="sbt.Project">Project</a>)
{
	<span class="keyword">val</span> <a title="sbt.ProjectInfo" id="82722">info</a> = <a href="#82751" title="sbt.Project">project</a>.<a href="Project.scala.html#53847" title="=&gt; sbt.ProjectInfo">info</a>
	<span class="keyword">val</span> <a title="xsbti.AppProvider" id="82724">app</a> = <a href="#82722" title="=&gt; sbt.ProjectInfo">info</a>.<a href="ProjectInfo.scala.html#55137" title="=&gt; xsbti.AppProvider">app</a>
	<span class="keyword">val</span> <a title="sbt.Logger" id="82726">log</a> = <a href="#82751" title="sbt.Project">project</a>.<a href="Project.scala.html#53842" title="=&gt; sbt.Logger">log</a>
	
	<span class="comment">/** The location of the jar used to launch the currently running instance of sbt.*/</span>
	<span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.io.File" id="82729">launcherJar</a> = <a href="../FileUtilities.scala.html#18420" title="(implicit scala.reflect.Manifest[xsbti.AppProvider])java.io.File" id="2651">classLocationFile</a>[xsbti.<a href="../xsbti/AppProvider.java.html#7627" title="xsbti.AppProvider">AppProvider</a>]
	<span class="comment">/** A temporary jar file to use in the given directory. */</span>
	<span class="keyword">def</span> <a title="(java.io.File)java.io.File" id="82730">tempJar</a>(<a title="java.io.File" id="82839">dir</a>: <span title="java.io.File">File</span>) = <a href="../Paths.scala.html#20819" title="implicit xsbt.Paths.fileToPath : (java.io.File)xsbt.Path">dir</a> <a href="../Paths.scala.html#20867" title="(String)java.io.File">/</a> <a href="#82728" title="=&gt; java.io.File">launcherJar</a>.<span title="()java.lang.String">getName</span>
		
	<span class="comment">/** Implementation of the sbt-update task: reads arguments and hands off to the other `apply`.*/</span>
	<span class="keyword">def</span> <a title="(Array[String])Option[String]" id="82731">apply</a>(<a title="Array[String]" id="82825">args</a>: <a title="Array[String]" id="1032">Array</a>[String]): <span title="Option[String]">Option</span>[String] =
		<a href="#82825" title="Array[String]">args</a> <span title="Option[String]" class="keyword">match</span>
		{
			<span title="Option[String]" class="keyword">case</span> <a href="#82864" title="(Array[String])Option[Seq[String]]">Array</a>(<a title="String" id="82867">version</a>) <span class="keyword">if</span> <a href="#82732" title="(String)Boolean">validVersion</a>(<a href="#82867" title="String">version</a>) =&gt; <a href="#82733" title="(String,Option[java.io.File])Option[String]">apply</a>(<a href="#82867" title="String">version</a>, <span title="object None">None</span>)
			<span title="Option[String]" class="keyword">case</span> <a href="#82889" title="(Array[String])Option[Seq[String]]">Array</a>(<a title="String" id="82892">version</a>, <a title="String" id="82893">temporaryJar</a>) <span class="keyword">if</span> <a href="#82732" title="(String)Boolean">validVersion</a>(<a href="#82892" title="String">version</a>) =&gt; <a href="#82733" title="(String,Option[java.io.File])Option[String]">apply</a>(<a href="#82892" title="String">version</a>, <span title="(java.io.File)Some[java.io.File]">Some</span>(<span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span>(<a href="#82893" title="String">temporaryJar</a>) <a title="()java.io.File" id="16961">getAbsoluteFile</a>))
			<span title="Some[java.lang.String]" class="keyword">case</span> _ =&gt; <span title="(java.lang.String)Some[java.lang.String]">Some</span>(<span title="java.lang.String(&quot;Expected '&lt;version&gt;' or '&lt;version&gt; &lt;new-launcher-file&gt;', got '&quot;)" class="string">&quot;Expected '&lt;version&gt;' or '&lt;version&gt; &lt;new-launcher-file&gt;', got '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#82825" title="Array[String]">args</a>.<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span>) <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;'&quot;)" class="string">&quot;'&quot;</span>)
		}

	<span class="keyword">def</span> <a title="(String)Boolean" id="82732">validVersion</a>(<a title="String" id="82868">version</a>: <span title="String">String</span>) = <span title="=&gt; Boolean">!</span><a href="#82868" title="String">version</a>.<span title="()java.lang.String">trim</span>.<span title="()Boolean">isEmpty</span>

	<span class="comment">/** Implementation of the sbt-update task after arguments have checked.  Gives user a chance to cancel and continues with `doUpdate`.*/</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Option[String]" id="82733">apply</a>(<a title="String" id="82754">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="82755">temporaryJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="Option[String]">Option</span>[String] =
	{
		<a href="LineReader.scala.html#60215" title="(String)Option[java.lang.String]">readLine</a>(<span title="java.lang.String(&quot;Updating the sbt version requires a restart.  Continue? (Y/n) &quot;)" class="string">&quot;Updating the sbt version requires a restart.  Continue? (Y/n) &quot;</span>) <span title="Option[String]" class="keyword">match</span>
		{
			<span title="Option[String]" class="keyword">case</span> Some(<a title="java.lang.String" id="82912">line</a>) <span class="keyword">if</span>(<a href="#82743" title="(String)Boolean">isYes</a>(<a href="#82912" title="java.lang.String">line</a>)) =&gt; <a href="#82734" title="(String,Option[java.io.File])Option[String]">doUpdate</a>(<a href="#82754" title="String">version</a>, <a href="#82755" title="Option[java.io.File]">temporaryJar</a>)
			<span title="Some[java.lang.String]" class="keyword">case</span> _ =&gt; <span title="(java.lang.String)Some[java.lang.String]">Some</span>(<span title="java.lang.String(&quot;Update declined.&quot;)" class="string">&quot;Update declined.&quot;</span>)
		}
	}
	<span class="comment">/** Implementation of the sbt-update task: high-level control after initial verification.*/</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Option[String]" id="82734">doUpdate</a>(<a title="String" id="82921">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="82922">temporaryJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="Option[String]">Option</span>[String] =
	{
		<a href="#82736" title="(String)Unit">retrieveNewVersion</a>(<a href="#82921" title="String">version</a>)
		<a href="#82726" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#52375" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Version is valid.  Setting 'sbt.version' to &quot;)" class="string">&quot;Version is valid.  Setting 'sbt.version' to &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#82921" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;...&quot;)" class="string">&quot;...&quot;</span>)
		<a href="#82735" title="(String)Unit">setNewVersion</a>(<a href="#82921" title="String">version</a>)

		<a href="#82726" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#52375" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;'sbt.version' updated.&quot;)" class="string">&quot;'sbt.version' updated.&quot;</span>)
		<span title="Unit" class="keyword">if</span>(<a href="#82922" title="Option[java.io.File]">temporaryJar</a>.<span title="=&gt; Boolean">isDefined</span> <span title="(Boolean)Boolean">||</span> <a href="#82737" title="(String)Boolean">updateInPlace</a>(<a href="#82921" title="String">version</a>))
		{
			<a href="#82726" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#52375" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Downloading new launcher ...&quot;)" class="string">&quot;Downloading new launcher ...&quot;</span>)
			
			<span title="Unit" class="keyword">if</span>(<a href="#82741" title="(String,Option[java.io.File])Boolean">downloadLauncher</a>(<a href="#82921" title="String">version</a>, <a href="#82922" title="Option[java.io.File]">temporaryJar</a>))
				<a href="#82726" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#52375" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Downloaded launcher.&quot;)" class="string">&quot;Downloaded launcher.&quot;</span>)
			<span class="keyword">else</span>
				<a href="#82739" title="(String,Option[java.io.File])Unit">tryUpdateLauncher</a>(<a href="#82921" title="String">version</a>, <a href="#82922" title="Option[java.io.File]">temporaryJar</a>)
		}
		<span class="keyword">else</span>
			<a href="#82726" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#52375" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Launcher update declined.&quot;)" class="string">&quot;Launcher update declined.&quot;</span>)

		<a href="#82726" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#52375" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Please restart sbt.&quot;)" class="string">&quot;Please restart sbt.&quot;</span>)
		<a title="object java.lang.System" id="1825">System</a>.<a title="(Int)Unit" id="18323">exit</a>(<span title="Int(0)" class="int">0</span>)
		<span title="object None">None</span>
	}
	<span class="comment">/** Updates 'sbt.version' in `project/build.properties`.*/</span>
	<span class="keyword">def</span> <a title="(String)Unit" id="82735">setNewVersion</a>(<a title="String" id="82926">version</a>: <span title="String">String</span>)
	{
		<a href="#82751" title="sbt.Project">project</a>.<a href="Project.scala.html#53904" title="=&gt; Update.this.project.Property[String]">sbtVersion</a>() = <a href="#82926" title="String">version</a>
		<a href="#82751" title="sbt.Project">project</a>.<a href="Environment.scala.html#54318" title="()Option[String]">saveEnvironment</a>()
	}
	<span class="comment">/** Retrieves the given `version` of sbt in order to verify the version is valid.*/</span>
	<span class="keyword">def</span> <a title="(String)Unit" id="82736">retrieveNewVersion</a>(<a title="String" id="82924">version</a>: <span title="String">String</span>)
	{
		<span class="keyword">val</span> <a title="xsbti.ApplicationID" id="82940">newAppID</a> = <a href="#82750" title="(xsbti.ApplicationID,String)xsbti.ApplicationID">changeVersion</a>(<a href="#82724" title="=&gt; xsbti.AppProvider">app</a>.<a href="../xsbti/AppProvider.java.html#55550" title="()xsbti.ApplicationID">id</a>, <a href="#82924" title="String">version</a>)
		<a href="#82726" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#52375" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Checking repositories for sbt &quot;)" class="string">&quot;Checking repositories for sbt &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#82924" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; ...&quot;)" class="string">&quot; ...&quot;</span>)
		<a href="#82724" title="=&gt; xsbti.AppProvider">app</a>.<a href="../xsbti/AppProvider.java.html#55549" title="()xsbti.ScalaProvider">scalaProvider</a>.<a href="../xsbti/ScalaProvider.java.html#22545" title="(xsbti.ApplicationID)xsbti.AppProvider">app</a>(<a href="#82940" title="xsbti.ApplicationID">newAppID</a>)
	}
	<span class="comment">/** Asks the user whether the current launcher should be overrwritten.  Called when no file is explicitly specified as an argument. */</span>
	<span class="keyword">def</span> <a title="(String)Boolean" id="82737">updateInPlace</a>(<a title="String" id="82928">version</a>: <span title="String">String</span>) =
	{
		<span class="keyword">val</span> <a title="Option[java.lang.String]" id="82930">input</a> = <a href="LineReader.scala.html#60215" title="(String)Option[java.lang.String]">readLine</a>(<span title="java.lang.String(&quot; The current launcher (&quot;)" class="string">&quot; The current launcher (&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#82728" title="=&gt; java.io.File">launcherJar</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;) will be updated in place.  Continue? (Y/n) &quot;)" class="string">&quot;) will be updated in place.  Continue? (Y/n) &quot;</span>)
		<a href="#82738" title="(Option[String])Boolean">isYes</a>(<a href="#82930" title="Option[java.lang.String]">input</a>)
	}
	<span class="keyword">def</span> <a title="(Option[String])Boolean" id="82738">isYes</a>(<a title="Option[String]" id="82920">line</a>: <span title="Option[String]">Option</span>[String]): <span title="Boolean">Boolean</span> = <a href="#82920" title="Option[String]">line</a>.<a title="((String) =&gt; Boolean)Option[String]" id="30537">filter</a>(<a href="#82743" title="(String)Boolean">isYes</a>).<span title="=&gt; Boolean">isDefined</span>
	
	<span class="comment">/** Updates the launcher as in `updateLauncher` but performs various checks and logging around it. */</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Unit" id="82739">tryUpdateLauncher</a>(<a title="String" id="82936">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="82937">temporaryJar</a>: <span title="Option[java.io.File]">Option</span>[File])
	{
		<a href="#82726" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#52376" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;No launcher found for '&quot;)" class="string">&quot;No launcher found for '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#82936" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;'&quot;)" class="string">&quot;'&quot;</span>)
		<span class="keyword">def</span> <a title="=&gt; java.lang.String" id="82949">promptStart</a> = <span title="java.lang.String" class="keyword">if</span>(<a href="#82937" title="Option[java.io.File]">temporaryJar</a>.<span title="=&gt; Boolean">isDefined</span>) <span title="java.lang.String(&quot; Copy current launcher but with &quot;)" class="string">&quot; Copy current launcher but with &quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot; Modify current launcher to use &quot;)" class="string">&quot; Modify current launcher to use &quot;</span>
		<span class="keyword">val</span> <a title="Option[java.lang.String]" id="82950">input</a> = <a href="LineReader.scala.html#60215" title="(String)Option[java.lang.String]">readLine</a>(<a href="#82949" title="=&gt; java.lang.String">promptStart</a> <span title="(Any)java.lang.String">+</span> <a href="#82936" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; as the default for new projects? (Y/n) &quot;)" class="string">&quot; as the default for new projects? (Y/n) &quot;</span>)
		<span class="keyword">val</span> <a title="Boolean" id="82951">updated</a> = <a href="#82738" title="(Option[String])Boolean">isYes</a>(<a href="#82950" title="Option[java.lang.String]">input</a>)
		<span title="Unit" class="keyword">if</span>(<a href="#82951" title="Boolean">updated</a>) <a href="#82744" title="(String,Option[java.io.File])Unit">updateLauncher</a>(<a href="#82936" title="String">version</a>, <a href="#82937" title="Option[java.io.File]">temporaryJar</a>)
		
		<span class="keyword">def</span> <a title="=&gt; java.lang.String" id="82952">extra</a> =  <span title="java.lang.String" class="keyword">if</span>(<a href="#82937" title="Option[java.io.File]">temporaryJar</a>.<span title="=&gt; Boolean">isDefined</span>) <span title="java.lang.String(&quot; at &quot;)" class="string">&quot; at &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#82937" title="Option[java.io.File]">temporaryJar</a>.<a title="=&gt; java.io.File" id="30528">get</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span>
		<a href="#82726" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#52375" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String" class="keyword">if</span>(<a href="#82951" title="Boolean">updated</a>) <span title="java.lang.String(&quot;Launcher updated&quot;)" class="string">&quot;Launcher updated&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#82952" title="=&gt; java.lang.String">extra</a> <span class="keyword">else</span> <span title="java.lang.String(&quot;Launcher not updated.&quot;)" class="string">&quot;Launcher not updated.&quot;</span>)
	}
	<span class="comment">/** The jar to copy/download to.  If `userJar` is not defined, it is a temporary file in `tmpDir` that should then be moved to the current launcher file.
	* If it is defined and is a directory, the jar is defined in that directory.  If it is a file, that file is returned. */</span>
	<span class="keyword">def</span> <a title="(java.io.File,Option[java.io.File])java.io.File" id="82740">targetJar</a>(<a title="java.io.File" id="82963">tmpDir</a>: <span title="java.io.File">File</span>, <a title="Option[java.io.File]" id="82964">userJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="java.io.File">File</span> = 
		<a href="#82964" title="Option[java.io.File]">userJar</a> <span title="java.io.File" class="keyword">match</span> { <span title="java.io.File" class="keyword">case</span> Some(<a title="java.io.File" id="82965">file</a>) =&gt; <span title="java.io.File" class="keyword">if</span>(<a href="#82965" title="java.io.File">file</a>.<a title="()Boolean" id="16969">isDirectory</a>) <a href="#82730" title="(java.io.File)java.io.File">tempJar</a>(<a href="#82965" title="java.io.File">file</a>) <span class="keyword">else</span> <a href="#82965" title="java.io.File">file</a>; <span title="java.io.File" class="keyword">case</span> <span title="object None">None</span> =&gt; <a href="#82730" title="(java.io.File)java.io.File">tempJar</a>(<a href="#82963" title="java.io.File">tmpDir</a>) }
		
	<span class="comment">/** Gets the given `version` of the launcher from Google Code.  If `userProvidedJar` is defined,
	* this updated launcher is downloaded there, otherwise it overwrites the current launcher. */</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Boolean" id="82741">downloadLauncher</a>(<a title="String" id="82933">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="82934">userProvidedJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="Boolean">Boolean</span> =
	{
		<span class="keyword">def</span> <a title="(java.io.File)Boolean" id="82966">getLauncher</a>(<a title="java.io.File" id="82967">tmp</a>: <span title="java.io.File">File</span>): <span title="Boolean">Boolean</span> =
		{
			<span class="keyword">val</span> <a title="java.io.File" id="82968">temporaryJar</a> = <a href="#82740" title="(java.io.File,Option[java.io.File])java.io.File">targetJar</a>(<a href="#82967" title="java.io.File">tmp</a>, <a href="#82934" title="Option[java.io.File]">userProvidedJar</a>)
			<a href="#82968" title="java.io.File">temporaryJar</a>.<a title="()java.io.File" id="16957">getParentFile</a>.<a title="()Boolean" id="16983">mkdirs</a>()
			<span class="keyword">val</span> <a title="java.net.URL" id="82969">url</a> = <a href="#82742" title="(String)java.net.URL">launcherURL</a>(<a href="#82933" title="String">version</a>)
			<span class="keyword">val</span> <a title="java.net.HttpURLConnection" id="82970">connection</a> = <a href="#82969" title="java.net.URL">url</a>.<a title="()java.net.URLConnection" id="19278">openConnection</a>.<a title="java.net.HttpURLConnection" id="3442">asInstanceOf</a>[<a title="java.net.HttpURLConnection" id="4622">HttpURLConnection</a>]
			<a href="#82970" title="java.net.HttpURLConnection">connection</a>.<a title="(Boolean)Unit" id="82805">setInstanceFollowRedirects</a>(<span title="Boolean(false)" class="keyword">false</span>)
			
			<span class="keyword">def</span> <a title="(java.io.InputStream)Unit" id="82971">download</a>(<a title="java.io.InputStream" id="83055">in</a>: <span title="java.io.InputStream">InputStream</span>): <span title="Unit">Unit</span> = <a href="../OpenResource.scala.html#83063" title="(java.io.File)((java.io.FileOutputStream) =&gt; Unit)Unit">fileOutputStream</a>(<span title="Boolean(false)" class="keyword">false</span>)(<a href="#82968" title="java.io.File">temporaryJar</a>) { <a title="java.io.FileOutputStream" id="83101">out</a> =&gt; <a href="../FileUtilities.scala.html#18436" title="(java.io.InputStream,java.io.OutputStream)Unit">transfer</a>(<a href="#83055" title="java.io.InputStream">in</a>, <a href="#83101" title="java.io.FileOutputStream">out</a>) }
			<span class="keyword">def</span> <a title="(java.io.InputStream)Boolean" id="82972">checkAndRetrieve</a>(<a title="java.io.InputStream" id="83104">in</a>: <span title="java.io.InputStream">InputStream</span>): <span title="Boolean">Boolean</span> =  (<a href="#82970" title="java.net.HttpURLConnection">connection</a>.<span title="()Int">getResponseCode</span> <span title="(Int)Boolean">==</span> <span title="Int(200)">HTTP_OK</span>) <span title="(Boolean)Boolean">&amp;&amp;</span> { <a href="#82971" title="(java.io.InputStream)Unit">download</a>(<a href="#83104" title="java.io.InputStream">in</a>); <span title="Boolean(true)" class="keyword">true</span> }
			<span class="keyword">def</span> <a title="(java.io.IOException)Boolean" id="82973">handleError</a>(<a title="java.io.IOException" id="83107">e</a>: <span title="java.io.IOException">IOException</span>) = <span title="Boolean" class="keyword">if</span>(<a href="#82970" title="java.net.HttpURLConnection">connection</a>.<span title="()Int">getResponseCode</span> <span title="(Int)Boolean">==</span> <span title="Int(404)">HTTP_NOT_FOUND</span> ) <span title="Boolean(false)" class="keyword">false</span> <span class="keyword">else</span> <span title="Nothing" class="keyword">throw</span> <a href="#83107" title="java.io.IOException">e</a>
			<span class="keyword">def</span> <a title="()Boolean" id="82974">retrieve</a>() =
			{
				<span class="keyword">val</span> <a title="java.io.InputStream" id="83115">in</a> = <a href="#82970" title="java.net.HttpURLConnection">connection</a>.<a title="()java.io.InputStream" id="83024">getInputStream</a>
				<span class="keyword">try</span> { <a href="#82972" title="(java.io.InputStream)Boolean">checkAndRetrieve</a>(<a href="#83115" title="java.io.InputStream">in</a>) } <span class="keyword">finally</span> { <a href="#83115" title="java.io.InputStream">in</a>.<a title="()Unit" id="20897">close</a>() }
			}
			
			<span class="keyword">val</span> <a title="Boolean" id="82975">success</a> = <span class="keyword">try</span> { <a href="#82974" title="()Boolean">retrieve</a>() } <span class="keyword">catch</span> { <span title="Boolean" class="keyword">case</span> <a title="java.io.IOException" id="83116">e</a>: <span title="java.io.IOException">IOException</span> =&gt; <a href="#82973" title="(java.io.IOException)Boolean">handleError</a>(<a href="#83116" title="java.io.IOException">e</a>)} <span class="keyword">finally</span> { <a href="#82970" title="java.net.HttpURLConnection">connection</a>.<a title="()Unit" id="82812">disconnect</a>() }
			<span title="Unit" class="keyword">if</span>(<a href="#82975" title="Boolean">success</a> <span title="(Boolean)Boolean">&amp;&amp;</span> <a href="#82934" title="Option[java.io.File]">userProvidedJar</a>.<span title="=&gt; Boolean">isEmpty</span>)
				<a href="#82745" title="(java.io.File,java.io.File)Unit">move</a>(<a href="#82968" title="java.io.File">temporaryJar</a>, <a href="#82728" title="=&gt; java.io.File">launcherJar</a>)
			<a href="#82975" title="Boolean">success</a>
		}
		<a href="../FileUtilities.scala.html#18439" title="((java.io.File) =&gt; Boolean)Boolean">withTemporaryDirectory</a>(<a href="#82966" title="(java.io.File)Boolean">getLauncher</a>)
	}
	<span class="comment">/** The location of the launcher for the given version, if it exists. */</span>
	<span class="keyword">def</span> <a title="(String)java.net.URL" id="82742">launcherURL</a>(<a title="String" id="82976">version</a>: <span title="String">String</span>): <span title="java.net.URL">URL</span> =
		<a title="(java.lang.String)java.net.URL" id="19257" class="keyword">new</a> <span title="java.net.URL">URL</span>(<span title="java.lang.String(&quot;http://simple-build-tool.googlecode.com/files/sbt-launch-&quot;)" class="string">&quot;http://simple-build-tool.googlecode.com/files/sbt-launch-&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#82976" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.jar&quot;)" class="string">&quot;.jar&quot;</span>)
		
	<span class="comment">/** True iff the given user input is empty, 'y' or 'yes' (case-insensitive).*/</span>
	<span class="keyword">def</span> <a title="(String)Boolean" id="82743">isYes</a>(<a title="String" id="82914">line</a>: <span title="String">String</span>) =
	{
		<span class="keyword">val</span> <a title="java.lang.String" id="82916">lower</a> = <a href="#82914" title="String">line</a>.<a title="()java.lang.String" id="6396">toLowerCase</a>
		<a href="#82916" title="java.lang.String">lower</a>.<span title="()Boolean">isEmpty</span> <span title="(Boolean)Boolean">||</span> <a href="#82916" title="java.lang.String">lower</a> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;y&quot;)" class="string">&quot;y&quot;</span> <span title="(Boolean)Boolean">||</span> <a href="#82916" title="java.lang.String">lower</a> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;yes&quot;)" class="string">&quot;yes&quot;</span>
	}
	<span class="comment">/** Copies the current launcher but with the default 'sbt.version' set to `version`.  If `userProvidedJar` is defined,
	* the updated launcher is copied there, otherwise the copy overwrites the current  launcher. */</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Unit" id="82744">updateLauncher</a>(<a title="String" id="82955">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="82956">userProvidedJar</a>: <span title="Option[java.io.File]">Option</span>[File])
	{
		<span class="keyword">def</span> <a title="(java.io.File,java.io.File)Unit" id="83123">makeUpdated</a>(<a title="java.io.File" id="83125">base</a>: <span title="java.io.File">File</span>, <a title="java.io.File" id="83126">newJar</a>: <span title="java.io.File">File</span>)
		{
			<span class="keyword">val</span> <a title="Set[java.io.File]" id="83127">files</a> = <a href="../FileUtilities.scala.html#18432" title="(java.io.File,java.io.File)Set[java.io.File]">unzip</a>(<a href="#82728" title="=&gt; java.io.File">launcherJar</a>, <a href="#83125" title="java.io.File">base</a>)
			<a href="#82746" title="(Iterable[java.io.File],String)Unit">updateBootProperties</a>(<a href="#83127" title="Set[java.io.File]">files</a>, <a href="#82955" title="String">version</a>)
			<a href="../FileUtilities.scala.html#18451" title="(Iterable[(java.io.File, String)],java.io.File)Unit">zip</a>(<a href="../PathMapper.scala.html#21166" title="(Set[java.io.File])Iterable[(java.io.File, String)]">relativeTo</a>(<a href="#83125" title="java.io.File">base</a>)( <a href="#83127" title="Set[java.io.File]">files</a> ), <a href="#83126" title="java.io.File">newJar</a>)
		}
		<span class="keyword">def</span> <a title="(java.io.File)Unit" id="83124">updateLauncher</a>(<a title="java.io.File" id="83152">tmp</a>: <span title="java.io.File">File</span>)
		{
			<span class="keyword">val</span> <a title="java.io.File" id="83153">basePath</a> = <a href="../Paths.scala.html#20819" title="implicit xsbt.Paths.fileToPath : (java.io.File)xsbt.Path">tmp</a> <a href="../Paths.scala.html#20867" title="(String)java.io.File">/</a> <span title="java.lang.String(&quot;launcher-jar&quot;)" class="string">&quot;launcher-jar&quot;</span>
			<span class="keyword">val</span> <a title="java.io.File" id="83154">temporaryJar</a> = <a href="#82740" title="(java.io.File,Option[java.io.File])java.io.File">targetJar</a>(<a href="#83152" title="java.io.File">tmp</a>, <a href="#82956" title="Option[java.io.File]">userProvidedJar</a>)
			<a href="#83123" title="(java.io.File,java.io.File)Unit">makeUpdated</a>(<a href="#83153" title="java.io.File">basePath</a>, <a href="#83154" title="java.io.File">temporaryJar</a>)
			<span title="Unit" class="keyword">if</span>(<a href="#82956" title="Option[java.io.File]">userProvidedJar</a>.<span title="=&gt; Boolean">isEmpty</span>)
				<a href="#82745" title="(java.io.File,java.io.File)Unit">move</a>(<a href="#83154" title="java.io.File">temporaryJar</a>, <a href="#82728" title="=&gt; java.io.File">launcherJar</a>)
		}

		<a href="../FileUtilities.scala.html#18439" title="((java.io.File) =&gt; Unit)Unit">withTemporaryDirectory</a>(<a href="#83124" title="(java.io.File)Unit">updateLauncher</a>)
	}
	
	<span class="comment">/** Copies the `src` file to the `dest` file, preferably by renaming.  The `src` file may or may not be removed.*/</span>
	<span class="keyword">def</span> <a title="(java.io.File,java.io.File)Unit" id="82745">move</a>(<a title="java.io.File" id="83117">src</a>: <span title="java.io.File">File</span>, <a title="java.io.File" id="83118">dest</a>: <span title="java.io.File">File</span>)
	{
		<span class="keyword">val</span> <a title="Boolean" id="83162">renameSuccess</a> = <a href="#83117" title="java.io.File">src</a> <a title="(java.io.File)Boolean" id="16984">renameTo</a> <a href="#83118" title="java.io.File">dest</a>
		<span title="Unit" class="keyword">if</span>(<span title="=&gt; Boolean">!</span><a href="#83162" title="Boolean">renameSuccess</a>)
			<a href="../FileUtilities.scala.html#18460" title="(java.io.File,java.io.File)Unit">copyFile</a>(<a href="#83117" title="java.io.File">src</a>, <a href="#83118" title="java.io.File">dest</a>)
	}
	
	<span class="comment">/** Updates the default value used for 'sbt.version' in the 'sbt.boot.properties' file in the launcher `files` to be `version`.*/</span>
	<span class="keyword">def</span> <a title="(Iterable[java.io.File],String)Unit" id="82746">updateBootProperties</a>(<a title="Iterable[java.io.File]" id="83136">files</a>: <a title="Iterable[java.io.File]" id="372">Iterable</a>[File], <a title="String" id="83137">version</a>: <span title="String">String</span>): <span title="Unit">Unit</span> =
		<a href="#83136" title="Iterable[java.io.File]">files</a>.<a title="((java.io.File) =&gt; Boolean)Option[java.io.File]" id="16151">find</a>(<a href="#83166" title="java.io.File">_</a>.<span title="()java.lang.String">getName</span> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;sbt.boot.properties&quot;)" class="string">&quot;sbt.boot.properties&quot;</span>).<a title="((java.io.File) =&gt; Unit)Unit" id="30538">foreach</a>(<a href="#82747" title="(String)(java.io.File)Unit">updateBootProperties</a>(<a href="#83137" title="String">version</a>))
	<span class="comment">/** Updates the default value used for 'sbt.version' in the given `file` to be `version`.*/</span>
	<span class="keyword">def</span> <a title="(String)(java.io.File)Unit" id="82747">updateBootProperties</a>(<a title="String" id="83130">version</a>: <span title="String">String</span>)(<a title="java.io.File" id="83131">file</a>: <span title="java.io.File">File</span>)
	{
		<span class="keyword">val</span> <a title="List[java.lang.String]" id="83173">newContent</a> = <a href="../FileUtilities.scala.html#18474" title="(java.io.File)List[String]">readLines</a>(<a href="#83131" title="java.io.File">file</a>) <a title="((String) =&gt; java.lang.String)List[java.lang.String]" id="15727">map</a> <a href="#82748" title="(String)(String)java.lang.String">updateSbtVersion</a>(<a href="#83130" title="String">version</a>)
		<a href="../FileUtilities.scala.html#18462" title="(java.io.File,String)Unit">write</a>(<a href="#83131" title="java.io.File">file</a>, <a href="#83173" title="List[java.lang.String]">newContent</a>.<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>))
	}
	
	<span class="comment">/** If the given `line` is the 'sbt.version' configuration, update it to use the `newVersion`.*/</span>
	<span class="keyword">def</span> <a title="(String)(String)java.lang.String" id="82748">updateSbtVersion</a>(<a title="String" id="83177">newVersion</a>: <span title="String">String</span>)(<a title="String" id="83178">line</a>: <span title="String">String</span>) =
		<span title="java.lang.String" class="keyword">if</span>(<a href="#83178" title="String">line</a>.<span title="()java.lang.String">trim</span>.<a title="(java.lang.String)Boolean" id="6370">startsWith</a>(<span title="java.lang.String(&quot;sbt.version&quot;)" class="string">&quot;sbt.version&quot;</span>)) <a href="#82749" title="(String)java.lang.String">sbtVersion</a>(<a href="#83177" title="String">newVersion</a>) <span class="keyword">else</span> <a href="#83178" title="String">line</a>
		
	<span class="comment">/** The configuration line that defines the 'sbt.version' property, using the provided `version` for defaults.*/</span>
	<span class="keyword">def</span> <a title="(String)java.lang.String" id="82749">sbtVersion</a>(<a title="String" id="83181">version</a>: <span title="String">String</span>) =
		<span title="java.lang.String(&quot; sbt.version: quick=set(&quot;)" class="string">&quot; sbt.version: quick=set(&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#83181" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;), new=prompt(sbt version)[&quot;)" class="string">&quot;), new=prompt(sbt version)[&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#83181" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;], fill=prompt(sbt version)[&quot;)" class="string">&quot;], fill=prompt(sbt version)[&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#83181" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span>
	
	<span class="comment">/** Copies the given ApplicationID but with the specified version.*/</span>
	<span class="keyword">def</span> <a title="(xsbti.ApplicationID,String)xsbti.ApplicationID" id="82750">changeVersion</a>(<a title="xsbti.ApplicationID" id="82941">appID</a>: xsbti.<a href="../xsbti/ApplicationID.java.html#7636" title="xsbti.ApplicationID">ApplicationID</a>, <a title="String" id="82942">versionA</a>: <span title="String">String</span>): xsbti.<a href="../xsbti/ApplicationID.java.html#7636" title="xsbti.ApplicationID">ApplicationID</a> =
		<a title="template $anon extends java.lang.Object with xsbti.ApplicationID" id="83187" class="keyword">new</a> xsbti.<a href="../xsbti/ApplicationID.java.html#7636" title="xsbti.ApplicationID">ApplicationID</a> {
			<span class="keyword">def</span> <a title="()java.lang.String" id="83189">groupID</a> = <a href="#82941" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#69103" title="()java.lang.String">groupID</a>
			<span class="keyword">def</span> <a title="()java.lang.String" id="83190">name</a> = <a href="#82941" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#69104" title="()java.lang.String">name</a>
			<span class="keyword">def</span> <a title="()String" id="83191">version</a> = <a href="#82942" title="String">versionA</a>
			<span class="keyword">def</span> <a title="()java.lang.String" id="83192">mainClass</a> = <a href="#82941" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#69106" title="()java.lang.String">mainClass</a>
			<span class="keyword">def</span> <a title="()Array[java.lang.String]" id="83193">mainComponents</a> = <a href="#82941" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#69107" title="()Array[java.lang.String]">mainComponents</a>
			<span class="keyword">def</span> <a title="()Boolean" id="83194">crossVersioned</a> = <a href="#82941" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#69108" title="()Boolean">crossVersioned</a>
			<span class="keyword">def</span> <a title="()Array[java.io.File]" id="83195">classpathExtra</a> = <a href="#82941" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#69109" title="()Array[java.io.File]">classpathExtra</a>
		}
}

        </pre>
    </body>
</html>