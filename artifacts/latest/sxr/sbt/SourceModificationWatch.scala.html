<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/SourceModificationWatch.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009  Mikko Peltonen, Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="keyword">object</span> <a title="object sbt.SourceModificationWatch" id="8457">SourceModificationWatch</a>
{
	<span class="keyword">def</span> <a title="(sbt.Project,Int)(=&gt; Boolean)(=&gt; Unit)Unit" id="70410">watchUntil</a>(<a title="sbt.Project" id="70411">project</a>: <a href="Project.scala.html#9290" title="sbt.Project">Project</a>, <a title="Int" id="70412">pollDelaySec</a>: <span title="Int">Int</span>)(<a title="=&gt; Boolean" id="70413">terminationCondition</a>: =&gt; Boolean)(<a title="=&gt; Unit" id="70414">onSourcesModified</a>: =&gt; Unit)
	{
		<span class="keyword">def</span> <a title="=&gt; Iterable[java.io.File]" id="78068">sourceFiles</a>: <a title="Iterable[java.io.File]" id="372">Iterable</a>[java.io.File] = <a href="#78069" title="=&gt; sbt.PathFinder">sourcesFinder</a>.<a href="Path.scala.html#52329" title="=&gt; scala.collection.immutable.Set[java.io.File]">getFiles</a>
		<span class="keyword">def</span> <a title="=&gt; sbt.PathFinder" id="78069">sourcesFinder</a>: <a href="Path.scala.html#10418" title="sbt.PathFinder">PathFinder</a> = (<a href="Path.scala.html#11862" title="object sbt.Path">Path</a>.<a href="Path.scala.html#52293" title="=&gt; sbt.PathFinder">emptyPathFinder</a> <a href="#78071" title="(sbt.PathFinder)((sbt.PathFinder, sbt.Project) =&gt; sbt.PathFinder)sbt.PathFinder" id="16159">/:</a> <a href="#70411" title="sbt.Project">project</a>.<a href="Dag.scala.html#54236" title="=&gt; List[sbt.Project]">topologicalSort</a>)(<a href="#78074" title="sbt.PathFinder">_</a> <a href="Path.scala.html#52316" title="(sbt.PathFinder)sbt.PathFinder">+++</a> <a href="#78075" title="sbt.Project">_</a>.<a href="Project.scala.html#53936" title="=&gt; sbt.PathFinder">watchPaths</a>)
		<span class="keyword">def</span> <a title="(Long,Int)Unit" id="78070">loop</a>(<a title="Long" id="78076">lastCallbackCallTime</a>: <a title="Long" id="2347">Long</a>, <a title="Int" id="78077">previousFileCount</a>: <span title="Int">Int</span>)
		{
			<span class="keyword">val</span> <a href="#78079" title="(Long, Int)">(</a><a href="#78078" title="Long" id="78079">lastModifiedTime</a>, <a href="#78078" title="Int" id="78080">fileCount</a>) = <a href="#78068" title="=&gt; Iterable[java.io.File]">sourceFiles</a>.<a title="((Long, Int))(((Long, Int), java.io.File) =&gt; (Long, Int))(Long, Int)" id="16155">foldLeft</a>(<span title="(Long,Int)(Long, Int)">(</span><span title="Long(0L)" class="long">0L</span>, <span title="Int(0)" class="int">0</span>)){(<a title="(Long, Int)" id="78086">acc</a>, <a title="java.io.File" id="78087">file</a>) =&gt; <span title="(Long,Int)(Long, Int)">(</span><a title="object Math" id="574">Math</a>.<a title="(Long,Long)Long" id="69530">max</a>(<a href="#78086" title="(Long, Int)">acc</a>.<span title="=&gt; Long">_1</span>, <a href="#78087" title="java.io.File">file</a>.<a title="()Long" id="16972">lastModified</a>), <a href="#78086" title="(Long, Int)">acc</a>.<span title="=&gt; Int">_2</span> <a title="(Int)Int" id="3086">+</a> <span title="Int(1)" class="int">1</span>)}
			<span class="keyword">val</span> <a title="Long" id="78081">newCallbackCallTime</a> =
				<span class="comment">// check if sources are modified</span>
				<span title="Long" class="keyword">if</span> (<a href="#78079" title="Long">lastModifiedTime</a> <a title="(Long)Boolean" id="3207">&gt;</a> <a href="#78076" title="Long">lastCallbackCallTime</a> <a title="(Boolean)Boolean" id="2689">||</a> <a href="#78077" title="Int">previousFileCount</a> <a title="(Int)Boolean" id="3081">!=</a> <a href="#78080" title="Int">fileCount</a>)
				{
					<span class="keyword">val</span> <a title="Long" id="78125">now</a> = <a title="object java.lang.System" id="1825">System</a>.<a title="()Long" id="18311">currentTimeMillis</a>
					<a href="#70414" title="=&gt; Unit">onSourcesModified</a>
					<a href="#78125" title="Long">now</a>
				}
				<span class="keyword">else</span>
					<a href="#78076" title="Long">lastCallbackCallTime</a>
			<a title="object java.lang.Thread" id="2020">Thread</a>.<a title="(Long)Unit" id="62273">sleep</a>(<a href="#70412" title="Int">pollDelaySec</a> <a title="implicit scala.Predef.int2long : (Int)Long" id="3088">*</a> <span title="Int(1000)" class="int">1000</span>)
			<span title="Unit" class="keyword">if</span>(<a title="=&gt; Boolean" id="2686">!</a><a href="#70413" title="=&gt; Boolean">terminationCondition</a>)
				<a href="#78070" title="(Long,Int)Unit">loop</a>(<a href="#78081" title="Long">newCallbackCallTime</a>, <a href="#78080" title="Int">fileCount</a>)
		}
		<a href="#78070" title="(Long,Int)Unit">loop</a>(<span title="Long(0L)" class="long">0L</span>, <span title="Int(0)" class="int">0</span>)
	}
}
        </pre>
    </body>
</html>