<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/classfile/Analyze.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt.classfile
<span class="keyword">import</span> sbt._

<span class="keyword">import</span> scala.collection.mutable
<span class="keyword">import</span> mutable.{ArrayBuffer, Buffer}
<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> java.lang.annotation.Annotation
<span class="keyword">import</span> java.lang.reflect.Method
<span class="keyword">import</span> java.lang.reflect.Modifier.{STATIC, PUBLIC, ABSTRACT}

<span class="keyword">private</span>[sbt] <span class="keyword">object</span> <a title="object sbt.classfile.Analyze" id="13025">Analyze</a>
{
	<span class="keyword">def</span> <a title="[T](sbt.Path,sbt.Path,Iterable[sbt.Path],Iterable[sbt.Path],sbt.Logger)(=&gt; scala.collection.Set[sbt.Path],sbt.AnalysisCallback,java.lang.ClassLoader)(=&gt; Option[String])Option[String]" id="34490">apply</a>[<a title="&gt;: Nothing &lt;: Any" id="34492">T</a>](<a title="sbt.Path" id="34511">basePath</a>: <a href="../Path.scala.html#10200" title="sbt.Path">Path</a>, <a title="sbt.Path" id="34512">outputDirectory</a>: <a href="../Path.scala.html#10200" title="sbt.Path">Path</a>, <a title="Iterable[sbt.Path]" id="34513">sources</a>: <span title="Iterable[sbt.Path]">Iterable</span>[Path], <a title="Iterable[sbt.Path]" id="34514">roots</a>: <span title="Iterable[sbt.Path]">Iterable</span>[Path], <a title="sbt.Logger" id="34515">log</a>: <a href="../Logger.scala.html#11865" title="sbt.Logger">Logger</a>)
		(<a title="=&gt; scala.collection.Set[sbt.Path]" id="34516">allProducts</a>: =&gt; scala.collection.Set[Path], <a title="sbt.AnalysisCallback" id="34517">analysis</a>: <a href="../AnalysisCallback.scala.html#9210" title="sbt.AnalysisCallback">AnalysisCallback</a>, <a title="java.lang.ClassLoader" id="34518">loader</a>: <a title="java.lang.ClassLoader" id="1671">ClassLoader</a>)
		(<a title="=&gt; Option[String]" id="34519">compile</a>: =&gt; Option[String]): <span title="Option[String]">Option</span>[String] =
	{
		<span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Path]" id="58329">sourceSet</a> = <span title="(sbt.Path*)scala.collection.immutable.Set[sbt.Path]">Set</span>(<a href="#34513" title="Iterable[sbt.Path]">sources</a>.<span title="=&gt; Seq[sbt.Path]">toSeq</span> : _*)
		<span class="keyword">val</span> <a title="sbt.PathFinder" id="58330">classesFinder</a> = <a href="#34512" title="sbt.Path">outputDirectory</a> <a href="../Path.scala.html#16182" title="(sbt.FileFilter)sbt.PathFinder">**</a> <a href="../NameFilter.scala.html#30800" title="(String)sbt.NameFilter">GlobFilter</a>(<span title="java.lang.String(&quot;*.class&quot;)" class="string">&quot;*.class&quot;</span>)
		<span class="keyword">val</span> <a title="scala.collection.Set[sbt.Path]" id="58331">existingClasses</a> = <a href="#58330" title="sbt.PathFinder">classesFinder</a>.<a href="../Path.scala.html#16189" title="=&gt; scala.collection.Set[sbt.Path]">get</a>

		<span class="keyword">def</span> <a title="(String,=&gt; String)Option[Class[_]]" id="58332">load</a>(<a title="String" id="58335">tpe</a>: <span title="String">String</span>, <a title="=&gt; String" id="58336">errMsg</a>: =&gt; String): <span title="Option[Class[_]]">Option</span>[Class[_]] =
			<span class="keyword">try</span> { <span title="(java.lang.Class[?0])Some[java.lang.Class[?0]]">Some</span>(<a title="object java.lang.Class" id="1618">Class</a>.<a title="(java.lang.String,Boolean,java.lang.ClassLoader)java.lang.Class[_]" id="3887">forName</a>(<a href="#58335" title="String">tpe</a>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#34518" title="java.lang.ClassLoader">loader</a>)) }
			<span class="keyword">catch</span> { <span title="None.type" class="keyword">case</span> <a title="java.lang.Throwable" id="58352">e</a> =&gt; <a href="#34515" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#19735" title="(=&gt; String)Unit">warn</a>(<a href="#58336" title="=&gt; String">errMsg</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; : &quot;)" class="string">&quot; : &quot;</span> <span title="(Any)java.lang.String">+</span><a href="#58352" title="java.lang.Throwable">e</a>.<a title="()java.lang.String" id="17831">toString</a>); <span title="object None">None</span> }

		<span class="comment">// runs after compilation</span>
		<span class="keyword">def</span> <a title="()Unit" id="58333">analyze</a>()
		{
			<span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Path]" id="58354">allClasses</a> = <span title="(sbt.Path*)scala.collection.immutable.Set[sbt.Path]">Set</span>(<a href="#58330" title="sbt.PathFinder">classesFinder</a>.<a href="../Path.scala.html#16189" title="=&gt; scala.collection.Set[sbt.Path]">get</a>.<span title="=&gt; Seq[sbt.Path]">toSeq</span> : _*)
			<span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Path]" id="58355">newClasses</a> = <a href="#58354" title="scala.collection.immutable.Set[sbt.Path]">allClasses</a> <span title="(Iterable[sbt.Path])scala.collection.immutable.Set[sbt.Path]">--</span> <a href="#58331" title="scala.collection.Set[sbt.Path]">existingClasses</a> <span title="(Iterable[sbt.Path])scala.collection.immutable.Set[sbt.Path]">--</span> <a href="#34516" title="=&gt; scala.collection.Set[sbt.Path]">allProducts</a>
			
			<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]" id="58356">productToSource</a> = <span title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]">HashMap</span>[Path, Path]
			<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]" id="58357">sourceToClassFiles</a> = <span title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]">HashMap</span>[Path, Buffer[ClassFile]]

			<span class="keyword">val</span> <a title="Iterable[Class[_]]" id="58358">superclasses</a> = <a href="#34517" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34534" title="=&gt; Iterable[String]">superclassNames</a> <a title="((String) =&gt; Iterable[Class[_]])Iterable[Class[_]]" id="16273">flatMap</a> { <a title="String" id="58366">tpe</a> =&gt; <a href="#58332" title="(Option[Class[_]])Iterable[Class[_]]" id="898">load</a>(<a href="#58366" title="String">tpe</a>, <span title="java.lang.String(&quot;Could not load superclass '&quot;)" class="string">&quot;Could not load superclass '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58366" title="String">tpe</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;'&quot;)" class="string">&quot;'&quot;</span>) }
			<span class="keyword">val</span> <a title="Iterable[String]" id="58359">annotations</a> = <a href="#34517" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34535" title="=&gt; Iterable[String]">annotationNames</a>

			<span class="keyword">def</span> <a title="(Seq[java.lang.annotation.Annotation])Iterable[String]" id="58360">annotated</a>(<a title="Seq[java.lang.annotation.Annotation]" id="58374">fromClass</a>: <a title="Seq[java.lang.annotation.Annotation]" id="729">Seq</a>[Annotation]) = <span title="Iterable[String]" class="keyword">if</span>(<a href="#58374" title="Seq[java.lang.annotation.Annotation]">fromClass</a>.<a title="=&gt; Boolean" id="16733">isEmpty</a>) <span title="object Nil">Nil</span> <span class="keyword">else</span> <a href="#58359" title="Iterable[String]">annotations</a>.<span title="((String) =&gt; Boolean)Iterable[String]">filter</span>(<span title="(java.lang.String*)scala.collection.immutable.Set[java.lang.String]">Set</span>() <a title="(Iterable[java.lang.String])scala.collection.immutable.Set[java.lang.String]" id="23016">++</a> <a href="#58374" title="Seq[java.lang.annotation.Annotation]">fromClass</a>.<a title="((java.lang.annotation.Annotation) =&gt; java.lang.String)Seq[java.lang.String]" id="16749">map</a>(<a href="#58399" title="java.lang.annotation.Annotation">_</a>.<a title="()java.lang.Class[_ &lt;: java.lang.annotation.Annotation]" id="58379">annotationType</a>.<span title="()java.lang.String">getName</span>))

			<span class="comment">// parse class files and assign classes to sources.  This must be done before dependencies, since the information comes</span>
			<span class="comment">// as class-&gt;class dependencies that must be mapped back to source-&gt;class dependencies using the source+class assignment</span>
			<span class="keyword">for</span>(<a title="((sbt.Path) =&gt; Unit)Unit" id="58402">newClass</a> &lt;- <a href="#58355" title="scala.collection.immutable.Set[sbt.Path]">newClasses</a>;
				<a title="(((sbt.Path, sbt.classfile.ClassFile)) =&gt; Unit)Unit" id="58413">path</a> &lt;- <a href="../Path.scala.html#10201" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#15577" title="(sbt.Path,sbt.Path)Option[sbt.Path]">relativize</a>(<a href="#34512" title="sbt.Path">outputDirectory</a>, <a href="#58402" title="sbt.Path">newClass</a>);
				<a title="sbt.classfile.ClassFile" id="58414">classFile</a> = <a href="Parser.scala.html#38550" title="(java.io.File,sbt.Logger)sbt.classfile.ClassFile">Parser</a>(<a href="#58402" title="sbt.Path">newClass</a>.<a href="../Path.scala.html#18076" title="=&gt; java.io.File">asFile</a>, <a href="#34515" title="sbt.Logger">log</a>);
				<a title="((String) =&gt; Unit)Unit" id="58463">sourceFile</a> &lt;- <a href="#58414" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38576" title="=&gt; Option[String]">sourceFile</a> <span title="(=&gt; Option[String])Option[String]">orElse</span> <a href="#34493" title="(String)Some[String]">guessSourceName</a>(<a href="#58402" title="sbt.Path">newClass</a>.<a href="../Path.scala.html#18076" title="=&gt; java.io.File">asFile</a>.<a title="()java.lang.String" id="16219">getName</a>);
				<a title="((sbt.Path) =&gt; Unit)Unit" id="58521">source</a> &lt;- <a href="#34499" title="(scala.collection.Set[sbt.Path],Iterable[sbt.Path],sbt.classfile.ClassFile,sbt.Logger)List[sbt.Path]">guessSourcePath</a>(<a href="#58329" title="scala.collection.immutable.Set[sbt.Path]">sourceSet</a>, <a href="#34514" title="Iterable[sbt.Path]">roots</a>, <a href="#58414" title="sbt.classfile.ClassFile">classFile</a>, <a href="#34515" title="sbt.Logger">log</a>))
			{
				<a href="#34517" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34538" title="(sbt.Path)Unit">beginSource</a>(<a href="#58521" title="sbt.Path">source</a>)
				<a href="#34517" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34545" title="(sbt.Path,sbt.Path)Unit">generatedClass</a>(<a href="#58521" title="sbt.Path">source</a>, <a href="#58413" title="sbt.Path">path</a>)
				<a href="#58356" title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]">productToSource</a>(<a href="#58413" title="sbt.Path">path</a>) = <a href="#58521" title="sbt.Path">source</a>
				<a href="#58357" title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]">sourceToClassFiles</a>.<a title="(sbt.Path,=&gt; scala.collection.mutable.Buffer[sbt.classfile.ClassFile])scala.collection.mutable.Buffer[sbt.classfile.ClassFile]" id="24523">getOrElseUpdate</a>(<a href="#58521" title="sbt.Path">source</a>, <span title="scala.collection.mutable.ArrayBuffer[sbt.classfile.ClassFile]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[sbt.classfile.ClassFile]">ArrayBuffer</span>[ClassFile]) <a title="(sbt.classfile.ClassFile)Unit" id="18720">+=</a> <a href="#58414" title="sbt.classfile.ClassFile">classFile</a>
			}
			
			<span class="comment">// get class to class dependencies and map back to source to class dependencies</span>
			<span class="keyword">for</span>( <a href="#58526" title="(((sbt.Path, scala.collection.mutable.Buffer[sbt.classfile.ClassFile])) =&gt; Unit)Unit">(</a><a title="sbt.Path" id="58531">source</a>, <a title="scala.collection.mutable.Buffer[sbt.classfile.ClassFile]" id="58532">classFiles</a>) &lt;- <a href="#58357" title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]">sourceToClassFiles</a> )
			{
				<span class="keyword">for</span>(<a title="((sbt.classfile.ClassFile) =&gt; Unit)Unit" id="58546">classFile</a> &lt;- <a href="#58532" title="scala.collection.mutable.Buffer[sbt.classfile.ClassFile]">classFiles</a> <span class="keyword">if</span> <a href="#34500" title="(sbt.classfile.ClassFile)Boolean">isTopLevel</a>(<a href="#58546" title="sbt.classfile.ClassFile">classFile</a>);
					<a title="((Class[_]) =&gt; Unit)Unit" id="58548">cls</a> &lt;- <a href="#58332" title="(String,=&gt; String)Option[Class[_]]">load</a>(<a href="#58546" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38568" title="=&gt; String">className</a>, <span title="java.lang.String(&quot;Could not load '&quot;)" class="string">&quot;Could not load '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58546" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38568" title="=&gt; String">className</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' to check for superclasses.&quot;)" class="string">&quot;' to check for superclasses.&quot;</span>) )
				{
					<span class="keyword">for</span>(<a title="((Class[_]) =&gt; Unit)Unit" id="58551">superclass</a> &lt;- <a href="#58358" title="Iterable[Class[_]]">superclasses</a>)
						<span title="Unit" class="keyword">if</span>(<a href="#58551" title="Class[_]">superclass</a>.<a title="(java.lang.Class[_])Boolean" id="3892">isAssignableFrom</a>(<a href="#58548" title="Class[_]">cls</a>))
							<a href="#34517" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34539" title="(sbt.Path,String,String,Boolean)Unit">foundSubclass</a>(<a href="#58531" title="sbt.Path">source</a>, <a href="#58546" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38568" title="=&gt; String">className</a>, <a href="#58551" title="Class[_]">superclass</a>.<span title="()java.lang.String">getName</span>, <span title="Boolean(false)" class="keyword">false</span>)

					<span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[String]" id="58549">annotations</a> = <span title="scala.collection.mutable.ArrayBuffer[String]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[String]">ArrayBuffer</span>[String]
					<a href="#58549" title="scala.collection.mutable.ArrayBuffer[String]">annotations</a> <span title="(Iterable[String])Unit">++=</span> <a href="#58360" title="(Seq[java.lang.annotation.Annotation])Iterable[String]">annotated</a>(<a href="#58548" title="Class[_]">cls</a>.<a title="()Array[java.lang.annotation.Annotation]" id="5692">getAnnotations</a>)
					<span class="keyword">for</span>(<a title="((java.lang.reflect.Method) =&gt; Unit)Unit" id="58560">method</a> &lt;- <a href="#58548" title="Class[_]">cls</a>.<a title="()Array[java.lang.reflect.Method]" id="4288">getMethods</a>)
					{
						<a href="#58549" title="scala.collection.mutable.ArrayBuffer[String]">annotations</a> <span title="(Iterable[String])Unit">++=</span> <a href="#58360" title="(Seq[java.lang.annotation.Annotation])Iterable[String]">annotated</a>(<a href="#58560" title="java.lang.reflect.Method">method</a>.<a title="()Array[java.lang.annotation.Annotation]" id="24113">getAnnotations</a>)
						<span title="Unit" class="keyword">if</span>(<a href="#34505" title="(java.lang.reflect.Method)Boolean">isMain</a>(<a href="#58560" title="java.lang.reflect.Method">method</a>))
							<a href="#34517" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34547" title="(sbt.Path,String)Unit">foundApplication</a>(<a href="#58531" title="sbt.Path">source</a>, <a href="#58546" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38568" title="=&gt; String">className</a>)
					}
					<a href="#58549" title="scala.collection.mutable.ArrayBuffer[String]">annotations</a>.<span title="((String) =&gt; Unit)Unit">foreach</span> { <a title="String" id="58569">ann</a> =&gt; <a href="#34517" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34540" title="(sbt.Path,String,String,Boolean)Unit">foundAnnotated</a>(<a href="#58531" title="sbt.Path">source</a>, <a href="#58546" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38568" title="=&gt; String">className</a>, <a href="#58569" title="String">ann</a>, <span title="Boolean(false)" class="keyword">false</span>) }
				}
				<span class="keyword">def</span> <a title="(String)Unit" id="58533">processDependency</a>(<a title="String" id="58574">tpe</a>: <span title="String">String</span>)
				{
					<a href="../Control.scala.html#11878" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#25769" title="(sbt.Logger)(=&gt; Unit)Unit">trapAndLog</a>(<a href="#34515" title="sbt.Logger">log</a>)
					{
						<span class="keyword">val</span> <a title="Option[Class[_]]" id="58575">loaded</a> = <a href="#58332" title="(String,=&gt; String)Option[Class[_]]">load</a>(<a href="#58574" title="String">tpe</a>, <span title="java.lang.String(&quot;Problem processing dependencies of source &quot;)" class="string">&quot;Problem processing dependencies of source &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58531" title="sbt.Path">source</a>)
						<span class="keyword">for</span>(<a title="((Class[_]) =&gt; Unit)Unit" id="58577">clazz</a> &lt;- <a href="#58575" title="Option[Class[_]]">loaded</a>; <a title="((java.io.File) =&gt; Unit)Unit" id="58584">file</a> &lt;- <a href="../Control.scala.html#11878" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#25770" title="(=&gt; java.io.File)Either[Exception,java.io.File]">convertException</a>(<a href="../FileUtilities.scala.html#9085" title="object sbt.FileUtilities">FileUtilities</a>.<a href="../FileUtilities.scala.html#15539" title="(Class[_])java.io.File">classLocationFile</a>(<a href="#58577" title="Class[_]">clazz</a>)).<a title="=&gt; Either.RightProjection[Exception,java.io.File]" id="25882">right</a>)
						{
							<span title="Unit" class="keyword">if</span>(<a href="#58584" title="java.io.File">file</a>.<a title="()Boolean" id="16233">isDirectory</a>)
							{
								<span class="keyword">val</span> <a title="java.io.File" id="58585">resolved</a> = <a href="#34498" title="(java.io.File,String)java.io.File">resolveClassFile</a>(<a href="#58584" title="java.io.File">file</a>, <a href="#58574" title="String">tpe</a>)
								<a title="(Boolean,Any)Unit" id="6091">assume</a>(<a href="#58585" title="java.io.File">resolved</a>.<a title="()Boolean" id="16232">exists</a>, <span title="java.lang.String(&quot;Resolved class file &quot;)" class="string">&quot;Resolved class file &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58585" title="java.io.File">resolved</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; from &quot;)" class="string">&quot; from &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58531" title="sbt.Path">source</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; did not exist&quot;)" class="string">&quot; did not exist&quot;</span>)
								<span class="keyword">val</span> <a title="sbt.Path" id="58586">resolvedPath</a> = <a href="../Path.scala.html#10201" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#15584" title="(java.io.File)sbt.Path">fromFile</a>(<a href="#58585" title="java.io.File">resolved</a>)
								<span title="Unit" class="keyword">if</span>(<a href="../Path.scala.html#10201" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#15584" title="(java.io.File)sbt.Path">fromFile</a>(<a href="#58584" title="java.io.File">file</a>) <span title="(AnyRef)Boolean">==</span> <a href="#34512" title="sbt.Path">outputDirectory</a>)
								{
									<a href="#58356" title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]">productToSource</a>.<a title="(sbt.Path)Option[sbt.Path]" id="25230">get</a>(<a href="#58586" title="sbt.Path">resolvedPath</a>) <span title="Unit" class="keyword">match</span>
									{
										<span title="Unit" class="keyword">case</span> Some(<a title="sbt.Path" id="58600">dependsOn</a>) =&gt; <a href="#34517" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34541" title="(sbt.Path,sbt.Path)Unit">sourceDependency</a>(<a href="#58600" title="sbt.Path">dependsOn</a>, <a href="#58531" title="sbt.Path">source</a>)
										<span title="Unit" class="keyword">case</span> <span title="object None">None</span> =&gt; <a href="#34517" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34544" title="(sbt.Path,sbt.Path)Unit">productDependency</a>(<a href="#58586" title="sbt.Path">resolvedPath</a>, <a href="#58531" title="sbt.Path">source</a>)
									}
								}
								<span class="keyword">else</span>
									<a href="#34517" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34543" title="(java.io.File,sbt.Path)Unit">classDependency</a>(<a href="#58585" title="java.io.File">resolved</a>, <a href="#58531" title="sbt.Path">source</a>)
							}
							<span class="keyword">else</span>
								<a href="#34517" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34542" title="(java.io.File,sbt.Path)Unit">jarDependency</a>(<a href="#58584" title="java.io.File">file</a>, <a href="#58531" title="sbt.Path">source</a>)
						}
					}
				}
				
				<a href="#58532" title="scala.collection.mutable.Buffer[sbt.classfile.ClassFile]">classFiles</a>.<a title="((sbt.classfile.ClassFile) =&gt; Iterable[String])Seq[String]" id="16751">flatMap</a>(<a href="#58611" title="sbt.classfile.ClassFile">_</a>.<a href="ClassFile.scala.html#38577" title="=&gt; Set[String]">types</a>).<span title="((String) =&gt; Unit)Unit">foreach</span>(<a href="#58533" title="(String)Unit">processDependency</a>)
				<a href="#34517" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34546" title="(sbt.Path)Unit">endSource</a>(<a href="#58531" title="sbt.Path">source</a>)
			}
		}
		
		<a href="#34519" title="=&gt; Option[String]">compile</a> <span title="(=&gt; Option[String])Option[String]">orElse</span> <a href="../Control.scala.html#11878" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#25773" title="(sbt.Logger)(=&gt; Unit)Either[String,Unit]">convertErrorMessage</a>(<a href="#34515" title="sbt.Logger">log</a>)(<a href="#58333" title="()Unit">analyze</a>()).<a title="=&gt; Either.LeftProjection[String,Unit]" id="25795">left</a>.<a title="=&gt; Option[String]" id="25817">toOption</a>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String)Some[String]" id="34493">guessSourceName</a>(<a title="String" id="58417">name</a>: <span title="String">String</span>) = <span title="(String)Some[String]">Some</span>( <a href="#34494" title="(String)String">takeToDollar</a>(<a href="#34497" title="(String)java.lang.String">trimClassExt</a>(<a href="#58417" title="String">name</a>)) )
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String)String" id="34494">takeToDollar</a>(<a title="String" id="58420">name</a>: <span title="String">String</span>) =
	{
		<span class="keyword">val</span> <a title="Int" id="58422">dollar</a> = <a href="#58420" title="String">name</a>.<span title="(Int)Int">indexOf</span>(<span title="Int(36)" class="char">'$'</span>)
		<span title="String" class="keyword">if</span>(<a href="#58422" title="Int">dollar</a> <span title="(Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span>) <a href="#58420" title="String">name</a> <span class="keyword">else</span> <a href="#58420" title="String">name</a>.<span title="(Int,Int)java.lang.String">substring</span>(<span title="Int(0)" class="int">0</span>, <a href="#58422" title="Int">dollar</a>)
	}
	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">val</span> <a title="java.lang.String(&quot;.class&quot;)" id="34495">ClassExt</a> = <span title="java.lang.String(&quot;.class&quot;)" class="string">&quot;.class&quot;</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String)java.lang.String" id="34497">trimClassExt</a>(<a title="String" id="58438">name</a>: <span title="String">String</span>) = <span title="java.lang.String" class="keyword">if</span>(<a href="#58438" title="String">name</a>.<a title="(java.lang.String)Boolean" id="5787">endsWith</a>(<span title="java.lang.String(&quot;.class&quot;)">ClassExt</span>)) <a href="#58438" title="String">name</a>.<span title="(Int,Int)java.lang.String">substring</span>(<span title="Int(0)" class="int">0</span>, <a href="#58438" title="String">name</a>.<span title="()Int">length</span> <span title="(Int)Int">-</span> <span title="java.lang.String(&quot;.class&quot;)">ClassExt</span>.<span title="()Int">length</span>) <span class="keyword">else</span> <a href="#58438" title="String">name</a>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(java.io.File,String)java.io.File" id="34498">resolveClassFile</a>(<a title="java.io.File" id="58587">file</a>: <span title="java.io.File">File</span>, <a title="String" id="58588">className</a>: <span title="String">String</span>): <span title="java.io.File">File</span> = (<a href="#58587" title="java.io.File">file</a> <a href="#58620" title="(java.io.File)((java.io.File, java.lang.String) =&gt; java.io.File)java.io.File" id="16292">/:</a> (<a href="#58588" title="String">className</a>.<a title="(Char,Char)java.lang.String" id="5803">replace</a>(<span title="Char('.')" class="char">'.'</span>,<span title="Char('/')" class="char">'/'</span>) <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.class&quot;)">ClassExt</span>).<span title="(java.lang.String)Array[java.lang.String]">split</span>(<span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>))(<a title="(java.io.File,java.lang.String)java.io.File" id="16217" class="keyword">new</a> <span title="java.io.File">File</span>(<a href="#58625" title="java.io.File">_</a>, <a href="#58626" title="java.lang.String">_</a>))
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(scala.collection.Set[sbt.Path],Iterable[sbt.Path],sbt.classfile.ClassFile,sbt.Logger)List[sbt.Path]" id="34499">guessSourcePath</a>(<a title="scala.collection.Set[sbt.Path]" id="58464">sources</a>: scala.collection.<a title="scala.collection.Set[sbt.Path]" id="15648">Set</a>[Path], <a title="Iterable[sbt.Path]" id="58465">roots</a>: <span title="Iterable[sbt.Path]">Iterable</span>[Path], <a title="sbt.classfile.ClassFile" id="58466">classFile</a>: <a href="ClassFile.scala.html#13165" title="sbt.classfile.ClassFile">ClassFile</a>, <a title="sbt.Logger" id="58467">log</a>: <a href="../Logger.scala.html#11865" title="sbt.Logger">Logger</a>) =
	{
		<span class="keyword">val</span> <a title="Array[java.lang.String]" id="58469">classNameParts</a> = <a href="#58466" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38568" title="=&gt; String">className</a>.<span title="(java.lang.String)Array[java.lang.String]">split</span>(<span title="java.lang.String(&quot;\.&quot;)" class="string">&quot;&quot;&quot;\.&quot;&quot;&quot;</span>)
		<span class="keyword">val</span> <a title="Int" id="58470">lastIndex</a> = <a href="#58469" title="Array[java.lang.String]">classNameParts</a>.<a title="=&gt; Int" id="17311">length</a> <span title="(Int)Int">-</span> <span title="Int(1)" class="int">1</span>
		<span class="keyword">val</span> <a title="Array.Projection[java.lang.String]" id="58471">pkg</a> = <a href="#58469" title="Array[java.lang.String]">classNameParts</a>.<a title="(Int)Array.Projection[java.lang.String]" id="17294">take</a>(<a href="#58470" title="Int">lastIndex</a>)
		<span class="keyword">val</span> <a title="java.lang.String" id="58472">simpleClassName</a> = <a href="#58469" title="(Int)java.lang.String" id="17312">classNameParts</a>(<a href="#58470" title="Int">lastIndex</a>)
		<span class="keyword">val</span> <a title="String" id="58473">sourceFileName</a> = <a href="#58466" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38576" title="=&gt; Option[String]">sourceFile</a>.<a title="(=&gt; String)String" id="19232">getOrElse</a>(<a href="#58472" title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString" id="6224">simpleClassName</a>.<a title="((Char) =&gt; Boolean)Seq[Char]" id="16758">takeWhile</a>(<a href="#58491" title="Char">_</a> <a title="(Char)Boolean" id="2967">!=</a> <span title="Char('$')" class="char">'$'</span>).<a title="(String,String,String)String" id="16307">mkString</a>(<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;.java&quot;)" class="string">&quot;.java&quot;</span>))
		<span class="keyword">val</span> <a title="String" id="58474">relativeSourceFile</a> = (<a href="#58471" title="Array.Projection[java.lang.String]">pkg</a> <a title="(Iterable[java.lang.String])RandomAccessSeq[java.lang.String]" id="16679">++</a> (<a href="#58473" title="String">sourceFileName</a> <a href="#58504" title="(String)List[String]" id="17936">::</a> <span title="object Nil">Nil</span>)).<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>)
		<span class="keyword">val</span> <a title="List[sbt.Path]" id="58475">candidates</a> = <a href="#58465" title="Iterable[sbt.Path]">roots</a>.<a title="((sbt.Path) =&gt; sbt.Path)Iterable[sbt.Path]" id="16271">map</a>(<a title="sbt.Path" id="58510">root</a> =&gt; <a href="../Path.scala.html#10201" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#15575" title="(sbt.Path,String)sbt.Path">fromString</a>(<a href="#58510" title="sbt.Path">root</a>, <a href="#58474" title="String">relativeSourceFile</a>)).<span title="((sbt.Path) =&gt; Boolean)Iterable[sbt.Path]">filter</span>(<a href="#58464" title="scala.collection.Set[sbt.Path]">sources</a>.<a href="#58514" title="(sbt.Path)Boolean" id="18152">contains</a>).<span title="=&gt; List[sbt.Path]">toList</span>
		<a href="#58475" title="List[sbt.Path]">candidates</a> <span title="Unit" class="keyword">match</span>
		{
			<span title="Unit" class="keyword">case</span> <span title="object Nil">Nil</span> =&gt; <a href="#58467" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#19735" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;Could not determine source for class &quot;)" class="string">&quot;Could not determine source for class &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58466" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38568" title="=&gt; String">className</a>)
			<span title="Unit" class="keyword">case</span> <a title="sbt.Path" id="58516">head</a> :: <span title="object Nil">Nil</span> =&gt; <span title="Unit">(</span>)
			<span title="Unit" class="keyword">case</span> _ =&gt;<a href="#58467" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#19735" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;Multiple sources matched for class &quot;)" class="string">&quot;Multiple sources matched for class &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58466" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38568" title="=&gt; String">className</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58475" title="List[sbt.Path]">candidates</a>.<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span>))
		}
		<a href="#58475" title="List[sbt.Path]">candidates</a>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.classfile.ClassFile)Boolean" id="34500">isTopLevel</a>(<a title="sbt.classfile.ClassFile" id="58536">classFile</a>: <a href="ClassFile.scala.html#13165" title="sbt.classfile.ClassFile">ClassFile</a>) = <a href="#58536" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38568" title="=&gt; String">className</a>.<span title="(Int)Int">indexOf</span>(<span title="Int(36)" class="char">'$'</span>) <span title="(Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span>
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.lang.Class[Unit]" id="34502">unit</a> = <span title="java.lang.Class[Unit]">classOf</span>[Unit]
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[java.lang.Class[Array[String]]]" id="34504">strArray</a> = <a title="(java.lang.Class[Array[String]]*)List[java.lang.Class[Array[String]]]" id="496">List</a>(<span title="java.lang.Class[Array[String]]">classOf</span>[Array[String]])

	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(java.lang.reflect.Method)Boolean" id="34505">isMain</a>(<a title="java.lang.reflect.Method" id="58565">method</a>: <a title="java.lang.reflect.Method" id="3815">Method</a>): <span title="Boolean">Boolean</span> =
		<a href="#58565" title="java.lang.reflect.Method">method</a>.<a title="()java.lang.String" id="24068">getName</a> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;main&quot;)" class="string">&quot;main&quot;</span> <span title="(Boolean)Boolean">&amp;&amp;</span>
		<a href="#34506" title="(Int)Boolean">isMain</a>(<a href="#58565" title="java.lang.reflect.Method">method</a>.<a title="()Int" id="24069">getModifiers</a>) <span title="(Boolean)Boolean">&amp;&amp;</span>
		<a href="#58565" title="java.lang.reflect.Method">method</a>.<a title="()java.lang.Class[_]" id="24073">getReturnType</a> <span title="(AnyRef)Boolean">==</span> <a href="#34501" title="=&gt; java.lang.Class[Unit]">unit</a> <span title="(Boolean)Boolean">&amp;&amp;</span>
		<a href="#58565" title="java.lang.reflect.Method">method</a>.<a title="()Array[java.lang.Class[_]]" id="24077">getParameterTypes</a>.<span title="=&gt; List[java.lang.Class[_]]">toList</span> <span title="(AnyRef)Boolean">==</span> <a href="#34503" title="=&gt; List[java.lang.Class[Array[String]]]">strArray</a>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(Int)Boolean" id="34506">isMain</a>(<a title="Int" id="58564">modifiers</a>: <a title="Int" id="2351">Int</a>): <span title="Boolean">Boolean</span> = (<a href="#58564" title="Int">modifiers</a> <span title="(Int)Int">&amp;</span> <a href="#34507" title="=&gt; Int">mainModifiers</a>) <span title="(Int)Boolean">==</span> <a href="#34507" title="=&gt; Int">mainModifiers</a> <span title="(Boolean)Boolean">&amp;&amp;</span> (<a href="#58564" title="Int">modifiers</a> <span title="(Int)Int">&amp;</span> <a href="#34509" title="=&gt; Int">notMainModifiers</a>) <span title="(Int)Boolean">==</span> <span title="Int(0)" class="int">0</span>
	
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="34507">mainModifiers</a> = STATIC  <span title="Int(9)">|</span> PUBLIC
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="34509">notMainModifiers</a> = <span title="Int(1024)">ABSTRACT</span>
}
        </pre>
    </body>
</html>