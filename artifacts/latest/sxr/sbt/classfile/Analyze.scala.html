<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/classfile/Analyze.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt.classfile
<span class="keyword">import</span> sbt._

<span class="keyword">import</span> scala.collection.mutable
<span class="keyword">import</span> mutable.{ArrayBuffer, Buffer}
<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> java.lang.annotation.Annotation
<span class="keyword">import</span> java.lang.reflect.Method
<span class="keyword">import</span> java.lang.reflect.Modifier.{STATIC, PUBLIC, ABSTRACT}

<span class="keyword">private</span>[sbt] <span class="keyword">object</span> <a title="object sbt.classfile.Analyze" id="14209">Analyze</a>
{
	<span class="keyword">def</span> <a title="[T](sbt.Path,sbt.Path,Iterable[sbt.Path],Iterable[sbt.Path],sbt.Logger)(=&gt; scala.collection.Set[sbt.Path],sbt.AnalysisCallback,java.lang.ClassLoader)(=&gt; Option[String])Option[String]" id="56913">apply</a>[<a title="&gt;: Nothing &lt;: Any" id="56915">T</a>](<a title="sbt.Path" id="56934">basePath</a>: <a href="../Path.scala.html#11861" title="sbt.Path">Path</a>, <a title="sbt.Path" id="56935">outputDirectory</a>: <a href="../Path.scala.html#11861" title="sbt.Path">Path</a>, <a title="Iterable[sbt.Path]" id="56936">sources</a>: <span title="Iterable[sbt.Path]">Iterable</span>[Path], <a title="Iterable[sbt.Path]" id="56937">roots</a>: <span title="Iterable[sbt.Path]">Iterable</span>[Path], <a title="sbt.Logger" id="56938">log</a>: <a href="../Logger.scala.html#13532" title="sbt.Logger">Logger</a>)
		(<a title="=&gt; scala.collection.Set[sbt.Path]" id="56939">allProducts</a>: =&gt; scala.collection.Set[Path], <a title="sbt.AnalysisCallback" id="56940">analysis</a>: <a href="../AnalysisCallback.scala.html#10844" title="sbt.AnalysisCallback">AnalysisCallback</a>, <a title="java.lang.ClassLoader" id="56941">loader</a>: <a title="java.lang.ClassLoader" id="1665">ClassLoader</a>)
		(<a title="=&gt; Option[String]" id="56942">compile</a>: =&gt; Option[String]): <span title="Option[String]">Option</span>[String] =
	{
		<span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Path]" id="84543">sourceSet</a> = <span title="(sbt.Path*)scala.collection.immutable.Set[sbt.Path]">Set</span>(<a href="#56936" title="Iterable[sbt.Path]">sources</a>.<span title="=&gt; Seq[sbt.Path]">toSeq</span> : _*)
		<span class="keyword">val</span> <a title="sbt.PathFinder" id="84544">classesFinder</a> = <a href="#56935" title="sbt.Path">outputDirectory</a> <a href="../Path.scala.html#52318" title="(sbt.FileFilter)sbt.PathFinder">**</a> <a href="../NameFilter.scala.html#56997" title="(String)sbt.NameFilter">GlobFilter</a>(<span title="java.lang.String(&quot;*.class&quot;)" class="string">&quot;*.class&quot;</span>)
		<span class="keyword">val</span> <a title="scala.collection.Set[sbt.Path]" id="84545">existingClasses</a> = <a href="#84544" title="sbt.PathFinder">classesFinder</a>.<a href="../Path.scala.html#52325" title="=&gt; scala.collection.Set[sbt.Path]">get</a>

		<span class="keyword">def</span> <a title="(String,=&gt; String)Option[Class[_]]" id="84546">load</a>(<a title="String" id="84549">tpe</a>: <span title="String">String</span>, <a title="=&gt; String" id="84550">errMsg</a>: =&gt; String): <span title="Option[Class[_]]">Option</span>[Class[_]] =
			<span class="keyword">try</span> { <span title="(java.lang.Class[?0])Some[java.lang.Class[?0]]">Some</span>(<a title="object java.lang.Class" id="1612">Class</a>.<a title="(java.lang.String,Boolean,java.lang.ClassLoader)java.lang.Class[_]" id="3911">forName</a>(<a href="#84549" title="String">tpe</a>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#56941" title="java.lang.ClassLoader">loader</a>)) }
			<span class="keyword">catch</span> { <span title="None.type" class="keyword">case</span> <a title="java.lang.Throwable" id="84566">e</a> =&gt; <a href="#56938" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#52376" title="(=&gt; String)Unit">warn</a>(<a href="#84550" title="=&gt; String">errMsg</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; : &quot;)" class="string">&quot; : &quot;</span> <span title="(Any)java.lang.String">+</span><a href="#84566" title="java.lang.Throwable">e</a>.<a title="()java.lang.String" id="18029">toString</a>); <span title="object None">None</span> }

		<span class="comment">// runs after compilation</span>
		<span class="keyword">def</span> <a title="()Unit" id="84547">analyze</a>()
		{
			<span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Path]" id="84568">allClasses</a> = <span title="(sbt.Path*)scala.collection.immutable.Set[sbt.Path]">Set</span>(<a href="#84544" title="sbt.PathFinder">classesFinder</a>.<a href="../Path.scala.html#52325" title="=&gt; scala.collection.Set[sbt.Path]">get</a>.<span title="=&gt; Seq[sbt.Path]">toSeq</span> : _*)
			<span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Path]" id="84569">newClasses</a> = <a href="#84568" title="scala.collection.immutable.Set[sbt.Path]">allClasses</a> <span title="(Iterable[sbt.Path])scala.collection.immutable.Set[sbt.Path]">--</span> <a href="#84545" title="scala.collection.Set[sbt.Path]">existingClasses</a> <span title="(Iterable[sbt.Path])scala.collection.immutable.Set[sbt.Path]">--</span> <a href="#56939" title="=&gt; scala.collection.Set[sbt.Path]">allProducts</a>
			
			<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]" id="84570">productToSource</a> = <span title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]">HashMap</span>[Path, Path]
			<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]" id="84571">sourceToClassFiles</a> = <span title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]">HashMap</span>[Path, Buffer[ClassFile]]

			<span class="keyword">val</span> <a title="Iterable[Class[_]]" id="84572">superclasses</a> = <a href="#56940" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#53696" title="=&gt; Iterable[String]">superclassNames</a> <a title="((String) =&gt; Iterable[Class[_]])Iterable[Class[_]]" id="16140">flatMap</a> { <a title="String" id="84580">tpe</a> =&gt; <a href="#84546" title="(Option[Class[_]])Iterable[Class[_]]" id="898">load</a>(<a href="#84580" title="String">tpe</a>, <span title="java.lang.String(&quot;Could not load superclass '&quot;)" class="string">&quot;Could not load superclass '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84580" title="String">tpe</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;'&quot;)" class="string">&quot;'&quot;</span>) }
			<span class="keyword">val</span> <a title="Iterable[String]" id="84573">annotations</a> = <a href="#56940" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#53697" title="=&gt; Iterable[String]">annotationNames</a>

			<span class="keyword">def</span> <a title="(Seq[java.lang.annotation.Annotation])Iterable[String]" id="84574">annotated</a>(<a title="Seq[java.lang.annotation.Annotation]" id="84588">fromClass</a>: <a title="Seq[java.lang.annotation.Annotation]" id="729">Seq</a>[Annotation]) = <span title="Iterable[String]" class="keyword">if</span>(<a href="#84588" title="Seq[java.lang.annotation.Annotation]">fromClass</a>.<a title="=&gt; Boolean" id="16000">isEmpty</a>) <span title="object Nil">Nil</span> <span class="keyword">else</span> <a href="#84573" title="Iterable[String]">annotations</a>.<span title="((String) =&gt; Boolean)Iterable[String]">filter</span>(<span title="(java.lang.String*)scala.collection.immutable.Set[java.lang.String]">Set</span>() <a title="(Iterable[java.lang.String])scala.collection.immutable.Set[java.lang.String]" id="16922">++</a> <a href="#84588" title="Seq[java.lang.annotation.Annotation]">fromClass</a>.<a title="((java.lang.annotation.Annotation) =&gt; java.lang.String)Seq[java.lang.String]" id="16016">map</a>(<a href="#84613" title="java.lang.annotation.Annotation">_</a>.<a title="()java.lang.Class[_ &lt;: java.lang.annotation.Annotation]" id="84593">annotationType</a>.<span title="()java.lang.String">getName</span>))

			<span class="comment">// parse class files and assign classes to sources.  This must be done before dependencies, since the information comes</span>
			<span class="comment">// as class-&gt;class dependencies that must be mapped back to source-&gt;class dependencies using the source+class assignment</span>
			<span class="keyword">for</span>(<a title="((sbt.Path) =&gt; Unit)Unit" id="84616">newClass</a> &lt;- <a href="#84569" title="scala.collection.immutable.Set[sbt.Path]">newClasses</a>;
				<a title="(((sbt.Path, sbt.classfile.ClassFile)) =&gt; Unit)Unit" id="84689">path</a> &lt;- <a href="../Path.scala.html#11862" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#52301" title="(sbt.Path,sbt.Path)Option[sbt.Path]">relativize</a>(<a href="#56935" title="sbt.Path">outputDirectory</a>, <a href="#84616" title="sbt.Path">newClass</a>);
				<a title="sbt.classfile.ClassFile" id="84690">classFile</a> = <a href="Parser.scala.html#84624" title="(java.io.File,sbt.Logger)sbt.classfile.ClassFile">Parser</a>(<a href="#84616" title="sbt.Path">newClass</a>.<a href="../Path.scala.html#52349" title="=&gt; java.io.File">asFile</a>, <a href="#56938" title="sbt.Logger">log</a>);
				<a title="((String) =&gt; Unit)Unit" id="84739">sourceFile</a> &lt;- <a href="#84690" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#84682" title="=&gt; Option[String]">sourceFile</a> <span title="(=&gt; Option[String])Option[String]">orElse</span> <a href="#56916" title="(String)Some[String]">guessSourceName</a>(<a href="#84616" title="sbt.Path">newClass</a>.<a href="../Path.scala.html#52349" title="=&gt; java.io.File">asFile</a>.<a title="()java.lang.String" id="16955">getName</a>);
				<a title="((sbt.Path) =&gt; Unit)Unit" id="84795">source</a> &lt;- <a href="#56922" title="(scala.collection.Set[sbt.Path],Iterable[sbt.Path],sbt.classfile.ClassFile,sbt.Logger)List[sbt.Path]">guessSourcePath</a>(<a href="#84543" title="scala.collection.immutable.Set[sbt.Path]">sourceSet</a>, <a href="#56937" title="Iterable[sbt.Path]">roots</a>, <a href="#84690" title="sbt.classfile.ClassFile">classFile</a>, <a href="#56938" title="sbt.Logger">log</a>))
			{
				<a href="#56940" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#53700" title="(sbt.Path)Unit">beginSource</a>(<a href="#84795" title="sbt.Path">source</a>)
				<a href="#56940" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#53707" title="(sbt.Path,sbt.Path)Unit">generatedClass</a>(<a href="#84795" title="sbt.Path">source</a>, <a href="#84689" title="sbt.Path">path</a>)
				<a href="#84570" title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]">productToSource</a>(<a href="#84689" title="sbt.Path">path</a>) = <a href="#84795" title="sbt.Path">source</a>
				<a href="#84571" title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]">sourceToClassFiles</a>.<a title="(sbt.Path,=&gt; scala.collection.mutable.Buffer[sbt.classfile.ClassFile])scala.collection.mutable.Buffer[sbt.classfile.ClassFile]" id="38010">getOrElseUpdate</a>(<a href="#84795" title="sbt.Path">source</a>, <span title="scala.collection.mutable.ArrayBuffer[sbt.classfile.ClassFile]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[sbt.classfile.ClassFile]">ArrayBuffer</span>[ClassFile]) <a title="(sbt.classfile.ClassFile)Unit" id="45214">+=</a> <a href="#84690" title="sbt.classfile.ClassFile">classFile</a>
			}
			
			<span class="comment">// get class to class dependencies and map back to source to class dependencies</span>
			<span class="keyword">for</span>( <a href="#84797" title="(((sbt.Path, scala.collection.mutable.Buffer[sbt.classfile.ClassFile])) =&gt; Unit)Unit">(</a><a title="sbt.Path" id="84802">source</a>, <a title="scala.collection.mutable.Buffer[sbt.classfile.ClassFile]" id="84803">classFiles</a>) &lt;- <a href="#84571" title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]">sourceToClassFiles</a> )
			{
				<span class="keyword">for</span>(<a title="((sbt.classfile.ClassFile) =&gt; Unit)Unit" id="84817">classFile</a> &lt;- <a href="#84803" title="scala.collection.mutable.Buffer[sbt.classfile.ClassFile]">classFiles</a> <span class="keyword">if</span> <a href="#56923" title="(sbt.classfile.ClassFile)Boolean">isTopLevel</a>(<a href="#84817" title="sbt.classfile.ClassFile">classFile</a>);
					<a title="((Class[_]) =&gt; Unit)Unit" id="84819">cls</a> &lt;- <a href="#84546" title="(String,=&gt; String)Option[Class[_]]">load</a>(<a href="#84817" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#84674" title="=&gt; String">className</a>, <span title="java.lang.String(&quot;Could not load '&quot;)" class="string">&quot;Could not load '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84817" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#84674" title="=&gt; String">className</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' to check for superclasses.&quot;)" class="string">&quot;' to check for superclasses.&quot;</span>) )
				{
					<span class="keyword">for</span>(<a title="((Class[_]) =&gt; Unit)Unit" id="84822">superclass</a> &lt;- <a href="#84572" title="Iterable[Class[_]]">superclasses</a>)
						<span title="Unit" class="keyword">if</span>(<a href="#84822" title="Class[_]">superclass</a>.<a title="(java.lang.Class[_])Boolean" id="3916">isAssignableFrom</a>(<a href="#84819" title="Class[_]">cls</a>))
							<a href="#56940" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#53701" title="(sbt.Path,String,String,Boolean)Unit">foundSubclass</a>(<a href="#84802" title="sbt.Path">source</a>, <a href="#84817" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#84674" title="=&gt; String">className</a>, <a href="#84822" title="Class[_]">superclass</a>.<span title="()java.lang.String">getName</span>, <span title="Boolean(false)" class="keyword">false</span>)

					<span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[String]" id="84820">annotations</a> = <span title="scala.collection.mutable.ArrayBuffer[String]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[String]">ArrayBuffer</span>[String]
					<a href="#84820" title="scala.collection.mutable.ArrayBuffer[String]">annotations</a> <span title="(Iterable[String])Unit">++=</span> <a href="#84574" title="(Seq[java.lang.annotation.Annotation])Iterable[String]">annotated</a>(<a href="#84819" title="Class[_]">cls</a>.<a title="()Array[java.lang.annotation.Annotation]" id="5966">getAnnotations</a>)
					<span class="keyword">for</span>(<a title="((java.lang.reflect.Method) =&gt; Unit)Unit" id="84827">method</a> &lt;- <a href="#84819" title="Class[_]">cls</a>.<a title="()Array[java.lang.reflect.Method]" id="4314">getMethods</a>)
					{
						<a href="#84820" title="scala.collection.mutable.ArrayBuffer[String]">annotations</a> <span title="(Iterable[String])Unit">++=</span> <a href="#84574" title="(Seq[java.lang.annotation.Annotation])Iterable[String]">annotated</a>(<a href="#84827" title="java.lang.reflect.Method">method</a>.<a title="()Array[java.lang.annotation.Annotation]" id="19622">getAnnotations</a>)
						<span title="Unit" class="keyword">if</span>(<a href="#56928" title="(java.lang.reflect.Method)Boolean">isMain</a>(<a href="#84827" title="java.lang.reflect.Method">method</a>))
							<a href="#56940" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#53709" title="(sbt.Path,String)Unit">foundApplication</a>(<a href="#84802" title="sbt.Path">source</a>, <a href="#84817" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#84674" title="=&gt; String">className</a>)
					}
					<a href="#84820" title="scala.collection.mutable.ArrayBuffer[String]">annotations</a>.<span title="((String) =&gt; Unit)Unit">foreach</span> { <a title="String" id="84834">ann</a> =&gt; <a href="#56940" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#53702" title="(sbt.Path,String,String,Boolean)Unit">foundAnnotated</a>(<a href="#84802" title="sbt.Path">source</a>, <a href="#84817" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#84674" title="=&gt; String">className</a>, <a href="#84834" title="String">ann</a>, <span title="Boolean(false)" class="keyword">false</span>) }
				}
				<span class="keyword">def</span> <a title="(String)Unit" id="84804">processDependency</a>(<a title="String" id="84835">tpe</a>: <span title="String">String</span>)
				{
					<a href="../Control.scala.html#13545" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#53227" title="(sbt.Logger)(=&gt; Unit)Unit">trapAndLog</a>(<a href="#56938" title="sbt.Logger">log</a>)
					{
						<span class="keyword">val</span> <a title="Option[Class[_]]" id="84836">loaded</a> = <a href="#84546" title="(String,=&gt; String)Option[Class[_]]">load</a>(<a href="#84835" title="String">tpe</a>, <span title="java.lang.String(&quot;Problem processing dependencies of source &quot;)" class="string">&quot;Problem processing dependencies of source &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84802" title="sbt.Path">source</a>)
						<span class="keyword">for</span>(<a title="((Class[_]) =&gt; Unit)Unit" id="84838">clazz</a> &lt;- <a href="#84836" title="Option[Class[_]]">loaded</a>; <a title="((java.io.File) =&gt; Unit)Unit" id="84845">file</a> &lt;- <a href="../Control.scala.html#13545" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#53228" title="(=&gt; java.io.File)Either[Exception,java.io.File]">convertException</a>(<a href="../FileUtilities.scala.html#10716" title="object sbt.FileUtilities">FileUtilities</a>.<a href="../FileUtilities.scala.html#52263" title="(Class[_])java.io.File">classLocationFile</a>(<a href="#84838" title="Class[_]">clazz</a>)).<a title="=&gt; Either.RightProjection[Exception,java.io.File]" id="53342">right</a>)
						{
							<span title="Unit" class="keyword">if</span>(<a href="#84845" title="java.io.File">file</a>.<a title="()Boolean" id="16969">isDirectory</a>)
							{
								<span class="keyword">val</span> <a title="java.io.File" id="84846">resolved</a> = <a href="#56921" title="(java.io.File,String)java.io.File">resolveClassFile</a>(<a href="#84845" title="java.io.File">file</a>, <a href="#84835" title="String">tpe</a>)
								<a title="(Boolean,Any)Unit" id="6478">assume</a>(<a href="#84846" title="java.io.File">resolved</a>.<a title="()Boolean" id="16968">exists</a>, <span title="java.lang.String(&quot;Resolved class file &quot;)" class="string">&quot;Resolved class file &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84846" title="java.io.File">resolved</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; from &quot;)" class="string">&quot; from &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84802" title="sbt.Path">source</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; did not exist&quot;)" class="string">&quot; did not exist&quot;</span>)
								<span class="keyword">val</span> <a title="sbt.Path" id="84847">resolvedPath</a> = <a href="../Path.scala.html#11862" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#52308" title="(java.io.File)sbt.Path">fromFile</a>(<a href="#84846" title="java.io.File">resolved</a>)
								<span title="Unit" class="keyword">if</span>(<a href="../Path.scala.html#11862" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#52308" title="(java.io.File)sbt.Path">fromFile</a>(<a href="#84845" title="java.io.File">file</a>) <span title="(AnyRef)Boolean">==</span> <a href="#56935" title="sbt.Path">outputDirectory</a>)
								{
									<a href="#84570" title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]">productToSource</a>.<a title="(sbt.Path)Option[sbt.Path]" id="38092">get</a>(<a href="#84847" title="sbt.Path">resolvedPath</a>) <span title="Unit" class="keyword">match</span>
									{
										<span title="Unit" class="keyword">case</span> Some(<a title="sbt.Path" id="84861">dependsOn</a>) =&gt; <a href="#56940" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#53703" title="(sbt.Path,sbt.Path)Unit">sourceDependency</a>(<a href="#84861" title="sbt.Path">dependsOn</a>, <a href="#84802" title="sbt.Path">source</a>)
										<span title="Unit" class="keyword">case</span> <span title="object None">None</span> =&gt; <a href="#56940" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#53706" title="(sbt.Path,sbt.Path)Unit">productDependency</a>(<a href="#84847" title="sbt.Path">resolvedPath</a>, <a href="#84802" title="sbt.Path">source</a>)
									}
								}
								<span class="keyword">else</span>
									<a href="#56940" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#53705" title="(java.io.File,sbt.Path)Unit">classDependency</a>(<a href="#84846" title="java.io.File">resolved</a>, <a href="#84802" title="sbt.Path">source</a>)
							}
							<span class="keyword">else</span>
								<a href="#56940" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#53704" title="(java.io.File,sbt.Path)Unit">jarDependency</a>(<a href="#84845" title="java.io.File">file</a>, <a href="#84802" title="sbt.Path">source</a>)
						}
					}
				}
				
				<a href="#84803" title="scala.collection.mutable.Buffer[sbt.classfile.ClassFile]">classFiles</a>.<a title="((sbt.classfile.ClassFile) =&gt; Iterable[String])Seq[String]" id="16018">flatMap</a>(<a href="#84864" title="sbt.classfile.ClassFile">_</a>.<a href="ClassFile.scala.html#84683" title="=&gt; Set[String]">types</a>).<span title="((String) =&gt; Unit)Unit">foreach</span>(<a href="#84804" title="(String)Unit">processDependency</a>)
				<a href="#56940" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#53708" title="(sbt.Path)Unit">endSource</a>(<a href="#84802" title="sbt.Path">source</a>)
			}
		}
		
		<a href="#56942" title="=&gt; Option[String]">compile</a> <span title="(=&gt; Option[String])Option[String]">orElse</span> <a href="../Control.scala.html#13545" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#53231" title="(sbt.Logger)(=&gt; Unit)Either[String,Unit]">convertErrorMessage</a>(<a href="#56938" title="sbt.Logger">log</a>)(<a href="#84547" title="()Unit">analyze</a>()).<a title="=&gt; Either.LeftProjection[String,Unit]" id="53255">left</a>.<a title="=&gt; Option[String]" id="53277">toOption</a>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String)Some[String]" id="56916">guessSourceName</a>(<a title="String" id="84693">name</a>: <span title="String">String</span>) = <span title="(String)Some[String]">Some</span>( <a href="#56917" title="(String)String">takeToDollar</a>(<a href="#56920" title="(String)java.lang.String">trimClassExt</a>(<a href="#84693" title="String">name</a>)) )
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String)String" id="56917">takeToDollar</a>(<a title="String" id="84696">name</a>: <span title="String">String</span>) =
	{
		<span class="keyword">val</span> <a title="Int" id="84698">dollar</a> = <a href="#84696" title="String">name</a>.<span title="(Int)Int">indexOf</span>(<span title="Int(36)" class="char">'$'</span>)
		<span title="String" class="keyword">if</span>(<a href="#84698" title="Int">dollar</a> <span title="(Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span>) <a href="#84696" title="String">name</a> <span class="keyword">else</span> <a href="#84696" title="String">name</a>.<span title="(Int,Int)java.lang.String">substring</span>(<span title="Int(0)" class="int">0</span>, <a href="#84698" title="Int">dollar</a>)
	}
	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">val</span> <a title="java.lang.String(&quot;.class&quot;)" id="56918">ClassExt</a> = <span title="java.lang.String(&quot;.class&quot;)" class="string">&quot;.class&quot;</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String)java.lang.String" id="56920">trimClassExt</a>(<a title="String" id="84714">name</a>: <span title="String">String</span>) = <span title="java.lang.String" class="keyword">if</span>(<a href="#84714" title="String">name</a>.<a title="(java.lang.String)Boolean" id="6371">endsWith</a>(<span title="java.lang.String(&quot;.class&quot;)">ClassExt</span>)) <a href="#84714" title="String">name</a>.<span title="(Int,Int)java.lang.String">substring</span>(<span title="Int(0)" class="int">0</span>, <a href="#84714" title="String">name</a>.<span title="()Int">length</span> <span title="(Int)Int">-</span> <span title="java.lang.String(&quot;.class&quot;)">ClassExt</span>.<span title="()Int">length</span>) <span class="keyword">else</span> <a href="#84714" title="String">name</a>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(java.io.File,String)java.io.File" id="56921">resolveClassFile</a>(<a title="java.io.File" id="84848">file</a>: <span title="java.io.File">File</span>, <a title="String" id="84849">className</a>: <span title="String">String</span>): <span title="java.io.File">File</span> = (<a href="#84848" title="java.io.File">file</a> <a href="#84870" title="(java.io.File)((java.io.File, java.lang.String) =&gt; java.io.File)java.io.File" id="16159">/:</a> (<a href="#84849" title="String">className</a>.<a title="(Char,Char)java.lang.String" id="6387">replace</a>(<span title="Char('.')" class="char">'.'</span>,<span title="Char('/')" class="char">'/'</span>) <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.class&quot;)">ClassExt</span>).<span title="(java.lang.String)Array[java.lang.String]">split</span>(<span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>))(<a title="(java.io.File,java.lang.String)java.io.File" id="16953" class="keyword">new</a> <span title="java.io.File">File</span>(<a href="#84875" title="java.io.File">_</a>, <a href="#84876" title="java.lang.String">_</a>))
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(scala.collection.Set[sbt.Path],Iterable[sbt.Path],sbt.classfile.ClassFile,sbt.Logger)List[sbt.Path]" id="56922">guessSourcePath</a>(<a title="scala.collection.Set[sbt.Path]" id="84740">sources</a>: scala.collection.<a title="scala.collection.Set[sbt.Path]" id="16299">Set</a>[Path], <a title="Iterable[sbt.Path]" id="84741">roots</a>: <span title="Iterable[sbt.Path]">Iterable</span>[Path], <a title="sbt.classfile.ClassFile" id="84742">classFile</a>: <a href="ClassFile.scala.html#14349" title="sbt.classfile.ClassFile">ClassFile</a>, <a title="sbt.Logger" id="84743">log</a>: <a href="../Logger.scala.html#13532" title="sbt.Logger">Logger</a>) =
	{
		<span class="keyword">val</span> <a title="Array[java.lang.String]" id="84745">classNameParts</a> = <a href="#84742" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#84674" title="=&gt; String">className</a>.<span title="(java.lang.String)Array[java.lang.String]">split</span>(<span title="java.lang.String(&quot;\.&quot;)" class="string">&quot;&quot;&quot;\.&quot;&quot;&quot;</span>)
		<span class="keyword">val</span> <a title="Int" id="84746">lastIndex</a> = <a href="#84745" title="Array[java.lang.String]">classNameParts</a>.<a title="=&gt; Int" id="15873">length</a> <span title="(Int)Int">-</span> <span title="Int(1)" class="int">1</span>
		<span class="keyword">val</span> <a title="Array.Projection[java.lang.String]" id="84747">pkg</a> = <a href="#84745" title="Array[java.lang.String]">classNameParts</a>.<a title="(Int)Array.Projection[java.lang.String]" id="15856">take</a>(<a href="#84746" title="Int">lastIndex</a>)
		<span class="keyword">val</span> <a title="java.lang.String" id="84748">simpleClassName</a> = <a href="#84745" title="(Int)java.lang.String" id="15874">classNameParts</a>(<a href="#84746" title="Int">lastIndex</a>)
		<span class="keyword">val</span> <a title="String" id="84749">sourceFileName</a> = <a href="#84742" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#84682" title="=&gt; Option[String]">sourceFile</a>.<a title="(=&gt; String)String" id="30531">getOrElse</a>(<a href="#84748" title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString" id="6611">simpleClassName</a>.<a title="((Char) =&gt; Boolean)Seq[Char]" id="16025">takeWhile</a>(<a href="#84767" title="Char">_</a> <a title="(Char)Boolean" id="2958">!=</a> <span title="Char('$')" class="char">'$'</span>).<a title="(String,String,String)String" id="16174">mkString</a>(<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;.java&quot;)" class="string">&quot;.java&quot;</span>))
		<span class="keyword">val</span> <a title="String" id="84750">relativeSourceFile</a> = (<a href="#84747" title="Array.Projection[java.lang.String]">pkg</a> <a title="(Iterable[java.lang.String])RandomAccessSeq[java.lang.String]" id="15946">++</a> (<a href="#84749" title="String">sourceFileName</a> <a href="#84780" title="(String)List[String]" id="15700">::</a> <span title="object Nil">Nil</span>)).<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>)
		<span class="keyword">val</span> <a title="List[sbt.Path]" id="84751">candidates</a> = <a href="#84741" title="Iterable[sbt.Path]">roots</a>.<a title="((sbt.Path) =&gt; sbt.Path)Iterable[sbt.Path]" id="16138">map</a>(<a title="sbt.Path" id="84786">root</a> =&gt; <a href="../Path.scala.html#11862" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#52299" title="(sbt.Path,String)sbt.Path">fromString</a>(<a href="#84786" title="sbt.Path">root</a>, <a href="#84750" title="String">relativeSourceFile</a>)).<span title="((sbt.Path) =&gt; Boolean)Iterable[sbt.Path]">filter</span>(<a href="#84740" title="scala.collection.Set[sbt.Path]">sources</a>.<a href="#84788" title="(sbt.Path)Boolean" id="18161">contains</a>).<span title="=&gt; List[sbt.Path]">toList</span>
		<a href="#84751" title="List[sbt.Path]">candidates</a> <span title="Unit" class="keyword">match</span>
		{
			<span title="Unit" class="keyword">case</span> <span title="object Nil">Nil</span> =&gt; <a href="#84743" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#52376" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;Could not determine source for class &quot;)" class="string">&quot;Could not determine source for class &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84742" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#84674" title="=&gt; String">className</a>)
			<span title="Unit" class="keyword">case</span> <a title="sbt.Path" id="84790">head</a> :: <span title="object Nil">Nil</span> =&gt; <span title="Unit">(</span>)
			<span title="Unit" class="keyword">case</span> _ =&gt;<a href="#84743" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#52376" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;Multiple sources matched for class &quot;)" class="string">&quot;Multiple sources matched for class &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84742" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#84674" title="=&gt; String">className</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84751" title="List[sbt.Path]">candidates</a>.<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span>))
		}
		<a href="#84751" title="List[sbt.Path]">candidates</a>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.classfile.ClassFile)Boolean" id="56923">isTopLevel</a>(<a title="sbt.classfile.ClassFile" id="84807">classFile</a>: <a href="ClassFile.scala.html#14349" title="sbt.classfile.ClassFile">ClassFile</a>) = <a href="#84807" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#84674" title="=&gt; String">className</a>.<span title="(Int)Int">indexOf</span>(<span title="Int(36)" class="char">'$'</span>) <span title="(Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span>
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.lang.Class[Unit]" id="56925">unit</a> = <span title="java.lang.Class[Unit]">classOf</span>[Unit]
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[java.lang.Class[Array[String]]]" id="56927">strArray</a> = <a title="(java.lang.Class[Array[String]]*)List[java.lang.Class[Array[String]]]" id="496">List</a>(<span title="java.lang.Class[Array[String]]">classOf</span>[Array[String]])

	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(java.lang.reflect.Method)Boolean" id="56928">isMain</a>(<a title="java.lang.reflect.Method" id="84832">method</a>: <a title="java.lang.reflect.Method" id="3839">Method</a>): <span title="Boolean">Boolean</span> =
		<a href="#84832" title="java.lang.reflect.Method">method</a>.<a title="()java.lang.String" id="19575">getName</a> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;main&quot;)" class="string">&quot;main&quot;</span> <span title="(Boolean)Boolean">&amp;&amp;</span>
		<a href="#56929" title="(Int)Boolean">isMain</a>(<a href="#84832" title="java.lang.reflect.Method">method</a>.<a title="()Int" id="19576">getModifiers</a>) <span title="(Boolean)Boolean">&amp;&amp;</span>
		<a href="#84832" title="java.lang.reflect.Method">method</a>.<a title="()java.lang.Class[_]" id="19580">getReturnType</a> <span title="(AnyRef)Boolean">==</span> <a href="#56924" title="=&gt; java.lang.Class[Unit]">unit</a> <span title="(Boolean)Boolean">&amp;&amp;</span>
		<a href="#84832" title="java.lang.reflect.Method">method</a>.<a title="()Array[java.lang.Class[_]]" id="19584">getParameterTypes</a>.<span title="=&gt; List[java.lang.Class[_]]">toList</span> <span title="(AnyRef)Boolean">==</span> <a href="#56926" title="=&gt; List[java.lang.Class[Array[String]]]">strArray</a>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(Int)Boolean" id="56929">isMain</a>(<a title="Int" id="84831">modifiers</a>: <a title="Int" id="2342">Int</a>): <span title="Boolean">Boolean</span> = (<a href="#84831" title="Int">modifiers</a> <span title="(Int)Int">&amp;</span> <a href="#56930" title="=&gt; Int">mainModifiers</a>) <span title="(Int)Boolean">==</span> <a href="#56930" title="=&gt; Int">mainModifiers</a> <span title="(Boolean)Boolean">&amp;&amp;</span> (<a href="#84831" title="Int">modifiers</a> <span title="(Int)Int">&amp;</span> <a href="#56932" title="=&gt; Int">notMainModifiers</a>) <span title="(Int)Boolean">==</span> <span title="Int(0)" class="int">0</span>
	
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="56930">mainModifiers</a> = STATIC  <span title="Int(9)">|</span> PUBLIC
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="56932">notMainModifiers</a> = <span title="Int(1024)">ABSTRACT</span>
}
        </pre>
    </body>
</html>