<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/classfile/Analyze.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt.classfile
<span class="keyword">import</span> sbt._

<span class="keyword">import</span> scala.collection.mutable
<span class="keyword">import</span> mutable.{ArrayBuffer, Buffer}
<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> java.lang.annotation.Annotation
<span class="keyword">import</span> java.lang.reflect.Method
<span class="keyword">import</span> java.lang.reflect.Modifier.{STATIC, PUBLIC, ABSTRACT}

<span class="keyword">private</span>[sbt] <span class="keyword">object</span> <a title="object sbt.classfile.Analyze" id="12915">Analyze</a>
{
	<span class="keyword">def</span> <a title="[T](sbt.Path,sbt.Path,Iterable[sbt.Path],Iterable[sbt.Path],sbt.Logger)(=&gt; scala.collection.Set[sbt.Path],sbt.AnalysisCallback,java.lang.ClassLoader)(=&gt; Option[String])Option[String]" id="34494">apply</a>[<a title="&gt;: Nothing &lt;: Any" id="34496">T</a>](<a title="sbt.Path" id="34510">basePath</a>: <a href="../Path.scala.html#10152" title="sbt.Path">Path</a>, <a title="sbt.Path" id="34511">outputDirectory</a>: <a href="../Path.scala.html#10152" title="sbt.Path">Path</a>, <a title="Iterable[sbt.Path]" id="34512">sources</a>: <span title="Iterable[sbt.Path]">Iterable</span>[Path], <a title="Iterable[sbt.Path]" id="34513">roots</a>: <span title="Iterable[sbt.Path]">Iterable</span>[Path], <a title="sbt.Logger" id="34514">log</a>: <a href="../Logger.scala.html#11784" title="sbt.Logger">Logger</a>)
		(<a title="=&gt; scala.collection.Set[sbt.Path]" id="34515">allProducts</a>: =&gt; scala.collection.Set[Path], <a title="sbt.AnalysisCallback" id="34516">analysis</a>: <a href="../AnalysisCallback.scala.html#9171" title="sbt.AnalysisCallback">AnalysisCallback</a>, <a title="java.lang.ClassLoader" id="34517">loader</a>: <a title="java.lang.ClassLoader" id="1671">ClassLoader</a>)
		(<a title="=&gt; Option[String]" id="34518">compile</a>: =&gt; Option[String]): <span title="Option[String]">Option</span>[String] =
	{
		<span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Path]" id="57934">sourceSet</a> = <span title="(sbt.Path*)scala.collection.immutable.Set[sbt.Path]">Set</span>(<a href="#34512" title="Iterable[sbt.Path]">sources</a>.<span title="=&gt; Seq[sbt.Path]">toSeq</span> : _*)
		<span class="keyword">val</span> <a title="sbt.PathFinder" id="57935">classesFinder</a> = <a href="#34511" title="sbt.Path">outputDirectory</a> <a href="../Path.scala.html#15971" title="(sbt.FileFilter)sbt.PathFinder">**</a> <a href="../NameFilter.scala.html#30459" title="(String)sbt.NameFilter">GlobFilter</a>(<span title="java.lang.String(&quot;*.class&quot;)" class="string">&quot;*.class&quot;</span>)
		<span class="keyword">val</span> <a title="scala.collection.Set[sbt.Path]" id="57936">existingClasses</a> = <a href="#57935" title="sbt.PathFinder">classesFinder</a>.<a href="../Path.scala.html#15978" title="=&gt; scala.collection.Set[sbt.Path]">get</a>

		<span class="keyword">def</span> <a title="(String,=&gt; String)Option[Class[_]]" id="57937">load</a>(<a title="String" id="57940">tpe</a>: <span title="String">String</span>, <a title="=&gt; String" id="57941">errMsg</a>: =&gt; String): <span title="Option[Class[_]]">Option</span>[Class[_]] =
			<span class="keyword">try</span> { <a title="(java.lang.Class[?0])Some[java.lang.Class[?0]]" id="286">Some</a>(<a title="object java.lang.Class" id="1618">Class</a>.<a title="(java.lang.String,Boolean,java.lang.ClassLoader)java.lang.Class[_]" id="3887">forName</a>(<a href="#57940" title="String">tpe</a>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#34517" title="java.lang.ClassLoader">loader</a>)) }
			<span class="keyword">catch</span> { <span title="None.type" class="keyword">case</span> <a title="java.lang.Throwable" id="57957">e</a> =&gt; <a href="#34514" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#19518" title="(=&gt; String)Unit">warn</a>(<a href="#57941" title="=&gt; String">errMsg</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; : &quot;)" class="string">&quot; : &quot;</span> <span title="(Any)java.lang.String">+</span><a href="#57957" title="java.lang.Throwable">e</a>.<a title="()java.lang.String" id="17620">toString</a>); <span title="object None">None</span> }

		<span class="comment">// runs after compilation</span>
		<span class="keyword">def</span> <a title="()Unit" id="57938">analyze</a>()
		{
			<span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Path]" id="57959">allClasses</a> = <span title="(sbt.Path*)scala.collection.immutable.Set[sbt.Path]">Set</span>(<a href="#57935" title="sbt.PathFinder">classesFinder</a>.<a href="../Path.scala.html#15978" title="=&gt; scala.collection.Set[sbt.Path]">get</a>.<span title="=&gt; Seq[sbt.Path]">toSeq</span> : _*)
			<span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Path]" id="57960">newClasses</a> = <a href="#57959" title="scala.collection.immutable.Set[sbt.Path]">allClasses</a> <span title="(Iterable[sbt.Path])scala.collection.immutable.Set[sbt.Path]">--</span> <a href="#57936" title="scala.collection.Set[sbt.Path]">existingClasses</a> <span title="(Iterable[sbt.Path])scala.collection.immutable.Set[sbt.Path]">--</span> <a href="#34515" title="=&gt; scala.collection.Set[sbt.Path]">allProducts</a>
			
			<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]" id="57961">productToSource</a> = <span title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]">HashMap</span>[Path, Path]
			<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]" id="57962">sourceToClassFiles</a> = <span title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]">HashMap</span>[Path, Buffer[ClassFile]]

			<span class="keyword">val</span> <a title="Iterable[Class[_]]" id="57963">superclasses</a> = <a href="#34516" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34533" title="=&gt; Iterable[String]">superclassNames</a> <a title="((String) =&gt; Iterable[Class[_]])Iterable[Class[_]]" id="16062">flatMap</a> { <a title="String" id="57971">tpe</a> =&gt; <a href="#57937" title="(Option[Class[_]])Iterable[Class[_]]" id="898">load</a>(<a href="#57971" title="String">tpe</a>, <span title="java.lang.String(&quot;Could not load superclass '&quot;)" class="string">&quot;Could not load superclass '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#57971" title="String">tpe</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;'&quot;)" class="string">&quot;'&quot;</span>) }
			<span class="keyword">val</span> <a title="Iterable[String]" id="57964">annotations</a> = <a href="#34516" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34534" title="=&gt; Iterable[String]">annotationNames</a>

			<span class="keyword">def</span> <a title="(Seq[java.lang.annotation.Annotation])Iterable[String]" id="57965">annotated</a>(<a title="Seq[java.lang.annotation.Annotation]" id="57979">fromClass</a>: <a title="Seq[java.lang.annotation.Annotation]" id="729">Seq</a>[Annotation]) = <span title="Iterable[String]" class="keyword">if</span>(<a href="#57979" title="Seq[java.lang.annotation.Annotation]">fromClass</a>.<a title="=&gt; Boolean" id="16522">isEmpty</a>) <span title="object Nil">Nil</span> <span class="keyword">else</span> <a href="#57964" title="Iterable[String]">annotations</a>.<span title="((String) =&gt; Boolean)Iterable[String]">filter</span>(<span title="(java.lang.String*)scala.collection.immutable.Set[java.lang.String]">Set</span>() <a title="(Iterable[java.lang.String])scala.collection.immutable.Set[java.lang.String]" id="22697">++</a> <a href="#57979" title="Seq[java.lang.annotation.Annotation]">fromClass</a>.<a title="((java.lang.annotation.Annotation) =&gt; java.lang.String)Seq[java.lang.String]" id="16538">map</a>(<a href="#58004" title="java.lang.annotation.Annotation">_</a>.<a title="()java.lang.Class[_ &lt;: java.lang.annotation.Annotation]" id="57984">annotationType</a>.<span title="()java.lang.String">getName</span>))

			<span class="comment">// parse class files and assign classes to sources.  This must be done before dependencies, since the information comes</span>
			<span class="comment">// as class-&gt;class dependencies that must be mapped back to source-&gt;class dependencies using the source+class assignment</span>
			<span class="keyword">for</span>(<a title="((sbt.Path) =&gt; Unit)Unit" id="58007">newClass</a> &lt;- <a href="#57960" title="scala.collection.immutable.Set[sbt.Path]">newClasses</a>;
				<a title="(((sbt.Path, sbt.classfile.ClassFile)) =&gt; Unit)Unit" id="58018">path</a> &lt;- <a href="../Path.scala.html#10153" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#15366" title="(sbt.Path,sbt.Path)Option[sbt.Path]">relativize</a>(<a href="#34511" title="sbt.Path">outputDirectory</a>, <a href="#58007" title="sbt.Path">newClass</a>);
				<a title="sbt.classfile.ClassFile" id="58019">classFile</a> = <a href="Parser.scala.html#38410" title="(java.io.File,sbt.Logger)sbt.classfile.ClassFile">Parser</a>(<a href="#58007" title="sbt.Path">newClass</a>.<a href="../Path.scala.html#17865" title="=&gt; java.io.File">asFile</a>, <a href="#34514" title="sbt.Logger">log</a>);
				<a title="((String) =&gt; Unit)Unit" id="58021">sourceFile</a> &lt;- <a href="#58019" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38436" title="=&gt; Option[String]">sourceFile</a>;
				<a title="((sbt.Path) =&gt; Unit)Unit" id="58080">source</a> &lt;- <a href="#34498" title="(scala.collection.Set[sbt.Path],Iterable[sbt.Path],sbt.classfile.ClassFile,sbt.Logger)List[sbt.Path]">guessSourcePath</a>(<a href="#57934" title="scala.collection.immutable.Set[sbt.Path]">sourceSet</a>, <a href="#34513" title="Iterable[sbt.Path]">roots</a>, <a href="#58019" title="sbt.classfile.ClassFile">classFile</a>, <a href="#34514" title="sbt.Logger">log</a>))
			{
				<a href="#34516" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34537" title="(sbt.Path)Unit">beginSource</a>(<a href="#58080" title="sbt.Path">source</a>)
				<a href="#34516" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34544" title="(sbt.Path,sbt.Path)Unit">generatedClass</a>(<a href="#58080" title="sbt.Path">source</a>, <a href="#58018" title="sbt.Path">path</a>)
				<a href="#57961" title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]">productToSource</a>(<a href="#58018" title="sbt.Path">path</a>) = <a href="#58080" title="sbt.Path">source</a>
				<a href="#57962" title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]">sourceToClassFiles</a>.<a title="(sbt.Path,=&gt; scala.collection.mutable.Buffer[sbt.classfile.ClassFile])scala.collection.mutable.Buffer[sbt.classfile.ClassFile]" id="24193">getOrElseUpdate</a>(<a href="#58080" title="sbt.Path">source</a>, <span title="scala.collection.mutable.ArrayBuffer[sbt.classfile.ClassFile]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[sbt.classfile.ClassFile]">ArrayBuffer</span>[ClassFile]) <a title="(sbt.classfile.ClassFile)Unit" id="18509">+=</a> <a href="#58019" title="sbt.classfile.ClassFile">classFile</a>
			}
			
			<span class="comment">// get class to class dependencies and map back to source to class dependencies</span>
			<span class="keyword">for</span>( <a href="#58085" title="(((sbt.Path, scala.collection.mutable.Buffer[sbt.classfile.ClassFile])) =&gt; Unit)Unit">(</a><a title="sbt.Path" id="58090">source</a>, <a title="scala.collection.mutable.Buffer[sbt.classfile.ClassFile]" id="58091">classFiles</a>) &lt;- <a href="#57962" title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]">sourceToClassFiles</a> )
			{
				<span class="keyword">for</span>(<a title="((sbt.classfile.ClassFile) =&gt; Unit)Unit" id="58105">classFile</a> &lt;- <a href="#58091" title="scala.collection.mutable.Buffer[sbt.classfile.ClassFile]">classFiles</a> <span class="keyword">if</span> <a href="#34499" title="(sbt.classfile.ClassFile)Boolean">isTopLevel</a>(<a href="#58105" title="sbt.classfile.ClassFile">classFile</a>);
					<a title="((Class[_]) =&gt; Unit)Unit" id="58107">cls</a> &lt;- <a href="#57937" title="(String,=&gt; String)Option[Class[_]]">load</a>(<a href="#58105" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38428" title="=&gt; String">className</a>, <span title="java.lang.String(&quot;Could not load '&quot;)" class="string">&quot;Could not load '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58105" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38428" title="=&gt; String">className</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' to check for superclasses.&quot;)" class="string">&quot;' to check for superclasses.&quot;</span>) )
				{
					<span class="keyword">for</span>(<a title="((Class[_]) =&gt; Unit)Unit" id="58110">superclass</a> &lt;- <a href="#57963" title="Iterable[Class[_]]">superclasses</a>)
						<span title="Unit" class="keyword">if</span>(<a href="#58110" title="Class[_]">superclass</a>.<a title="(java.lang.Class[_])Boolean" id="3892">isAssignableFrom</a>(<a href="#58107" title="Class[_]">cls</a>))
							<a href="#34516" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34538" title="(sbt.Path,String,String,Boolean)Unit">foundSubclass</a>(<a href="#58090" title="sbt.Path">source</a>, <a href="#58105" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38428" title="=&gt; String">className</a>, <a href="#58110" title="Class[_]">superclass</a>.<span title="()java.lang.String">getName</span>, <span title="Boolean(false)" class="keyword">false</span>)

					<span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[String]" id="58108">annotations</a> = <span title="scala.collection.mutable.ArrayBuffer[String]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[String]">ArrayBuffer</span>[String]
					<a href="#58108" title="scala.collection.mutable.ArrayBuffer[String]">annotations</a> <span title="(Iterable[String])Unit">++=</span> <a href="#57965" title="(Seq[java.lang.annotation.Annotation])Iterable[String]">annotated</a>(<a href="#58107" title="Class[_]">cls</a>.<a title="()Array[java.lang.annotation.Annotation]" id="5692">getAnnotations</a>)
					<span class="keyword">for</span>(<a title="((java.lang.reflect.Method) =&gt; Unit)Unit" id="58119">method</a> &lt;- <a href="#58107" title="Class[_]">cls</a>.<a title="()Array[java.lang.reflect.Method]" id="4288">getMethods</a>)
					{
						<a href="#58108" title="scala.collection.mutable.ArrayBuffer[String]">annotations</a> <span title="(Iterable[String])Unit">++=</span> <a href="#57965" title="(Seq[java.lang.annotation.Annotation])Iterable[String]">annotated</a>(<a href="#58119" title="java.lang.reflect.Method">method</a>.<a title="()Array[java.lang.annotation.Annotation]" id="23785">getAnnotations</a>)
						<span title="Unit" class="keyword">if</span>(<a href="#34504" title="(java.lang.reflect.Method)Boolean">isMain</a>(<a href="#58119" title="java.lang.reflect.Method">method</a>))
							<a href="#34516" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34546" title="(sbt.Path,String)Unit">foundApplication</a>(<a href="#58090" title="sbt.Path">source</a>, <a href="#58105" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38428" title="=&gt; String">className</a>)
					}
					<a href="#58108" title="scala.collection.mutable.ArrayBuffer[String]">annotations</a>.<span title="((String) =&gt; Unit)Unit">foreach</span> { <a title="String" id="58128">ann</a> =&gt; <a href="#34516" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34539" title="(sbt.Path,String,String,Boolean)Unit">foundAnnotated</a>(<a href="#58090" title="sbt.Path">source</a>, <a href="#58105" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38428" title="=&gt; String">className</a>, <a href="#58128" title="String">ann</a>, <span title="Boolean(false)" class="keyword">false</span>) }
				}
				<span class="keyword">def</span> <a title="(String)Unit" id="58092">processDependency</a>(<a title="String" id="58133">tpe</a>: <span title="String">String</span>)
				{
					<a href="../Control.scala.html#11797" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#25437" title="(sbt.Logger)(=&gt; Unit)Unit">trapAndLog</a>(<a href="#34514" title="sbt.Logger">log</a>)
					{
						<span class="keyword">val</span> <a title="Option[Class[_]]" id="58134">loaded</a> = <a href="#57937" title="(String,=&gt; String)Option[Class[_]]">load</a>(<a href="#58133" title="String">tpe</a>, <span title="java.lang.String(&quot;Problem processing dependencies of source &quot;)" class="string">&quot;Problem processing dependencies of source &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58090" title="sbt.Path">source</a>)
						<span class="keyword">for</span>(<a title="((Class[_]) =&gt; Unit)Unit" id="58136">clazz</a> &lt;- <a href="#58134" title="Option[Class[_]]">loaded</a>; <a title="((java.io.File) =&gt; Unit)Unit" id="58143">file</a> &lt;- <a href="../Control.scala.html#11797" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#25438" title="(=&gt; java.io.File)Either[Exception,java.io.File]">convertException</a>(<a href="../FileUtilities.scala.html#9046" title="object sbt.FileUtilities">FileUtilities</a>.<a href="../FileUtilities.scala.html#15328" title="(Class[_])java.io.File">classLocationFile</a>(<a href="#58136" title="Class[_]">clazz</a>)).<a title="=&gt; Either.RightProjection[Exception,java.io.File]" id="25550">right</a>)
						{
							<span title="Unit" class="keyword">if</span>(<a href="#58143" title="java.io.File">file</a>.<a title="()Boolean" id="16022">isDirectory</a>)
							{
								<span class="keyword">val</span> <a title="java.io.File" id="58144">resolved</a> = <a href="#34497" title="(java.io.File,String)java.io.File">resolveClassFile</a>(<a href="#58143" title="java.io.File">file</a>, <a href="#58133" title="String">tpe</a>)
								<a title="(Boolean,Any)Unit" id="6091">assume</a>(<a href="#58144" title="java.io.File">resolved</a>.<a title="()Boolean" id="16021">exists</a>, <span title="java.lang.String(&quot;Resolved class file &quot;)" class="string">&quot;Resolved class file &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58144" title="java.io.File">resolved</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; from &quot;)" class="string">&quot; from &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58090" title="sbt.Path">source</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; did not exist&quot;)" class="string">&quot; did not exist&quot;</span>)
								<span class="keyword">val</span> <a title="sbt.Path" id="58145">resolvedPath</a> = <a href="../Path.scala.html#10153" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#15373" title="(java.io.File)sbt.Path">fromFile</a>(<a href="#58144" title="java.io.File">resolved</a>)
								<span title="Unit" class="keyword">if</span>(<a href="../Path.scala.html#10153" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#15373" title="(java.io.File)sbt.Path">fromFile</a>(<a href="#58143" title="java.io.File">file</a>) <span title="(AnyRef)Boolean">==</span> <a href="#34511" title="sbt.Path">outputDirectory</a>)
								{
									<a href="#57961" title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]">productToSource</a>.<a title="(sbt.Path)Option[sbt.Path]" id="24898">get</a>(<a href="#58145" title="sbt.Path">resolvedPath</a>) <span title="Unit" class="keyword">match</span>
									{
										<span title="Unit" class="keyword">case</span> Some(<a title="sbt.Path" id="58159">dependsOn</a>) =&gt; <a href="#34516" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34540" title="(sbt.Path,sbt.Path)Unit">sourceDependency</a>(<a href="#58159" title="sbt.Path">dependsOn</a>, <a href="#58090" title="sbt.Path">source</a>)
										<span title="Unit" class="keyword">case</span> <span title="object None">None</span> =&gt; <a href="#34516" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34543" title="(sbt.Path,sbt.Path)Unit">productDependency</a>(<a href="#58145" title="sbt.Path">resolvedPath</a>, <a href="#58090" title="sbt.Path">source</a>)
									}
								}
								<span class="keyword">else</span>
									<a href="#34516" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34542" title="(java.io.File,sbt.Path)Unit">classDependency</a>(<a href="#58144" title="java.io.File">resolved</a>, <a href="#58090" title="sbt.Path">source</a>)
							}
							<span class="keyword">else</span>
								<a href="#34516" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34541" title="(java.io.File,sbt.Path)Unit">jarDependency</a>(<a href="#58143" title="java.io.File">file</a>, <a href="#58090" title="sbt.Path">source</a>)
						}
					}
				}
				
				<a href="#58091" title="scala.collection.mutable.Buffer[sbt.classfile.ClassFile]">classFiles</a>.<a title="((sbt.classfile.ClassFile) =&gt; Iterable[String])Seq[String]" id="16540">flatMap</a>(<a href="#58170" title="sbt.classfile.ClassFile">_</a>.<a href="ClassFile.scala.html#38437" title="=&gt; Set[String]">types</a>).<span title="((String) =&gt; Unit)Unit">foreach</span>(<a href="#58092" title="(String)Unit">processDependency</a>)
				<a href="#34516" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#34545" title="(sbt.Path)Unit">endSource</a>(<a href="#58090" title="sbt.Path">source</a>)
			}
		}
		
		<a href="#34518" title="=&gt; Option[String]">compile</a> <a title="(=&gt; Option[String])Option[String]" id="19023">orElse</a> <a href="../Control.scala.html#11797" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#25441" title="(sbt.Logger)(=&gt; Unit)Either[String,Unit]">convertErrorMessage</a>(<a href="#34514" title="sbt.Logger">log</a>)(<a href="#57938" title="()Unit">analyze</a>()).<a title="=&gt; Either.LeftProjection[String,Unit]" id="25463">left</a>.<a title="=&gt; Option[String]" id="25485">toOption</a>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(java.io.File,String)java.io.File" id="34497">resolveClassFile</a>(<a title="java.io.File" id="58146">file</a>: <span title="java.io.File">File</span>, <a title="String" id="58147">className</a>: <span title="String">String</span>): <span title="java.io.File">File</span> = (<a href="#58146" title="java.io.File">file</a> <a href="#58179" title="(java.io.File)((java.io.File, java.lang.String) =&gt; java.io.File)java.io.File" id="16081">/:</a> (<a href="#58147" title="String">className</a>.<a title="(Char,Char)java.lang.String" id="5803">replace</a>(<span title="Char('.')" class="char">'.'</span>,<span title="Char('/')" class="char">'/'</span>) <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.class&quot;)" class="string">&quot;.class&quot;</span>).<span title="(java.lang.String)Array[java.lang.String]">split</span>(<span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>))(<a title="(java.io.File,java.lang.String)java.io.File" id="16006" class="keyword">new</a> <span title="java.io.File">File</span>(<a href="#58184" title="java.io.File">_</a>, <a href="#58185" title="java.lang.String">_</a>))
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(scala.collection.Set[sbt.Path],Iterable[sbt.Path],sbt.classfile.ClassFile,sbt.Logger)List[sbt.Path]" id="34498">guessSourcePath</a>(<a title="scala.collection.Set[sbt.Path]" id="58022">sources</a>: scala.collection.<a title="scala.collection.Set[sbt.Path]" id="15437">Set</a>[Path], <a title="Iterable[sbt.Path]" id="58023">roots</a>: <span title="Iterable[sbt.Path]">Iterable</span>[Path], <a title="sbt.classfile.ClassFile" id="58024">classFile</a>: <a href="ClassFile.scala.html#13058" title="sbt.classfile.ClassFile">ClassFile</a>, <a title="sbt.Logger" id="58025">log</a>: <a href="../Logger.scala.html#11784" title="sbt.Logger">Logger</a>) =
	{
		<span class="keyword">val</span> <a title="Array[java.lang.String]" id="58027">classNameParts</a> = <a href="#58024" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38428" title="=&gt; String">className</a>.<span title="(java.lang.String)Array[java.lang.String]">split</span>(<span title="java.lang.String(&quot;\.&quot;)" class="string">&quot;&quot;&quot;\.&quot;&quot;&quot;</span>)
		<span class="keyword">val</span> <a title="Int" id="58028">lastIndex</a> = <a href="#58027" title="Array[java.lang.String]">classNameParts</a>.<a title="=&gt; Int" id="17100">length</a> <a title="(Int)Int" id="3096">-</a> <span title="Int(1)" class="int">1</span>
		<span class="keyword">val</span> <a title="Array.Projection[java.lang.String]" id="58029">pkg</a> = <a href="#58027" title="Array[java.lang.String]">classNameParts</a>.<a title="(Int)Array.Projection[java.lang.String]" id="17083">take</a>(<a href="#58028" title="Int">lastIndex</a>)
		<span class="keyword">val</span> <a title="java.lang.String" id="58030">simpleClassName</a> = <a href="#58027" title="(Int)java.lang.String" id="17101">classNameParts</a>(<a href="#58028" title="Int">lastIndex</a>)
		<span class="keyword">val</span> <a title="String" id="58031">sourceFileName</a> = <a href="#58024" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38436" title="=&gt; Option[String]">sourceFile</a>.<a title="(=&gt; String)String" id="19015">getOrElse</a>(<a href="#58030" title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString" id="6224">simpleClassName</a>.<a title="((Char) =&gt; Boolean)Seq[Char]" id="16547">takeWhile</a>(<a href="#58050" title="Char">_</a> <a title="(Char)Boolean" id="2967">!=</a> <span title="Char('$')" class="char">'$'</span>).<a title="(String,String,String)String" id="16096">mkString</a>(<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;.java&quot;)" class="string">&quot;.java&quot;</span>))
		<span class="keyword">val</span> <a title="String" id="58032">relativeSourceFile</a> = (<a href="#58029" title="Array.Projection[java.lang.String]">pkg</a> <a title="(Iterable[java.lang.String])RandomAccessSeq[java.lang.String]" id="16468">++</a> (<a href="#58031" title="String">sourceFileName</a> <a href="#58063" title="(String)List[String]" id="17725">::</a> <span title="object Nil">Nil</span>)).<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>)
		<span class="keyword">val</span> <a title="List[sbt.Path]" id="58033">candidates</a> = <a href="#58023" title="Iterable[sbt.Path]">roots</a>.<a title="((sbt.Path) =&gt; sbt.Path)Iterable[sbt.Path]" id="16060">map</a>(<a title="sbt.Path" id="58069">root</a> =&gt; <a href="../Path.scala.html#10153" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#15364" title="(sbt.Path,String)sbt.Path">fromString</a>(<a href="#58069" title="sbt.Path">root</a>, <a href="#58032" title="String">relativeSourceFile</a>)).<span title="((sbt.Path) =&gt; Boolean)Iterable[sbt.Path]">filter</span>(<a href="#58022" title="scala.collection.Set[sbt.Path]">sources</a>.<a href="#58073" title="(sbt.Path)Boolean" id="17941">contains</a>).<span title="=&gt; List[sbt.Path]">toList</span>
		<a href="#58033" title="List[sbt.Path]">candidates</a> <span title="Unit" class="keyword">match</span>
		{
			<span title="Unit" class="keyword">case</span> <span title="object Nil">Nil</span> =&gt; <a href="#58025" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#19518" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;Could not determine source for class &quot;)" class="string">&quot;Could not determine source for class &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58024" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38428" title="=&gt; String">className</a>)
			<span title="Unit" class="keyword">case</span> <a title="sbt.Path" id="58075">head</a> :: <span title="object Nil">Nil</span> =&gt; <span title="Unit">(</span>)
			<span title="Unit" class="keyword">case</span> _ =&gt;<a href="#58025" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#19518" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;Multiple sources matched for class &quot;)" class="string">&quot;Multiple sources matched for class &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58024" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38428" title="=&gt; String">className</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#58033" title="List[sbt.Path]">candidates</a>.<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span>))
		}
		<a href="#58033" title="List[sbt.Path]">candidates</a>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.classfile.ClassFile)Boolean" id="34499">isTopLevel</a>(<a title="sbt.classfile.ClassFile" id="58095">classFile</a>: <a href="ClassFile.scala.html#13058" title="sbt.classfile.ClassFile">ClassFile</a>) = <a href="#58095" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#38428" title="=&gt; String">className</a>.<a title="(Int)Int" id="5789">indexOf</a>(<span title="Int(36)" class="char">'$'</span>) <a title="(Int)Boolean" id="3091">&lt;</a> <span title="Int(0)" class="int">0</span>
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.lang.Class[Unit]" id="34501">unit</a> = <span title="java.lang.Class[Unit]">classOf</span>[Unit]
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[java.lang.Class[Array[String]]]" id="34503">strArray</a> = <a title="(java.lang.Class[Array[String]]*)List[java.lang.Class[Array[String]]]" id="496">List</a>(<span title="java.lang.Class[Array[String]]">classOf</span>[Array[String]])

	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(java.lang.reflect.Method)Boolean" id="34504">isMain</a>(<a title="java.lang.reflect.Method" id="58124">method</a>: <a title="java.lang.reflect.Method" id="3815">Method</a>): <span title="Boolean">Boolean</span> =
		<a href="#58124" title="java.lang.reflect.Method">method</a>.<a title="()java.lang.String" id="23740">getName</a> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;main&quot;)" class="string">&quot;main&quot;</span> <span title="(Boolean)Boolean">&amp;&amp;</span>
		<a href="#34505" title="(Int)Boolean">isMain</a>(<a href="#58124" title="java.lang.reflect.Method">method</a>.<a title="()Int" id="23741">getModifiers</a>) <span title="(Boolean)Boolean">&amp;&amp;</span>
		<a href="#58124" title="java.lang.reflect.Method">method</a>.<a title="()java.lang.Class[_]" id="23745">getReturnType</a> <span title="(AnyRef)Boolean">==</span> <a href="#34500" title="=&gt; java.lang.Class[Unit]">unit</a> <span title="(Boolean)Boolean">&amp;&amp;</span>
		<a href="#58124" title="java.lang.reflect.Method">method</a>.<a title="()Array[java.lang.Class[_]]" id="23749">getParameterTypes</a>.<span title="=&gt; List[java.lang.Class[_]]">toList</span> <span title="(AnyRef)Boolean">==</span> <a href="#34502" title="=&gt; List[java.lang.Class[Array[String]]]">strArray</a>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(Int)Boolean" id="34505">isMain</a>(<a title="Int" id="58123">modifiers</a>: <a title="Int" id="2351">Int</a>): <span title="Boolean">Boolean</span> = (<a href="#58123" title="Int">modifiers</a> <span title="(Int)Int">&amp;</span> <a href="#34506" title="=&gt; Int">mainModifiers</a>) <span title="(Int)Boolean">==</span> <a href="#34506" title="=&gt; Int">mainModifiers</a> <span title="(Boolean)Boolean">&amp;&amp;</span> (<a href="#58123" title="Int">modifiers</a> <span title="(Int)Int">&amp;</span> <a href="#34508" title="=&gt; Int">notMainModifiers</a>) <span title="(Int)Boolean">==</span> <span title="Int(0)" class="int">0</span>
	
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="34506">mainModifiers</a> = STATIC  <span title="Int(9)">|</span> PUBLIC
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="34508">notMainModifiers</a> = <span title="Int(1024)">ABSTRACT</span>
}
        </pre>
    </body>
</html>