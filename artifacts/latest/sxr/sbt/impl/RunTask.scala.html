<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/impl/RunTask.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009  Mark Harrah
 */</span>
 <span class="keyword">package</span> sbt.impl
 <span class="keyword">import</span> sbt._

<span class="keyword">import</span> scala.collection.{immutable, mutable}
<span class="keyword">import</span> scala.collection.Map
<span class="keyword">import</span> sbt.wrap.Wrappers.identityMap

<span class="keyword">private</span>[sbt] <span class="keyword">object</span> <a title="object sbt.impl.RunTask" id="14300">RunTask</a>
{
	<span class="keyword">final</span> <span class="keyword">type</span> <a title="sbt.Project#Task" id="72323">Task</a> = Project#<a href="../TaskManager.scala.html#50843" title="sbt.Project#Task">Task</a>
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="72324">apply</a>(<a title="sbt.impl.RunTask.Task" id="72337">root</a>: <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="72338">rootName</a>: <span title="String">String</span>): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]]  = <a href="#72325" title="(sbt.impl.RunTask.Task,String,Boolean)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">apply</a>(<a href="#72337" title="sbt.impl.RunTask.Task">root</a>, <a href="#72338" title="String">rootName</a>, <span title="Boolean(true)" class="keyword">true</span>)
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String,Boolean)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="72325">apply</a>(<a title="sbt.impl.RunTask.Task" id="72334">root</a>: <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="72335">rootName</a>: <span title="String">String</span>, <a title="Boolean" id="72336">parallelExecution</a>: <a title="Boolean" id="2110">Boolean</a>): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]] =
		<a href="#72326" title="(sbt.impl.RunTask.Task,String,Int)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">apply</a>(<a href="#72334" title="sbt.impl.RunTask.Task">root</a>, <a href="#72335" title="String">rootName</a>, <span title="Int" class="keyword">if</span>(<a href="#72336" title="Boolean">parallelExecution</a>) <a title="object java.lang.Runtime" id="1694">Runtime</a>.<a title="()java.lang.Runtime" id="57931">getRuntime</a>.<a title="()Int" id="57943">availableProcessors</a> <span class="keyword">else</span> <span title="Int(1)" class="int">1</span>)
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String,Int)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="72326">apply</a>(<a title="sbt.impl.RunTask.Task" id="72329">root</a>: <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="72330">rootName</a>: <span title="String">String</span>, <a title="Int" id="72331">maximumTasks</a>: <span title="Int">Int</span>): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]]  = (<span title="sbt.impl.RunTask" class="keyword">new</span> <a href="#14299" title="sbt.impl.RunTask">RunTask</a>(<a href="#72329" title="sbt.impl.RunTask.Task">root</a>, <a href="#72330" title="String">rootName</a>, <a href="#72331" title="Int">maximumTasks</a>)).<a href="#84107" title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">run</a>()
}
<span class="keyword">import</span> RunTask._
<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class RunTask extends java.lang.Object with NotNull with ScalaObject" id="14299">RunTask</a>(<a title="sbt.impl.RunTask.Task" id="84149">root</a>: <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="84150">rootName</a>: <span title="String">String</span>, <a title="Int" id="84151">maximumTasks</a>: <span title="Int">Int</span>) <span class="keyword">extends</span> <a title="NotNull" id="193">NotNull</a>
{
	<a title="(Boolean)Unit" id="6483">require</a>(<a href="#84151" title="Int">maximumTasks</a> <span title="(Int)Boolean">&gt;=</span> <span title="Int(1)" class="int">1</span>)
	<span class="keyword">def</span> <a title="=&gt; Boolean" id="84105">parallel</a> = <a href="#84151" title="Int">maximumTasks</a> <a title="(Int)Boolean" id="3088">&gt;</a> <span title="Int(1)" class="int">1</span>
	<span class="keyword">def</span> <a title="=&gt; Boolean" id="84106">multiProject</a> = <a href="#84140" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>.<a title="=&gt; Int" id="17964">size</a> <span title="(Int)Boolean">&gt;=</span> <span title="Int(2)" class="int">2</span>
	<span class="keyword">def</span> <a title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="84107">run</a>(): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]]  =
	{
		<span class="keyword">try</span>
		{
			<a href="#84108" title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">runTasksExceptRoot</a>() <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">match</span>
			{
				<span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">case</span> <span title="object Nil">Nil</span> =&gt;
					<span class="keyword">val</span> <a title="Option[String]" id="84312">result</a> = <a href="#84116" title="(sbt.impl.RunTask.Task,String)Option[String]">runTask</a>(<a href="#84149" title="sbt.impl.RunTask.Task">root</a>, <a href="#84150" title="String">rootName</a>)
					<a href="#84312" title="Option[String]">result</a>.<span title="((String) =&gt; sbt.WorkFailure[sbt.impl.RunTask.Task])Option[sbt.WorkFailure[sbt.impl.RunTask.Task]]">map</span>( <a title="String" id="84317">errorMessage</a> =&gt; <a href="../ParallelRunner.scala.html#69394" title="(sbt.impl.RunTask.Task,String)sbt.WorkFailure[sbt.impl.RunTask.Task]">WorkFailure</a>(<a href="#84149" title="sbt.impl.RunTask.Task">root</a>, <span title="java.lang.String(&quot;Error running &quot;)" class="string">&quot;Error running &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84150" title="String">rootName</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84317" title="String">errorMessage</a>) ).<a title="=&gt; List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="30340">toList</a>
				<span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">case</span> <a title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="84323">failures</a> =&gt; <a href="#84323" title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">failures</a>
			}
		}
		<span class="keyword">finally</span>
		{
			<span class="keyword">for</span>(<a title="((sbt.Project#ManagerType) =&gt; Unit)Unit" id="84325">project</a> &lt;- <a href="#84140" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>; <a title="((String) =&gt; Unit)Unit" id="84327">saveError</a> &lt;- <a href="#84325" title="sbt.Project#ManagerType">project</a>.<a href="../Environment.scala.html#51328" title="()Option[String]">saveEnvironment</a>)
				<a href="#84325" title="sbt.Project#ManagerType">project</a>.<a href="../Project.scala.html#50852" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#49386" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;Could not save properties for project &quot;)" class="string">&quot;Could not save properties for project &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84325" title="sbt.Project#ManagerType">project</a>.<a href="../Project.scala.html#50858" title="=&gt; String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84327" title="String">saveError</a>)
		}
	}
	<span class="comment">// This runs all tasks except the root.task.</span>
	<span class="comment">// It uses a buffered logger in record mode to ensure that all output for a given task is consecutive</span>
	<span class="comment">// it ignores the root task so that the root task may be run with buffering disabled so that the output</span>
	<span class="comment">// occurs without delay.</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="84108">runTasksExceptRoot</a>() =
		<a href="../ParallelRunner.scala.html#8446" title="object sbt.ParallelRunner">ParallelRunner</a>.<a href="../ParallelRunner.scala.html#69288" title="(sbt.impl.RunTask.Task,(sbt.impl.RunTask.Task) =&gt; String,(sbt.impl.RunTask.Task) =&gt; Option[String],Int,(sbt.impl.RunTask.Task) =&gt; sbt.Logger)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">run</a>(<a href="#84136" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>, <a href="#84128" title="(sbt.impl.RunTask.Task)String">expandedTaskName</a>, <a href="#84110" title="(sbt.impl.RunTask.Task)Option[String]">runIfNotRoot</a>, <a href="#84151" title="Int">maximumTasks</a>, (<a title="sbt.impl.RunTask.Task" id="84305">t</a>: <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>) =&gt; <a href="#84305" title="sbt.impl.RunTask.Task">t</a>.<a href="../TaskManager.scala.html#52213" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#50852" title="=&gt; sbt.Logger">log</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="((sbt.BufferedLogger) =&gt; Unit)Unit" id="84109">withBuffered</a>(<a title="(sbt.BufferedLogger) =&gt; Unit" id="84329">f</a>: BufferedLogger =&gt; Unit)
	{
		<span class="keyword">for</span>(<a title="((sbt.BufferedLogger) =&gt; Unit)Unit" id="84331">buffered</a> &lt;- <a href="#84142" title="=&gt; List[sbt.BufferedLogger]">bufferedLoggers</a>)
			<a href="../Control.scala.html#13546" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#50236" title="(=&gt; Unit)Unit">trap</a>(<a href="#84329" title="(sbt.BufferedLogger)Unit" id="15917">f</a>(<a href="#84331" title="sbt.BufferedLogger">buffered</a>))
	}
	<span class="comment">/** Will be called in its own thread. Runs the given task if it is not the root task.*/</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Option[String]" id="84110">runIfNotRoot</a>(<a title="sbt.impl.RunTask.Task" id="84301">action</a>: <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>): <span title="Option[String]">Option</span>[String] =
	{
		<span title="Option[String]" class="keyword">if</span>(<a href="#84115" title="(sbt.impl.RunTask.Task)Boolean">isRoot</a>(<a href="#84301" title="sbt.impl.RunTask.Task">action</a>))
			<span title="object None">None</span>
		<span class="keyword">else</span>
			<a href="#84116" title="(sbt.impl.RunTask.Task,String)Option[String]">runTask</a>(<a href="#84301" title="sbt.impl.RunTask.Task">action</a>, <a href="#84128" title="(sbt.impl.RunTask.Task)String">expandedTaskName</a>(<a href="#84301" title="sbt.impl.RunTask.Task">action</a>))
	}
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="84111">headerStart</a> = <span title="object java.lang.System">System</span>.<span title="(java.lang.String,java.lang.String)java.lang.String">getProperty</span>(<span title="java.lang.String(&quot;sbt.start.delimiter&quot;)" class="string">&quot;sbt.start.delimiter&quot;</span>, <span title="java.lang.String(&quot;==&quot;)" class="string">&quot;==&quot;</span>)
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="84113">headerEnd</a> = <span title="object java.lang.System">System</span>.<span title="(java.lang.String,java.lang.String)java.lang.String">getProperty</span>(<span title="java.lang.String(&quot;sbt.end.delimiter&quot;)" class="string">&quot;sbt.end.delimiter&quot;</span>, <span title="java.lang.String(&quot;==&quot;)" class="string">&quot;==&quot;</span>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Boolean" id="84115">isRoot</a>(<a title="sbt.impl.RunTask.Task" id="84334">t</a>: <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>) = <a href="#84334" title="sbt.impl.RunTask.Task">t</a> <span title="(AnyRef)Boolean">==</span> <a href="#84136" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>
	<span class="comment">/** Will be called in its own thread except for the root task. */</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String)Option[String]" id="84116">runTask</a>(<a title="sbt.impl.RunTask.Task" id="84313">action</a>: <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="84314">actionName</a>: <span title="String">String</span>): <span title="Option[String]">Option</span>[String] =
	{
		<span class="keyword">val</span> <a title="java.lang.String" id="84337">label</a> = <span title="java.lang.String" class="keyword">if</span>(<a href="#84106" title="=&gt; Boolean">multiProject</a>) (<a href="#84313" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#52213" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#50858" title="=&gt; String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; / &quot;)" class="string">&quot; / &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84314" title="String">actionName</a>) <span class="keyword">else</span> <a href="#84314" title="String">actionName</a>
		<span class="keyword">def</span> <a title="(sbt.ControlEvent.Value,String,String)Unit" id="84338">banner</a>(<a title="sbt.ControlEvent.Value" id="84343">event</a>: ControlEvent.<a title="sbt.ControlEvent.Value" id="33834">Value</a>, <a title="String" id="84344">firstSeparator</a>: <span title="String">String</span>, <a title="String" id="84345">secondSeparator</a>: <span title="String">String</span>) =
			<a href="../Control.scala.html#13546" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#50236" title="(=&gt; Unit)Unit">trap</a>(<a href="#84313" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#52213" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#50852" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#49390" title="(sbt.ControlEvent.Value,=&gt; String)Unit">control</a>(<a href="#84343" title="sbt.ControlEvent.Value">event</a>, <a href="#84344" title="String">firstSeparator</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84337" title="java.lang.String">label</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84345" title="String">secondSeparator</a>))
		<span class="keyword">val</span> <a title="Boolean" id="84339">buffered</a> = <a href="#84105" title="=&gt; Boolean">parallel</a> <a title="(Boolean)Boolean" id="2694">&amp;&amp;</a> <a title="=&gt; Boolean" id="2690">!</a><a href="#84115" title="(sbt.impl.RunTask.Task)Boolean">isRoot</a>(<a href="#84313" title="sbt.impl.RunTask.Task">action</a>)
		<span title="Unit" class="keyword">if</span>(<a href="#84339" title="Boolean">buffered</a>)
			<a href="#84338" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#12202" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#64657" title="=&gt; sbt.ControlEvent.Value">Start</a>, <span title="java.lang.String(&quot;\012  &quot;)" class="string">&quot;\n  &quot;</span>, <span title="java.lang.String(&quot;...&quot;)" class="string">&quot;...&quot;</span>)
		<span class="keyword">def</span> <a title="()Option[String]" id="84340">doRun</a>() =
		{
			<a href="#84338" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#12202" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#64659" title="=&gt; sbt.ControlEvent.Value">Header</a>, <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84111" title="=&gt; java.lang.String">headerStart</a>, <a href="#84111" title="=&gt; java.lang.String">headerStart</a>)
			<span class="keyword">try</span> { <a href="#84313" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#52221" title="=&gt; Option[String]">invoke</a> }
			<span class="keyword">catch</span> { <span title="Some[java.lang.String]" class="keyword">case</span> <a title="Exception" id="84351">e</a>: <a title="Exception" id="2071">Exception</a> =&gt; <a href="#84313" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#52213" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#50852" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#49382" title="(=&gt; Throwable)Unit">trace</a>(<a href="#84351" title="Exception">e</a>); <span title="(java.lang.String)Some[java.lang.String]">Some</span>(<a href="#84351" title="Exception">e</a>.<a title="()java.lang.String" id="17833">toString</a>) }
			<span class="keyword">finally</span> { <a href="#84338" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#12202" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#64661" title="=&gt; sbt.ControlEvent.Value">Finish</a>, <a href="#84113" title="=&gt; java.lang.String">headerEnd</a>, <a href="#84113" title="=&gt; java.lang.String">headerEnd</a>) }
		}
		
		<span title="Option[String]" class="keyword">if</span>(<a href="#84339" title="Boolean">buffered</a>)
			<a href="#84117" title="(sbt.impl.RunTask.Task,=&gt; Option[String])Option[String]">bufferLogging</a>(<a href="#84313" title="sbt.impl.RunTask.Task">action</a>, <a href="#84340" title="()Option[String]">doRun</a>())
		<span class="keyword">else</span>
			<a href="#84340" title="()Option[String]">doRun</a>()
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](sbt.impl.RunTask.Task,=&gt; T)T" id="84117">bufferLogging</a>[<a title="&gt;: Nothing &lt;: Any" id="84119">T</a>](<a title="sbt.impl.RunTask.Task" id="84358">action</a>: <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>, <a title="=&gt; T" id="84359">f</a>: =&gt; T) =
		<a href="#84148" title="(sbt.Project)Option[sbt.BufferedLogger]">bufferedLogger</a>(<a href="#84358" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#52213" title="=&gt; sbt.Project#ManagerType">manager</a>) <span title="T" class="keyword">match</span>
		{
			<span title="T" class="keyword">case</span> <a id="1">Some</a>(<a title="sbt.BufferedLogger" id="84363">buffered</a>) =&gt; <a href="#84363" title="sbt.BufferedLogger">buffered</a>.<a href="../Logger.scala.html#64903" title="(=&gt; T)T">buffer</a> { <a href="#84359" title="=&gt; T">f</a> }
			<span title="T" class="keyword">case</span> <span title="object None">None</span> =&gt; <a href="#84359" title="=&gt; T">f</a>
		}
	
	<span class="comment">/* Most of the following is for implicitly adding dependencies (see the expand method)*/</span>
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.Project,Iterable[sbt.Project]]" id="84120">projectDependencyCache</a> = <a href="../wrap/Wrappers.scala.html#49453" title="sbt.wrap.MutableMapWrapper[sbt.Project,Iterable[sbt.Project]]">identityMap</a>[<a href="../Project.scala.html#9291" title="sbt.Project">Project</a>, <a title="Iterable[sbt.Project]" id="376">Iterable</a>[Project]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)Iterable[sbt.Project]" id="84122">dependencies</a>(<a title="sbt.Project" id="84366">project</a>: <a href="../Project.scala.html#9291" title="sbt.Project">Project</a>) = <a href="#84120" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.Project,Iterable[sbt.Project]]">projectDependencyCache</a>.<a href="../wrap/Wrappers.scala.html#64950" title="(sbt.Project,=&gt; Iterable[sbt.Project])Iterable[sbt.Project]">getOrElseUpdate</a>(<a href="#84366" title="sbt.Project">project</a>, <a href="#84366" title="sbt.Project">project</a>.<a href="../Dag.scala.html#51246" title="=&gt; List[sbt.Project]">topologicalSort</a>.<a title="(Int)List[sbt.Project]" id="15524">dropRight</a>(<span title="Int(1)" class="int">1</span>))

	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]" id="84123">expandedCache</a> = <a href="../wrap/Wrappers.scala.html#49453" title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]">identityMap</a>[<a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>, <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="84125">expanded</a>(<a title="sbt.impl.RunTask.Task" id="84368">task</a>: <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a> = <a href="#84123" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]">expandedCache</a>.<a href="../wrap/Wrappers.scala.html#64950" title="(sbt.impl.RunTask.Task,=&gt; sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">getOrElseUpdate</a>(<a href="#84368" title="sbt.impl.RunTask.Task">task</a>, <a href="#84145" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expandImpl</a>(<a href="#84368" title="sbt.impl.RunTask.Task">task</a>))

	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]" id="84126">expandedTaskNameCache</a> = <a href="../wrap/Wrappers.scala.html#49453" title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]">identityMap</a>[<a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>, <span title="String">String</span>]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)String" id="84128">expandedTaskName</a>(<a title="sbt.impl.RunTask.Task" id="84288">task</a>: <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>) =
		<span title="String" class="keyword">if</span>(<a href="#84288" title="sbt.impl.RunTask.Task">task</a> <span title="(AnyRef)Boolean">==</span> <a href="#84136" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>)
			<a href="#84150" title="String">rootName</a>
		<span class="keyword">else</span>
			<a href="#84126" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]">expandedTaskNameCache</a>.<a href="../wrap/Wrappers.scala.html#64935" title="(sbt.impl.RunTask.Task,=&gt; String)String">getOrElse</a>(<a href="#84288" title="sbt.impl.RunTask.Task">task</a>, <a href="#84288" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#52214" title="=&gt; String">name</a>)

	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]" id="84129">nameToTaskCache</a> = <a href="../wrap/Wrappers.scala.html#49453" title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]">identityMap</a>[<a href="../Project.scala.html#9291" title="sbt.Project">Project</a>, <span title="scala.collection.Map[String,sbt.impl.RunTask.Task]">Map</span>[String, Task]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]" id="84131">nameToTaskMap</a>(<a title="sbt.Project" id="84370">project</a>: <a href="../Project.scala.html#9291" title="sbt.Project">Project</a>): <span title="scala.collection.Map[String,sbt.impl.RunTask.Task]">Map</span>[String, Task] = <a href="#84129" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]">nameToTaskCache</a>.<a href="../wrap/Wrappers.scala.html#64950" title="(sbt.Project,=&gt; scala.collection.Map[String,sbt.impl.RunTask.Task])scala.collection.Map[String,sbt.impl.RunTask.Task]">getOrElseUpdate</a>(<a href="#84370" title="sbt.Project">project</a>, <a href="#84370" title="sbt.Project">project</a>.<a href="../Project.scala.html#50864" title="=&gt; scala.collection.Map[String,project.ManagedTask]">tasks</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project,String)Option[sbt.impl.RunTask.Task]" id="84132">taskForName</a>(<a title="sbt.Project" id="84371">project</a>: <a href="../Project.scala.html#9291" title="sbt.Project">Project</a>, <a title="String" id="84372">name</a>: <span title="String">String</span>): <span title="Option[sbt.impl.RunTask.Task]">Option</span>[Task] = <a href="#84131" title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]">nameToTaskMap</a>(<a href="#84371" title="sbt.Project">project</a>).<span title="(String)Option[sbt.impl.RunTask.Task]">get</span>(<a href="#84372" title="String">name</a>)
	
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]" id="84133">taskNameCache</a> = <a href="../wrap/Wrappers.scala.html#49453" title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]">identityMap</a>[<a href="../Project.scala.html#9291" title="sbt.Project">Project</a>, <span title="scala.collection.Map[sbt.impl.RunTask.Task,String]">Map</span>[Task, String]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Option[String]" id="84135">taskName</a>(<a title="sbt.impl.RunTask.Task" id="84373">task</a>: <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>) =
	{
		<span class="keyword">val</span> <a title="sbt.Project#ManagerType" id="84375">project</a> = <a href="#84373" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#52213" title="=&gt; sbt.Project#ManagerType">manager</a>
		<a href="#84133" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]">taskNameCache</a>.<a href="../wrap/Wrappers.scala.html#64950" title="(sbt.Project,=&gt; scala.collection.Map[sbt.impl.RunTask.Task,String])scala.collection.Map[sbt.impl.RunTask.Task,String]">getOrElseUpdate</a>(<a href="#84375" title="sbt.Project#ManagerType">project</a>, <a href="#84147" title="(sbt.Project)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]">taskNameMap</a>(<a href="#84375" title="sbt.Project#ManagerType">project</a>)).<span title="(sbt.impl.RunTask.Task)Option[String]">get</span>(<a href="#84373" title="sbt.impl.RunTask.Task">task</a>)
	}
	
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.impl.RunTask.Task" id="84136">expandedRoot</a> = <a href="#84144" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expand</a>(<a href="#84149" title="sbt.impl.RunTask.Task">root</a>)
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="List[sbt.Project#ManagedTask]" id="84138">allTasks</a> = <a href="#84136" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>.<a href="../Dag.scala.html#51246" title="=&gt; List[sbt.Project#ManagedTask]">topologicalSort</a>
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Project#ManagerType]" id="84140">allProjects</a> = <a title="(sbt.Project#ManagerType*)scala.collection.immutable.Set[sbt.Project#ManagerType]" id="6474">Set</a>(<a href="#84138" title="=&gt; List[sbt.Project#ManagedTask]">allTasks</a>.<span title="((sbt.Project#ManagedTask) =&gt; sbt.Project#ManagerType)List[sbt.Project#ManagerType]">map</span>(<a href="#84265" title="sbt.Project#ManagedTask">_</a>.<a href="../TaskManager.scala.html#52213" title="=&gt; sbt.Project#ManagerType">manager</a>).<span title="=&gt; Seq[sbt.Project#ManagerType]">toSeq</span> : _*)
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="List[sbt.BufferedLogger]" id="84142">bufferedLoggers</a> = <span title="List[sbt.BufferedLogger]" class="keyword">if</span>(<a href="#84105" title="=&gt; Boolean">parallel</a>) <a href="#84140" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>.<span title="=&gt; List[sbt.Project#ManagerType]">toList</span>.<a title="((sbt.Project#ManagerType) =&gt; Iterable[sbt.BufferedLogger])List[sbt.BufferedLogger]" id="15552">flatMap</a>(<a href="#84148" title="(Option[sbt.BufferedLogger])Iterable[sbt.BufferedLogger]">bufferedLogger</a>) <span class="keyword">else</span> <span title="object Nil">Nil</span>
	
	<span class="comment">/** Adds implicit dependencies, which are tasks with the same name in the project dependencies
	* of the enclosing project of the task.*/</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="84144">expand</a>(<a title="sbt.impl.RunTask.Task" id="84257">root</a>: <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a> = <a href="#84125" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expanded</a>(<a href="#84257" title="sbt.impl.RunTask.Task">root</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="84145">expandImpl</a>(<a title="sbt.impl.RunTask.Task" id="84369">task</a>: <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#50843" title="sbt.impl.RunTask.Task">Task</a> =
	{
		<span class="keyword">val</span> <a title="Option[String]" id="84385">nameOption</a> = <a href="#84135" title="(sbt.impl.RunTask.Task)Option[String]">taskName</a>(<a href="#84369" title="sbt.impl.RunTask.Task">task</a>)
		<span class="keyword">val</span> <a title="List[sbt.Project#ManagedTask]" id="84386">explicitDependencies</a> = <a href="#84369" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#52206" title="=&gt; List[sbt.Project#ManagedTask]">dependencies</a>
		<span class="keyword">val</span> <a title="Iterable[sbt.impl.RunTask.Task]" id="84387">implicitDependencies</a> = <a href="#84385" title="Option[String]">nameOption</a>.<span title="((String) =&gt; Iterable[sbt.impl.RunTask.Task])Option[Iterable[sbt.impl.RunTask.Task]]">map</span>(<a title="String" id="84400">name</a> =&gt; <a href="#84122" title="(sbt.Project)Iterable[sbt.Project]">dependencies</a>(<a href="#84369" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#52213" title="=&gt; sbt.Project#ManagerType">manager</a>).<a title="((sbt.Project) =&gt; Iterable[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]" id="15944">flatMap</a>(<a href="#84146" title="(Option[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]">noninteractiveTask</a>(<a href="#84400" title="String">name</a>)) ).<a title="(=&gt; Iterable[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]" id="30329">getOrElse</a>(<span title="object Nil">Nil</span>)
		<span class="keyword">val</span> <a title="scala.collection.mutable.Set[sbt.Project#ManagedTask]" id="84388">allDependencies</a> = mutable.<a title="(sbt.Project#ManagedTask*)scala.collection.mutable.Set[sbt.Project#ManagedTask]" id="20038">HashSet</a>( (<a href="#84386" title="List[sbt.Project#ManagedTask]">explicitDependencies</a> <a title="(Iterable[sbt.Project#ManagedTask])List[sbt.Project#ManagedTask]" id="15510">++</a> <a href="#84387" title="Iterable[sbt.impl.RunTask.Task]">implicitDependencies</a>).<span title="=&gt; Seq[sbt.Project#ManagedTask]">toSeq</span>  : _* )
		<span class="keyword">val</span> <a title="sbt.Project#Task" id="84389">expandedTask</a> = <a href="#84369" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#52219" title="((List[_184.ManagedTask])_184.Task) forSome { val _184: sbt.Project }">setDependencies</a>(<a href="#84388" title="scala.collection.mutable.Set[sbt.Project#ManagedTask]">allDependencies</a>.<span title="=&gt; List[sbt.Project#ManagedTask]">toList</span>.<span title="((sbt.Project#ManagedTask) =&gt; sbt.impl.RunTask.Task)List[sbt.impl.RunTask.Task]">map</span>(<a href="#84125" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expanded</a>))
		<a href="#84385" title="Option[String]">nameOption</a>.<span title="((String) =&gt; Unit)Unit">foreach</span>(<a title="String" id="84433">name</a> =&gt; <a href="#84126" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]">expandedTaskNameCache</a>(<a href="#84389" title="sbt.Project#Task">expandedTask</a>) = <a href="#84433" title="String">name</a>)
		<a href="#84389" title="sbt.Project#Task">expandedTask</a>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String)(sbt.Project)Option[sbt.impl.RunTask.Task]" id="84146">noninteractiveTask</a>(<a title="String" id="84404">name</a>: <span title="String">String</span>)(<a title="sbt.Project" id="84405">project</a>: <a href="../Project.scala.html#9291" title="sbt.Project">Project</a>): <span title="Option[sbt.impl.RunTask.Task]">Option</span>[Task] =
		<a href="#84132" title="(sbt.Project,String)Option[sbt.impl.RunTask.Task]">taskForName</a>(<a href="#84405" title="sbt.Project">project</a>, <a href="#84404" title="String">name</a>) <a title="((sbt.impl.RunTask.Task) =&gt; Option[sbt.impl.RunTask.Task])Option[sbt.impl.RunTask.Task]" id="30333">flatMap</a> { <a title="sbt.impl.RunTask.Task" id="84436">task</a> =&gt;
			<span title="Option[sbt.impl.RunTask.Task]" class="keyword">if</span>(<a href="#84436" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#52208" title="=&gt; Boolean">interactive</a>)
			{
				<a href="#84405" title="sbt.Project">project</a>.<a href="../Project.scala.html#50852" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#49384" title="(=&gt; String)Unit">debug</a>(<span title="java.lang.String(&quot;Not including task &quot;)" class="string">&quot;Not including task &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84404" title="String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; in project &quot;)" class="string">&quot; in project &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84405" title="sbt.Project">project</a>.<a href="../Project.scala.html#50858" title="=&gt; String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: interactive tasks can only be run directly.&quot;)" class="string">&quot;: interactive tasks can only be run directly.&quot;</span>)
				<span title="object None">None</span>
			}
			<span class="keyword">else</span>
				<span title="(sbt.impl.RunTask.Task)Some[sbt.impl.RunTask.Task]">Some</span>(<a href="#84436" title="sbt.impl.RunTask.Task">task</a>)
		}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]" id="84147">taskNameMap</a>(<a title="sbt.Project" id="84378">project</a>: <a href="../Project.scala.html#9291" title="sbt.Project">Project</a>) = mutable.<a title="((sbt.impl.RunTask.Task, String)*)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]" id="20023">Map</a>(<a href="#84131" title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]">nameToTaskMap</a>(<a href="#84378" title="sbt.Project">project</a>).<a title="(((String, sbt.impl.RunTask.Task)) =&gt; (sbt.impl.RunTask.Task, String))Iterable[(sbt.impl.RunTask.Task, String)]" id="15942">map</a>(<a href="#84384" title="(String, sbt.impl.RunTask.Task)">_</a>.<a title="=&gt; (sbt.impl.RunTask.Task, String)" id="17802">swap</a>).<a title="=&gt; Seq[(sbt.impl.RunTask.Task, String)]" id="15976">toSeq</a> : _*)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)Option[sbt.BufferedLogger]" id="84148">bufferedLogger</a>(<a title="sbt.Project" id="84274">project</a>: <a href="../Project.scala.html#9291" title="sbt.Project">Project</a>): <span title="Option[sbt.BufferedLogger]">Option</span>[BufferedLogger] =
		<a href="#84274" title="sbt.Project">project</a>.<a href="../Project.scala.html#50852" title="=&gt; sbt.Logger">log</a> <span title="Option[sbt.BufferedLogger]" class="keyword">match</span>
		{
			<span title="Some[sbt.BufferedLogger]" class="keyword">case</span> <a title="sbt.BufferedLogger" id="84439">buffered</a>: <a href="../Logger.scala.html#8061" title="sbt.BufferedLogger">BufferedLogger</a> =&gt; <span title="(sbt.BufferedLogger)Some[sbt.BufferedLogger]">Some</span>(<a href="#84439" title="sbt.BufferedLogger">buffered</a>)
			<span title="None.type" class="keyword">case</span> _ =&gt; <span title="object None">None</span>
		}
}
        </pre>
    </body>
</html>