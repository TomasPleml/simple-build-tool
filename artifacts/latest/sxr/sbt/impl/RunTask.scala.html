<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/impl/RunTask.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009  Mark Harrah
 */</span>
 <span class="keyword">package</span> sbt.impl
 <span class="keyword">import</span> sbt._

<span class="keyword">import</span> scala.collection.{immutable, mutable}
<span class="keyword">import</span> scala.collection.Map
<span class="keyword">import</span> sbt.wrap.Wrappers.identityMap

<span class="keyword">private</span>[sbt] <span class="keyword">object</span> <a title="object sbt.impl.RunTask" id="13625">RunTask</a>
{
	<span class="keyword">final</span> <span class="keyword">type</span> <a title="sbt.Project#Task" id="68283">Task</a> = Project#<a href="../TaskManager.scala.html#14812" title="sbt.Project#Task">Task</a>
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="68284">apply</a>(<a title="sbt.impl.RunTask.Task" id="68297">root</a>: <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="68298">rootName</a>: <span title="String">String</span>): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]]  = <a href="#68285" title="(sbt.impl.RunTask.Task,String,Boolean)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">apply</a>(<a href="#68297" title="sbt.impl.RunTask.Task">root</a>, <a href="#68298" title="String">rootName</a>, <span title="Boolean(true)" class="keyword">true</span>)
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String,Boolean)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="68285">apply</a>(<a title="sbt.impl.RunTask.Task" id="68294">root</a>: <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="68295">rootName</a>: <span title="String">String</span>, <a title="Boolean" id="68296">parallelExecution</a>: <a title="Boolean" id="2115">Boolean</a>): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]] =
		<a href="#68286" title="(sbt.impl.RunTask.Task,String,Int)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">apply</a>(<a href="#68294" title="sbt.impl.RunTask.Task">root</a>, <a href="#68295" title="String">rootName</a>, <span title="Int" class="keyword">if</span>(<a href="#68296" title="Boolean">parallelExecution</a>) <a title="object java.lang.Runtime" id="1696">Runtime</a>.<a title="()java.lang.Runtime" id="63129">getRuntime</a>.<a title="()Int" id="63141">availableProcessors</a> <span class="keyword">else</span> <span title="Int(1)" class="int">1</span>)
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String,Int)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="68286">apply</a>(<a title="sbt.impl.RunTask.Task" id="68289">root</a>: <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="68290">rootName</a>: <span title="String">String</span>, <a title="Int" id="68291">maximumTasks</a>: <span title="Int">Int</span>): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]]  = (<span title="sbt.impl.RunTask" class="keyword">new</span> <a href="#13624" title="sbt.impl.RunTask">RunTask</a>(<a href="#68289" title="sbt.impl.RunTask.Task">root</a>, <a href="#68290" title="String">rootName</a>, <a href="#68291" title="Int">maximumTasks</a>)).<a href="#74005" title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">run</a>()
}
<span class="keyword">import</span> RunTask._
<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class RunTask extends java.lang.Object with NotNull with ScalaObject" id="13624">RunTask</a>(<a title="sbt.impl.RunTask.Task" id="74047">root</a>: <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="74048">rootName</a>: <span title="String">String</span>, <a title="Int" id="74049">maximumTasks</a>: <span title="Int">Int</span>) <span class="keyword">extends</span> <a title="NotNull" id="189">NotNull</a>
{
	<a title="(Boolean)Unit" id="6092">require</a>(<a href="#74049" title="Int">maximumTasks</a> <span title="(Int)Boolean">&gt;=</span> <span title="Int(1)" class="int">1</span>)
	<span class="keyword">def</span> <a title="=&gt; Boolean" id="74003">parallel</a> = <a href="#74049" title="Int">maximumTasks</a> <a title="(Int)Boolean" id="3093">&gt;</a> <span title="Int(1)" class="int">1</span>
	<span class="keyword">def</span> <a title="=&gt; Boolean" id="74004">multiProject</a> = <a href="#74038" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>.<a title="=&gt; Int" id="18151">size</a> <span title="(Int)Boolean">&gt;=</span> <span title="Int(2)" class="int">2</span>
	<span class="keyword">def</span> <a title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="74005">run</a>(): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]]  =
	{
		<span class="keyword">try</span>
		{
			<a href="#74006" title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">runTasksExceptRoot</a>() <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">match</span>
			{
				<span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">case</span> <span title="object Nil">Nil</span> =&gt;
					<span class="keyword">val</span> <a title="Option[String]" id="74228">result</a> = <a href="#74014" title="(sbt.impl.RunTask.Task,String)Option[String]">runTask</a>(<a href="#74047" title="sbt.impl.RunTask.Task">root</a>, <a href="#74048" title="String">rootName</a>)
					<a href="#74228" title="Option[String]">result</a>.<span title="((String) =&gt; sbt.WorkFailure[sbt.impl.RunTask.Task])Option[sbt.WorkFailure[sbt.impl.RunTask.Task]]">map</span>( <a title="String" id="74233">errorMessage</a> =&gt; <a href="../ParallelRunner.scala.html#74235" title="(sbt.impl.RunTask.Task,String)sbt.WorkFailure[sbt.impl.RunTask.Task]">WorkFailure</a>(<a href="#74047" title="sbt.impl.RunTask.Task">root</a>, <span title="java.lang.String(&quot;Error running &quot;)" class="string">&quot;Error running &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74048" title="String">rootName</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74233" title="String">errorMessage</a>) ).<a title="=&gt; List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="19243">toList</a>
				<span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">case</span> <a title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="74248">failures</a> =&gt; <a href="#74248" title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">failures</a>
			}
		}
		<span class="keyword">finally</span>
		{
			<span class="keyword">for</span>(<a title="((sbt.Project#ManagerType) =&gt; Unit)Unit" id="74250">project</a> &lt;- <a href="#74038" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>; <a title="((String) =&gt; Unit)Unit" id="74252">saveError</a> &lt;- <a href="#74250" title="sbt.Project#ManagerType">project</a>.<a href="../Environment.scala.html#15012" title="()Option[String]">saveEnvironment</a>)
				<a href="#74250" title="sbt.Project#ManagerType">project</a>.<a href="../Project.scala.html#14821" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#19735" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;Could not save properties for project &quot;)" class="string">&quot;Could not save properties for project &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74250" title="sbt.Project#ManagerType">project</a>.<a href="../Project.scala.html#14827" title="=&gt; String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74252" title="String">saveError</a>)
		}
	}
	<span class="comment">// This runs all tasks except the root.task.</span>
	<span class="comment">// It uses a buffered logger in record mode to ensure that all output for a given task is consecutive</span>
	<span class="comment">// it ignores the root task so that the root task may be run with buffering disabled so that the output</span>
	<span class="comment">// occurs without delay.</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="74006">runTasksExceptRoot</a>() =
		<a href="../ParallelRunner.scala.html#6820" title="object sbt.ParallelRunner">ParallelRunner</a>.<a href="../ParallelRunner.scala.html#74186" title="(sbt.impl.RunTask.Task,(sbt.impl.RunTask.Task) =&gt; String,(sbt.impl.RunTask.Task) =&gt; Option[String],Int,(sbt.impl.RunTask.Task) =&gt; sbt.Logger)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">run</a>(<a href="#74034" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>, <a href="#74026" title="(sbt.impl.RunTask.Task)String">expandedTaskName</a>, <a href="#74008" title="(sbt.impl.RunTask.Task)Option[String]">runIfNotRoot</a>, <a href="#74049" title="Int">maximumTasks</a>, (<a title="sbt.impl.RunTask.Task" id="74221">t</a>: <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>) =&gt; <a href="#74221" title="sbt.impl.RunTask.Task">t</a>.<a href="../TaskManager.scala.html#19284" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#14821" title="=&gt; sbt.Logger">log</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="((sbt.BufferedLogger) =&gt; Unit)Unit" id="74007">withBuffered</a>(<a title="(sbt.BufferedLogger) =&gt; Unit" id="74254">f</a>: BufferedLogger =&gt; Unit)
	{
		<span class="keyword">for</span>(<a title="((sbt.BufferedLogger) =&gt; Unit)Unit" id="74256">buffered</a> &lt;- <a href="#74040" title="=&gt; List[sbt.BufferedLogger]">bufferedLoggers</a>)
			<a href="../Control.scala.html#11878" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#25768" title="(=&gt; Unit)Unit">trap</a>(<a href="#74254" title="(sbt.BufferedLogger)Unit" id="16544">f</a>(<a href="#74256" title="sbt.BufferedLogger">buffered</a>))
	}
	<span class="comment">/** Will be called in its own thread. Runs the given task if it is not the root task.*/</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Option[String]" id="74008">runIfNotRoot</a>(<a title="sbt.impl.RunTask.Task" id="74217">action</a>: <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>): <span title="Option[String]">Option</span>[String] =
	{
		<span title="Option[String]" class="keyword">if</span>(<a href="#74013" title="(sbt.impl.RunTask.Task)Boolean">isRoot</a>(<a href="#74217" title="sbt.impl.RunTask.Task">action</a>))
			<span title="object None">None</span>
		<span class="keyword">else</span>
			<a href="#74014" title="(sbt.impl.RunTask.Task,String)Option[String]">runTask</a>(<a href="#74217" title="sbt.impl.RunTask.Task">action</a>, <a href="#74026" title="(sbt.impl.RunTask.Task)String">expandedTaskName</a>(<a href="#74217" title="sbt.impl.RunTask.Task">action</a>))
	}
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="74009">headerStart</a> = <span title="object java.lang.System">System</span>.<span title="(java.lang.String,java.lang.String)java.lang.String">getProperty</span>(<span title="java.lang.String(&quot;sbt.start.delimiter&quot;)" class="string">&quot;sbt.start.delimiter&quot;</span>, <span title="java.lang.String(&quot;==&quot;)" class="string">&quot;==&quot;</span>)
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="74011">headerEnd</a> = <span title="object java.lang.System">System</span>.<span title="(java.lang.String,java.lang.String)java.lang.String">getProperty</span>(<span title="java.lang.String(&quot;sbt.end.delimiter&quot;)" class="string">&quot;sbt.end.delimiter&quot;</span>, <span title="java.lang.String(&quot;==&quot;)" class="string">&quot;==&quot;</span>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Boolean" id="74013">isRoot</a>(<a title="sbt.impl.RunTask.Task" id="74259">t</a>: <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>) = <a href="#74259" title="sbt.impl.RunTask.Task">t</a> <span title="(AnyRef)Boolean">==</span> <a href="#74034" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>
	<span class="comment">/** Will be called in its own thread except for the root task. */</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String)Option[String]" id="74014">runTask</a>(<a title="sbt.impl.RunTask.Task" id="74229">action</a>: <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="74230">actionName</a>: <span title="String">String</span>): <span title="Option[String]">Option</span>[String] =
	{
		<span class="keyword">val</span> <a title="java.lang.String" id="74262">label</a> = <span title="java.lang.String" class="keyword">if</span>(<a href="#74004" title="=&gt; Boolean">multiProject</a>) (<a href="#74229" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#19284" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#14827" title="=&gt; String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; / &quot;)" class="string">&quot; / &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74230" title="String">actionName</a>) <span class="keyword">else</span> <a href="#74230" title="String">actionName</a>
		<span class="keyword">def</span> <a title="(sbt.ControlEvent.Value,String,String)Unit" id="74263">banner</a>(<a title="sbt.ControlEvent.Value" id="74268">event</a>: ControlEvent.<a title="sbt.ControlEvent.Value" id="19926">Value</a>, <a title="String" id="74269">firstSeparator</a>: <span title="String">String</span>, <a title="String" id="74270">secondSeparator</a>: <span title="String">String</span>) =
			<a href="../Control.scala.html#11878" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#25768" title="(=&gt; Unit)Unit">trap</a>(<a href="#74229" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#19284" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#14821" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#19739" title="(sbt.ControlEvent.Value,=&gt; String)Unit">control</a>(<a href="#74268" title="sbt.ControlEvent.Value">event</a>, <a href="#74269" title="String">firstSeparator</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74262" title="java.lang.String">label</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74270" title="String">secondSeparator</a>))
		<span class="keyword">val</span> <a title="Boolean" id="74264">buffered</a> = <a href="#74003" title="=&gt; Boolean">parallel</a> <a title="(Boolean)Boolean" id="2699">&amp;&amp;</a> <a title="=&gt; Boolean" id="2695">!</a><a href="#74013" title="(sbt.impl.RunTask.Task)Boolean">isRoot</a>(<a href="#74229" title="sbt.impl.RunTask.Task">action</a>)
		<span title="Unit" class="keyword">if</span>(<a href="#74264" title="Boolean">buffered</a>)
			<a href="#74263" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#10534" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#68945" title="=&gt; sbt.ControlEvent.Value">Start</a>, <span title="java.lang.String(&quot;\012  &quot;)" class="string">&quot;\n  &quot;</span>, <span title="java.lang.String(&quot;...&quot;)" class="string">&quot;...&quot;</span>)
		<span class="keyword">def</span> <a title="()Option[String]" id="74265">doRun</a>() =
		{
			<a href="#74263" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#10534" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#68947" title="=&gt; sbt.ControlEvent.Value">Header</a>, <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74009" title="=&gt; java.lang.String">headerStart</a>, <a href="#74009" title="=&gt; java.lang.String">headerStart</a>)
			<span class="keyword">try</span> { <a href="#74229" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#19292" title="=&gt; Option[String]">invoke</a> }
			<span class="keyword">catch</span> { <span title="Some[java.lang.String]" class="keyword">case</span> <a title="Exception" id="74276">e</a>: <a title="Exception" id="2076">Exception</a> =&gt; <a href="#74229" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#19284" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#14821" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#19731" title="(=&gt; Throwable)Unit">trace</a>(<a href="#74276" title="Exception">e</a>); <span title="(java.lang.String)Some[java.lang.String]">Some</span>(<a href="#74276" title="Exception">e</a>.<a title="()java.lang.String" id="17831">toString</a>) }
			<span class="keyword">finally</span> { <a href="#74263" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#10534" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#68949" title="=&gt; sbt.ControlEvent.Value">Finish</a>, <a href="#74011" title="=&gt; java.lang.String">headerEnd</a>, <a href="#74011" title="=&gt; java.lang.String">headerEnd</a>) }
		}
		
		<span title="Option[String]" class="keyword">if</span>(<a href="#74264" title="Boolean">buffered</a>)
			<a href="#74015" title="(sbt.impl.RunTask.Task,=&gt; Option[String])Option[String]">bufferLogging</a>(<a href="#74229" title="sbt.impl.RunTask.Task">action</a>, <a href="#74265" title="()Option[String]">doRun</a>())
		<span class="keyword">else</span>
			<a href="#74265" title="()Option[String]">doRun</a>()
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](sbt.impl.RunTask.Task,=&gt; T)T" id="74015">bufferLogging</a>[<a title="&gt;: Nothing &lt;: Any" id="74017">T</a>](<a title="sbt.impl.RunTask.Task" id="74283">action</a>: <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>, <a title="=&gt; T" id="74284">f</a>: =&gt; T) =
		<a href="#74046" title="(sbt.Project)Option[sbt.BufferedLogger]">bufferedLogger</a>(<a href="#74283" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#19284" title="=&gt; sbt.Project#ManagerType">manager</a>) <span title="T" class="keyword">match</span>
		{
			<span title="T" class="keyword">case</span> <a id="1">Some</a>(<a title="sbt.BufferedLogger" id="74288">buffered</a>) =&gt; <a href="#74288" title="sbt.BufferedLogger">buffered</a>.<a href="../Logger.scala.html#67777" title="(=&gt; T)T">buffer</a> { <a href="#74284" title="=&gt; T">f</a> }
			<span title="T" class="keyword">case</span> <span title="object None">None</span> =&gt; <a href="#74284" title="=&gt; T">f</a>
		}
	
	<span class="comment">/* Most of the following is for implicitly adding dependencies (see the expand method)*/</span>
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.Project,Iterable[sbt.Project]]" id="74018">projectDependencyCache</a> = <a href="../wrap/Wrappers.scala.html#18233" title="sbt.wrap.MutableMapWrapper[sbt.Project,Iterable[sbt.Project]]">identityMap</a>[<a href="../Project.scala.html#7665" title="sbt.Project">Project</a>, <a title="Iterable[sbt.Project]" id="372">Iterable</a>[Project]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)Iterable[sbt.Project]" id="74020">dependencies</a>(<a title="sbt.Project" id="74291">project</a>: <a href="../Project.scala.html#7665" title="sbt.Project">Project</a>) = <a href="#74018" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.Project,Iterable[sbt.Project]]">projectDependencyCache</a>.<a href="../wrap/Wrappers.scala.html#29956" title="(sbt.Project,=&gt; Iterable[sbt.Project])Iterable[sbt.Project]">getOrElseUpdate</a>(<a href="#74291" title="sbt.Project">project</a>, <a href="#74291" title="sbt.Project">project</a>.<a href="../Dag.scala.html#14930" title="=&gt; List[sbt.Project]">topologicalSort</a>.<a title="(Int)List[sbt.Project]" id="17956">dropRight</a>(<span title="Int(1)" class="int">1</span>))

	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]" id="74021">expandedCache</a> = <a href="../wrap/Wrappers.scala.html#18233" title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]">identityMap</a>[<a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>, <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="74023">expanded</a>(<a title="sbt.impl.RunTask.Task" id="74293">task</a>: <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a> = <a href="#74021" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]">expandedCache</a>.<a href="../wrap/Wrappers.scala.html#29956" title="(sbt.impl.RunTask.Task,=&gt; sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">getOrElseUpdate</a>(<a href="#74293" title="sbt.impl.RunTask.Task">task</a>, <a href="#74043" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expandImpl</a>(<a href="#74293" title="sbt.impl.RunTask.Task">task</a>))

	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]" id="74024">expandedTaskNameCache</a> = <a href="../wrap/Wrappers.scala.html#18233" title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]">identityMap</a>[<a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>, <span title="String">String</span>]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)String" id="74026">expandedTaskName</a>(<a title="sbt.impl.RunTask.Task" id="74204">task</a>: <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>) =
		<span title="String" class="keyword">if</span>(<a href="#74204" title="sbt.impl.RunTask.Task">task</a> <span title="(AnyRef)Boolean">==</span> <a href="#74034" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>)
			<a href="#74048" title="String">rootName</a>
		<span class="keyword">else</span>
			<a href="#74024" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]">expandedTaskNameCache</a>.<a href="../wrap/Wrappers.scala.html#29941" title="(sbt.impl.RunTask.Task,=&gt; String)String">getOrElse</a>(<a href="#74204" title="sbt.impl.RunTask.Task">task</a>, <a href="#74204" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#19285" title="=&gt; String">name</a>)

	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]" id="74027">nameToTaskCache</a> = <a href="../wrap/Wrappers.scala.html#18233" title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]">identityMap</a>[<a href="../Project.scala.html#7665" title="sbt.Project">Project</a>, <span title="scala.collection.Map[String,sbt.impl.RunTask.Task]">Map</span>[String, Task]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]" id="74029">nameToTaskMap</a>(<a title="sbt.Project" id="74295">project</a>: <a href="../Project.scala.html#7665" title="sbt.Project">Project</a>): <span title="scala.collection.Map[String,sbt.impl.RunTask.Task]">Map</span>[String, Task] = <a href="#74027" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]">nameToTaskCache</a>.<a href="../wrap/Wrappers.scala.html#29956" title="(sbt.Project,=&gt; scala.collection.Map[String,sbt.impl.RunTask.Task])scala.collection.Map[String,sbt.impl.RunTask.Task]">getOrElseUpdate</a>(<a href="#74295" title="sbt.Project">project</a>, <a href="#74295" title="sbt.Project">project</a>.<a href="../Project.scala.html#14833" title="=&gt; scala.collection.Map[String,project.ManagedTask]">tasks</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project,String)Option[sbt.impl.RunTask.Task]" id="74030">taskForName</a>(<a title="sbt.Project" id="74296">project</a>: <a href="../Project.scala.html#7665" title="sbt.Project">Project</a>, <a title="String" id="74297">name</a>: <span title="String">String</span>): <span title="Option[sbt.impl.RunTask.Task]">Option</span>[Task] = <a href="#74029" title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]">nameToTaskMap</a>(<a href="#74296" title="sbt.Project">project</a>).<span title="(String)Option[sbt.impl.RunTask.Task]">get</span>(<a href="#74297" title="String">name</a>)
	
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]" id="74031">taskNameCache</a> = <a href="../wrap/Wrappers.scala.html#18233" title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]">identityMap</a>[<a href="../Project.scala.html#7665" title="sbt.Project">Project</a>, <span title="scala.collection.Map[sbt.impl.RunTask.Task,String]">Map</span>[Task, String]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Option[String]" id="74033">taskName</a>(<a title="sbt.impl.RunTask.Task" id="74298">task</a>: <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>) =
	{
		<span class="keyword">val</span> <a title="sbt.Project#ManagerType" id="74300">project</a> = <a href="#74298" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#19284" title="=&gt; sbt.Project#ManagerType">manager</a>
		<a href="#74031" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]">taskNameCache</a>.<a href="../wrap/Wrappers.scala.html#29956" title="(sbt.Project,=&gt; scala.collection.Map[sbt.impl.RunTask.Task,String])scala.collection.Map[sbt.impl.RunTask.Task,String]">getOrElseUpdate</a>(<a href="#74300" title="sbt.Project#ManagerType">project</a>, <a href="#74045" title="(sbt.Project)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]">taskNameMap</a>(<a href="#74300" title="sbt.Project#ManagerType">project</a>)).<span title="(sbt.impl.RunTask.Task)Option[String]">get</span>(<a href="#74298" title="sbt.impl.RunTask.Task">task</a>)
	}
	
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.impl.RunTask.Task" id="74034">expandedRoot</a> = <a href="#74042" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expand</a>(<a href="#74047" title="sbt.impl.RunTask.Task">root</a>)
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="List[sbt.Project#ManagedTask]" id="74036">allTasks</a> = <a href="#74034" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>.<a href="../Dag.scala.html#14930" title="=&gt; List[sbt.Project#ManagedTask]">topologicalSort</a>
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Project#ManagerType]" id="74038">allProjects</a> = <a title="(sbt.Project#ManagerType*)scala.collection.immutable.Set[sbt.Project#ManagerType]" id="6083">Set</a>(<a href="#74036" title="=&gt; List[sbt.Project#ManagedTask]">allTasks</a>.<span title="((sbt.Project#ManagedTask) =&gt; sbt.Project#ManagerType)List[sbt.Project#ManagerType]">map</span>(<a href="#74163" title="sbt.Project#ManagedTask">_</a>.<a href="../TaskManager.scala.html#19284" title="=&gt; sbt.Project#ManagerType">manager</a>).<span title="=&gt; Seq[sbt.Project#ManagerType]">toSeq</span> : _*)
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="List[sbt.BufferedLogger]" id="74040">bufferedLoggers</a> = <span title="List[sbt.BufferedLogger]" class="keyword">if</span>(<a href="#74003" title="=&gt; Boolean">parallel</a>) <a href="#74038" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>.<span title="=&gt; List[sbt.Project#ManagerType]">toList</span>.<a title="((sbt.Project#ManagerType) =&gt; Iterable[sbt.BufferedLogger])List[sbt.BufferedLogger]" id="17984">flatMap</a>(<a href="#74046" title="(Option[sbt.BufferedLogger])Iterable[sbt.BufferedLogger]">bufferedLogger</a>) <span class="keyword">else</span> <span title="object Nil">Nil</span>
	
	<span class="comment">/** Adds implicit dependencies, which are tasks with the same name in the project dependencies
	* of the enclosing project of the task.*/</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="74042">expand</a>(<a title="sbt.impl.RunTask.Task" id="74155">root</a>: <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a> = <a href="#74023" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expanded</a>(<a href="#74155" title="sbt.impl.RunTask.Task">root</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="74043">expandImpl</a>(<a title="sbt.impl.RunTask.Task" id="74294">task</a>: <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#14812" title="sbt.impl.RunTask.Task">Task</a> =
	{
		<span class="keyword">val</span> <a title="Option[String]" id="74310">nameOption</a> = <a href="#74033" title="(sbt.impl.RunTask.Task)Option[String]">taskName</a>(<a href="#74294" title="sbt.impl.RunTask.Task">task</a>)
		<span class="keyword">val</span> <a title="List[sbt.Project#ManagedTask]" id="74311">explicitDependencies</a> = <a href="#74294" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#19277" title="=&gt; List[sbt.Project#ManagedTask]">dependencies</a>
		<span class="keyword">val</span> <a title="Iterable[sbt.impl.RunTask.Task]" id="74312">implicitDependencies</a> = <a href="#74310" title="Option[String]">nameOption</a>.<span title="((String) =&gt; Iterable[sbt.impl.RunTask.Task])Option[Iterable[sbt.impl.RunTask.Task]]">map</span>(<a title="String" id="74325">name</a> =&gt; <a href="#74020" title="(sbt.Project)Iterable[sbt.Project]">dependencies</a>(<a href="#74294" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#19284" title="=&gt; sbt.Project#ManagerType">manager</a>).<a title="((sbt.Project) =&gt; Iterable[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]" id="16273">flatMap</a>(<a href="#74044" title="(Option[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]">noninteractiveTask</a>(<a href="#74325" title="String">name</a>)) ).<a title="(=&gt; Iterable[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]" id="19232">getOrElse</a>(<span title="object Nil">Nil</span>)
		<span class="keyword">val</span> <a title="scala.collection.mutable.Set[sbt.Project#ManagedTask]" id="74313">allDependencies</a> = mutable.<a title="(sbt.Project#ManagedTask*)scala.collection.mutable.Set[sbt.Project#ManagedTask]" id="15745">HashSet</a>( (<a href="#74311" title="List[sbt.Project#ManagedTask]">explicitDependencies</a> <a title="(Iterable[sbt.Project#ManagedTask])List[sbt.Project#ManagedTask]" id="17942">++</a> <a href="#74312" title="Iterable[sbt.impl.RunTask.Task]">implicitDependencies</a>).<span title="=&gt; Seq[sbt.Project#ManagedTask]">toSeq</span>  : _* )
		<span class="keyword">val</span> <a title="sbt.Project#Task" id="74314">expandedTask</a> = <a href="#74294" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#19290" title="((List[_183.ManagedTask])_183.Task) forSome { val _183: sbt.Project }">setDependencies</a>(<a href="#74313" title="scala.collection.mutable.Set[sbt.Project#ManagedTask]">allDependencies</a>.<span title="=&gt; List[sbt.Project#ManagedTask]">toList</span>.<span title="((sbt.Project#ManagedTask) =&gt; sbt.impl.RunTask.Task)List[sbt.impl.RunTask.Task]">map</span>(<a href="#74023" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expanded</a>))
		<a href="#74310" title="Option[String]">nameOption</a>.<span title="((String) =&gt; Unit)Unit">foreach</span>(<a title="String" id="74358">name</a> =&gt; <a href="#74024" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]">expandedTaskNameCache</a>(<a href="#74314" title="sbt.Project#Task">expandedTask</a>) = <a href="#74358" title="String">name</a>)
		<a href="#74314" title="sbt.Project#Task">expandedTask</a>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String)(sbt.Project)Option[sbt.impl.RunTask.Task]" id="74044">noninteractiveTask</a>(<a title="String" id="74329">name</a>: <span title="String">String</span>)(<a title="sbt.Project" id="74330">project</a>: <a href="../Project.scala.html#7665" title="sbt.Project">Project</a>): <span title="Option[sbt.impl.RunTask.Task]">Option</span>[Task] =
		<a href="#74030" title="(sbt.Project,String)Option[sbt.impl.RunTask.Task]">taskForName</a>(<a href="#74330" title="sbt.Project">project</a>, <a href="#74329" title="String">name</a>) <a title="((sbt.impl.RunTask.Task) =&gt; Option[sbt.impl.RunTask.Task])Option[sbt.impl.RunTask.Task]" id="19236">flatMap</a> { <a title="sbt.impl.RunTask.Task" id="74361">task</a> =&gt;
			<span title="Option[sbt.impl.RunTask.Task]" class="keyword">if</span>(<a href="#74361" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#19279" title="=&gt; Boolean">interactive</a>)
			{
				<a href="#74330" title="sbt.Project">project</a>.<a href="../Project.scala.html#14821" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#19733" title="(=&gt; String)Unit">debug</a>(<span title="java.lang.String(&quot;Not including task &quot;)" class="string">&quot;Not including task &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74329" title="String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; in project &quot;)" class="string">&quot; in project &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74330" title="sbt.Project">project</a>.<a href="../Project.scala.html#14827" title="=&gt; String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: interactive tasks can only be run directly.&quot;)" class="string">&quot;: interactive tasks can only be run directly.&quot;</span>)
				<span title="object None">None</span>
			}
			<span class="keyword">else</span>
				<span title="(sbt.impl.RunTask.Task)Some[sbt.impl.RunTask.Task]">Some</span>(<a href="#74361" title="sbt.impl.RunTask.Task">task</a>)
		}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]" id="74045">taskNameMap</a>(<a title="sbt.Project" id="74303">project</a>: <a href="../Project.scala.html#7665" title="sbt.Project">Project</a>) = mutable.<a title="((sbt.impl.RunTask.Task, String)*)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]" id="15730">Map</a>(<a href="#74029" title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]">nameToTaskMap</a>(<a href="#74303" title="sbt.Project">project</a>).<a title="(((String, sbt.impl.RunTask.Task)) =&gt; (sbt.impl.RunTask.Task, String))Iterable[(sbt.impl.RunTask.Task, String)]" id="16271">map</a>(<a href="#74309" title="(String, sbt.impl.RunTask.Task)">_</a>.<a title="=&gt; (sbt.impl.RunTask.Task, String)" id="17800">swap</a>).<a title="=&gt; Seq[(sbt.impl.RunTask.Task, String)]" id="16305">toSeq</a> : _*)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)Option[sbt.BufferedLogger]" id="74046">bufferedLogger</a>(<a title="sbt.Project" id="74172">project</a>: <a href="../Project.scala.html#7665" title="sbt.Project">Project</a>): <span title="Option[sbt.BufferedLogger]">Option</span>[BufferedLogger] =
		<a href="#74172" title="sbt.Project">project</a>.<a href="../Project.scala.html#14821" title="=&gt; sbt.Logger">log</a> <span title="Option[sbt.BufferedLogger]" class="keyword">match</span>
		{
			<span title="Some[sbt.BufferedLogger]" class="keyword">case</span> <a title="sbt.BufferedLogger" id="74364">buffered</a>: <a href="../Logger.scala.html#6444" title="sbt.BufferedLogger">BufferedLogger</a> =&gt; <span title="(sbt.BufferedLogger)Some[sbt.BufferedLogger]">Some</span>(<a href="#74364" title="sbt.BufferedLogger">buffered</a>)
			<span title="None.type" class="keyword">case</span> _ =&gt; <span title="object None">None</span>
		}
}
        </pre>
    </body>
</html>