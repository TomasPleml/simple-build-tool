<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/impl/MapUtilities.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2008, 2009 Mark Harrah
 */</span>

<span class="keyword">package</span> sbt.impl
<span class="keyword">import</span> sbt._

<span class="keyword">import</span> java.util.Properties
<span class="keyword">import</span> java.io.{File, FileInputStream, FileOutputStream, InputStream, OutputStream}
<span class="keyword">import</span> scala.collection.mutable.{HashMap, HashSet, ListBuffer, Map, Set}

<span class="keyword">private</span>[sbt] <span class="keyword">object</span> <a title="object sbt.impl.PropertiesUtilities" id="14318">PropertiesUtilities</a>
{
	<span class="keyword">def</span> <a title="(java.util.Properties,String,sbt.Path,sbt.Logger)Option[String]" id="60200">write</a>(<a title="java.util.Properties" id="60203">properties</a>: <span title="java.util.Properties">Properties</span>, <a title="String" id="60204">label</a>: <span title="String">String</span>, <a title="sbt.Path" id="60205">to</a>: <a href="../Path.scala.html#11862" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="60206">log</a>: <a href="../Logger.scala.html#13533" title="sbt.Logger">Logger</a>) =
		<a href="../FileUtilities.scala.html#10717" title="object sbt.FileUtilities">FileUtilities</a>.<a href="../FileUtilities.scala.html#49252" title="(java.io.File,sbt.Logger)((java.io.OutputStream) =&gt; Option[String])Option[String]">writeStream</a>(<a href="#60205" title="sbt.Path">to</a>.<a href="../Path.scala.html#49359" title="=&gt; java.io.File">asFile</a>, <a href="#60206" title="sbt.Logger">log</a>)(<a title="java.io.OutputStream" id="60213">output</a> =&gt; { <a href="#60203" title="java.util.Properties">properties</a>.<a title="(java.io.OutputStream,java.lang.String)Unit" id="40177">store</a>(<a href="#60213" title="java.io.OutputStream">output</a>, <a href="#60204" title="String">label</a>); <span title="object None">None</span> })
	<span class="keyword">def</span> <a title="(java.util.Properties,sbt.Path,sbt.Logger)Option[String]" id="60201">load</a>(<a title="java.util.Properties" id="82924">properties</a>: <span title="java.util.Properties">Properties</span>, <a title="sbt.Path" id="82925">from</a>: <a href="../Path.scala.html#11862" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="82926">log</a>: <a href="../Logger.scala.html#13533" title="sbt.Logger">Logger</a>): <span title="Option[String]">Option</span>[String] =
	{
		<span class="keyword">val</span> <a title="java.io.File" id="82927">file</a> = <a href="#82925" title="sbt.Path">from</a>.<a href="../Path.scala.html#49359" title="=&gt; java.io.File">asFile</a>
		<span title="Option[String]" class="keyword">if</span>(<a href="#82927" title="java.io.File">file</a>.<a title="()Boolean" id="16772">exists</a>)
			<a href="../FileUtilities.scala.html#10717" title="object sbt.FileUtilities">FileUtilities</a>.<a href="../FileUtilities.scala.html#49254" title="(java.io.File,sbt.Logger)((java.io.InputStream) =&gt; Option[String])Option[String]">readStream</a>(<a href="#82927" title="java.io.File">file</a>, <a href="#82926" title="sbt.Logger">log</a>)( <a title="java.io.InputStream" id="82930">input</a> =&gt; { <a href="#82924" title="java.util.Properties">properties</a>.<a title="(java.io.InputStream)Unit" id="40174">load</a>(<a href="#82930" title="java.io.InputStream">input</a>); <span title="object None">None</span> })
		<span class="keyword">else</span>
			<span title="object None">None</span>
	}
	<span class="keyword">def</span> <a title="(java.util.Properties)Iterable[String]" id="60202">propertyNames</a>(<a title="java.util.Properties" id="82932">properties</a>: <span title="java.util.Properties">Properties</span>): <span title="Iterable[String]">Iterable</span>[String] =
		wrap.<a href="../wrap/Wrappers.scala.html#14839" title="object sbt.wrap.Wrappers">Wrappers</a>.<a href="../wrap/Wrappers.scala.html#49474" title="(java.util.Enumeration[?0])List[?0]">toList</a>(<a href="#82932" title="java.util.Properties">properties</a>.<a title="()java.util.Enumeration[_]" id="40184">propertyNames</a>).<span title="((?0) =&gt; java.lang.String)List[java.lang.String]">map</span>(<a href="#82949" title="?0">_</a>.<a title="()java.lang.String" id="3443">toString</a>)
}

<span class="keyword">private</span>[sbt] <span class="keyword">object</span> <a title="object sbt.impl.MapUtilities" id="14510">MapUtilities</a>
{
	<span class="keyword">def</span> <a title="[Key, Value](scala.collection.mutable.Map[Key,Value],String,sbt.Path,sbt.Logger)(implicit sbt.Format[Key],sbt.Format[Value])Option[String]" id="49040">write</a>[<a title="&gt;: Nothing &lt;: Any" id="49043">Key</a>, <a title="&gt;: Nothing &lt;: Any" id="49044">Value</a>](<a title="scala.collection.mutable.Map[Key,Value]" id="50219">map</a>: <span title="scala.collection.mutable.Map[Key,Value]">Map</span>[Key, Value], <a title="String" id="50220">label</a>: <span title="String">String</span>, <a title="sbt.Path" id="50221">to</a>: <a href="../Path.scala.html#11862" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="50222">log</a>: <a href="../Logger.scala.html#13533" title="sbt.Logger">Logger</a>)(<span class="keyword">implicit</span> <a title="sbt.Format[Key]" id="50223">keyFormat</a>: <a href="../Format.scala.html#11439" title="sbt.Format[Key]">Format</a>[Key], <a title="sbt.Format[Value]" id="50224">valueFormat</a>: <a href="../Format.scala.html#11439" title="sbt.Format[Value]">Format</a>[Value]): <span title="Option[String]">Option</span>[String] =
	{
		<span class="keyword">val</span> <a title="java.util.Properties" id="82951">properties</a> = <span title="java.util.Properties" class="keyword">new</span> <span title="java.util.Properties">Properties</span>
		<a href="#50219" title="scala.collection.mutable.Map[Key,Value]">map</a> <span title="(((Key, Value)) =&gt; Unit)Unit">foreach</span> { <a title="(Key, Value)" id="82959">pair</a> =&gt; <a href="#82951" title="java.util.Properties">properties</a>.<a title="(java.lang.String,java.lang.String)java.lang.Object" id="40172">setProperty</a>(<a href="#50223" title="sbt.Format[Key]">keyFormat</a>.<a href="../Format.scala.html#49148" title="(Key)String">toString</a>(<a href="#82959" title="(Key, Value)">pair</a>.<a title="=&gt; Key" id="17796">_1</a>), <a href="#50224" title="sbt.Format[Value]">valueFormat</a>.<a href="../Format.scala.html#49148" title="(Value)String">toString</a>(<a href="#82959" title="(Key, Value)">pair</a>.<a title="=&gt; Value" id="17798">_2</a>)) }
		<a href="#14318" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="#60200" title="(java.util.Properties,String,sbt.Path,sbt.Logger)Option[String]">write</a>(<a href="#82951" title="java.util.Properties">properties</a>, <a href="#50220" title="String">label</a>, <a href="#50221" title="sbt.Path">to</a>, <a href="#50222" title="sbt.Logger">log</a>)
	}
	<span class="keyword">def</span> <a title="[Key, Value](scala.collection.mutable.Map[Key,Value],sbt.Path,sbt.Logger)(implicit sbt.Format[Key],sbt.Format[Value])Option[String]" id="49045">read</a>[<a title="&gt;: Nothing &lt;: Any" id="49048">Key</a>, <a title="&gt;: Nothing &lt;: Any" id="49049">Value</a>](<a title="scala.collection.mutable.Map[Key,Value]" id="50208">map</a>: <span title="scala.collection.mutable.Map[Key,Value]">Map</span>[Key, Value], <a title="sbt.Path" id="50209">from</a>: <a href="../Path.scala.html#11862" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="50210">log</a>: <a href="../Logger.scala.html#13533" title="sbt.Logger">Logger</a>)(<span class="keyword">implicit</span> <a title="sbt.Format[Key]" id="50211">keyFormat</a>: <a href="../Format.scala.html#11439" title="sbt.Format[Key]">Format</a>[Key], <a title="sbt.Format[Value]" id="50212">valueFormat</a>: <a href="../Format.scala.html#11439" title="sbt.Format[Value]">Format</a>[Value]): <span title="Option[String]">Option</span>[String] =
	{
		<a href="#50208" title="scala.collection.mutable.Map[Key,Value]">map</a>.<a title="()Unit" id="37803">clear</a>
		<span class="keyword">val</span> <a title="java.util.Properties" id="82962">properties</a> = <span title="java.util.Properties" class="keyword">new</span> <span title="java.util.Properties">Properties</span>
		<a href="#14318" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="#60201" title="(java.util.Properties,sbt.Path,sbt.Logger)Option[String]">load</a>(<a href="#82962" title="java.util.Properties">properties</a>, <a href="#50209" title="sbt.Path">from</a>, <a href="#50210" title="sbt.Logger">log</a>) <a title="(=&gt; Option[String])Option[String]" id="30337">orElse</a>
		{
			<span class="keyword">for</span>(<a title="((String) =&gt; Unit)Unit" id="82971">name</a> &lt;- <a href="#14318" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="#60202" title="(java.util.Properties)Iterable[String]">propertyNames</a>(<a href="#82962" title="java.util.Properties">properties</a>))
				<a href="#50208" title="scala.collection.mutable.Map[Key,Value]">map</a>.<span title="(Key,Value)Option[Value]">put</span>( <a href="#50211" title="sbt.Format[Key]">keyFormat</a>.<a href="../Format.scala.html#49149" title="(String)Key">fromString</a>(<a href="#82971" title="String">name</a>), <a href="#50212" title="sbt.Format[Value]">valueFormat</a>.<a href="../Format.scala.html#49149" title="(String)Value">fromString</a>(<a href="#82962" title="java.util.Properties">properties</a>.<a title="(java.lang.String)java.lang.String" id="40181">getProperty</a>(<a href="#82971" title="String">name</a>)))
			<span title="object None">None</span>
		}
	}
	<span class="keyword">def</span> <a title="(String,sbt.Path,sbt.Logger)scala.collection.Map[String,String]" id="49050">readStrings</a>(<a title="String" id="60156">label</a>: <span title="String">String</span>, <a title="sbt.Path" id="60157">envBackingPath</a>: <a href="../Path.scala.html#11862" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="60158">log</a>: <a href="../Logger.scala.html#13533" title="sbt.Logger">Logger</a>): scala.collection.<a title="scala.collection.Map[String,String]" id="16079">Map</a>[String, String] =
	{
		<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,String]" id="82973">map</a> = <span title="scala.collection.mutable.HashMap[String,String]" class="keyword">new</span> <a title="scala.collection.mutable.HashMap[String,String]" id="20220">HashMap</a>[String, String]
		<span class="keyword">for</span>(<a title="((String) =&gt; Unit)Unit" id="82979">errorMsg</a> &lt;- <a href="#49045" title="(scala.collection.mutable.Map[String,String],sbt.Path,sbt.Logger)(implicit sbt.Format[String],sbt.Format[String])Option[String]">read</a>(<a href="#82973" title="scala.collection.mutable.HashMap[String,String]">map</a>, <a href="#60157" title="sbt.Path">envBackingPath</a>, <a href="#60158" title="sbt.Logger">log</a>))
			<a href="#60158" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#49387" title="(=&gt; String)Unit">error</a>(<span title="java.lang.String(&quot;Error loading properties from &quot;)" class="string">&quot;Error loading properties from &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#60156" title="String">label</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; : &quot;)" class="string">&quot; : &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#82979" title="String">errorMsg</a>)
		<a href="#82973" title="scala.collection.mutable.HashMap[String,String]">map</a>.<a title="=&gt; scala.collection.Map[String,String]" id="37809">readOnly</a>
	}
	<span class="keyword">def</span> <a title="[Key, Value](scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]])Iterable[Value]" id="49051">all</a>[<a title="&gt;: Nothing &lt;: Any" id="49054">Key</a>, <a title="&gt;: Nothing &lt;: Any" id="49055">Value</a>](<a title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]" id="50570">map</a>: <span title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">Map</span>[Key, Set[Value]]): <span title="Iterable[Value]">Iterable</span>[Value] =
		<a href="#50570" title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">map</a>.<a title="=&gt; Iterator[scala.collection.mutable.Set[Value]]" id="37840">values</a>.<span title="=&gt; List[scala.collection.mutable.Set[Value]]">toList</span>.<a title="((scala.collection.mutable.Set[Value]) =&gt; Iterable[Value])List[Value]" id="15552">flatMap</a>(<a title="scala.collection.mutable.Set[Value]" id="82984">set</a> =&gt; <a href="#82984" title="scala.collection.mutable.Set[Value]">set</a>.<a title="=&gt; List[Value]" id="15975">toList</a>)
	
	<span class="keyword">def</span> <a title="[Key, Value](scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]])Iterable[(Key, scala.collection.Set[Value])]" id="49056">readOnlyIterable</a>[<a title="&gt;: Nothing &lt;: Any" id="49059">Key</a>, <a title="&gt;: Nothing &lt;: Any" id="49060">Value</a>](<a title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]" id="49590">i</a>: <span title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">Map</span>[Key, Set[Value]]): <span title="Iterable[(Key, scala.collection.Set[Value])]">Iterable</span>[(Key, scala.collection.Set[Value])] =
		<span class="keyword">for</span>( <a href="#82987" title="(((Key, scala.collection.mutable.Set[Value])) =&gt; (Key, scala.collection.Set[Value]))List[(Key, scala.collection.Set[Value])]" id="15536">(</a><a title="Key" id="82994">key</a>, <a title="scala.collection.mutable.Set[Value]" id="82995">set</a>) &lt;- <a href="#49590" title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">i</a>.<a title="=&gt; Iterator[(Key, scala.collection.mutable.Set[Value])]" id="15936">elements</a>.<span title="=&gt; List[(Key, scala.collection.mutable.Set[Value])]">toList</span>) <span class="keyword">yield</span> <a title="(Key,scala.collection.Set[Value])(Key, scala.collection.Set[Value])" id="1331">(</a><a href="#82994" title="Key">key</a>, wrap.<a href="../wrap/Wrappers.scala.html#14839" title="object sbt.wrap.Wrappers">Wrappers</a>.<a href="../wrap/Wrappers.scala.html#49482" title="(scala.collection.mutable.Set[Value])scala.collection.Set[Value]">readOnly</a>(<a href="#82995" title="scala.collection.mutable.Set[Value]">set</a>))<span class="comment">//.readOnly)</span>
		
	<span class="keyword">def</span> <a title="[Key, Value](Key,scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]])Unit" id="49061">mark</a>[<a title="&gt;: Nothing &lt;: Any" id="49064">Key</a>, <a title="&gt;: Nothing &lt;: Any" id="49065">Value</a>](<a title="Key" id="49631">source</a>: <a href="#49064" title="Key">Key</a>, <a title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]" id="49632">map</a>: <span title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">Map</span>[Key, Set[Value]])
	{
		<span title="Unit" class="keyword">if</span>(<a title="=&gt; Boolean" id="2690">!</a><a href="#49632" title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">map</a>.<a title="(Key)Boolean" id="37836">contains</a>(<a href="#49631" title="Key">source</a>))
			<a href="#49632" title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">map</a>.<span title="(Key,scala.collection.mutable.Set[Value])Option[scala.collection.mutable.Set[Value]]">put</span>(<a href="#49631" title="Key">source</a>, <span title="scala.collection.mutable.HashSet[Value]" class="keyword">new</span> <span title="scala.collection.mutable.HashSet[Value]">HashSet</span>[Value])
	}
	<span class="keyword">def</span> <a title="[Key, Value](Key,Value,scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]])Unit" id="49066">add</a>[<a title="&gt;: Nothing &lt;: Any" id="49069">Key</a>, <a title="&gt;: Nothing &lt;: Any" id="49070">Value</a>](<a title="Key" id="49600">key</a>: <a href="#49069" title="Key">Key</a>, <a title="Value" id="49601">value</a>: <a href="#49070" title="Value">Value</a>, <a title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]" id="49602">map</a>: <span title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">Map</span>[Key, Set[Value]]): <a title="Unit" id="2109">Unit</a> =
		<a href="#49602" title="scala.collection.mutable.Map[Key,scala.collection.mutable.Set[Value]]">map</a>.<a title="(Key,=&gt; scala.collection.mutable.Set[Value])scala.collection.mutable.Set[Value]" id="37804">getOrElseUpdate</a>(<a href="#49600" title="Key">key</a>, <span title="scala.collection.mutable.HashSet[Value]" class="keyword">new</span> <span title="scala.collection.mutable.HashSet[Value]">HashSet</span>[Value]) <a title="(Value)scala.collection.mutable.Set[Value]" id="30696">+</a> <a href="#49601" title="Value">value</a>
}
        </pre>
    </body>
</html>