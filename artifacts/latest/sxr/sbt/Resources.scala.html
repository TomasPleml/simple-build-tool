<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/Resources.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2008, 2009  Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> xsbti.AppProvider
<span class="keyword">import</span> FileUtilities._

<span class="keyword">object</span> <a title="object sbt.Resources" id="8662">Resources</a>
{
	<span class="keyword">def</span> <a title="(String)sbt.Resources" id="74370">apply</a>(<a title="String" id="74374">basePath</a>: <span title="String">String</span>) =
	{
		<span title="(Boolean)Unit">require</span>(<a href="#74374" title="String">basePath</a>.<a title="(java.lang.String)Boolean" id="5786">startsWith</a>(<span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>))
		<span class="keyword">val</span> <a title="java.net.URL" id="74376">resource</a> = <a title="()java.lang.Class[_ &lt;: java.lang.Object]" id="3459">getClass</a>.<a title="(java.lang.String)java.net.URL" id="4603">getResource</a>(<a href="#74374" title="String">basePath</a>)
		<span title="sbt.Resources" class="keyword">if</span>(<a href="#74376" title="java.net.URL">resource</a> <a title="(AnyRef)Boolean" id="3457">==</a> <span title="Null(null)" class="keyword">null</span>)
			<span title="(String)Nothing">error</span>(<span title="java.lang.String(&quot;Resource base directory '&quot;)" class="string">&quot;Resource base directory '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74374" title="String">basePath</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' not on classpath.&quot;)" class="string">&quot;' not on classpath.&quot;</span>)
		<span class="keyword">else</span>
		{
			<span class="keyword">val</span> <a title="java.io.File" id="74381">file</a> = <a href="FileUtilities.scala.html#15535" title="(java.net.URL)java.io.File">toFile</a>(<a href="#74376" title="java.net.URL">resource</a>)
			<span title="sbt.Resources" class="keyword">if</span>(<a href="#74381" title="java.io.File">file</a>.<a title="()Boolean" id="16232">exists</a>)
				<span title="sbt.Resources" class="keyword">new</span> <a href="#8661" title="sbt.Resources">Resources</a>(<a href="#74381" title="java.io.File">file</a>)
			<span class="keyword">else</span>
				<span title="(String)Nothing">error</span>(<span title="java.lang.String(&quot;Resource base directory '&quot;)" class="string">&quot;Resource base directory '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74374" title="String">basePath</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' does not exist.&quot;)" class="string">&quot;' does not exist.&quot;</span>)
		}
	}
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="74371">LoadErrorPrefix</a> = <span title="java.lang.String(&quot;Error loading initial project: &quot;)" class="string">&quot;Error loading initial project: &quot;</span>
}

<span class="keyword">class</span> <a title="class Resources extends java.lang.Object with ScalaObject" id="8661">Resources</a>(<span class="keyword">val</span> <a title="java.io.File" id="74394">baseDirectory</a>: <span title="java.io.File">File</span>)
{
	<span class="keyword">import</span> Resources._
	<span class="comment">// The returned directory is not actually read-only, but it should be treated that way</span>
	<span class="keyword">def</span> <a title="(String,String)Either[String,java.io.File]" id="74387">readOnlyResourceDirectory</a>(<a title="String" id="74397">group</a>: <span title="String">String</span>, <a title="String" id="74398">name</a>: <span title="String">String</span>): <span title="Either[String,java.io.File]">Either</span>[String, File] =
	{
		<span class="keyword">val</span> <a title="java.io.File" id="74399">groupDirectory</a> = <span title="(java.io.File,java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span>(<a href="#74394" title="=&gt; java.io.File">baseDirectory</a>, <a href="#74397" title="String">group</a>)
		<span title="Either[String,java.io.File]" class="keyword">if</span>(<a href="#74399" title="java.io.File">groupDirectory</a>.<span title="()Boolean">isDirectory</span>)
		{
			<span class="keyword">val</span> <a title="java.io.File" id="74415">resourceDirectory</a> = <span title="(java.io.File,java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span>(<a href="#74399" title="java.io.File">groupDirectory</a>, <a href="#74398" title="String">name</a>)
			<span title="Either[String,java.io.File]" class="keyword">if</span>(<a href="#74415" title="java.io.File">resourceDirectory</a>.<span title="()Boolean">isDirectory</span>)
				<a title="(java.io.File)Right[Nothing,java.io.File]" id="490">Right</a>(<a href="#74415" title="java.io.File">resourceDirectory</a>)
			<span class="keyword">else</span>
				<span title="(java.lang.String)Left[java.lang.String,Nothing]">Left</span>(<span title="java.lang.String(&quot;Resource directory '&quot;)" class="string">&quot;Resource directory '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74398" title="String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' in group '&quot;)" class="string">&quot;' in group '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74397" title="String">group</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' not found.&quot;)" class="string">&quot;' not found.&quot;</span>)
		}
		<span class="keyword">else</span>
			<span title="(java.lang.String)Left[java.lang.String,Nothing]">Left</span>(<span title="java.lang.String(&quot;Group '&quot;)" class="string">&quot;Group '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74397" title="String">group</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' not found.&quot;)" class="string">&quot;' not found.&quot;</span>)
	}
	<span class="keyword">def</span> <a title="[T](String,String,sbt.Logger)((java.io.File) =&gt; Either[String,T])Either[String,T]" id="74388">readWriteResourceDirectory</a>[<a title="&gt;: Nothing &lt;: Any" id="74390">T</a>](<a title="String" id="74436">group</a>: <span title="String">String</span>, <a title="String" id="74437">name</a>: <span title="String">String</span>, <a title="sbt.Logger" id="74438">log</a>: <a href="Logger.scala.html#11865" title="sbt.Logger">Logger</a>)
		(<a title="(java.io.File) =&gt; Either[String,T]" id="74439">withDirectory</a>: File =&gt; Either[String, T]): <span title="Either[String,T]">Either</span>[String, T] =
			<a href="#74387" title="(String,String)Either[String,java.io.File]">readOnlyResourceDirectory</a>(<a href="#74436" title="String">group</a>, <a href="#74437" title="String">name</a>).<span title="=&gt; Either.RightProjection[String,java.io.File]">right</span> <span title="((java.io.File) =&gt; Either[String,T])Either[String,T]">flatMap</span>(<a title="java.io.File" id="74445">file</a> =&gt; <a href="#74391" title="(java.io.File,sbt.Logger)((java.io.File) =&gt; Either[String,T])Either[String,T]">readWriteResourceDirectory</a>(<a href="#74445" title="java.io.File">file</a>, <a href="#74438" title="sbt.Logger">log</a>)(<a href="#74439" title="(java.io.File) =&gt; Either[String,T]">withDirectory</a>))
	<span class="keyword">def</span> <a title="[T](java.io.File,sbt.Logger)((java.io.File) =&gt; Either[String,T])Either[String,T]" id="74391">readWriteResourceDirectory</a>[<a title="&gt;: Nothing &lt;: Any" id="74393">T</a>](<a title="java.io.File" id="74447">readOnly</a>: <span title="java.io.File">File</span>, <a title="sbt.Logger" id="74448">log</a>: <a href="Logger.scala.html#11865" title="sbt.Logger">Logger</a>)
		(<a title="(java.io.File) =&gt; Either[String,T]" id="74449">withDirectory</a>: File =&gt; Either[String, T]): <span title="Either[String,T]">Either</span>[String, T] =
	{
		<span title="(Boolean)Unit">require</span>(<a href="#74447" title="java.io.File">readOnly</a>.<span title="()Boolean">isDirectory</span>)
		<span class="keyword">def</span> <a title="(java.io.File)(java.io.File)Either[String,T]" id="74453">readWrite</a>(<a title="java.io.File" id="74455">readOnly</a>: <span title="java.io.File">File</span>)(<a title="java.io.File" id="74456">temporary</a>: <span title="java.io.File">File</span>): <span title="Either[String,T]">Either</span>[String, T] =
		{
			<span class="keyword">val</span> <a title="java.io.File" id="74457">readWriteDirectory</a> = <span title="(java.io.File,java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span>(<a href="#74456" title="java.io.File">temporary</a>, <a href="#74455" title="java.io.File">readOnly</a>.<a title="()java.lang.String" id="16219">getName</a>)
			<a href="FileUtilities.scala.html#9085" title="object sbt.FileUtilities">FileUtilities</a>.<a href="FileUtilities.scala.html#15483" title="(java.io.File,java.io.File,sbt.Logger)Option[String]">copyDirectory</a>(<a href="#74455" title="java.io.File">readOnly</a>, <a href="#74457" title="java.io.File">readWriteDirectory</a>, <a href="#74448" title="sbt.Logger">log</a>).<a title="(=&gt; Unit)Either[String,Unit] with Product" id="19246">toLeft</a>(<span title="Unit">(</span>)).<span title="=&gt; Either.RightProjection[String,Unit]">right</span> <span title="((Unit) =&gt; Either[String,T])Either[String,T]">flatMap</span> { <a title="Unit" id="74490">x</a> =&gt;
				<a href="#74449" title="(java.io.File)Either[String,T]" id="16544">withDirectory</a>(<a href="#74457" title="java.io.File">readWriteDirectory</a>)
			}
		}
		<a href="FileUtilities.scala.html#15464" title="(sbt.Logger)((java.io.File) =&gt; Either[String,T])Either[String,T]">doInTemporaryDirectory</a>(<a href="#74448" title="sbt.Logger">log</a>)(<a href="#74453" title="(java.io.File)(java.io.File)Either[String,T]">readWrite</a>(<a href="#74447" title="java.io.File">readOnly</a>))
	}
}
        </pre>
    </body>
</html>