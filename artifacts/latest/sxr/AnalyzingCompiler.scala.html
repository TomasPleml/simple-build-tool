<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>AnalyzingCompiler.scala</title>
        <script type="text/javascript" src="jquery-all.js"></script>
        <script type="text/javascript" src="linked.js"></script>
        <link rel="stylesheet" type="text/css" href="style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="keyword">package</span> xsbt

	<span class="keyword">import</span> sbt.ComponentManager
	<span class="keyword">import</span> xsbti.{AnalysisCallback, Logger =&gt; xLogger}
	<span class="keyword">import</span> java.io.File
	<span class="keyword">import</span> java.net.{URL, URLClassLoader}

<span class="comment">/** Interface to the Scala compiler that uses the dependency analysis plugin.  This class uses the Scala library and compiler
* provided by scalaInstance.  This class requires a ComponentManager in order to obtain the interface code to scalac and
* the analysis plugin.  Because these call Scala code for a different Scala version than the one used for this class, they must
* be compiled for the version of Scala being used.*/</span>
<span class="keyword">class</span> <a title="class AnalyzingCompiler extends java.lang.Object with NotNull with ScalaObject" id="7095">AnalyzingCompiler</a>(<span class="keyword">val</span> <a title="xsbt.ScalaInstance" id="15687">scalaInstance</a>: <a href="ScalaInstance.scala.html#7485" title="xsbt.ScalaInstance">ScalaInstance</a>, <span class="keyword">val</span> <a title="sbt.ComponentManager" id="15688">manager</a>: <a href="ComponentManager.scala.html#10409" title="sbt.ComponentManager">ComponentManager</a>, <span class="keyword">val</span> <a title="xsbt.ClasspathOptions" id="15689">cp</a>: <a href="CompilerArguments.scala.html#7344" title="xsbt.ClasspathOptions">ClasspathOptions</a>, <a title="xsbt.CompileLogger" id="15690">log</a>: <a href="CompileLogger.scala.html#6840" title="xsbt.CompileLogger">CompileLogger</a>) <span class="keyword">extends</span> <a title="NotNull" id="189">NotNull</a>
{
	<span class="keyword">def</span> <a title="(xsbt.ScalaInstance,sbt.ComponentManager,xsbt.CompileLogger)xsbt.AnalyzingCompiler" id="15183" class="keyword">this</a>(<a title="xsbt.ScalaInstance" id="16203">scalaInstance</a>: <a href="ScalaInstance.scala.html#7485" title="xsbt.ScalaInstance">ScalaInstance</a>, <a title="sbt.ComponentManager" id="16204">manager</a>: <a href="ComponentManager.scala.html#10409" title="sbt.ComponentManager">ComponentManager</a>, <a title="xsbt.CompileLogger" id="16205">log</a>: <a href="CompileLogger.scala.html#6840" title="xsbt.CompileLogger">CompileLogger</a>) = <a href="#7095" title="AnalyzingCompiler.this.type" class="keyword">this</a>(<a href="#16203" title="xsbt.ScalaInstance">scalaInstance</a>, <a href="#16204" title="sbt.ComponentManager">manager</a>, <a href="CompilerArguments.scala.html#7345" title="object xsbt.ClasspathOptions">ClasspathOptions</a>.<a href="CompilerArguments.scala.html#16210" title="=&gt; xsbt.ClasspathOptions">auto</a>, <a href="#16205" title="xsbt.CompileLogger">log</a>)
	<span class="keyword">def</span> <a title="(Set[java.io.File],Set[java.io.File],java.io.File,Seq[String],xsbti.AnalysisCallback,Int,xsbt.CompileLogger)Unit" id="15184">apply</a>(<a title="Set[java.io.File]" id="16235">sources</a>: <span title="Set[java.io.File]">Set</span>[File], <a title="Set[java.io.File]" id="16236">classpath</a>: <span title="Set[java.io.File]">Set</span>[File], <a title="java.io.File" id="16237">outputDirectory</a>: <span title="java.io.File">File</span>, <a title="Seq[String]" id="16238">options</a>: <span title="Seq[String]">Seq</span>[String], <a title="xsbti.AnalysisCallback" id="16239">callback</a>: <a href="xsbti/AnalysisCallback.java.html#7615" title="xsbti.AnalysisCallback">AnalysisCallback</a>, <a title="Int" id="16240">maximumErrors</a>: <span title="Int">Int</span>, <a title="xsbt.CompileLogger" id="16241">log</a>: <a href="CompileLogger.scala.html#6840" title="xsbt.CompileLogger">CompileLogger</a>)
	{
		<span class="keyword">val</span> <a title="Seq[String]" id="17021">arguments</a> = (<a href="CompilerArguments.scala.html#17027" title="(Set[java.io.File],Set[java.io.File],java.io.File,Seq[String])Seq[String]" class="keyword">new</a> <a href="CompilerArguments.scala.html#7362" title="xsbt.CompilerArguments">CompilerArguments</a>(<a href="#15687" title="=&gt; xsbt.ScalaInstance">scalaInstance</a>, <a href="#15689" title="=&gt; xsbt.ClasspathOptions">cp</a>))(<a href="#16235" title="Set[java.io.File]">sources</a>, <a href="#16236" title="Set[java.io.File]">classpath</a>, <a href="#16237" title="java.io.File">outputDirectory</a>, <a href="#16238" title="Seq[String]">options</a>)
		<a href="#15188" title="(String,xsbt.CompileLogger)(Class[_]*)(AnyRef*)Unit">call</a>(<span title="java.lang.String(&quot;xsbt.CompilerInterface&quot;)" class="string">&quot;xsbt.CompilerInterface&quot;</span>, <a href="#16241" title="xsbt.CompileLogger">log</a>)(
			<span title="java.lang.Class[Array[String]]">classOf</span>[Array[String]], <span title="java.lang.Class[xsbti.AnalysisCallback]">classOf</span>[AnalysisCallback], <span title="java.lang.Class[Int]">classOf</span>[Int], <span title="java.lang.Class[xsbti.Logger]">classOf</span>[xLogger] ) (
			<a href="#17021" title="Seq[String]">arguments</a>.<span title="Array[String]">toArray</span>[<span title="String">String</span>] : <span title="Array[String]">Array</span>[String], <a href="#16239" title="xsbti.AnalysisCallback">callback</a>, <a href="#16240" title="implicit scala.Predef.int2Integer : (Int)java.lang.Integer">maximumErrors</a>: java.lang.<span title="java.lang.Integer">Integer</span>, <a href="#16241" title="xsbt.CompileLogger">log</a> )
	}
	<span class="keyword">def</span> <a title="(Set[java.io.File],Set[java.io.File],java.io.File,Seq[String],Int,xsbt.CompileLogger)Unit" id="15185">doc</a>(<a title="Set[java.io.File]" id="18137">sources</a>: <span title="Set[java.io.File]">Set</span>[File], <a title="Set[java.io.File]" id="18138">classpath</a>: <span title="Set[java.io.File]">Set</span>[File], <a title="java.io.File" id="18139">outputDirectory</a>: <span title="java.io.File">File</span>, <a title="Seq[String]" id="18140">options</a>: <span title="Seq[String]">Seq</span>[String], <a title="Int" id="18141">maximumErrors</a>: <span title="Int">Int</span>, <a title="xsbt.CompileLogger" id="18142">log</a>: <a href="CompileLogger.scala.html#6840" title="xsbt.CompileLogger">CompileLogger</a>): <span title="Unit">Unit</span> =
	{
		<span class="keyword">val</span> <a title="Seq[String]" id="18143">arguments</a> = (<a href="CompilerArguments.scala.html#17027" title="(Set[java.io.File],Set[java.io.File],java.io.File,Seq[String])Seq[String]" class="keyword">new</a> <a href="CompilerArguments.scala.html#7362" title="xsbt.CompilerArguments">CompilerArguments</a>(<a href="#15687" title="=&gt; xsbt.ScalaInstance">scalaInstance</a>, <a href="#15689" title="=&gt; xsbt.ClasspathOptions">cp</a>))(<a href="#18137" title="Set[java.io.File]">sources</a>, <a href="#18138" title="Set[java.io.File]">classpath</a>, <a href="#18139" title="java.io.File">outputDirectory</a>, <a href="#18140" title="Seq[String]">options</a>)
		<a href="#15188" title="(String,xsbt.CompileLogger)(Class[_]*)(AnyRef*)Unit">call</a>(<span title="java.lang.String(&quot;xsbt.ScaladocInterface&quot;)" class="string">&quot;xsbt.ScaladocInterface&quot;</span>, <a href="#18142" title="xsbt.CompileLogger">log</a>) (<span title="java.lang.Class[Array[String]]">classOf</span>[Array[String]], <span title="java.lang.Class[Int]">classOf</span>[Int], <span title="java.lang.Class[xsbti.Logger]">classOf</span>[xLogger]) (<a href="#18143" title="Seq[String]">arguments</a>.<span title="Array[String]">toArray</span>[<span title="String">String</span>] : <span title="Array[String]">Array</span>[String], <a href="#18141" title="implicit scala.Predef.int2Integer : (Int)java.lang.Integer">maximumErrors</a>: java.lang.<span title="java.lang.Integer">Integer</span>, <a href="#18142" title="xsbt.CompileLogger">log</a>)
	}
	<span class="keyword">def</span> <a title="(Set[java.io.File],Seq[String],String,xsbt.CompileLogger)Unit" id="15186">console</a>(<a title="Set[java.io.File]" id="18147">classpath</a>: <span title="Set[java.io.File]">Set</span>[File], <a title="Seq[String]" id="18148">options</a>: <span title="Seq[String]">Seq</span>[String], <a title="String" id="18149">initialCommands</a>: <span title="String">String</span>, <a title="xsbt.CompileLogger" id="18150">log</a>: <a href="CompileLogger.scala.html#6840" title="xsbt.CompileLogger">CompileLogger</a>): <span title="Unit">Unit</span> =
	{
		<span class="keyword">val</span> <a title="xsbt.CompilerArguments" id="18151">arguments</a> = <span title="xsbt.CompilerArguments" class="keyword">new</span> <a href="CompilerArguments.scala.html#7362" title="xsbt.CompilerArguments">CompilerArguments</a>(<a href="#15687" title="=&gt; xsbt.ScalaInstance">scalaInstance</a>, <a href="#15689" title="=&gt; xsbt.ClasspathOptions">cp</a>)
		<span class="keyword">val</span> <a title="String" id="18152">classpathString</a> = <a href="CompilerArguments.scala.html#7363" title="object xsbt.CompilerArguments">CompilerArguments</a>.<a href="CompilerArguments.scala.html#15661" title="(Set[java.io.File])String">absString</a>(<a href="#18151" title="xsbt.CompilerArguments">arguments</a>.<a href="CompilerArguments.scala.html#17028" title="(Set[java.io.File])Set[java.io.File]">finishClasspath</a>(<a href="#18147" title="Set[java.io.File]">classpath</a>))
		<span class="keyword">val</span> <a title="java.lang.String" id="18153">bootClasspath</a> = <span title="java.lang.String" class="keyword">if</span>(<a href="#15689" title="=&gt; xsbt.ClasspathOptions">cp</a>.<a href="CompilerArguments.scala.html#15669" title="=&gt; Boolean">autoBoot</a>) <a href="#18151" title="xsbt.CompilerArguments">arguments</a>.<a href="CompilerArguments.scala.html#17032" title="=&gt; java.lang.String">createBootClasspath</a> <span class="keyword">else</span> <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>
		<a href="#15188" title="(String,xsbt.CompileLogger)(Class[_]*)(AnyRef*)Unit">call</a>(<span title="java.lang.String(&quot;xsbt.ConsoleInterface&quot;)" class="string">&quot;xsbt.ConsoleInterface&quot;</span>, <a href="#18150" title="xsbt.CompileLogger">log</a>) (<span title="java.lang.Class[Array[String]]">classOf</span>[Array[String]], <span title="java.lang.Class[String]">classOf</span>[String], <span title="java.lang.Class[String]">classOf</span>[String], <span title="java.lang.Class[String]">classOf</span>[String], <span title="java.lang.Class[xsbti.Logger]">classOf</span>[xLogger]) (<a href="#18148" title="Seq[String]">options</a>.<span title="Array[String]">toArray</span>[<span title="String">String</span>]: <span title="Array[String]">Array</span>[String], <a href="#18153" title="java.lang.String">bootClasspath</a>, <a href="#18152" title="String">classpathString</a>, <a href="#18149" title="String">initialCommands</a>, <a href="#18150" title="xsbt.CompileLogger">log</a>)
	}
	<span class="keyword">def</span> <a title="(xsbt.CompileLogger)Unit" id="15187">force</a>(<a title="xsbt.CompileLogger" id="18346">log</a>: <a href="CompileLogger.scala.html#6840" title="xsbt.CompileLogger">CompileLogger</a>): <span title="Unit">Unit</span> = <a href="#15191" title="(xsbt.CompileLogger)java.io.File">getInterfaceJar</a>(<a href="#18346" title="xsbt.CompileLogger">log</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String,xsbt.CompileLogger)(Class[_]*)(AnyRef*)Unit" id="15188">call</a>(<a title="String" id="17039">interfaceClassName</a>: <span title="String">String</span>, <a title="xsbt.CompileLogger" id="17040">log</a>: <a href="CompileLogger.scala.html#6840" title="xsbt.CompileLogger">CompileLogger</a>)(<a title="Class[_]*" id="17041">argTypes</a>: <span title="Class[_]*">Class</span>[_]*)(<a title="AnyRef*" id="17042">args</a>: <span title="AnyRef*">AnyRef</span>*)
	{
		<span class="keyword">val</span> <a title="java.lang.Class[_]" id="18491">interfaceClass</a> = <a href="#15190" title="(String,xsbt.CompileLogger)java.lang.Class[_]">getInterfaceClass</a>(<a href="#17039" title="String">interfaceClassName</a>, <a href="#17040" title="xsbt.CompileLogger">log</a>)
		<span class="keyword">val</span> <a title="AnyRef" id="18492">interface</a> = <a href="#18491" title="java.lang.Class[_]">interfaceClass</a>.<a title="()Any" id="3913">newInstance</a>.<a title="AnyRef" id="3442">asInstanceOf</a>[<a title="AnyRef" id="1953">AnyRef</a>]
		<span class="keyword">val</span> <a title="java.lang.reflect.Method" id="18493">method</a> = <a href="#18491" title="java.lang.Class[_]">interfaceClass</a>.<a title="(java.lang.String,java.lang.Class[_]*)java.lang.reflect.Method" id="4320">getMethod</a>(<span title="java.lang.String(&quot;run&quot;)" class="string">&quot;run&quot;</span>, <a href="#17041" title="Class[_]*">argTypes</a> : _*)
		<span class="keyword">try</span> { <a href="#18493" title="java.lang.reflect.Method">method</a>.<a title="(Any,java.lang.Object*)java.lang.Object" id="19595">invoke</a>(<a href="#18492" title="AnyRef">interface</a>, <a href="#17042" title="AnyRef*">args</a>: _*) }
		<span class="keyword">catch</span> { <span title="Nothing" class="keyword">case</span> <a title="java.lang.reflect.InvocationTargetException" id="19633">e</a>: java.lang.reflect.<a title="java.lang.reflect.InvocationTargetException" id="3881">InvocationTargetException</a> =&gt; <span title="Nothing" class="keyword">throw</span> <a href="#19633" title="java.lang.reflect.InvocationTargetException">e</a>.<a title="()java.lang.Throwable" id="19638">getCause</a> }
	}
	<span class="keyword">private</span>[<span class="keyword">this</span>] <span class="keyword">def</span> <a title="=&gt; java.net.URLClassLoader" id="15189">loader</a> =
	{
		<span class="keyword">val</span> <a title="java.io.File" id="19149">interfaceJar</a> = <a href="#15191" title="(xsbt.CompileLogger)java.io.File">getInterfaceJar</a>(<a href="#15690" title="xsbt.CompileLogger">log</a>)
		<span class="keyword">val</span> <a title="java.lang.ClassLoader" id="19150">dual</a> = <a href="#15193" title="(java.lang.ClassLoader,java.lang.ClassLoader)java.lang.ClassLoader">createDualLoader</a>(<a href="#15687" title="=&gt; xsbt.ScalaInstance">scalaInstance</a>.<a href="ScalaInstance.scala.html#15208" title="=&gt; java.lang.ClassLoader">loader</a>, <a href="#7095" title="()java.lang.Class[_]" id="3450">getClass</a>.<a title="()java.lang.ClassLoader" id="3924">getClassLoader</a>) <span class="comment">// this goes to scalaLoader for scala classes and sbtLoader for xsbti classes</span>
		<span title="java.net.URLClassLoader" class="keyword">new</span> <a title="java.net.URLClassLoader" id="4394">URLClassLoader</a>(<a title="(java.net.URL*)Array[java.net.URL]" id="1033">Array</a>(<a href="#19149" title="java.io.File">interfaceJar</a>.<a title="()java.net.URI" id="16965">toURI</a>.<a title="()java.net.URL" id="19502">toURL</a>), <a href="#19150" title="java.lang.ClassLoader">dual</a>)
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String,xsbt.CompileLogger)java.lang.Class[_]" id="15190">getInterfaceClass</a>(<a title="String" id="18494">name</a>: <span title="String">String</span>, <a title="xsbt.CompileLogger" id="18495">log</a>: <a href="CompileLogger.scala.html#6840" title="xsbt.CompileLogger">CompileLogger</a>) = <a title="object java.lang.Class" id="1612">Class</a>.<a title="(java.lang.String,Boolean,java.lang.ClassLoader)java.lang.Class[_]" id="3911">forName</a>(<a href="#18494" title="String">name</a>, <span title="Boolean(true)" class="keyword">true</span>, <a href="#15189" title="=&gt; java.net.URLClassLoader">loader</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(xsbt.CompileLogger)java.io.File" id="15191">getInterfaceJar</a>(<a title="xsbt.CompileLogger" id="18347">log</a>: <a href="CompileLogger.scala.html#6840" title="xsbt.CompileLogger">CompileLogger</a>) =
	{
		<span class="comment">// this is the instance used to compile the interface component</span>
		<span class="keyword">val</span> <a title="xsbt.ComponentCompiler" id="18349">componentCompiler</a> = <a href="#15192" title="(xsbt.CompileLogger)xsbt.ComponentCompiler">newComponentCompiler</a>(<a href="#18347" title="xsbt.CompileLogger">log</a>)
		<a href="#18347" title="xsbt.CompileLogger">log</a>.<a href="CompileLogger.scala.html#15683" title="(=&gt; String)Unit">debug</a>(<span title="java.lang.String(&quot;Getting &quot;)" class="string">&quot;Getting &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="ComponentCompiler.scala.html#7276" title="object xsbt.ComponentCompiler">ComponentCompiler</a>.<a href="ComponentCompiler.scala.html#18396" title="=&gt; java.lang.String">compilerInterfaceID</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; from component compiler for Scala &quot;)" class="string">&quot; from component compiler for Scala &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#15687" title="=&gt; xsbt.ScalaInstance">scalaInstance</a>.<a href="ScalaInstance.scala.html#15206" title="=&gt; String">version</a>)
		<a href="ComponentCompiler.scala.html#18359" title="(String)java.io.File">componentCompiler</a>(<a href="ComponentCompiler.scala.html#7276" title="object xsbt.ComponentCompiler">ComponentCompiler</a>.<a href="ComponentCompiler.scala.html#18396" title="=&gt; java.lang.String">compilerInterfaceID</a>)
	}
	<span class="keyword">def</span> <a title="(xsbt.CompileLogger)xsbt.ComponentCompiler" id="15192">newComponentCompiler</a>(<a title="xsbt.CompileLogger" id="18350">log</a>: <a href="CompileLogger.scala.html#6840" title="xsbt.CompileLogger">CompileLogger</a>) = <span title="xsbt.ComponentCompiler" class="keyword">new</span> <a href="ComponentCompiler.scala.html#7275" title="xsbt.ComponentCompiler">ComponentCompiler</a>(<span title="xsbt.RawCompiler" class="keyword">new</span> <a href="RawCompiler.scala.html#7143" title="xsbt.RawCompiler">RawCompiler</a>(<a href="#15687" title="=&gt; xsbt.ScalaInstance">scalaInstance</a>, <a href="CompilerArguments.scala.html#7345" title="object xsbt.ClasspathOptions">ClasspathOptions</a>.<a href="CompilerArguments.scala.html#16210" title="=&gt; xsbt.ClasspathOptions">auto</a>, <a href="#18350" title="xsbt.CompileLogger">log</a>), <a href="#15688" title="=&gt; sbt.ComponentManager">manager</a>)
	<span class="keyword">protected</span> <span class="keyword">def</span> <a title="(java.lang.ClassLoader,java.lang.ClassLoader)java.lang.ClassLoader" id="15193">createDualLoader</a>(<a title="java.lang.ClassLoader" id="19151">scalaLoader</a>: <span title="java.lang.ClassLoader">ClassLoader</span>, <a title="java.lang.ClassLoader" id="19152">sbtLoader</a>: <span title="java.lang.ClassLoader">ClassLoader</span>): <span title="java.lang.ClassLoader">ClassLoader</span> =
	{
		<span class="keyword">val</span> <a title="(String) =&gt; Boolean" id="19644">xsbtiFilter</a> = (<a title="String" id="19647">name</a>: <span title="String">String</span>) =&gt; <a href="#19647" title="String">name</a>.<a title="(java.lang.String)Boolean" id="6370">startsWith</a>(<span title="java.lang.String(&quot;xsbti.&quot;)" class="string">&quot;xsbti.&quot;</span>)
		<span class="keyword">val</span> <a title="(String) =&gt; Boolean" id="19645">notXsbtiFilter</a> = (<a title="String" id="19650">name</a>: <span title="String">String</span>) =&gt; <a title="=&gt; Boolean" id="2686">!</a><a href="#19644" title="(String)Boolean" id="16113">xsbtiFilter</a>(<a href="#19650" title="String">name</a>)
		<span title="xsbt.DualLoader" class="keyword">new</span> <a href="DualLoader.scala.html#7479" title="xsbt.DualLoader">DualLoader</a>(<a href="#19151" title="java.lang.ClassLoader">scalaLoader</a>, <a href="#19645" title="(String) =&gt; Boolean">notXsbtiFilter</a>, <a title="String" id="19687">x</a> =&gt; <span title="Boolean(true)" class="keyword">true</span>, <a href="#19152" title="java.lang.ClassLoader">sbtLoader</a>, <a href="#19644" title="(String) =&gt; Boolean">xsbtiFilter</a>, <a title="String" id="19689">x</a> =&gt; <span title="Boolean(false)" class="keyword">false</span>)
	}
	<span class="keyword">override</span> <span class="keyword">def</span> <a title="()java.lang.String" id="15194">toString</a> = <span title="java.lang.String(&quot;Analyzing compiler (Scala &quot;)" class="string">&quot;Analyzing compiler (Scala &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#15687" title="=&gt; xsbt.ScalaInstance">scalaInstance</a>.<a href="ScalaInstance.scala.html#15218" title="=&gt; java.lang.String">actualVersion</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;)&quot;)" class="string">&quot;)&quot;</span>
}
        </pre>
    </body>
</html>