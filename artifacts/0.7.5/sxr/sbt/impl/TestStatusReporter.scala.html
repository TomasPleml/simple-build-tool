<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/impl/TestStatusReporter.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt.impl
<span class="keyword">import</span> sbt._

<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> scala.collection.mutable.{HashMap, Map}

<span class="comment">/** Only intended to be used once per instance. */</span>
<span class="keyword">private</span>[sbt] <span class="keyword">class</span> <a title="class TestStatusReporter extends java.lang.Object with sbt.TestsListener with ScalaObject" id="14533">TestStatusReporter</a>(<a title="sbt.Path" id="57893">path</a>: <a href="../Path.scala.html#11862" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="57894">log</a>: <a href="../Logger.scala.html#13533" title="sbt.Logger">Logger</a>) <span class="keyword">extends</span> <a href="../TestReportListener.scala.html#10821" title="sbt.TestsListener">TestsListener</a>
{
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[String,Long]" id="57884">succeeded</a>: <span title="scala.collection.mutable.Map[String,Long]">Map</span>[String, Long] = <a href="#14285" title="object sbt.impl.TestStatus">TestStatus</a>.<a href="#84618" title="(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]">read</a>(<a href="#57893" title="sbt.Path">path</a>, <a href="#57894" title="sbt.Logger">log</a>)

	<span class="keyword">def</span> <a title="=&gt; Unit" id="57885">doInit</a> <span title="Unit">{</span>}
	<span class="keyword">def</span> <a title="(String)Unit" id="57886">startGroup</a>(<a title="String" id="84624">name</a>: <span title="String">String</span>) { <a href="#57883" title="=&gt; scala.collection.mutable.Map[String,Long]">succeeded</a> <a title="(String)Option[Long]" id="37798">removeKey</a> <a href="#84624" title="String">name</a> }
	<span class="keyword">def</span> <a title="(sbt.TestEvent)Unit" id="57887">testEvent</a>(<a title="sbt.TestEvent" id="84625">event</a>: <a href="../TestReportListener.scala.html#11022" title="sbt.TestEvent">TestEvent</a>) <span title="Unit">{</span>}
	<span class="keyword">def</span> <a title="(String,Throwable)Unit" id="57888">endGroup</a>(<a title="String" id="84626">name</a>: <span title="String">String</span>, <a title="Throwable" id="84627">t</a>: <span title="Throwable">Throwable</span>) <span title="Unit">{</span>}
	<span class="keyword">def</span> <a title="(String,sbt.Result.Value)Unit" id="57889">endGroup</a>(<a title="String" id="84628">name</a>: <span title="String">String</span>, <a title="sbt.Result.Value" id="84629">result</a>: Result.<span title="sbt.Result.Value">Value</span>)
	{
		<span title="Unit" class="keyword">if</span>(<a href="#84629" title="sbt.Result.Value">result</a> <a title="(AnyRef)Boolean" id="3452">==</a> <a href="../TestFramework.scala.html#13339" title="object sbt.Result">Result</a>.<a href="../TestFramework.scala.html#75448" title="=&gt; sbt.Result.Value">Passed</a>)
			<a href="#57883" title="=&gt; scala.collection.mutable.Map[String,Long]">succeeded</a>(<a href="#84628" title="String">name</a>) = <a title="object java.lang.System" id="1829">System</a>.<a title="()Long" id="18115">currentTimeMillis</a>
	}
	<span class="keyword">def</span> <a title="(sbt.Result.Value)Unit" id="57890">doComplete</a>(<a title="sbt.Result.Value" id="84631">finalResult</a>: Result.<span title="sbt.Result.Value">Value</span>) { <a href="#57892" title="()Unit">complete</a>() }
	<span class="keyword">def</span> <a title="(Throwable)Unit" id="57891">doComplete</a>(<a title="Throwable" id="84632">t</a>: <span title="Throwable">Throwable</span>) { <a href="#57892" title="()Unit">complete</a>() }
	
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="57892">complete</a>()
	{
		<a href="#14285" title="object sbt.impl.TestStatus">TestStatus</a>.<a href="#84619" title="(scala.collection.mutable.Map[String,Long],String,sbt.Path,sbt.Logger)Unit">write</a>(<a href="#57883" title="=&gt; scala.collection.mutable.Map[String,Long]">succeeded</a>, <span title="java.lang.String(&quot;Successful Tests&quot;)" class="string">&quot;Successful Tests&quot;</span>, <a href="#57893" title="sbt.Path">path</a>, <a href="#57894" title="sbt.Logger">log</a>)
	}
}

<span class="keyword">private</span>[sbt] <span class="keyword">class</span> <a title="class TestQuickFilter extends java.lang.Object with (String) =&gt; Boolean with NotNull with ScalaObject" id="14485">TestQuickFilter</a>(<a title="sbt.CompileAnalysis" id="57864">testAnalysis</a>: <a href="../Analysis.scala.html#8628" title="sbt.CompileAnalysis">CompileAnalysis</a>, <a title="Boolean" id="57865">failedOnly</a>: <a title="Boolean" id="2110">Boolean</a>, <a title="sbt.Path" id="57866">path</a>: <a href="../Path.scala.html#11862" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="57867">log</a>: <a href="../Logger.scala.html#13533" title="sbt.Logger">Logger</a>) <span class="keyword">extends</span> (String =&gt; Boolean) <span class="keyword">with</span> <a title="NotNull" id="193">NotNull</a>
{
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[String,Long]" id="57860">exclude</a> = <a href="#14285" title="object sbt.impl.TestStatus">TestStatus</a>.<a href="#84618" title="(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]">read</a>(<a href="#57866" title="sbt.Path">path</a>, <a href="#57867" title="sbt.Logger">log</a>)
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[String,sbt.Path]" id="57862">map</a> = <a href="#57864" title="sbt.CompileAnalysis">testAnalysis</a>.<a href="../Analysis.scala.html#50442" title="=&gt; scala.collection.mutable.Map[String,sbt.Path]">testSourceMap</a>
	<span class="keyword">def</span> <a title="(String)Boolean" id="57863">apply</a>(<a title="String" id="84642">test</a>: <span title="String">String</span>) =
		<a href="#57859" title="=&gt; scala.collection.mutable.Map[String,Long]">exclude</a>.<a title="(String)Option[Long]" id="37831">get</a>(<a href="#84642" title="String">test</a>) <span title="Boolean" class="keyword">match</span>
		{
			<span title="Boolean(true)" class="keyword">case</span> <span title="object None">None</span> =&gt; <span title="Boolean(true)" class="keyword">true</span> <span class="comment">// include because this test has not been run or did not succeed</span>
			<span title="Boolean" class="keyword">case</span> Some(<a title="Long" id="84644">lastSuccessTime</a>) =&gt; <span class="comment">// succeeded the last time it was run</span>
				<span title="Boolean" class="keyword">if</span>(<a href="#57865" title="Boolean">failedOnly</a>)
					<span title="Boolean(false)" class="keyword">false</span> <span class="comment">// don't include because the last time succeeded</span>
				<span class="keyword">else</span>
					<a href="#57864" title="sbt.CompileAnalysis">testAnalysis</a>.<a href="../Analysis.scala.html#49101" title="(sbt.Path)Option[scala.collection.mutable.Set[sbt.Path]]">products</a>(<a href="#57861" title="(String)sbt.Path" id="37835">map</a>(<a href="#84642" title="String">test</a>)) <span title="Boolean" class="keyword">match</span>
					{
						<span title="Boolean(true)" class="keyword">case</span> <span title="object None">None</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
						<span title="Boolean" class="keyword">case</span> Some(<a title="scala.collection.mutable.Set[sbt.Path]" id="84649">products</a>) =&gt; <a href="#84649" title="scala.collection.mutable.Set[sbt.Path]">products</a>.<a title="((sbt.Path) =&gt; Boolean)Boolean" id="15954">exists</a>(<a href="#84644" title="Long">lastSuccessTime</a> <a title="(Long)Boolean" id="3210">&lt;=</a> <a href="#84651" title="sbt.Path">_</a>.<a href="../Path.scala.html#49356" title="=&gt; Long">lastModified</a>) <span class="comment">// include if the test is newer than the last run</span>
					}
		}
}
<span class="keyword">private</span> <span class="keyword">object</span> <a title="object sbt.impl.TestStatus" id="14285">TestStatus</a>
{
	<span class="keyword">import</span> java.util.Properties
	<span class="keyword">def</span> <a title="(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]" id="84618">read</a>(<a title="sbt.Path" id="84621">path</a>: <a href="../Path.scala.html#11862" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="84622">log</a>: <a href="../Logger.scala.html#13533" title="sbt.Logger">Logger</a>): <span title="scala.collection.mutable.Map[String,Long]">Map</span>[String, Long] =
	{
		<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,Long]" id="84654">map</a> = <span title="scala.collection.mutable.HashMap[String,Long]" class="keyword">new</span> <a title="scala.collection.mutable.HashMap[String,Long]" id="20220">HashMap</a>[String, Long]
		<span class="keyword">val</span> <a title="java.util.Properties" id="84655">properties</a> = <span title="java.util.Properties" class="keyword">new</span> <span title="java.util.Properties">Properties</span>
		<a href="#84620" title="(Option[String],String,sbt.Logger)Unit">logError</a>(<a href="MapUtilities.scala.html#14318" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="MapUtilities.scala.html#60201" title="(java.util.Properties,sbt.Path,sbt.Logger)Option[String]">load</a>(<a href="#84655" title="java.util.Properties">properties</a>, <a href="#84621" title="sbt.Path">path</a>, <a href="#84622" title="sbt.Logger">log</a>), <span title="java.lang.String(&quot;loading&quot;)" class="string">&quot;loading&quot;</span>, <a href="#84622" title="sbt.Logger">log</a>)
		<span class="keyword">for</span>(<a title="((String) =&gt; Unit)Unit" id="84666">test</a> &lt;- <a href="MapUtilities.scala.html#14318" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="MapUtilities.scala.html#60202" title="(java.util.Properties)Iterable[String]">propertyNames</a>(<a href="#84655" title="java.util.Properties">properties</a>))
			<a href="#84654" title="scala.collection.mutable.HashMap[String,Long]">map</a>.<a title="(String,Long)Option[Long]" id="37799">put</a>(<a href="#84666" title="String">test</a>, <a href="#84655" title="java.util.Properties">properties</a>.<a title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString" id="40181">getProperty</a>(<a href="#84666" title="String">test</a>).<a title="=&gt; Long" id="17328">toLong</a>)
		<a href="#84654" title="scala.collection.mutable.HashMap[String,Long]">map</a>
	}
	<span class="keyword">def</span> <a title="(scala.collection.mutable.Map[String,Long],String,sbt.Path,sbt.Logger)Unit" id="84619">write</a>(<a title="scala.collection.mutable.Map[String,Long]" id="84633">map</a>: <span title="scala.collection.mutable.Map[String,Long]">Map</span>[String, Long], <a title="String" id="84634">label</a>: <span title="String">String</span>, <a title="sbt.Path" id="84635">path</a>: <a href="../Path.scala.html#11862" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="84636">log</a>: <a href="../Logger.scala.html#13533" title="sbt.Logger">Logger</a>)
	{
		<span class="keyword">val</span> <a title="java.util.Properties" id="84672">properties</a> = <span title="java.util.Properties" class="keyword">new</span> <span title="java.util.Properties">Properties</span>
		<span class="keyword">for</span>( <a href="#84679" title="(((String, Long)) =&gt; Unit)Unit" id="15946">(</a><a title="String" id="84684">test</a>, <a title="Long" id="84685">lastSuccessTime</a>) &lt;- <a href="#84633" title="scala.collection.mutable.Map[String,Long]">map</a>)
			<a href="#84672" title="java.util.Properties">properties</a>.<a title="(java.lang.String,java.lang.String)java.lang.Object" id="40172">setProperty</a>(<a href="#84684" title="String">test</a>, <a href="#84685" title="Long">lastSuccessTime</a>.<a title="()java.lang.String" id="3443">toString</a>)
		<a href="#84620" title="(Option[String],String,sbt.Logger)Unit">logError</a>(<a href="MapUtilities.scala.html#14318" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="MapUtilities.scala.html#60200" title="(java.util.Properties,String,sbt.Path,sbt.Logger)Option[String]">write</a>(<a href="#84672" title="java.util.Properties">properties</a>, <a href="#84634" title="String">label</a>, <a href="#84635" title="sbt.Path">path</a>, <a href="#84636" title="sbt.Logger">log</a>), <span title="java.lang.String(&quot;writing&quot;)" class="string">&quot;writing&quot;</span>, <a href="#84636" title="sbt.Logger">log</a>)
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(Option[String],String,sbt.Logger)Unit" id="84620">logError</a>(<a title="Option[String]" id="84662">result</a>: <a title="Option[String]" id="901">Option</a>[String], <a title="String" id="84663">action</a>: <span title="String">String</span>, <a title="sbt.Logger" id="84664">log</a>: <a href="../Logger.scala.html#13533" title="sbt.Logger">Logger</a>)
	{
		<a href="#84662" title="Option[String]">result</a>.<a title="((String) =&gt; Unit)Unit" id="30336">foreach</a>(<a title="String" id="84687">msg</a> =&gt; <a href="#84664" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#49387" title="(=&gt; String)Unit">error</a>(<span title="java.lang.String(&quot;Error &quot;)" class="string">&quot;Error &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84663" title="String">action</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; test status: &quot;)" class="string">&quot; test status: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#84687" title="String">msg</a>))
	}
}
        </pre>
    </body>
</html>