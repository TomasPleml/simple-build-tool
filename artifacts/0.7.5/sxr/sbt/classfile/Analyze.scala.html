<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/classfile/Analyze.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt.classfile
<span class="keyword">import</span> sbt._

<span class="keyword">import</span> scala.collection.mutable
<span class="keyword">import</span> mutable.{ArrayBuffer, Buffer}
<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> java.lang.annotation.Annotation
<span class="keyword">import</span> java.lang.reflect.Method
<span class="keyword">import</span> java.lang.reflect.Modifier.{STATIC, PUBLIC, ABSTRACT}

<span class="keyword">private</span>[sbt] <span class="keyword">object</span> <a title="object sbt.classfile.Analyze" id="14023">Analyze</a>
{
	<span class="keyword">def</span> <a title="[T](sbt.Path,sbt.Path,Iterable[sbt.Path],Iterable[sbt.Path],sbt.Logger)(=&gt; scala.collection.Set[sbt.Path],sbt.AnalysisCallback,java.lang.ClassLoader)(=&gt; Option[String])Option[String]" id="53923">apply</a>[<a title="&gt;: Nothing &lt;: Any" id="53925">T</a>](<a title="sbt.Path" id="53944">basePath</a>: <a href="../Path.scala.html#11862" title="sbt.Path">Path</a>, <a title="sbt.Path" id="53945">outputDirectory</a>: <a href="../Path.scala.html#11862" title="sbt.Path">Path</a>, <a title="Iterable[sbt.Path]" id="53946">sources</a>: <span title="Iterable[sbt.Path]">Iterable</span>[Path], <a title="Iterable[sbt.Path]" id="53947">roots</a>: <span title="Iterable[sbt.Path]">Iterable</span>[Path], <a title="sbt.Logger" id="53948">log</a>: <a href="../Logger.scala.html#13533" title="sbt.Logger">Logger</a>)
		(<a title="=&gt; scala.collection.Set[sbt.Path]" id="53949">allProducts</a>: =&gt; scala.collection.Set[Path], <a title="sbt.AnalysisCallback" id="53950">analysis</a>: <a href="../AnalysisCallback.scala.html#10845" title="sbt.AnalysisCallback">AnalysisCallback</a>, <a title="java.lang.ClassLoader" id="53951">loader</a>: <a title="java.lang.ClassLoader" id="1669">ClassLoader</a>)
		(<a title="=&gt; Option[String]" id="53952">compile</a>: =&gt; Option[String]): <span title="Option[String]">Option</span>[String] =
	{
		<span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Path]" id="81406">sourceSet</a> = <span title="(sbt.Path*)scala.collection.immutable.Set[sbt.Path]">Set</span>(<a href="#53946" title="Iterable[sbt.Path]">sources</a>.<span title="=&gt; Seq[sbt.Path]">toSeq</span> : _*)
		<span class="keyword">val</span> <a title="sbt.PathFinder" id="81407">classesFinder</a> = <a href="#53945" title="sbt.Path">outputDirectory</a> <a href="../Path.scala.html#49328" title="(sbt.FileFilter)sbt.PathFinder">**</a> <a href="../NameFilter.scala.html#54007" title="(String)sbt.NameFilter">GlobFilter</a>(<span title="java.lang.String(&quot;*.class&quot;)" class="string">&quot;*.class&quot;</span>)
		<span class="keyword">val</span> <a title="scala.collection.Set[sbt.Path]" id="81408">existingClasses</a> = <a href="#81407" title="sbt.PathFinder">classesFinder</a>.<a href="../Path.scala.html#49335" title="=&gt; scala.collection.Set[sbt.Path]">get</a>

		<span class="keyword">def</span> <a title="(String,=&gt; String)Option[Class[_]]" id="81409">load</a>(<a title="String" id="81412">tpe</a>: <span title="String">String</span>, <a title="=&gt; String" id="81413">errMsg</a>: =&gt; String): <span title="Option[Class[_]]">Option</span>[Class[_]] =
			<span class="keyword">try</span> { <span title="(java.lang.Class[?0])Some[java.lang.Class[?0]]">Some</span>(<a title="object java.lang.Class" id="1616">Class</a>.<a title="(java.lang.String,Boolean,java.lang.ClassLoader)java.lang.Class[_]" id="3915">forName</a>(<a href="#81412" title="String">tpe</a>, <span title="Boolean(false)" class="keyword">false</span>, <a href="#53951" title="java.lang.ClassLoader">loader</a>)) }
			<span class="keyword">catch</span> { <span title="None.type" class="keyword">case</span> <a title="java.lang.Throwable" id="81429">e</a> =&gt; <a href="#53948" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#49386" title="(=&gt; String)Unit">warn</a>(<a href="#81413" title="=&gt; String">errMsg</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; : &quot;)" class="string">&quot; : &quot;</span> <span title="(Any)java.lang.String">+</span><a href="#81429" title="java.lang.Throwable">e</a>.<a title="()java.lang.String" id="17833">toString</a>); <span title="object None">None</span> }

		<span class="comment">// runs after compilation</span>
		<span class="keyword">def</span> <a title="()Unit" id="81410">analyze</a>()
		{
			<span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Path]" id="81431">allClasses</a> = <span title="(sbt.Path*)scala.collection.immutable.Set[sbt.Path]">Set</span>(<a href="#81407" title="sbt.PathFinder">classesFinder</a>.<a href="../Path.scala.html#49335" title="=&gt; scala.collection.Set[sbt.Path]">get</a>.<span title="=&gt; Seq[sbt.Path]">toSeq</span> : _*)
			<span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Path]" id="81432">newClasses</a> = <a href="#81431" title="scala.collection.immutable.Set[sbt.Path]">allClasses</a> <span title="(Iterable[sbt.Path])scala.collection.immutable.Set[sbt.Path]">--</span> <a href="#81408" title="scala.collection.Set[sbt.Path]">existingClasses</a> <span title="(Iterable[sbt.Path])scala.collection.immutable.Set[sbt.Path]">--</span> <a href="#53949" title="=&gt; scala.collection.Set[sbt.Path]">allProducts</a>
			
			<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]" id="81433">productToSource</a> = <span title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]">HashMap</span>[Path, Path]
			<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]" id="81434">sourceToClassFiles</a> = <span title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]" class="keyword">new</span> mutable.<span title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]">HashMap</span>[Path, Buffer[ClassFile]]

			<span class="keyword">val</span> <a title="Iterable[Class[_]]" id="81435">superclasses</a> = <a href="#53950" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#50706" title="=&gt; Iterable[String]">superclassNames</a> <a title="((String) =&gt; Iterable[Class[_]])Iterable[Class[_]]" id="15944">flatMap</a> { <a title="String" id="81443">tpe</a> =&gt; <a href="#81409" title="(Option[Class[_]])Iterable[Class[_]]" id="902">load</a>(<a href="#81443" title="String">tpe</a>, <span title="java.lang.String(&quot;Could not load superclass '&quot;)" class="string">&quot;Could not load superclass '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#81443" title="String">tpe</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;'&quot;)" class="string">&quot;'&quot;</span>) }
			<span class="keyword">val</span> <a title="Iterable[String]" id="81436">annotations</a> = <a href="#53950" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#50707" title="=&gt; Iterable[String]">annotationNames</a>

			<span class="keyword">def</span> <a title="(Seq[java.lang.annotation.Annotation])Iterable[String]" id="81437">annotated</a>(<a title="Seq[java.lang.annotation.Annotation]" id="81451">fromClass</a>: <a title="Seq[java.lang.annotation.Annotation]" id="733">Seq</a>[Annotation]) = <span title="Iterable[String]" class="keyword">if</span>(<a href="#81451" title="Seq[java.lang.annotation.Annotation]">fromClass</a>.<a title="=&gt; Boolean" id="15804">isEmpty</a>) <span title="object Nil">Nil</span> <span class="keyword">else</span> <a href="#81436" title="Iterable[String]">annotations</a>.<span title="((String) =&gt; Boolean)Iterable[String]">filter</span>(<span title="(java.lang.String*)scala.collection.immutable.Set[java.lang.String]">Set</span>() <a title="(Iterable[java.lang.String])scala.collection.immutable.Set[java.lang.String]" id="16726">++</a> <a href="#81451" title="Seq[java.lang.annotation.Annotation]">fromClass</a>.<a title="((java.lang.annotation.Annotation) =&gt; java.lang.String)Seq[java.lang.String]" id="15820">map</a>(<a href="#81476" title="java.lang.annotation.Annotation">_</a>.<a title="()java.lang.Class[_ &lt;: java.lang.annotation.Annotation]" id="81456">annotationType</a>.<span title="()java.lang.String">getName</span>))

			<span class="comment">// parse class files and assign classes to sources.  This must be done before dependencies, since the information comes</span>
			<span class="comment">// as class-&gt;class dependencies that must be mapped back to source-&gt;class dependencies using the source+class assignment</span>
			<span class="keyword">for</span>(<a title="((sbt.Path) =&gt; Unit)Unit" id="81479">newClass</a> &lt;- <a href="#81432" title="scala.collection.immutable.Set[sbt.Path]">newClasses</a>;
				<a title="(((sbt.Path, sbt.classfile.ClassFile)) =&gt; Unit)Unit" id="81552">path</a> &lt;- <a href="../Path.scala.html#11863" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#49311" title="(sbt.Path,sbt.Path)Option[sbt.Path]">relativize</a>(<a href="#53945" title="sbt.Path">outputDirectory</a>, <a href="#81479" title="sbt.Path">newClass</a>);
				<a title="sbt.classfile.ClassFile" id="81553">classFile</a> = <a href="Parser.scala.html#81487" title="(java.io.File,sbt.Logger)sbt.classfile.ClassFile">Parser</a>(<a href="#81479" title="sbt.Path">newClass</a>.<a href="../Path.scala.html#49359" title="=&gt; java.io.File">asFile</a>, <a href="#53948" title="sbt.Logger">log</a>);
				<a title="((String) =&gt; Unit)Unit" id="81602">sourceFile</a> &lt;- <a href="#81553" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#81545" title="=&gt; Option[String]">sourceFile</a> <span title="(=&gt; Option[String])Option[String]">orElse</span> <a href="#53926" title="(String)Some[String]">guessSourceName</a>(<a href="#81479" title="sbt.Path">newClass</a>.<a href="../Path.scala.html#49359" title="=&gt; java.io.File">asFile</a>.<a title="()java.lang.String" id="16759">getName</a>);
				<a title="((sbt.Path) =&gt; Unit)Unit" id="81658">source</a> &lt;- <a href="#53932" title="(scala.collection.Set[sbt.Path],Iterable[sbt.Path],sbt.classfile.ClassFile,sbt.Logger)List[sbt.Path]">guessSourcePath</a>(<a href="#81406" title="scala.collection.immutable.Set[sbt.Path]">sourceSet</a>, <a href="#53947" title="Iterable[sbt.Path]">roots</a>, <a href="#81553" title="sbt.classfile.ClassFile">classFile</a>, <a href="#53948" title="sbt.Logger">log</a>))
			{
				<a href="#53950" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#50710" title="(sbt.Path)Unit">beginSource</a>(<a href="#81658" title="sbt.Path">source</a>)
				<a href="#53950" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#50717" title="(sbt.Path,sbt.Path)Unit">generatedClass</a>(<a href="#81658" title="sbt.Path">source</a>, <a href="#81552" title="sbt.Path">path</a>)
				<a href="#81433" title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]">productToSource</a>(<a href="#81552" title="sbt.Path">path</a>) = <a href="#81658" title="sbt.Path">source</a>
				<a href="#81434" title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]">sourceToClassFiles</a>.<a title="(sbt.Path,=&gt; scala.collection.mutable.Buffer[sbt.classfile.ClassFile])scala.collection.mutable.Buffer[sbt.classfile.ClassFile]" id="37804">getOrElseUpdate</a>(<a href="#81658" title="sbt.Path">source</a>, <span title="scala.collection.mutable.ArrayBuffer[sbt.classfile.ClassFile]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[sbt.classfile.ClassFile]">ArrayBuffer</span>[ClassFile]) <a title="(sbt.classfile.ClassFile)Unit" id="45005">+=</a> <a href="#81553" title="sbt.classfile.ClassFile">classFile</a>
			}
			
			<span class="comment">// get class to class dependencies and map back to source to class dependencies</span>
			<span class="keyword">for</span>( <a href="#81660" title="(((sbt.Path, scala.collection.mutable.Buffer[sbt.classfile.ClassFile])) =&gt; Unit)Unit">(</a><a title="sbt.Path" id="81665">source</a>, <a title="scala.collection.mutable.Buffer[sbt.classfile.ClassFile]" id="81666">classFiles</a>) &lt;- <a href="#81434" title="scala.collection.mutable.HashMap[sbt.Path,scala.collection.mutable.Buffer[sbt.classfile.ClassFile]]">sourceToClassFiles</a> )
			{
				<span class="keyword">for</span>(<a title="((sbt.classfile.ClassFile) =&gt; Unit)Unit" id="81680">classFile</a> &lt;- <a href="#81666" title="scala.collection.mutable.Buffer[sbt.classfile.ClassFile]">classFiles</a> <span class="keyword">if</span> <a href="#53933" title="(sbt.classfile.ClassFile)Boolean">isTopLevel</a>(<a href="#81680" title="sbt.classfile.ClassFile">classFile</a>);
					<a title="((Class[_]) =&gt; Unit)Unit" id="81682">cls</a> &lt;- <a href="#81409" title="(String,=&gt; String)Option[Class[_]]">load</a>(<a href="#81680" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#81537" title="=&gt; String">className</a>, <span title="java.lang.String(&quot;Could not load '&quot;)" class="string">&quot;Could not load '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#81680" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#81537" title="=&gt; String">className</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' to check for superclasses.&quot;)" class="string">&quot;' to check for superclasses.&quot;</span>) )
				{
					<span class="keyword">for</span>(<a title="((Class[_]) =&gt; Unit)Unit" id="81685">superclass</a> &lt;- <a href="#81435" title="Iterable[Class[_]]">superclasses</a>)
						<span title="Unit" class="keyword">if</span>(<a href="#81685" title="Class[_]">superclass</a>.<a title="(java.lang.Class[_])Boolean" id="3920">isAssignableFrom</a>(<a href="#81682" title="Class[_]">cls</a>))
							<a href="#53950" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#50711" title="(sbt.Path,String,String,Boolean)Unit">foundSubclass</a>(<a href="#81665" title="sbt.Path">source</a>, <a href="#81680" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#81537" title="=&gt; String">className</a>, <a href="#81685" title="Class[_]">superclass</a>.<span title="()java.lang.String">getName</span>, <span title="Boolean(false)" class="keyword">false</span>)

					<span class="keyword">val</span> <a title="scala.collection.mutable.ArrayBuffer[String]" id="81683">annotations</a> = <span title="scala.collection.mutable.ArrayBuffer[String]" class="keyword">new</span> <span title="scala.collection.mutable.ArrayBuffer[String]">ArrayBuffer</span>[String]
					<a href="#81683" title="scala.collection.mutable.ArrayBuffer[String]">annotations</a> <span title="(Iterable[String])Unit">++=</span> <a href="#81437" title="(Seq[java.lang.annotation.Annotation])Iterable[String]">annotated</a>(<a href="#81682" title="Class[_]">cls</a>.<a title="()Array[java.lang.annotation.Annotation]" id="5970">getAnnotations</a>)
					<span class="keyword">for</span>(<a title="((java.lang.reflect.Method) =&gt; Unit)Unit" id="81690">method</a> &lt;- <a href="#81682" title="Class[_]">cls</a>.<a title="()Array[java.lang.reflect.Method]" id="4318">getMethods</a>)
					{
						<a href="#81683" title="scala.collection.mutable.ArrayBuffer[String]">annotations</a> <span title="(Iterable[String])Unit">++=</span> <a href="#81437" title="(Seq[java.lang.annotation.Annotation])Iterable[String]">annotated</a>(<a href="#81690" title="java.lang.reflect.Method">method</a>.<a title="()Array[java.lang.annotation.Annotation]" id="19426">getAnnotations</a>)
						<span title="Unit" class="keyword">if</span>(<a href="#53938" title="(java.lang.reflect.Method)Boolean">isMain</a>(<a href="#81690" title="java.lang.reflect.Method">method</a>))
							<a href="#53950" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#50719" title="(sbt.Path,String)Unit">foundApplication</a>(<a href="#81665" title="sbt.Path">source</a>, <a href="#81680" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#81537" title="=&gt; String">className</a>)
					}
					<a href="#81683" title="scala.collection.mutable.ArrayBuffer[String]">annotations</a>.<span title="((String) =&gt; Unit)Unit">foreach</span> { <a title="String" id="81697">ann</a> =&gt; <a href="#53950" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#50712" title="(sbt.Path,String,String,Boolean)Unit">foundAnnotated</a>(<a href="#81665" title="sbt.Path">source</a>, <a href="#81680" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#81537" title="=&gt; String">className</a>, <a href="#81697" title="String">ann</a>, <span title="Boolean(false)" class="keyword">false</span>) }
				}
				<span class="keyword">def</span> <a title="(String)Unit" id="81667">processDependency</a>(<a title="String" id="81698">tpe</a>: <span title="String">String</span>)
				{
					<a href="../Control.scala.html#13546" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#50237" title="(sbt.Logger)(=&gt; Unit)Unit">trapAndLog</a>(<a href="#53948" title="sbt.Logger">log</a>)
					{
						<span class="keyword">val</span> <a title="Option[Class[_]]" id="81699">loaded</a> = <a href="#81409" title="(String,=&gt; String)Option[Class[_]]">load</a>(<a href="#81698" title="String">tpe</a>, <span title="java.lang.String(&quot;Problem processing dependencies of source &quot;)" class="string">&quot;Problem processing dependencies of source &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#81665" title="sbt.Path">source</a>)
						<span class="keyword">for</span>(<a title="((Class[_]) =&gt; Unit)Unit" id="81701">clazz</a> &lt;- <a href="#81699" title="Option[Class[_]]">loaded</a>; <a title="((java.io.File) =&gt; Unit)Unit" id="81708">file</a> &lt;- <a href="../Control.scala.html#13546" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#50238" title="(=&gt; java.io.File)Either[Exception,java.io.File]">convertException</a>(<a href="../FileUtilities.scala.html#10717" title="object sbt.FileUtilities">FileUtilities</a>.<a href="../FileUtilities.scala.html#49273" title="(Class[_])java.io.File">classLocationFile</a>(<a href="#81701" title="Class[_]">clazz</a>)).<a title="=&gt; Either.RightProjection[Exception,java.io.File]" id="50352">right</a>)
						{
							<span title="Unit" class="keyword">if</span>(<a href="#81708" title="java.io.File">file</a>.<a title="()Boolean" id="16773">isDirectory</a>)
							{
								<span class="keyword">val</span> <a title="java.io.File" id="81709">resolved</a> = <a href="#53931" title="(java.io.File,String)java.io.File">resolveClassFile</a>(<a href="#81708" title="java.io.File">file</a>, <a href="#81698" title="String">tpe</a>)
								<a title="(Boolean,Any)Unit" id="6482">assume</a>(<a href="#81709" title="java.io.File">resolved</a>.<a title="()Boolean" id="16772">exists</a>, <span title="java.lang.String(&quot;Resolved class file &quot;)" class="string">&quot;Resolved class file &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#81709" title="java.io.File">resolved</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; from &quot;)" class="string">&quot; from &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#81665" title="sbt.Path">source</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; did not exist&quot;)" class="string">&quot; did not exist&quot;</span>)
								<span class="keyword">val</span> <a title="sbt.Path" id="81710">resolvedPath</a> = <a href="../Path.scala.html#11863" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#49318" title="(java.io.File)sbt.Path">fromFile</a>(<a href="#81709" title="java.io.File">resolved</a>)
								<span title="Unit" class="keyword">if</span>(<a href="../Path.scala.html#11863" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#49318" title="(java.io.File)sbt.Path">fromFile</a>(<a href="#81708" title="java.io.File">file</a>) <span title="(AnyRef)Boolean">==</span> <a href="#53945" title="sbt.Path">outputDirectory</a>)
								{
									<a href="#81433" title="scala.collection.mutable.HashMap[sbt.Path,sbt.Path]">productToSource</a>.<a title="(sbt.Path)Option[sbt.Path]" id="37886">get</a>(<a href="#81710" title="sbt.Path">resolvedPath</a>) <span title="Unit" class="keyword">match</span>
									{
										<span title="Unit" class="keyword">case</span> Some(<a title="sbt.Path" id="81724">dependsOn</a>) =&gt; <a href="#53950" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#50713" title="(sbt.Path,sbt.Path)Unit">sourceDependency</a>(<a href="#81724" title="sbt.Path">dependsOn</a>, <a href="#81665" title="sbt.Path">source</a>)
										<span title="Unit" class="keyword">case</span> <span title="object None">None</span> =&gt; <a href="#53950" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#50716" title="(sbt.Path,sbt.Path)Unit">productDependency</a>(<a href="#81710" title="sbt.Path">resolvedPath</a>, <a href="#81665" title="sbt.Path">source</a>)
									}
								}
								<span class="keyword">else</span>
									<a href="#53950" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#50715" title="(java.io.File,sbt.Path)Unit">classDependency</a>(<a href="#81709" title="java.io.File">resolved</a>, <a href="#81665" title="sbt.Path">source</a>)
							}
							<span class="keyword">else</span>
								<a href="#53950" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#50714" title="(java.io.File,sbt.Path)Unit">jarDependency</a>(<a href="#81708" title="java.io.File">file</a>, <a href="#81665" title="sbt.Path">source</a>)
						}
					}
				}
				
				<a href="#81666" title="scala.collection.mutable.Buffer[sbt.classfile.ClassFile]">classFiles</a>.<a title="((sbt.classfile.ClassFile) =&gt; Iterable[String])Seq[String]" id="15822">flatMap</a>(<a href="#81727" title="sbt.classfile.ClassFile">_</a>.<a href="ClassFile.scala.html#81546" title="=&gt; Set[String]">types</a>).<span title="((String) =&gt; Unit)Unit">foreach</span>(<a href="#81667" title="(String)Unit">processDependency</a>)
				<a href="#53950" title="sbt.AnalysisCallback">analysis</a>.<a href="../AnalysisCallback.scala.html#50718" title="(sbt.Path)Unit">endSource</a>(<a href="#81665" title="sbt.Path">source</a>)
			}
		}
		
		<a href="#53952" title="=&gt; Option[String]">compile</a> <span title="(=&gt; Option[String])Option[String]">orElse</span> <a href="../Control.scala.html#13546" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#50241" title="(sbt.Logger)(=&gt; Unit)Either[String,Unit]">convertErrorMessage</a>(<a href="#53948" title="sbt.Logger">log</a>)(<a href="#81410" title="()Unit">analyze</a>()).<a title="=&gt; Either.LeftProjection[String,Unit]" id="50265">left</a>.<a title="=&gt; Option[String]" id="50287">toOption</a>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String)Some[String]" id="53926">guessSourceName</a>(<a title="String" id="81556">name</a>: <span title="String">String</span>) = <span title="(String)Some[String]">Some</span>( <a href="#53927" title="(String)String">takeToDollar</a>(<a href="#53930" title="(String)java.lang.String">trimClassExt</a>(<a href="#81556" title="String">name</a>)) )
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String)String" id="53927">takeToDollar</a>(<a title="String" id="81559">name</a>: <span title="String">String</span>) =
	{
		<span class="keyword">val</span> <a title="Int" id="81561">dollar</a> = <a href="#81559" title="String">name</a>.<span title="(Int)Int">indexOf</span>(<span title="Int(36)" class="char">'$'</span>)
		<span title="String" class="keyword">if</span>(<a href="#81561" title="Int">dollar</a> <span title="(Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span>) <a href="#81559" title="String">name</a> <span class="keyword">else</span> <a href="#81559" title="String">name</a>.<span title="(Int,Int)java.lang.String">substring</span>(<span title="Int(0)" class="int">0</span>, <a href="#81561" title="Int">dollar</a>)
	}
	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">val</span> <a title="java.lang.String(&quot;.class&quot;)" id="53928">ClassExt</a> = <span title="java.lang.String(&quot;.class&quot;)" class="string">&quot;.class&quot;</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String)java.lang.String" id="53930">trimClassExt</a>(<a title="String" id="81577">name</a>: <span title="String">String</span>) = <span title="java.lang.String" class="keyword">if</span>(<a href="#81577" title="String">name</a>.<a title="(java.lang.String)Boolean" id="6375">endsWith</a>(<span title="java.lang.String(&quot;.class&quot;)">ClassExt</span>)) <a href="#81577" title="String">name</a>.<span title="(Int,Int)java.lang.String">substring</span>(<span title="Int(0)" class="int">0</span>, <a href="#81577" title="String">name</a>.<span title="()Int">length</span> <span title="(Int)Int">-</span> <span title="java.lang.String(&quot;.class&quot;)">ClassExt</span>.<span title="()Int">length</span>) <span class="keyword">else</span> <a href="#81577" title="String">name</a>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(java.io.File,String)java.io.File" id="53931">resolveClassFile</a>(<a title="java.io.File" id="81711">file</a>: <span title="java.io.File">File</span>, <a title="String" id="81712">className</a>: <span title="String">String</span>): <span title="java.io.File">File</span> = (<a href="#81711" title="java.io.File">file</a> <a href="#81733" title="(java.io.File)((java.io.File, java.lang.String) =&gt; java.io.File)java.io.File" id="15963">/:</a> (<a href="#81712" title="String">className</a>.<a title="(Char,Char)java.lang.String" id="6391">replace</a>(<span title="Char('.')" class="char">'.'</span>,<span title="Char('/')" class="char">'/'</span>) <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.class&quot;)">ClassExt</span>).<span title="(java.lang.String)Array[java.lang.String]">split</span>(<span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>))(<a title="(java.io.File,java.lang.String)java.io.File" id="16757" class="keyword">new</a> <span title="java.io.File">File</span>(<a href="#81738" title="java.io.File">_</a>, <a href="#81739" title="java.lang.String">_</a>))
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(scala.collection.Set[sbt.Path],Iterable[sbt.Path],sbt.classfile.ClassFile,sbt.Logger)List[sbt.Path]" id="53932">guessSourcePath</a>(<a title="scala.collection.Set[sbt.Path]" id="81603">sources</a>: scala.collection.<a title="scala.collection.Set[sbt.Path]" id="16103">Set</a>[Path], <a title="Iterable[sbt.Path]" id="81604">roots</a>: <span title="Iterable[sbt.Path]">Iterable</span>[Path], <a title="sbt.classfile.ClassFile" id="81605">classFile</a>: <a href="ClassFile.scala.html#14163" title="sbt.classfile.ClassFile">ClassFile</a>, <a title="sbt.Logger" id="81606">log</a>: <a href="../Logger.scala.html#13533" title="sbt.Logger">Logger</a>) =
	{
		<span class="keyword">val</span> <a title="Array[java.lang.String]" id="81608">classNameParts</a> = <a href="#81605" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#81537" title="=&gt; String">className</a>.<span title="(java.lang.String)Array[java.lang.String]">split</span>(<span title="java.lang.String(&quot;\.&quot;)" class="string">&quot;&quot;&quot;\.&quot;&quot;&quot;</span>)
		<span class="keyword">val</span> <a title="Int" id="81609">lastIndex</a> = <a href="#81608" title="Array[java.lang.String]">classNameParts</a>.<a title="=&gt; Int" id="15677">length</a> <span title="(Int)Int">-</span> <span title="Int(1)" class="int">1</span>
		<span class="keyword">val</span> <a title="Array.Projection[java.lang.String]" id="81610">pkg</a> = <a href="#81608" title="Array[java.lang.String]">classNameParts</a>.<a title="(Int)Array.Projection[java.lang.String]" id="15660">take</a>(<a href="#81609" title="Int">lastIndex</a>)
		<span class="keyword">val</span> <a title="java.lang.String" id="81611">simpleClassName</a> = <a href="#81608" title="(Int)java.lang.String" id="15678">classNameParts</a>(<a href="#81609" title="Int">lastIndex</a>)
		<span class="keyword">val</span> <a title="String" id="81612">sourceFileName</a> = <a href="#81605" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#81545" title="=&gt; Option[String]">sourceFile</a>.<a title="(=&gt; String)String" id="30329">getOrElse</a>(<a href="#81611" title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString" id="6615">simpleClassName</a>.<a title="((Char) =&gt; Boolean)Seq[Char]" id="15829">takeWhile</a>(<a href="#81630" title="Char">_</a> <a title="(Char)Boolean" id="2962">!=</a> <span title="Char('$')" class="char">'$'</span>).<a title="(String,String,String)String" id="15978">mkString</a>(<span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span>, <span title="java.lang.String(&quot;.java&quot;)" class="string">&quot;.java&quot;</span>))
		<span class="keyword">val</span> <a title="String" id="81613">relativeSourceFile</a> = (<a href="#81610" title="Array.Projection[java.lang.String]">pkg</a> <a title="(Iterable[java.lang.String])RandomAccessSeq[java.lang.String]" id="15750">++</a> (<a href="#81612" title="String">sourceFileName</a> <a href="#81643" title="(String)List[String]" id="15504">::</a> <span title="object Nil">Nil</span>)).<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>)
		<span class="keyword">val</span> <a title="List[sbt.Path]" id="81614">candidates</a> = <a href="#81604" title="Iterable[sbt.Path]">roots</a>.<a title="((sbt.Path) =&gt; sbt.Path)Iterable[sbt.Path]" id="15942">map</a>(<a title="sbt.Path" id="81649">root</a> =&gt; <a href="../Path.scala.html#11863" title="object sbt.Path">Path</a>.<a href="../Path.scala.html#49309" title="(sbt.Path,String)sbt.Path">fromString</a>(<a href="#81649" title="sbt.Path">root</a>, <a href="#81613" title="String">relativeSourceFile</a>)).<span title="((sbt.Path) =&gt; Boolean)Iterable[sbt.Path]">filter</span>(<a href="#81603" title="scala.collection.Set[sbt.Path]">sources</a>.<a href="#81651" title="(sbt.Path)Boolean" id="17965">contains</a>).<span title="=&gt; List[sbt.Path]">toList</span>
		<a href="#81614" title="List[sbt.Path]">candidates</a> <span title="Unit" class="keyword">match</span>
		{
			<span title="Unit" class="keyword">case</span> <span title="object Nil">Nil</span> =&gt; <a href="#81606" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#49386" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;Could not determine source for class &quot;)" class="string">&quot;Could not determine source for class &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#81605" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#81537" title="=&gt; String">className</a>)
			<span title="Unit" class="keyword">case</span> <a title="sbt.Path" id="81653">head</a> :: <span title="object Nil">Nil</span> =&gt; <span title="Unit">(</span>)
			<span title="Unit" class="keyword">case</span> _ =&gt;<a href="#81606" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#49386" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;Multiple sources matched for class &quot;)" class="string">&quot;Multiple sources matched for class &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#81605" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#81537" title="=&gt; String">className</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#81614" title="List[sbt.Path]">candidates</a>.<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot;, &quot;)" class="string">&quot;, &quot;</span>))
		}
		<a href="#81614" title="List[sbt.Path]">candidates</a>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.classfile.ClassFile)Boolean" id="53933">isTopLevel</a>(<a title="sbt.classfile.ClassFile" id="81670">classFile</a>: <a href="ClassFile.scala.html#14163" title="sbt.classfile.ClassFile">ClassFile</a>) = <a href="#81670" title="sbt.classfile.ClassFile">classFile</a>.<a href="ClassFile.scala.html#81537" title="=&gt; String">className</a>.<span title="(Int)Int">indexOf</span>(<span title="Int(36)" class="char">'$'</span>) <span title="(Int)Boolean">&lt;</span> <span title="Int(0)" class="int">0</span>
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.lang.Class[Unit]" id="53935">unit</a> = <span title="java.lang.Class[Unit]">classOf</span>[Unit]
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="List[java.lang.Class[Array[String]]]" id="53937">strArray</a> = <a title="(java.lang.Class[Array[String]]*)List[java.lang.Class[Array[String]]]" id="500">List</a>(<span title="java.lang.Class[Array[String]]">classOf</span>[Array[String]])

	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(java.lang.reflect.Method)Boolean" id="53938">isMain</a>(<a title="java.lang.reflect.Method" id="81695">method</a>: <a title="java.lang.reflect.Method" id="3843">Method</a>): <span title="Boolean">Boolean</span> =
		<a href="#81695" title="java.lang.reflect.Method">method</a>.<a title="()java.lang.String" id="19379">getName</a> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;main&quot;)" class="string">&quot;main&quot;</span> <span title="(Boolean)Boolean">&amp;&amp;</span>
		<a href="#53939" title="(Int)Boolean">isMain</a>(<a href="#81695" title="java.lang.reflect.Method">method</a>.<a title="()Int" id="19380">getModifiers</a>) <span title="(Boolean)Boolean">&amp;&amp;</span>
		<a href="#81695" title="java.lang.reflect.Method">method</a>.<a title="()java.lang.Class[_]" id="19384">getReturnType</a> <span title="(AnyRef)Boolean">==</span> <a href="#53934" title="=&gt; java.lang.Class[Unit]">unit</a> <span title="(Boolean)Boolean">&amp;&amp;</span>
		<a href="#81695" title="java.lang.reflect.Method">method</a>.<a title="()Array[java.lang.Class[_]]" id="19388">getParameterTypes</a>.<span title="=&gt; List[java.lang.Class[_]]">toList</span> <span title="(AnyRef)Boolean">==</span> <a href="#53936" title="=&gt; List[java.lang.Class[Array[String]]]">strArray</a>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(Int)Boolean" id="53939">isMain</a>(<a title="Int" id="81694">modifiers</a>: <a title="Int" id="2346">Int</a>): <span title="Boolean">Boolean</span> = (<a href="#81694" title="Int">modifiers</a> <span title="(Int)Int">&amp;</span> <a href="#53940" title="=&gt; Int">mainModifiers</a>) <span title="(Int)Boolean">==</span> <a href="#53940" title="=&gt; Int">mainModifiers</a> <span title="(Boolean)Boolean">&amp;&amp;</span> (<a href="#81694" title="Int">modifiers</a> <span title="(Int)Int">&amp;</span> <a href="#53942" title="=&gt; Int">notMainModifiers</a>) <span title="(Int)Boolean">==</span> <span title="Int(0)" class="int">0</span>
	
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="53940">mainModifiers</a> = STATIC  <span title="Int(9)">|</span> PUBLIC
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="Int" id="53942">notMainModifiers</a> = <span title="Int(1024)">ABSTRACT</span>
}
        </pre>
    </body>
</html>