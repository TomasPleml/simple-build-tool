<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/Resources.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2008, 2009  Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> xsbti.AppProvider
<span class="keyword">import</span> FileUtilities._

<span class="keyword">object</span> <a title="object sbt.Resources" id="10285">Resources</a>
{
	<span class="keyword">def</span> <a title="(String)sbt.Resources" id="73390">apply</a>(<a title="String" id="73394">basePath</a>: <span title="String">String</span>) =
	{
		<span title="(Boolean)Unit">require</span>(<a href="#73394" title="String">basePath</a>.<a title="(java.lang.String)Boolean" id="6374">startsWith</a>(<span title="java.lang.String(&quot;/&quot;)" class="string">&quot;/&quot;</span>))
		<span class="keyword">val</span> <a title="java.net.URL" id="73396">resource</a> = <a title="()java.lang.Class[_]" id="3454">getClass</a>.<a title="(java.lang.String)java.net.URL" id="4722">getResource</a>(<a href="#73394" title="String">basePath</a>)
		<span title="sbt.Resources" class="keyword">if</span>(<a href="#73396" title="java.net.URL">resource</a> <a title="(AnyRef)Boolean" id="3452">==</a> <span title="Null(null)" class="keyword">null</span>)
			<span title="(String)Nothing">error</span>(<span title="java.lang.String(&quot;Resource base directory '&quot;)" class="string">&quot;Resource base directory '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73394" title="String">basePath</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' not on classpath.&quot;)" class="string">&quot;' not on classpath.&quot;</span>)
		<span class="keyword">else</span>
		{
			<span class="keyword">val</span> <a title="java.io.File" id="73401">file</a> = <a href="FileUtilities.scala.html#49269" title="(java.net.URL)java.io.File">toFile</a>(<a href="#73396" title="java.net.URL">resource</a>)
			<span title="sbt.Resources" class="keyword">if</span>(<a href="#73401" title="java.io.File">file</a>.<a title="()Boolean" id="16772">exists</a>)
				<span title="sbt.Resources" class="keyword">new</span> <a href="#10284" title="sbt.Resources">Resources</a>(<a href="#73401" title="java.io.File">file</a>)
			<span class="keyword">else</span>
				<span title="(String)Nothing">error</span>(<span title="java.lang.String(&quot;Resource base directory '&quot;)" class="string">&quot;Resource base directory '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73394" title="String">basePath</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' does not exist.&quot;)" class="string">&quot;' does not exist.&quot;</span>)
		}
	}
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="73391">LoadErrorPrefix</a> = <span title="java.lang.String(&quot;Error loading initial project: &quot;)" class="string">&quot;Error loading initial project: &quot;</span>
}

<span class="keyword">class</span> <a title="class Resources extends java.lang.Object with ScalaObject" id="10284">Resources</a>(<span class="keyword">val</span> <a title="java.io.File" id="73414">baseDirectory</a>: <span title="java.io.File">File</span>)
{
	<span class="keyword">import</span> Resources._
	<span class="comment">// The returned directory is not actually read-only, but it should be treated that way</span>
	<span class="keyword">def</span> <a title="(String,String)Either[String,java.io.File]" id="73407">readOnlyResourceDirectory</a>(<a title="String" id="73417">group</a>: <span title="String">String</span>, <a title="String" id="73418">name</a>: <span title="String">String</span>): <span title="Either[String,java.io.File]">Either</span>[String, File] =
	{
		<span class="keyword">val</span> <a title="java.io.File" id="73419">groupDirectory</a> = <span title="(java.io.File,java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span>(<a href="#73414" title="=&gt; java.io.File">baseDirectory</a>, <a href="#73417" title="String">group</a>)
		<span title="Either[String,java.io.File]" class="keyword">if</span>(<a href="#73419" title="java.io.File">groupDirectory</a>.<span title="()Boolean">isDirectory</span>)
		{
			<span class="keyword">val</span> <a title="java.io.File" id="73435">resourceDirectory</a> = <span title="(java.io.File,java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span>(<a href="#73419" title="java.io.File">groupDirectory</a>, <a href="#73418" title="String">name</a>)
			<span title="Either[String,java.io.File]" class="keyword">if</span>(<a href="#73435" title="java.io.File">resourceDirectory</a>.<span title="()Boolean">isDirectory</span>)
				<a title="(java.io.File)Right[Nothing,java.io.File]" id="494">Right</a>(<a href="#73435" title="java.io.File">resourceDirectory</a>)
			<span class="keyword">else</span>
				<span title="(java.lang.String)Left[java.lang.String,Nothing]">Left</span>(<span title="java.lang.String(&quot;Resource directory '&quot;)" class="string">&quot;Resource directory '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73418" title="String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' in group '&quot;)" class="string">&quot;' in group '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73417" title="String">group</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' not found.&quot;)" class="string">&quot;' not found.&quot;</span>)
		}
		<span class="keyword">else</span>
			<span title="(java.lang.String)Left[java.lang.String,Nothing]">Left</span>(<span title="java.lang.String(&quot;Group '&quot;)" class="string">&quot;Group '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73417" title="String">group</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;' not found.&quot;)" class="string">&quot;' not found.&quot;</span>)
	}
	<span class="keyword">def</span> <a title="[T](String,String,sbt.Logger)((java.io.File) =&gt; Either[String,T])Either[String,T]" id="73408">readWriteResourceDirectory</a>[<a title="&gt;: Nothing &lt;: Any" id="73410">T</a>](<a title="String" id="73456">group</a>: <span title="String">String</span>, <a title="String" id="73457">name</a>: <span title="String">String</span>, <a title="sbt.Logger" id="73458">log</a>: <a href="Logger.scala.html#13533" title="sbt.Logger">Logger</a>)
		(<a title="(java.io.File) =&gt; Either[String,T]" id="73459">withDirectory</a>: File =&gt; Either[String, T]): <span title="Either[String,T]">Either</span>[String, T] =
			<a href="#73407" title="(String,String)Either[String,java.io.File]">readOnlyResourceDirectory</a>(<a href="#73456" title="String">group</a>, <a href="#73457" title="String">name</a>).<span title="=&gt; Either.RightProjection[String,java.io.File]">right</span> <span title="((java.io.File) =&gt; Either[String,T])Either[String,T]">flatMap</span>(<a title="java.io.File" id="73465">file</a> =&gt; <a href="#73411" title="(java.io.File,sbt.Logger)((java.io.File) =&gt; Either[String,T])Either[String,T]">readWriteResourceDirectory</a>(<a href="#73465" title="java.io.File">file</a>, <a href="#73458" title="sbt.Logger">log</a>)(<a href="#73459" title="(java.io.File) =&gt; Either[String,T]">withDirectory</a>))
	<span class="keyword">def</span> <a title="[T](java.io.File,sbt.Logger)((java.io.File) =&gt; Either[String,T])Either[String,T]" id="73411">readWriteResourceDirectory</a>[<a title="&gt;: Nothing &lt;: Any" id="73413">T</a>](<a title="java.io.File" id="73467">readOnly</a>: <span title="java.io.File">File</span>, <a title="sbt.Logger" id="73468">log</a>: <a href="Logger.scala.html#13533" title="sbt.Logger">Logger</a>)
		(<a title="(java.io.File) =&gt; Either[String,T]" id="73469">withDirectory</a>: File =&gt; Either[String, T]): <span title="Either[String,T]">Either</span>[String, T] =
	{
		<span title="(Boolean)Unit">require</span>(<a href="#73467" title="java.io.File">readOnly</a>.<span title="()Boolean">isDirectory</span>)
		<span class="keyword">def</span> <a title="(java.io.File)(java.io.File)Either[String,T]" id="73473">readWrite</a>(<a title="java.io.File" id="73475">readOnly</a>: <span title="java.io.File">File</span>)(<a title="java.io.File" id="73476">temporary</a>: <span title="java.io.File">File</span>): <span title="Either[String,T]">Either</span>[String, T] =
		{
			<span class="keyword">val</span> <a title="java.io.File" id="73477">readWriteDirectory</a> = <span title="(java.io.File,java.lang.String)java.io.File" class="keyword">new</span> <span title="java.io.File">File</span>(<a href="#73476" title="java.io.File">temporary</a>, <a href="#73475" title="java.io.File">readOnly</a>.<a title="()java.lang.String" id="16759">getName</a>)
			<a href="FileUtilities.scala.html#10717" title="object sbt.FileUtilities">FileUtilities</a>.<a href="FileUtilities.scala.html#49217" title="(java.io.File,java.io.File,sbt.Logger)Option[String]">copyDirectory</a>(<a href="#73475" title="java.io.File">readOnly</a>, <a href="#73477" title="java.io.File">readWriteDirectory</a>, <a href="#73468" title="sbt.Logger">log</a>).<a title="(=&gt; Unit)Either[String,Unit] with Product" id="30343">toLeft</a>(<span title="Unit">(</span>)).<span title="=&gt; Either.RightProjection[String,Unit]">right</span> <span title="((Unit) =&gt; Either[String,T])Either[String,T]">flatMap</span> { <a title="Unit" id="73504">x</a> =&gt;
				<a href="#73469" title="(java.io.File)Either[String,T]" id="15917">withDirectory</a>(<a href="#73477" title="java.io.File">readWriteDirectory</a>)
			}
		}
		<a href="FileUtilities.scala.html#49198" title="(sbt.Logger)((java.io.File) =&gt; Either[String,T])Either[String,T]">doInTemporaryDirectory</a>(<a href="#73468" title="sbt.Logger">log</a>)(<a href="#73473" title="(java.io.File)(java.io.File)Either[String,T]">readWrite</a>(<a href="#73467" title="java.io.File">readOnly</a>))
	}
}
        </pre>
    </body>
</html>