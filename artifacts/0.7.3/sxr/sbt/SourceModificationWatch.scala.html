<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/SourceModificationWatch.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009  Mikko Peltonen, Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="keyword">object</span> <a title="object sbt.SourceModificationWatch" id="6835">SourceModificationWatch</a>
{
	<span class="keyword">def</span> <a title="(sbt.Project,Int)(=&gt; Boolean)(=&gt; Unit)Unit" id="69565">watchUntil</a>(<a title="sbt.Project" id="69567">project</a>: <a href="Project.scala.html#7647" title="sbt.Project">Project</a>, <a title="Int" id="69568">pollDelaySec</a>: <span title="Int">Int</span>)(<a title="=&gt; Boolean" id="69569">terminationCondition</a>: =&gt; Boolean)(<a title="=&gt; Unit" id="69570">onSourcesModified</a>: =&gt; Unit)
	{
		<span class="keyword">def</span> <a title="=&gt; Iterable[java.io.File]" id="69571">sourceFiles</a>: <a title="Iterable[java.io.File]" id="372">Iterable</a>[java.io.File] = <a href="#69572" title="=&gt; sbt.PathFinder">sourcesFinder</a>.<a href="Path.scala.html#15982" title="=&gt; scala.collection.immutable.Set[java.io.File]">getFiles</a>
		<span class="keyword">def</span> <a title="=&gt; sbt.PathFinder" id="69572">sourcesFinder</a>: <a href="Path.scala.html#8754" title="sbt.PathFinder">PathFinder</a> = (<a href="Path.scala.html#10153" title="object sbt.Path">Path</a>.<a href="Path.scala.html#15358" title="=&gt; sbt.PathFinder">emptyPathFinder</a> <a href="#69574" title="(sbt.PathFinder)((sbt.PathFinder, sbt.Project) =&gt; sbt.PathFinder)sbt.PathFinder" id="16081">/:</a> <a href="#69567" title="sbt.Project">project</a>.<a href="Dag.scala.html#14719" title="=&gt; List[sbt.Project]">topologicalSort</a>)(<a href="#69577" title="sbt.PathFinder">_</a> <a href="Path.scala.html#15969" title="(sbt.PathFinder)sbt.PathFinder">+++</a> <a href="#69578" title="sbt.Project">_</a>.<a href="Project.scala.html#14704" title="=&gt; sbt.PathFinder">watchPaths</a>)
		<span class="keyword">def</span> <a title="(Long,Int)Unit" id="69573">loop</a>(<a title="Long" id="69579">lastCallbackCallTime</a>: <a title="Long" id="2356">Long</a>, <a title="Int" id="69580">previousFileCount</a>: <span title="Int">Int</span>)
		{
			<span class="keyword">val</span> <a href="#69582" title="(Long, Int)">(</a><a href="#69581" title="Long" id="69582">lastModifiedTime</a>, <a href="#69581" title="Int" id="69583">fileCount</a>) = <a href="#69571" title="=&gt; Iterable[java.io.File]">sourceFiles</a>.<a title="((Long, Int))(((Long, Int), java.io.File) =&gt; (Long, Int))(Long, Int)" id="16077">foldLeft</a>(<span title="(Long,Int)(Long, Int)">(</span><span title="Long(0L)" class="long">0L</span>, <span title="Int(0)" class="int">0</span>)){(<a title="(Long, Int)" id="69589">acc</a>, <a title="java.io.File" id="69590">file</a>) =&gt; <span title="(Long,Int)(Long, Int)">(</span><a title="object Math" id="574">Math</a>.<a title="(Long,Long)Long" id="69668">max</a>(<a href="#69589" title="(Long, Int)">acc</a>.<span title="=&gt; Long">_1</span>, <a href="#69590" title="java.io.File">file</a>.<a title="()Long" id="16025">lastModified</a>), <a href="#69589" title="(Long, Int)">acc</a>.<span title="=&gt; Int">_2</span> <a title="(Int)Int" id="3095">+</a> <span title="Int(1)" class="int">1</span>)}
			<span class="keyword">val</span> <a title="Long" id="69584">newCallbackCallTime</a> =
				<span class="comment">// check if sources are modified</span>
				<span title="Long" class="keyword">if</span> (<a href="#69582" title="Long">lastModifiedTime</a> <a title="(Long)Boolean" id="3216">&gt;</a> <a href="#69579" title="Long">lastCallbackCallTime</a> <a title="(Boolean)Boolean" id="2698">||</a> <a href="#69580" title="Int">previousFileCount</a> <a title="(Int)Boolean" id="3090">!=</a> <a href="#69583" title="Int">fileCount</a>)
				{
					<span class="keyword">val</span> <a title="Long" id="69761">now</a> = <a title="object java.lang.System" id="1831">System</a>.<a title="()Long" id="34091">currentTimeMillis</a>
					<a href="#69570" title="=&gt; Unit">onSourcesModified</a>
					<a href="#69761" title="Long">now</a>
				}
				<span class="keyword">else</span>
					<a href="#69579" title="Long">lastCallbackCallTime</a>
			<a title="object java.lang.Thread" id="2029">Thread</a>.<a title="(Long)Unit" id="33096">sleep</a>(<a href="#69568" title="Int">pollDelaySec</a> <a title="implicit scala.Predef.int2long : (Int)Long" id="3097">*</a> <span title="Int(1000)" class="int">1000</span>)
			<span title="Unit" class="keyword">if</span>(<a title="=&gt; Boolean" id="2695">!</a><a href="#69569" title="=&gt; Boolean">terminationCondition</a>)
				<a href="#69573" title="(Long,Int)Unit">loop</a>(<a href="#69584" title="Long">newCallbackCallTime</a>, <a href="#69583" title="Int">fileCount</a>)
		}
		<a href="#69573" title="(Long,Int)Unit">loop</a>(<span title="Long(0L)" class="long">0L</span>, <span title="Int(0)" class="int">0</span>)
	}
}
        </pre>
    </body>
</html>