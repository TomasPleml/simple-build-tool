<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/Update.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2010 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="comment">/** A trait that provides a task for updating sbt.  */</span>
<span class="keyword">trait</span> <a title="trait UpdateSbt extends java.lang.Object with sbt.Project with ScalaObject" id="8829">UpdateSbt</a> <span class="keyword">extends</span> <a href="Project.scala.html#7647" title="sbt.Project">Project</a>
{
	<span class="comment">/** The first argument is the version to update to and is mandatory.
	* The second argument is the location of the launcher jar.  If omitted, the launcher used to launch the currently running instance of sbt is used.*/</span>
	<span class="keyword">lazy</span> <span class="keyword">val</span> <a title="UpdateSbt.this.MethodTask" id="74395">sbtUpdate</a> = <a href="TaskManager.scala.html#14601" title="((Array[String]) =&gt; UpdateSbt.this.ManagedTask)UpdateSbt.this.MethodTask">task</a> { <a title="Array[String]" id="74404">args</a> =&gt; <a href="TaskManager.scala.html#14599" title="(=&gt; Option[String])UpdateSbt.this.Task">task</a> { (<a href="#74426" title="(Array[String])Option[String]" class="keyword">new</a> <a href="#8604" title="sbt.Update">Update</a>(<a href="#8829" title="sbt.UpdateSbt" class="keyword">this</a>))(<a href="#74404" title="Array[String]">args</a>) } } <a href="TaskManager.scala.html#18997" title="(String)UpdateSbt.this.MethodTask">describedAs</a>(<span title="java.lang.String(&quot;Updates the version of sbt used to build this project and updates the launcher jar.&quot;)" class="string">&quot;Updates the version of sbt used to build this project and updates the launcher jar.&quot;</span>)
}

<span class="keyword">import</span> java.io.{File, InputStream, IOException}
<span class="keyword">import</span> java.net.{HttpURLConnection, URL}
<span class="keyword">import</span> HttpURLConnection.{HTTP_NOT_FOUND , HTTP_OK}
<span class="keyword">import</span> SimpleReader.readLine
<span class="keyword">import</span> xsbt.FileUtilities.{classLocationFile, copyFile, readLines, transfer, unzip, withTemporaryDirectory, write, zip}
<span class="keyword">import</span> xsbt.PathMapper.relativeTo
<span class="keyword">import</span> xsbt.Paths._
<span class="keyword">import</span> xsbt.OpenResource.{fileOutputStream, urlInputStream}

<span class="keyword">private</span> <span class="keyword">class</span> <a title="class Update extends java.lang.Object with ScalaObject" id="8604">Update</a>(<a title="sbt.Project" id="74446">project</a>: <a href="Project.scala.html#7647" title="sbt.Project">Project</a>)
{
	<span class="keyword">val</span> <a title="sbt.ProjectInfo" id="74417">info</a> = <a href="#74446" title="sbt.Project">project</a>.<a href="Project.scala.html#14617" title="=&gt; sbt.ProjectInfo">info</a>
	<span class="keyword">val</span> <a title="xsbti.AppProvider" id="74419">app</a> = <a href="#74417" title="=&gt; sbt.ProjectInfo">info</a>.<a href="ProjectInfo.scala.html#18957" title="=&gt; xsbti.AppProvider">app</a>
	<span class="keyword">val</span> <a title="sbt.Logger" id="74421">log</a> = <a href="#74446" title="sbt.Project">project</a>.<a href="Project.scala.html#14612" title="=&gt; sbt.Logger">log</a>
	
	<span class="comment">/** The location of the jar used to launch the currently running instance of sbt.*/</span>
	<span class="keyword">lazy</span> <span class="keyword">val</span> <a title="java.io.File" id="74424">launcherJar</a> = <a href="../FileUtilities.scala.html#32077" title="(implicit scala.reflect.Manifest[xsbti.AppProvider])java.io.File" id="2660">classLocationFile</a>[xsbti.<a href="../xsbti/AppProvider.java.html#5875" title="xsbti.AppProvider">AppProvider</a>]
	<span class="comment">/** A temporary jar file to use in the given directory. */</span>
	<span class="keyword">def</span> <a title="(java.io.File)java.io.File" id="74425">tempJar</a>(<a title="java.io.File" id="74533">dir</a>: <span title="java.io.File">File</span>) = <a href="../Paths.scala.html#47762" title="implicit xsbt.Paths.fileToPath : (java.io.File)xsbt.Path">dir</a> <a href="../Paths.scala.html#47812" title="(String)java.io.File">/</a> <a href="#74423" title="=&gt; java.io.File">launcherJar</a>.<span title="()java.lang.String">getName</span>
		
	<span class="comment">/** Implementation of the sbt-update task: reads arguments and hands off to the other `apply`.*/</span>
	<span class="keyword">def</span> <a title="(Array[String])Option[String]" id="74426">apply</a>(<a title="Array[String]" id="74520">args</a>: <a title="Array[String]" id="1032">Array</a>[String]): <span title="Option[String]">Option</span>[String] =
		<a href="#74520" title="Array[String]">args</a> <span title="Option[String]" class="keyword">match</span>
		{
			<span title="Option[String]" class="keyword">case</span> <a href="#74539" title="(Array[String])Option[Seq[String]]">Array</a>(<a title="String" id="74542">version</a>) <span class="keyword">if</span> <a href="#74427" title="(String)Boolean">validVersion</a>(<a href="#74542" title="String">version</a>) =&gt; <a href="#74428" title="(String,Option[java.io.File])Option[String]">apply</a>(<a href="#74542" title="String">version</a>, <span title="object None">None</span>)
			<span title="Option[String]" class="keyword">case</span> <a href="#74571" title="(Array[String])Option[Seq[String]]">Array</a>(<a title="String" id="74574">version</a>, <a title="String" id="74575">temporaryJar</a>) <span class="keyword">if</span> <a href="#74427" title="(String)Boolean">validVersion</a>(<a href="#74574" title="String">version</a>) =&gt; <a href="#74428" title="(String,Option[java.io.File])Option[String]">apply</a>(<a href="#74574" title="String">version</a>, <span title="(java.io.File)Some[java.io.File]">Some</span>(<span title="java.io.File" class="keyword">new</span> <span title="java.io.File">File</span>(<a href="#74575" title="String">temporaryJar</a>) <a title="()java.io.File" id="16014">getAbsoluteFile</a>))
			<span title="Some[java.lang.String]" class="keyword">case</span> _ =&gt; <span title="(java.lang.String)Some[java.lang.String]">Some</span>(<span title="java.lang.String(&quot;Expected '&lt;version&gt;' or '&lt;version&gt; &lt;new-launcher-file&gt;', got '&quot;)" class="string">&quot;Expected '&lt;version&gt;' or '&lt;version&gt; &lt;new-launcher-file&gt;', got '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74520" title="Array[String]">args</a>.<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span>) <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;'&quot;)" class="string">&quot;'&quot;</span>)
		}

	<span class="keyword">def</span> <a title="(String)Boolean" id="74427">validVersion</a>(<a title="String" id="74543">version</a>: <span title="String">String</span>) = <span title="=&gt; Boolean">!</span><a href="#74543" title="String">version</a>.<span title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString">trim</span>.<span title="=&gt; Boolean">isEmpty</span>

	<span class="comment">/** Implementation of the sbt-update task after arguments have checked.  Gives user a chance to cancel and continues with `doUpdate`.*/</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Option[String]" id="74428">apply</a>(<a title="String" id="74449">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="74450">temporaryJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="Option[String]">Option</span>[String] =
	{
		<a href="LineReader.scala.html#43687" title="(String)Option[java.lang.String]">readLine</a>(<span title="java.lang.String(&quot;Updating the sbt version requires a restart.  Continue? (Y/n) &quot;)" class="string">&quot;Updating the sbt version requires a restart.  Continue? (Y/n) &quot;</span>) <span title="Option[String]" class="keyword">match</span>
		{
			<span title="Option[String]" class="keyword">case</span> Some(<a title="java.lang.String" id="74594">line</a>) <span class="keyword">if</span>(<a href="#74438" title="(String)Boolean">isYes</a>(<a href="#74594" title="java.lang.String">line</a>)) =&gt; <a href="#74429" title="(String,Option[java.io.File])Option[String]">doUpdate</a>(<a href="#74449" title="String">version</a>, <a href="#74450" title="Option[java.io.File]">temporaryJar</a>)
			<span title="Some[java.lang.String]" class="keyword">case</span> _ =&gt; <span title="(java.lang.String)Some[java.lang.String]">Some</span>(<span title="java.lang.String(&quot;Update declined.&quot;)" class="string">&quot;Update declined.&quot;</span>)
		}
	}
	<span class="comment">/** Implementation of the sbt-update task: high-level control after initial verification.*/</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Option[String]" id="74429">doUpdate</a>(<a title="String" id="74610">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="74611">temporaryJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="Option[String]">Option</span>[String] =
	{
		<a href="#74431" title="(String)Unit">retrieveNewVersion</a>(<a href="#74610" title="String">version</a>)
		<a href="#74421" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19517" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Version is valid.  Setting 'sbt.version' to &quot;)" class="string">&quot;Version is valid.  Setting 'sbt.version' to &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74610" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;...&quot;)" class="string">&quot;...&quot;</span>)
		<a href="#74430" title="(String)Unit">setNewVersion</a>(<a href="#74610" title="String">version</a>)

		<a href="#74421" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19517" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;'sbt.version' updated.&quot;)" class="string">&quot;'sbt.version' updated.&quot;</span>)
		<span title="Unit" class="keyword">if</span>(<a href="#74611" title="Option[java.io.File]">temporaryJar</a>.<span title="=&gt; Boolean">isDefined</span> <span title="(Boolean)Boolean">||</span> <a href="#74432" title="(String)Boolean">updateInPlace</a>(<a href="#74610" title="String">version</a>))
		{
			<a href="#74421" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19517" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Downloading new launcher ...&quot;)" class="string">&quot;Downloading new launcher ...&quot;</span>)
			
			<span title="Unit" class="keyword">if</span>(<a href="#74436" title="(String,Option[java.io.File])Boolean">downloadLauncher</a>(<a href="#74610" title="String">version</a>, <a href="#74611" title="Option[java.io.File]">temporaryJar</a>))
				<a href="#74421" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19517" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Downloaded launcher.&quot;)" class="string">&quot;Downloaded launcher.&quot;</span>)
			<span class="keyword">else</span>
				<a href="#74434" title="(String,Option[java.io.File])Unit">tryUpdateLauncher</a>(<a href="#74610" title="String">version</a>, <a href="#74611" title="Option[java.io.File]">temporaryJar</a>)
		}
		<span class="keyword">else</span>
			<a href="#74421" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19517" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Launcher update declined.&quot;)" class="string">&quot;Launcher update declined.&quot;</span>)

		<a href="#74421" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19517" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Please restart sbt.&quot;)" class="string">&quot;Please restart sbt.&quot;</span>)
		<a title="object java.lang.System" id="1831">System</a>.<a title="(Int)Unit" id="34105">exit</a>(<span title="Int(0)" class="int">0</span>)
		<span title="object None">None</span>
	}
	<span class="comment">/** Updates 'sbt.version' in `project/build.properties`.*/</span>
	<span class="keyword">def</span> <a title="(String)Unit" id="74430">setNewVersion</a>(<a title="String" id="74615">version</a>: <span title="String">String</span>)
	{
		<a href="#74446" title="sbt.Project">project</a>.<a href="Project.scala.html#14674" title="=&gt; Update.this.project.Property[String]">sbtVersion</a>() = <a href="#74615" title="String">version</a>
		<a href="#74446" title="sbt.Project">project</a>.<a href="Environment.scala.html#14801" title="()Option[String]">saveEnvironment</a>()
	}
	<span class="comment">/** Retrieves the given `version` of sbt in order to verify the version is valid.*/</span>
	<span class="keyword">def</span> <a title="(String)Unit" id="74431">retrieveNewVersion</a>(<a title="String" id="74613">version</a>: <span title="String">String</span>)
	{
		<span class="keyword">val</span> <a title="xsbti.ApplicationID" id="74629">newAppID</a> = <a href="#74445" title="(xsbti.ApplicationID,String)xsbti.ApplicationID">changeVersion</a>(<a href="#74419" title="=&gt; xsbti.AppProvider">app</a>.<a href="../xsbti/AppProvider.java.html#22816" title="()xsbti.ApplicationID">id</a>, <a href="#74613" title="String">version</a>)
		<a href="#74421" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19517" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String(&quot;Checking repositories for sbt &quot;)" class="string">&quot;Checking repositories for sbt &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74613" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; ...&quot;)" class="string">&quot; ...&quot;</span>)
		<a href="#74419" title="=&gt; xsbti.AppProvider">app</a>.<a href="../xsbti/AppProvider.java.html#22815" title="()xsbti.ScalaProvider">scalaProvider</a>.<a href="../xsbti/ScalaProvider.java.html#22828" title="(xsbti.ApplicationID)xsbti.AppProvider">app</a>(<a href="#74629" title="xsbti.ApplicationID">newAppID</a>)
	}
	<span class="comment">/** Asks the user whether the current launcher should be overrwritten.  Called when no file is explicitly specified as an argument. */</span>
	<span class="keyword">def</span> <a title="(String)Boolean" id="74432">updateInPlace</a>(<a title="String" id="74617">version</a>: <span title="String">String</span>) =
	{
		<span class="keyword">val</span> <a title="Option[java.lang.String]" id="74619">input</a> = <a href="LineReader.scala.html#43687" title="(String)Option[java.lang.String]">readLine</a>(<span title="java.lang.String(&quot; The current launcher (&quot;)" class="string">&quot; The current launcher (&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74423" title="=&gt; java.io.File">launcherJar</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;) will be updated in place.  Continue? (Y/n) &quot;)" class="string">&quot;) will be updated in place.  Continue? (Y/n) &quot;</span>)
		<a href="#74433" title="(Option[String])Boolean">isYes</a>(<a href="#74619" title="Option[java.lang.String]">input</a>)
	}
	<span class="keyword">def</span> <a title="(Option[String])Boolean" id="74433">isYes</a>(<a title="Option[String]" id="74609">line</a>: <span title="Option[String]">Option</span>[String]): <span title="Boolean">Boolean</span> = <a href="#74609" title="Option[String]">line</a>.<a title="((String) =&gt; Boolean)Option[String]" id="19021">filter</a>(<a href="#74438" title="(String)Boolean">isYes</a>).<span title="=&gt; Boolean">isDefined</span>
	
	<span class="comment">/** Updates the launcher as in `updateLauncher` but performs various checks and logging around it. */</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Unit" id="74434">tryUpdateLauncher</a>(<a title="String" id="74625">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="74626">temporaryJar</a>: <span title="Option[java.io.File]">Option</span>[File])
	{
		<a href="#74421" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19518" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;No launcher found for '&quot;)" class="string">&quot;No launcher found for '&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74625" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;'&quot;)" class="string">&quot;'&quot;</span>)
		<span class="keyword">def</span> <a title="=&gt; java.lang.String" id="74638">promptStart</a> = <span title="java.lang.String" class="keyword">if</span>(<a href="#74626" title="Option[java.io.File]">temporaryJar</a>.<span title="=&gt; Boolean">isDefined</span>) <span title="java.lang.String(&quot; Copy current launcher but with &quot;)" class="string">&quot; Copy current launcher but with &quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot; Modify current launcher to use &quot;)" class="string">&quot; Modify current launcher to use &quot;</span>
		<span class="keyword">val</span> <a title="Option[java.lang.String]" id="74639">input</a> = <a href="LineReader.scala.html#43687" title="(String)Option[java.lang.String]">readLine</a>(<a href="#74638" title="=&gt; java.lang.String">promptStart</a> <span title="(Any)java.lang.String">+</span> <a href="#74625" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; as the default for new projects? (Y/n) &quot;)" class="string">&quot; as the default for new projects? (Y/n) &quot;</span>)
		<span class="keyword">val</span> <a title="Boolean" id="74640">updated</a> = <a href="#74433" title="(Option[String])Boolean">isYes</a>(<a href="#74639" title="Option[java.lang.String]">input</a>)
		<span title="Unit" class="keyword">if</span>(<a href="#74640" title="Boolean">updated</a>) <a href="#74439" title="(String,Option[java.io.File])Unit">updateLauncher</a>(<a href="#74625" title="String">version</a>, <a href="#74626" title="Option[java.io.File]">temporaryJar</a>)
		
		<span class="keyword">def</span> <a title="=&gt; java.lang.String" id="74641">extra</a> =  <span title="java.lang.String" class="keyword">if</span>(<a href="#74626" title="Option[java.io.File]">temporaryJar</a>.<span title="=&gt; Boolean">isDefined</span>) <span title="java.lang.String(&quot; at &quot;)" class="string">&quot; at &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74626" title="Option[java.io.File]">temporaryJar</a>.<a title="=&gt; java.io.File" id="19012">get</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span> <span class="keyword">else</span> <span title="java.lang.String(&quot;.&quot;)" class="string">&quot;.&quot;</span>
		<a href="#74421" title="=&gt; sbt.Logger">log</a>.<a href="Logger.scala.html#19517" title="(=&gt; String)Unit">info</a>(<span title="java.lang.String" class="keyword">if</span>(<a href="#74640" title="Boolean">updated</a>) <span title="java.lang.String(&quot;Launcher updated&quot;)" class="string">&quot;Launcher updated&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74641" title="=&gt; java.lang.String">extra</a> <span class="keyword">else</span> <span title="java.lang.String(&quot;Launcher not updated.&quot;)" class="string">&quot;Launcher not updated.&quot;</span>)
	}
	<span class="comment">/** The jar to copy/download to.  If `userJar` is not defined, it is a temporary file in `tmpDir` that should then be moved to the current launcher file.
	* If it is defined and is a directory, the jar is defined in that directory.  If it is a file, that file is returned. */</span>
	<span class="keyword">def</span> <a title="(java.io.File,Option[java.io.File])java.io.File" id="74435">targetJar</a>(<a title="java.io.File" id="74652">tmpDir</a>: <span title="java.io.File">File</span>, <a title="Option[java.io.File]" id="74653">userJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="java.io.File">File</span> = 
		<a href="#74653" title="Option[java.io.File]">userJar</a> <span title="java.io.File" class="keyword">match</span> { <span title="java.io.File" class="keyword">case</span> Some(<a title="java.io.File" id="74654">file</a>) =&gt; <span title="java.io.File" class="keyword">if</span>(<a href="#74654" title="java.io.File">file</a>.<a title="()Boolean" id="16022">isDirectory</a>) <a href="#74425" title="(java.io.File)java.io.File">tempJar</a>(<a href="#74654" title="java.io.File">file</a>) <span class="keyword">else</span> <a href="#74654" title="java.io.File">file</a>; <span title="java.io.File" class="keyword">case</span> <span title="object None">None</span> =&gt; <a href="#74425" title="(java.io.File)java.io.File">tempJar</a>(<a href="#74652" title="java.io.File">tmpDir</a>) }
		
	<span class="comment">/** Gets the given `version` of the launcher from Google Code.  If `userProvidedJar` is defined,
	* this updated launcher is downloaded there, otherwise it overwrites the current launcher. */</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Boolean" id="74436">downloadLauncher</a>(<a title="String" id="74622">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="74623">userProvidedJar</a>: <span title="Option[java.io.File]">Option</span>[File]): <span title="Boolean">Boolean</span> =
	{
		<span class="keyword">def</span> <a title="(java.io.File)Boolean" id="74655">getLauncher</a>(<a title="java.io.File" id="74656">tmp</a>: <span title="java.io.File">File</span>): <span title="Boolean">Boolean</span> =
		{
			<span class="keyword">val</span> <a title="java.io.File" id="74657">temporaryJar</a> = <a href="#74435" title="(java.io.File,Option[java.io.File])java.io.File">targetJar</a>(<a href="#74656" title="java.io.File">tmp</a>, <a href="#74623" title="Option[java.io.File]">userProvidedJar</a>)
			<a href="#74657" title="java.io.File">temporaryJar</a>.<a title="()java.io.File" id="16010">getParentFile</a>.<a title="()Boolean" id="16036">mkdirs</a>()
			<span class="keyword">val</span> <a title="java.net.URL" id="74658">url</a> = <a href="#74437" title="(String)java.net.URL">launcherURL</a>(<a href="#74622" title="String">version</a>)
			<span class="keyword">val</span> <a title="java.net.HttpURLConnection" id="74659">connection</a> = <a href="#74658" title="java.net.URL">url</a>.<a title="()java.net.URLConnection" id="25112">openConnection</a>.<a title="java.net.HttpURLConnection" id="3451">asInstanceOf</a>[<a title="java.net.HttpURLConnection" id="4534">HttpURLConnection</a>]
			<a href="#74659" title="java.net.HttpURLConnection">connection</a>.<a title="(Boolean)Unit" id="74500">setInstanceFollowRedirects</a>(<span title="Boolean(false)" class="keyword">false</span>)
			
			<span class="keyword">def</span> <a title="(java.io.InputStream)Unit" id="74660">download</a>(<a title="java.io.InputStream" id="74733">in</a>: <span title="java.io.InputStream">InputStream</span>): <span title="Unit">Unit</span> = <a href="../OpenResource.scala.html#36796" title="(java.io.File)((java.io.FileOutputStream) =&gt; Unit)Unit">fileOutputStream</a>(<span title="Boolean(false)" class="keyword">false</span>)(<a href="#74657" title="java.io.File">temporaryJar</a>) { <a title="java.io.FileOutputStream" id="74736">out</a> =&gt; <a href="../FileUtilities.scala.html#32093" title="(java.io.InputStream,java.io.OutputStream)Unit">transfer</a>(<a href="#74733" title="java.io.InputStream">in</a>, <a href="#74736" title="java.io.FileOutputStream">out</a>) }
			<span class="keyword">def</span> <a title="(java.io.InputStream)Boolean" id="74661">checkAndRetrieve</a>(<a title="java.io.InputStream" id="74737">in</a>: <span title="java.io.InputStream">InputStream</span>): <span title="Boolean">Boolean</span> =  (<a href="#74659" title="java.net.HttpURLConnection">connection</a>.<span title="()Int">getResponseCode</span> <span title="(Int)Boolean">==</span> <span title="Int(200)">HTTP_OK</span>) <span title="(Boolean)Boolean">&amp;&amp;</span> { <a href="#74660" title="(java.io.InputStream)Unit">download</a>(<a href="#74737" title="java.io.InputStream">in</a>); <span title="Boolean(true)" class="keyword">true</span> }
			<span class="keyword">def</span> <a title="(java.io.IOException)Boolean" id="74662">handleError</a>(<a title="java.io.IOException" id="74740">e</a>: <span title="java.io.IOException">IOException</span>) = <span title="Boolean" class="keyword">if</span>(<a href="#74659" title="java.net.HttpURLConnection">connection</a>.<span title="()Int">getResponseCode</span> <span title="(Int)Boolean">==</span> <span title="Int(404)">HTTP_NOT_FOUND</span> ) <span title="Boolean(false)" class="keyword">false</span> <span class="keyword">else</span> <span title="Nothing" class="keyword">throw</span> <a href="#74740" title="java.io.IOException">e</a>
			<span class="keyword">def</span> <a title="()Boolean" id="74663">retrieve</a>() =
			{
				<span class="keyword">val</span> <a title="java.io.InputStream" id="74745">in</a> = <a href="#74659" title="java.net.HttpURLConnection">connection</a>.<a title="()java.io.InputStream" id="74702">getInputStream</a>
				<span class="keyword">try</span> { <a href="#74661" title="(java.io.InputStream)Boolean">checkAndRetrieve</a>(<a href="#74745" title="java.io.InputStream">in</a>) } <span class="keyword">finally</span> { <a href="#74745" title="java.io.InputStream">in</a>.<a title="()Unit" id="29595">close</a>() }
			}
			
			<span class="keyword">val</span> <a title="Boolean" id="74664">success</a> = <span class="keyword">try</span> { <a href="#74663" title="()Boolean">retrieve</a>() } <span class="keyword">catch</span> { <span title="Boolean" class="keyword">case</span> <a title="java.io.IOException" id="74746">e</a>: <span title="java.io.IOException">IOException</span> =&gt; <a href="#74662" title="(java.io.IOException)Boolean">handleError</a>(<a href="#74746" title="java.io.IOException">e</a>)} <span class="keyword">finally</span> { <a href="#74659" title="java.net.HttpURLConnection">connection</a>.<a title="()Unit" id="74507">disconnect</a>() }
			<span title="Unit" class="keyword">if</span>(<a href="#74664" title="Boolean">success</a> <span title="(Boolean)Boolean">&amp;&amp;</span> <a href="#74623" title="Option[java.io.File]">userProvidedJar</a>.<span title="=&gt; Boolean">isEmpty</span>)
				<a href="#74440" title="(java.io.File,java.io.File)Unit">move</a>(<a href="#74657" title="java.io.File">temporaryJar</a>, <a href="#74423" title="=&gt; java.io.File">launcherJar</a>)
			<a href="#74664" title="Boolean">success</a>
		}
		<a href="../FileUtilities.scala.html#32096" title="((java.io.File) =&gt; Boolean)Boolean">withTemporaryDirectory</a>(<a href="#74655" title="(java.io.File)Boolean">getLauncher</a>)
	}
	<span class="comment">/** The location of the launcher for the given version, if it exists. */</span>
	<span class="keyword">def</span> <a title="(String)java.net.URL" id="74437">launcherURL</a>(<a title="String" id="74665">version</a>: <span title="String">String</span>): <span title="java.net.URL">URL</span> =
		<a title="(java.lang.String)java.net.URL" id="25091" class="keyword">new</a> <span title="java.net.URL">URL</span>(<span title="java.lang.String(&quot;http://simple-build-tool.googlecode.com/files/sbt-launch-&quot;)" class="string">&quot;http://simple-build-tool.googlecode.com/files/sbt-launch-&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74665" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;.jar&quot;)" class="string">&quot;.jar&quot;</span>)
		
	<span class="comment">/** True iff the given user input is empty, 'y' or 'yes' (case-insensitive).*/</span>
	<span class="keyword">def</span> <a title="(String)Boolean" id="74438">isYes</a>(<a title="String" id="74596">line</a>: <span title="String">String</span>) =
	{
		<span class="keyword">val</span> <a title="java.lang.String" id="74598">lower</a> = <a href="#74596" title="String">line</a>.<a title="()java.lang.String" id="5812">toLowerCase</a>
		<a href="#74598" title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString">lower</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(Boolean)Boolean">||</span> <a href="#74598" title="java.lang.String">lower</a> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;y&quot;)" class="string">&quot;y&quot;</span> <span title="(Boolean)Boolean">||</span> <a href="#74598" title="java.lang.String">lower</a> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;yes&quot;)" class="string">&quot;yes&quot;</span>
	}
	<span class="comment">/** Copies the current launcher but with the default 'sbt.version' set to `version`.  If `userProvidedJar` is defined,
	* the updated launcher is copied there, otherwise the copy overwrites the current  launcher. */</span>
	<span class="keyword">def</span> <a title="(String,Option[java.io.File])Unit" id="74439">updateLauncher</a>(<a title="String" id="74644">version</a>: <span title="String">String</span>, <a title="Option[java.io.File]" id="74645">userProvidedJar</a>: <span title="Option[java.io.File]">Option</span>[File])
	{
		<span class="keyword">def</span> <a title="(java.io.File,java.io.File)Unit" id="74766">makeUpdated</a>(<a title="java.io.File" id="74768">base</a>: <span title="java.io.File">File</span>, <a title="java.io.File" id="74769">newJar</a>: <span title="java.io.File">File</span>)
		{
			<span class="keyword">val</span> <a title="Set[java.io.File]" id="74770">files</a> = <a href="../FileUtilities.scala.html#32089" title="(java.io.File,java.io.File)Set[java.io.File]">unzip</a>(<a href="#74423" title="=&gt; java.io.File">launcherJar</a>, <a href="#74768" title="java.io.File">base</a>)
			<a href="#74441" title="(Iterable[java.io.File],String)Unit">updateBootProperties</a>(<a href="#74770" title="Set[java.io.File]">files</a>, <a href="#74644" title="String">version</a>)
			<a href="../FileUtilities.scala.html#32108" title="(Iterable[(java.io.File, String)],java.io.File)Unit">zip</a>(<a href="../PathMapper.scala.html#32024" title="(Set[java.io.File])Iterable[(java.io.File, String)]">relativeTo</a>(<a href="#74768" title="java.io.File">base</a>)( <a href="#74770" title="Set[java.io.File]">files</a> ), <a href="#74769" title="java.io.File">newJar</a>)
		}
		<span class="keyword">def</span> <a title="(java.io.File)Unit" id="74767">updateLauncher</a>(<a title="java.io.File" id="74793">tmp</a>: <span title="java.io.File">File</span>)
		{
			<span class="keyword">val</span> <a title="java.io.File" id="74794">basePath</a> = <a href="../Paths.scala.html#47762" title="implicit xsbt.Paths.fileToPath : (java.io.File)xsbt.Path">tmp</a> <a href="../Paths.scala.html#47812" title="(String)java.io.File">/</a> <span title="java.lang.String(&quot;launcher-jar&quot;)" class="string">&quot;launcher-jar&quot;</span>
			<span class="keyword">val</span> <a title="java.io.File" id="74795">temporaryJar</a> = <a href="#74435" title="(java.io.File,Option[java.io.File])java.io.File">targetJar</a>(<a href="#74793" title="java.io.File">tmp</a>, <a href="#74645" title="Option[java.io.File]">userProvidedJar</a>)
			<a href="#74766" title="(java.io.File,java.io.File)Unit">makeUpdated</a>(<a href="#74794" title="java.io.File">basePath</a>, <a href="#74795" title="java.io.File">temporaryJar</a>)
			<span title="Unit" class="keyword">if</span>(<a href="#74645" title="Option[java.io.File]">userProvidedJar</a>.<span title="=&gt; Boolean">isEmpty</span>)
				<a href="#74440" title="(java.io.File,java.io.File)Unit">move</a>(<a href="#74795" title="java.io.File">temporaryJar</a>, <a href="#74423" title="=&gt; java.io.File">launcherJar</a>)
		}

		<a href="../FileUtilities.scala.html#32096" title="((java.io.File) =&gt; Unit)Unit">withTemporaryDirectory</a>(<a href="#74767" title="(java.io.File)Unit">updateLauncher</a>)
	}
	
	<span class="comment">/** Copies the `src` file to the `dest` file, preferably by renaming.  The `src` file may or may not be removed.*/</span>
	<span class="keyword">def</span> <a title="(java.io.File,java.io.File)Unit" id="74440">move</a>(<a title="java.io.File" id="74747">src</a>: <span title="java.io.File">File</span>, <a title="java.io.File" id="74748">dest</a>: <span title="java.io.File">File</span>)
	{
		<span class="keyword">val</span> <a title="Boolean" id="74803">renameSuccess</a> = <a href="#74747" title="java.io.File">src</a> <a title="(java.io.File)Boolean" id="16037">renameTo</a> <a href="#74748" title="java.io.File">dest</a>
		<span title="Unit" class="keyword">if</span>(<span title="=&gt; Boolean">!</span><a href="#74803" title="Boolean">renameSuccess</a>)
			<a href="../FileUtilities.scala.html#32117" title="(java.io.File,java.io.File)Unit">copyFile</a>(<a href="#74747" title="java.io.File">src</a>, <a href="#74748" title="java.io.File">dest</a>)
	}
	
	<span class="comment">/** Updates the default value used for 'sbt.version' in the 'sbt.boot.properties' file in the launcher `files` to be `version`.*/</span>
	<span class="keyword">def</span> <a title="(Iterable[java.io.File],String)Unit" id="74441">updateBootProperties</a>(<a title="Iterable[java.io.File]" id="74779">files</a>: <a title="Iterable[java.io.File]" id="372">Iterable</a>[File], <a title="String" id="74780">version</a>: <span title="String">String</span>): <span title="Unit">Unit</span> =
		<a href="#74779" title="Iterable[java.io.File]">files</a>.<a title="((java.io.File) =&gt; Boolean)Option[java.io.File]" id="16073">find</a>(<a href="#74805" title="java.io.File">_</a>.<span title="()java.lang.String">getName</span> <span title="(AnyRef)Boolean">==</span> <span title="java.lang.String(&quot;sbt.boot.properties&quot;)" class="string">&quot;sbt.boot.properties&quot;</span>).<a title="((java.io.File) =&gt; Unit)Unit" id="19022">foreach</a>(<a href="#74442" title="(String)(java.io.File)Unit">updateBootProperties</a>(<a href="#74780" title="String">version</a>))
	<span class="comment">/** Updates the default value used for 'sbt.version' in the given `file` to be `version`.*/</span>
	<span class="keyword">def</span> <a title="(String)(java.io.File)Unit" id="74442">updateBootProperties</a>(<a title="String" id="74773">version</a>: <span title="String">String</span>)(<a title="java.io.File" id="74774">file</a>: <span title="java.io.File">File</span>)
	{
		<span class="keyword">val</span> <a title="List[java.lang.String]" id="74812">newContent</a> = <a href="../FileUtilities.scala.html#32128" title="(java.io.File)List[String]">readLines</a>(<a href="#74774" title="java.io.File">file</a>) <a title="((String) =&gt; java.lang.String)List[java.lang.String]" id="17752">map</a> <a href="#74443" title="(String)(String)java.lang.String">updateSbtVersion</a>(<a href="#74773" title="String">version</a>)
		<a href="../FileUtilities.scala.html#32119" title="(java.io.File,String)Unit">write</a>(<a href="#74774" title="java.io.File">file</a>, <a href="#74812" title="List[java.lang.String]">newContent</a>.<span title="(String)String">mkString</span>(<span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span>))
	}
	
	<span class="comment">/** If the given `line` is the 'sbt.version' configuration, update it to use the `newVersion`.*/</span>
	<span class="keyword">def</span> <a title="(String)(String)java.lang.String" id="74443">updateSbtVersion</a>(<a title="String" id="74816">newVersion</a>: <span title="String">String</span>)(<a title="String" id="74817">line</a>: <span title="String">String</span>) =
		<span title="java.lang.String" class="keyword">if</span>(<a href="#74817" title="String">line</a>.<span title="()java.lang.String">trim</span>.<a title="(java.lang.String)Boolean" id="5786">startsWith</a>(<span title="java.lang.String(&quot;sbt.version&quot;)" class="string">&quot;sbt.version&quot;</span>)) <a href="#74444" title="(String)java.lang.String">sbtVersion</a>(<a href="#74816" title="String">newVersion</a>) <span class="keyword">else</span> <a href="#74817" title="String">line</a>
		
	<span class="comment">/** The configuration line that defines the 'sbt.version' property, using the provided `version` for defaults.*/</span>
	<span class="keyword">def</span> <a title="(String)java.lang.String" id="74444">sbtVersion</a>(<a title="String" id="74820">version</a>: <span title="String">String</span>) =
		<span title="java.lang.String(&quot; sbt.version: quick=set(&quot;)" class="string">&quot; sbt.version: quick=set(&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74820" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;), new=prompt(sbt version)[&quot;)" class="string">&quot;), new=prompt(sbt version)[&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74820" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;], fill=prompt(sbt version)[&quot;)" class="string">&quot;], fill=prompt(sbt version)[&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#74820" title="String">version</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;]&quot;)" class="string">&quot;]&quot;</span>
	
	<span class="comment">/** Copies the given ApplicationID but with the specified version.*/</span>
	<span class="keyword">def</span> <a title="(xsbti.ApplicationID,String)xsbti.ApplicationID" id="74445">changeVersion</a>(<a title="xsbti.ApplicationID" id="74630">appID</a>: xsbti.<a href="../xsbti/ApplicationID.java.html#5887" title="xsbti.ApplicationID">ApplicationID</a>, <a title="String" id="74631">versionA</a>: <span title="String">String</span>): xsbti.<a href="../xsbti/ApplicationID.java.html#5887" title="xsbti.ApplicationID">ApplicationID</a> =
		<a title="template $anon extends java.lang.Object with xsbti.ApplicationID" id="74826" class="keyword">new</a> xsbti.<a href="../xsbti/ApplicationID.java.html#5887" title="xsbti.ApplicationID">ApplicationID</a> {
			<span class="keyword">def</span> <a title="()java.lang.String" id="74828">groupID</a> = <a href="#74630" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#30636" title="()java.lang.String">groupID</a>
			<span class="keyword">def</span> <a title="()java.lang.String" id="74829">name</a> = <a href="#74630" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#30637" title="()java.lang.String">name</a>
			<span class="keyword">def</span> <a title="()String" id="74830">version</a> = <a href="#74631" title="String">versionA</a>
			<span class="keyword">def</span> <a title="()java.lang.String" id="74831">mainClass</a> = <a href="#74630" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#30639" title="()java.lang.String">mainClass</a>
			<span class="keyword">def</span> <a title="()Array[java.lang.String]" id="74832">mainComponents</a> = <a href="#74630" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#30640" title="()Array[java.lang.String]">mainComponents</a>
			<span class="keyword">def</span> <a title="()Boolean" id="74833">crossVersioned</a> = <a href="#74630" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#30641" title="()Boolean">crossVersioned</a>
			<span class="keyword">def</span> <a title="()Array[java.io.File]" id="74834">classpathExtra</a> = <a href="#74630" title="xsbti.ApplicationID">appID</a>.<a href="../xsbti/ApplicationID.java.html#30642" title="()Array[java.io.File]">classpathExtra</a>
		}
}

        </pre>
    </body>
</html>