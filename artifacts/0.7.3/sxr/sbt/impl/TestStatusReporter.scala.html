<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/impl/TestStatusReporter.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt.impl
<span class="keyword">import</span> sbt._

<span class="keyword">import</span> java.io.File
<span class="keyword">import</span> scala.collection.mutable.{HashMap, Map}

<span class="comment">/** Only intended to be used once per instance. */</span>
<span class="keyword">private</span>[sbt] <span class="keyword">class</span> <a title="class TestStatusReporter extends java.lang.Object with sbt.TestsListener with ScalaObject" id="13684">TestStatusReporter</a>(<a title="sbt.Path" id="80414">path</a>: <a href="../Path.scala.html#10152" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="80415">log</a>: <a href="../Logger.scala.html#11784" title="sbt.Logger">Logger</a>) <span class="keyword">extends</span> <a href="../TestReportListener.scala.html#9150" title="sbt.TestsListener">TestsListener</a>
{
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[String,Long]" id="80405">succeeded</a>: <span title="scala.collection.mutable.Map[String,Long]">Map</span>[String, Long] = <a href="#13442" title="object sbt.impl.TestStatus">TestStatus</a>.<a href="#85067" title="(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]">read</a>(<a href="#80414" title="sbt.Path">path</a>, <a href="#80415" title="sbt.Logger">log</a>)

	<span class="keyword">def</span> <a title="=&gt; Unit" id="80406">doInit</a> <span title="Unit">{</span>}
	<span class="keyword">def</span> <a title="(String)Unit" id="80407">startGroup</a>(<a title="String" id="85073">name</a>: <span title="String">String</span>) { <a href="#80404" title="=&gt; scala.collection.mutable.Map[String,Long]">succeeded</a> <a title="(String)Option[Long]" id="24187">removeKey</a> <a href="#85073" title="String">name</a> }
	<span class="keyword">def</span> <a title="(sbt.TestEvent)Unit" id="80408">testEvent</a>(<a title="sbt.TestEvent" id="85074">event</a>: <a href="../TestReportListener.scala.html#9351" title="sbt.TestEvent">TestEvent</a>) <span title="Unit">{</span>}
	<span class="keyword">def</span> <a title="(String,Throwable)Unit" id="80409">endGroup</a>(<a title="String" id="85075">name</a>: <span title="String">String</span>, <a title="Throwable" id="85076">t</a>: <span title="Throwable">Throwable</span>) <span title="Unit">{</span>}
	<span class="keyword">def</span> <a title="(String,sbt.Result.Value)Unit" id="80410">endGroup</a>(<a title="String" id="85077">name</a>: <span title="String">String</span>, <a title="sbt.Result.Value" id="85078">result</a>: Result.<span title="sbt.Result.Value">Value</span>)
	{
		<span title="Unit" class="keyword">if</span>(<a href="#85078" title="sbt.Result.Value">result</a> <a title="(AnyRef)Boolean" id="3457">==</a> <a href="../TestFramework.scala.html#11602" title="object sbt.Result">Result</a>.<a href="../TestFramework.scala.html#32461" title="=&gt; sbt.Result.Value">Passed</a>)
			<a href="#80404" title="=&gt; scala.collection.mutable.Map[String,Long]">succeeded</a>(<a href="#85077" title="String">name</a>) = <a title="object java.lang.System" id="1831">System</a>.<a title="()Long" id="34091">currentTimeMillis</a>
	}
	<span class="keyword">def</span> <a title="(sbt.Result.Value)Unit" id="80411">doComplete</a>(<a title="sbt.Result.Value" id="85080">finalResult</a>: Result.<span title="sbt.Result.Value">Value</span>) { <a href="#80413" title="()Unit">complete</a>() }
	<span class="keyword">def</span> <a title="(Throwable)Unit" id="80412">doComplete</a>(<a title="Throwable" id="85081">t</a>: <span title="Throwable">Throwable</span>) { <a href="#80413" title="()Unit">complete</a>() }
	
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="()Unit" id="80413">complete</a>()
	{
		<a href="#13442" title="object sbt.impl.TestStatus">TestStatus</a>.<a href="#85068" title="(scala.collection.mutable.Map[String,Long],String,sbt.Path,sbt.Logger)Unit">write</a>(<a href="#80404" title="=&gt; scala.collection.mutable.Map[String,Long]">succeeded</a>, <span title="java.lang.String(&quot;Successful Tests&quot;)" class="string">&quot;Successful Tests&quot;</span>, <a href="#80414" title="sbt.Path">path</a>, <a href="#80415" title="sbt.Logger">log</a>)
	}
}

<span class="keyword">private</span>[sbt] <span class="keyword">class</span> <a title="class TestQuickFilter extends java.lang.Object with (String) =&gt; Boolean with NotNull with ScalaObject" id="13636">TestQuickFilter</a>(<a title="sbt.CompileAnalysis" id="80393">testAnalysis</a>: <a href="../Analysis.scala.html#6996" title="sbt.CompileAnalysis">CompileAnalysis</a>, <a title="Boolean" id="80394">failedOnly</a>: <a title="Boolean" id="2115">Boolean</a>, <a title="sbt.Path" id="80395">path</a>: <a href="../Path.scala.html#10152" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="80396">log</a>: <a href="../Logger.scala.html#11784" title="sbt.Logger">Logger</a>) <span class="keyword">extends</span> (String =&gt; Boolean) <span class="keyword">with</span> <a title="NotNull" id="189">NotNull</a>
{
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[String,Long]" id="80389">exclude</a> = <a href="#13442" title="object sbt.impl.TestStatus">TestStatus</a>.<a href="#85067" title="(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]">read</a>(<a href="#80395" title="sbt.Path">path</a>, <a href="#80396" title="sbt.Logger">log</a>)
	<span class="keyword">private</span> <span class="keyword">lazy</span> <span class="keyword">val</span> <a title="scala.collection.mutable.Map[String,sbt.Path]" id="80391">map</a> = <a href="#80393" title="sbt.CompileAnalysis">testAnalysis</a>.<a href="../Analysis.scala.html#26929" title="=&gt; scala.collection.mutable.Map[String,sbt.Path]">testSourceMap</a>
	<span class="keyword">def</span> <a title="(String)Boolean" id="80392">apply</a>(<a title="String" id="85092">test</a>: <span title="String">String</span>) =
		<a href="#80388" title="=&gt; scala.collection.mutable.Map[String,Long]">exclude</a>.<a title="(String)Option[Long]" id="24227">get</a>(<a href="#85092" title="String">test</a>) <span title="Boolean" class="keyword">match</span>
		{
			<span title="Boolean(true)" class="keyword">case</span> <span title="object None">None</span> =&gt; <span title="Boolean(true)" class="keyword">true</span> <span class="comment">// include because this test has not been run or did not succeed</span>
			<span title="Boolean" class="keyword">case</span> Some(<a title="Long" id="85094">lastSuccessTime</a>) =&gt; <span class="comment">// succeeded the last time it was run</span>
				<span title="Boolean" class="keyword">if</span>(<a href="#80394" title="Boolean">failedOnly</a>)
					<span title="Boolean(false)" class="keyword">false</span> <span class="comment">// don't include because the last time succeeded</span>
				<span class="keyword">else</span>
					<a href="#80393" title="sbt.CompileAnalysis">testAnalysis</a>.<a href="../Analysis.scala.html#26862" title="(sbt.Path)Option[scala.collection.mutable.Set[sbt.Path]]">products</a>(<a href="#80390" title="(String)sbt.Path" id="24231">map</a>(<a href="#85092" title="String">test</a>)) <span title="Boolean" class="keyword">match</span>
					{
						<span title="Boolean(true)" class="keyword">case</span> <span title="object None">None</span> =&gt; <span title="Boolean(true)" class="keyword">true</span>
						<span title="Boolean" class="keyword">case</span> Some(<a title="scala.collection.mutable.Set[sbt.Path]" id="85102">products</a>) =&gt; <a href="#85102" title="scala.collection.mutable.Set[sbt.Path]">products</a>.<a title="((sbt.Path) =&gt; Boolean)Boolean" id="16072">exists</a>(<a href="#85094" title="Long">lastSuccessTime</a> <a title="(Long)Boolean" id="3215">&lt;=</a> <a href="#85104" title="sbt.Path">_</a>.<a href="../Path.scala.html#17862" title="=&gt; Long">lastModified</a>) <span class="comment">// include if the test is newer than the last run</span>
					}
		}
}
<span class="keyword">private</span> <span class="keyword">object</span> <a title="object sbt.impl.TestStatus" id="13442">TestStatus</a>
{
	<span class="keyword">import</span> java.util.Properties
	<span class="keyword">def</span> <a title="(sbt.Path,sbt.Logger)scala.collection.mutable.Map[String,Long]" id="85067">read</a>(<a title="sbt.Path" id="85070">path</a>: <a href="../Path.scala.html#10152" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="85071">log</a>: <a href="../Logger.scala.html#11784" title="sbt.Logger">Logger</a>): <span title="scala.collection.mutable.Map[String,Long]">Map</span>[String, Long] =
	{
		<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,Long]" id="85107">map</a> = <span title="scala.collection.mutable.HashMap[String,Long]" class="keyword">new</span> <a title="scala.collection.mutable.HashMap[String,Long]" id="15716">HashMap</a>[String, Long]
		<span class="keyword">val</span> <a title="java.util.Properties" id="85108">properties</a> = <span title="java.util.Properties" class="keyword">new</span> <span title="java.util.Properties">Properties</span>
		<a href="#85069" title="(Option[String],String,sbt.Logger)Unit">logError</a>(<a href="MapUtilities.scala.html#13475" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="MapUtilities.scala.html#56313" title="(java.util.Properties,sbt.Path,sbt.Logger)Option[String]">load</a>(<a href="#85108" title="java.util.Properties">properties</a>, <a href="#85070" title="sbt.Path">path</a>, <a href="#85071" title="sbt.Logger">log</a>), <span title="java.lang.String(&quot;loading&quot;)" class="string">&quot;loading&quot;</span>, <a href="#85071" title="sbt.Logger">log</a>)
		<span class="keyword">for</span>(<a title="((String) =&gt; Unit)Unit" id="85119">test</a> &lt;- <a href="MapUtilities.scala.html#13475" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="MapUtilities.scala.html#56314" title="(java.util.Properties)Iterable[String]">propertyNames</a>(<a href="#85108" title="java.util.Properties">properties</a>))
			<a href="#85107" title="scala.collection.mutable.HashMap[String,Long]">map</a>.<a title="(String,Long)Option[Long]" id="24188">put</a>(<a href="#85119" title="String">test</a>, <a href="#85108" title="java.util.Properties">properties</a>.<a title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString" id="56194">getProperty</a>(<a href="#85119" title="String">test</a>).<a title="=&gt; Long" id="17030">toLong</a>)
		<a href="#85107" title="scala.collection.mutable.HashMap[String,Long]">map</a>
	}
	<span class="keyword">def</span> <a title="(scala.collection.mutable.Map[String,Long],String,sbt.Path,sbt.Logger)Unit" id="85068">write</a>(<a title="scala.collection.mutable.Map[String,Long]" id="85082">map</a>: <span title="scala.collection.mutable.Map[String,Long]">Map</span>[String, Long], <a title="String" id="85083">label</a>: <span title="String">String</span>, <a title="sbt.Path" id="85084">path</a>: <a href="../Path.scala.html#10152" title="sbt.Path">Path</a>, <a title="sbt.Logger" id="85085">log</a>: <a href="../Logger.scala.html#11784" title="sbt.Logger">Logger</a>)
	{
		<span class="keyword">val</span> <a title="java.util.Properties" id="85125">properties</a> = <span title="java.util.Properties" class="keyword">new</span> <span title="java.util.Properties">Properties</span>
		<span class="keyword">for</span>( <a href="#85132" title="(((String, Long)) =&gt; Unit)Unit" id="16064">(</a><a title="String" id="85137">test</a>, <a title="Long" id="85138">lastSuccessTime</a>) &lt;- <a href="#85082" title="scala.collection.mutable.Map[String,Long]">map</a>)
			<a href="#85125" title="java.util.Properties">properties</a>.<a title="(java.lang.String,java.lang.String)java.lang.Object" id="56187">setProperty</a>(<a href="#85137" title="String">test</a>, <a href="#85138" title="Long">lastSuccessTime</a>.<a title="()java.lang.String" id="3448">toString</a>)
		<a href="#85069" title="(Option[String],String,sbt.Logger)Unit">logError</a>(<a href="MapUtilities.scala.html#13475" title="object sbt.impl.PropertiesUtilities">PropertiesUtilities</a>.<a href="MapUtilities.scala.html#56312" title="(java.util.Properties,String,sbt.Path,sbt.Logger)Option[String]">write</a>(<a href="#85125" title="java.util.Properties">properties</a>, <a href="#85083" title="String">label</a>, <a href="#85084" title="sbt.Path">path</a>, <a href="#85085" title="sbt.Logger">log</a>), <span title="java.lang.String(&quot;writing&quot;)" class="string">&quot;writing&quot;</span>, <a href="#85085" title="sbt.Logger">log</a>)
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(Option[String],String,sbt.Logger)Unit" id="85069">logError</a>(<a title="Option[String]" id="85115">result</a>: <a title="Option[String]" id="897">Option</a>[String], <a title="String" id="85116">action</a>: <span title="String">String</span>, <a title="sbt.Logger" id="85117">log</a>: <a href="../Logger.scala.html#11784" title="sbt.Logger">Logger</a>)
	{
		<a href="#85115" title="Option[String]">result</a>.<a title="((String) =&gt; Unit)Unit" id="19022">foreach</a>(<a title="String" id="85140">msg</a> =&gt; <a href="#85117" title="sbt.Logger">log</a>.<a href="../Logger.scala.html#19519" title="(=&gt; String)Unit">error</a>(<span title="java.lang.String(&quot;Error &quot;)" class="string">&quot;Error &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#85116" title="String">action</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; test status: &quot;)" class="string">&quot; test status: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#85140" title="String">msg</a>))
	}
}
        </pre>
    </body>
</html>