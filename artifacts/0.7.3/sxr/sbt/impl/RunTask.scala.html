<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/impl/RunTask.scala</title>
        <script type="text/javascript" src="../../jquery-all.js"></script>
        <script type="text/javascript" src="../../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2009  Mark Harrah
 */</span>
 <span class="keyword">package</span> sbt.impl
 <span class="keyword">import</span> sbt._

<span class="keyword">import</span> scala.collection.{immutable, mutable}
<span class="keyword">import</span> scala.collection.Map
<span class="keyword">import</span> sbt.wrap.Wrappers.identityMap

<span class="keyword">private</span>[sbt] <span class="keyword">object</span> <a title="object sbt.impl.RunTask" id="13457">RunTask</a>
{
	<span class="keyword">final</span> <span class="keyword">type</span> <a title="sbt.Project#Task" id="67763">Task</a> = Project#<a href="../TaskManager.scala.html#14605" title="sbt.Project#Task">Task</a>
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="67764">apply</a>(<a title="sbt.impl.RunTask.Task" id="67777">root</a>: <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="67778">rootName</a>: <span title="String">String</span>): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]]  = <a href="#67765" title="(sbt.impl.RunTask.Task,String,Boolean)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">apply</a>(<a href="#67777" title="sbt.impl.RunTask.Task">root</a>, <a href="#67778" title="String">rootName</a>, <span title="Boolean(true)" class="keyword">true</span>)
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String,Boolean)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="67765">apply</a>(<a title="sbt.impl.RunTask.Task" id="67774">root</a>: <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="67775">rootName</a>: <span title="String">String</span>, <a title="Boolean" id="67776">parallelExecution</a>: <a title="Boolean" id="2115">Boolean</a>): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]] =
		<a href="#67766" title="(sbt.impl.RunTask.Task,String,Int)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">apply</a>(<a href="#67774" title="sbt.impl.RunTask.Task">root</a>, <a href="#67775" title="String">rootName</a>, <span title="Int" class="keyword">if</span>(<a href="#67776" title="Boolean">parallelExecution</a>) <a title="object java.lang.Runtime" id="1696">Runtime</a>.<a title="()java.lang.Runtime" id="62623">getRuntime</a>.<a title="()Int" id="62635">availableProcessors</a> <span class="keyword">else</span> <span title="Int(1)" class="int">1</span>)
	<span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String,Int)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="67766">apply</a>(<a title="sbt.impl.RunTask.Task" id="67769">root</a>: <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="67770">rootName</a>: <span title="String">String</span>, <a title="Int" id="67771">maximumTasks</a>: <span title="Int">Int</span>): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]]  = (<span title="sbt.impl.RunTask" class="keyword">new</span> <a href="#13456" title="sbt.impl.RunTask">RunTask</a>(<a href="#67769" title="sbt.impl.RunTask.Task">root</a>, <a href="#67770" title="String">rootName</a>, <a href="#67771" title="Int">maximumTasks</a>)).<a href="#73227" title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">run</a>()
}
<span class="keyword">import</span> RunTask._
<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">class</span> <a title="class RunTask extends java.lang.Object with NotNull with ScalaObject" id="13456">RunTask</a>(<a title="sbt.impl.RunTask.Task" id="73269">root</a>: <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="73270">rootName</a>: <span title="String">String</span>, <a title="Int" id="73271">maximumTasks</a>: <span title="Int">Int</span>) <span class="keyword">extends</span> <a title="NotNull" id="189">NotNull</a>
{
	<a title="(Boolean)Unit" id="6092">require</a>(<a href="#73271" title="Int">maximumTasks</a> <span title="(Int)Boolean">&gt;=</span> <span title="Int(1)" class="int">1</span>)
	<span class="keyword">def</span> <a title="=&gt; Boolean" id="73225">parallel</a> = <a href="#73271" title="Int">maximumTasks</a> <a title="(Int)Boolean" id="3093">&gt;</a> <span title="Int(1)" class="int">1</span>
	<span class="keyword">def</span> <a title="=&gt; Boolean" id="73226">multiProject</a> = <a href="#73260" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>.<a title="=&gt; Int" id="17940">size</a> <span title="(Int)Boolean">&gt;=</span> <span title="Int(2)" class="int">2</span>
	<span class="keyword">def</span> <a title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="73227">run</a>(): <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">List</span>[WorkFailure[Task]]  =
	{
		<span class="keyword">try</span>
		{
			<a href="#73228" title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">runTasksExceptRoot</a>() <span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">match</span>
			{
				<span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">case</span> <span title="object Nil">Nil</span> =&gt;
					<span class="keyword">val</span> <a title="Option[String]" id="73450">result</a> = <a href="#73236" title="(sbt.impl.RunTask.Task,String)Option[String]">runTask</a>(<a href="#73269" title="sbt.impl.RunTask.Task">root</a>, <a href="#73270" title="String">rootName</a>)
					<a href="#73450" title="Option[String]">result</a>.<span title="((String) =&gt; sbt.WorkFailure[sbt.impl.RunTask.Task])Option[sbt.WorkFailure[sbt.impl.RunTask.Task]]">map</span>( <a title="String" id="73455">errorMessage</a> =&gt; <a href="../ParallelRunner.scala.html#73457" title="(sbt.impl.RunTask.Task,String)sbt.WorkFailure[sbt.impl.RunTask.Task]">WorkFailure</a>(<a href="#73269" title="sbt.impl.RunTask.Task">root</a>, <span title="java.lang.String(&quot;Error running &quot;)" class="string">&quot;Error running &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73270" title="String">rootName</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73455" title="String">errorMessage</a>) ).<a title="=&gt; List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="19026">toList</a>
				<span title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" class="keyword">case</span> <a title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="73470">failures</a> =&gt; <a href="#73470" title="List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">failures</a>
			}
		}
		<span class="keyword">finally</span>
		{
			<span class="keyword">for</span>(<a title="((sbt.Project#ManagerType) =&gt; Unit)Unit" id="73472">project</a> &lt;- <a href="#73260" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>; <a title="((String) =&gt; Unit)Unit" id="73474">saveError</a> &lt;- <a href="#73472" title="sbt.Project#ManagerType">project</a>.<a href="../Environment.scala.html#14801" title="()Option[String]">saveEnvironment</a>)
				<a href="#73472" title="sbt.Project#ManagerType">project</a>.<a href="../Project.scala.html#14612" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#19518" title="(=&gt; String)Unit">warn</a>(<span title="java.lang.String(&quot;Could not save properties for project &quot;)" class="string">&quot;Could not save properties for project &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73472" title="sbt.Project#ManagerType">project</a>.<a href="../Project.scala.html#14618" title="=&gt; String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: &quot;)" class="string">&quot;: &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73474" title="String">saveError</a>)
		}
	}
	<span class="comment">// This runs all tasks except the root.task.</span>
	<span class="comment">// It uses a buffered logger in record mode to ensure that all output for a given task is consecutive</span>
	<span class="comment">// it ignores the root task so that the root task may be run with buffering disabled so that the output</span>
	<span class="comment">// occurs without delay.</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="()List[sbt.WorkFailure[sbt.impl.RunTask.Task]]" id="73228">runTasksExceptRoot</a>() =
		<a href="../ParallelRunner.scala.html#6820" title="object sbt.ParallelRunner">ParallelRunner</a>.<a href="../ParallelRunner.scala.html#73408" title="(sbt.impl.RunTask.Task,(sbt.impl.RunTask.Task) =&gt; String,(sbt.impl.RunTask.Task) =&gt; Option[String],Int,(sbt.impl.RunTask.Task) =&gt; sbt.Logger)List[sbt.WorkFailure[sbt.impl.RunTask.Task]]">run</a>(<a href="#73256" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>, <a href="#73248" title="(sbt.impl.RunTask.Task)String">expandedTaskName</a>, <a href="#73230" title="(sbt.impl.RunTask.Task)Option[String]">runIfNotRoot</a>, <a href="#73271" title="Int">maximumTasks</a>, (<a title="sbt.impl.RunTask.Task" id="73443">t</a>: <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>) =&gt; <a href="#73443" title="sbt.impl.RunTask.Task">t</a>.<a href="../TaskManager.scala.html#19067" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#14612" title="=&gt; sbt.Logger">log</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="((sbt.BufferedLogger) =&gt; Unit)Unit" id="73229">withBuffered</a>(<a title="(sbt.BufferedLogger) =&gt; Unit" id="73476">f</a>: BufferedLogger =&gt; Unit)
	{
		<span class="keyword">for</span>(<a title="((sbt.BufferedLogger) =&gt; Unit)Unit" id="73478">buffered</a> &lt;- <a href="#73262" title="=&gt; List[sbt.BufferedLogger]">bufferedLoggers</a>)
			<a href="../Control.scala.html#11797" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#25436" title="(=&gt; Unit)Unit">trap</a>(<a href="#73476" title="(sbt.BufferedLogger)Unit" id="16333">f</a>(<a href="#73478" title="sbt.BufferedLogger">buffered</a>))
	}
	<span class="comment">/** Will be called in its own thread. Runs the given task if it is not the root task.*/</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Option[String]" id="73230">runIfNotRoot</a>(<a title="sbt.impl.RunTask.Task" id="73439">action</a>: <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>): <span title="Option[String]">Option</span>[String] =
	{
		<span title="Option[String]" class="keyword">if</span>(<a href="#73235" title="(sbt.impl.RunTask.Task)Boolean">isRoot</a>(<a href="#73439" title="sbt.impl.RunTask.Task">action</a>))
			<span title="object None">None</span>
		<span class="keyword">else</span>
			<a href="#73236" title="(sbt.impl.RunTask.Task,String)Option[String]">runTask</a>(<a href="#73439" title="sbt.impl.RunTask.Task">action</a>, <a href="#73248" title="(sbt.impl.RunTask.Task)String">expandedTaskName</a>(<a href="#73439" title="sbt.impl.RunTask.Task">action</a>))
	}
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="73231">headerStart</a> = <span title="object java.lang.System">System</span>.<span title="(java.lang.String,java.lang.String)java.lang.String">getProperty</span>(<span title="java.lang.String(&quot;sbt.start.delimiter&quot;)" class="string">&quot;sbt.start.delimiter&quot;</span>, <span title="java.lang.String(&quot;==&quot;)" class="string">&quot;==&quot;</span>)
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="java.lang.String" id="73233">headerEnd</a> = <span title="object java.lang.System">System</span>.<span title="(java.lang.String,java.lang.String)java.lang.String">getProperty</span>(<span title="java.lang.String(&quot;sbt.end.delimiter&quot;)" class="string">&quot;sbt.end.delimiter&quot;</span>, <span title="java.lang.String(&quot;==&quot;)" class="string">&quot;==&quot;</span>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Boolean" id="73235">isRoot</a>(<a title="sbt.impl.RunTask.Task" id="73481">t</a>: <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>) = <a href="#73481" title="sbt.impl.RunTask.Task">t</a> <span title="(AnyRef)Boolean">==</span> <a href="#73256" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>
	<span class="comment">/** Will be called in its own thread except for the root task. */</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task,String)Option[String]" id="73236">runTask</a>(<a title="sbt.impl.RunTask.Task" id="73451">action</a>: <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>, <a title="String" id="73452">actionName</a>: <span title="String">String</span>): <span title="Option[String]">Option</span>[String] =
	{
		<span class="keyword">val</span> <a title="java.lang.String" id="73484">label</a> = <span title="java.lang.String" class="keyword">if</span>(<a href="#73226" title="=&gt; Boolean">multiProject</a>) (<a href="#73451" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#19067" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#14618" title="=&gt; String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; / &quot;)" class="string">&quot; / &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73452" title="String">actionName</a>) <span class="keyword">else</span> <a href="#73452" title="String">actionName</a>
		<span class="keyword">def</span> <a title="(sbt.ControlEvent.Value,String,String)Unit" id="73485">banner</a>(<a title="sbt.ControlEvent.Value" id="73490">event</a>: ControlEvent.<a title="sbt.ControlEvent.Value" id="21709">Value</a>, <a title="String" id="73491">firstSeparator</a>: <span title="String">String</span>, <a title="String" id="73492">secondSeparator</a>: <span title="String">String</span>) =
			<a href="../Control.scala.html#11797" title="object sbt.Control">Control</a>.<a href="../Control.scala.html#25436" title="(=&gt; Unit)Unit">trap</a>(<a href="#73451" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#19067" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#14612" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#19522" title="(sbt.ControlEvent.Value,=&gt; String)Unit">control</a>(<a href="#73490" title="sbt.ControlEvent.Value">event</a>, <a href="#73491" title="String">firstSeparator</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73484" title="java.lang.String">label</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; &quot;)" class="string">&quot; &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73492" title="String">secondSeparator</a>))
		<span class="keyword">val</span> <a title="Boolean" id="73486">buffered</a> = <a href="#73225" title="=&gt; Boolean">parallel</a> <a title="(Boolean)Boolean" id="2699">&amp;&amp;</a> <a title="=&gt; Boolean" id="2695">!</a><a href="#73235" title="(sbt.impl.RunTask.Task)Boolean">isRoot</a>(<a href="#73451" title="sbt.impl.RunTask.Task">action</a>)
		<span title="Unit" class="keyword">if</span>(<a href="#73486" title="Boolean">buffered</a>)
			<a href="#73485" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#10486" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#68428" title="=&gt; sbt.ControlEvent.Value">Start</a>, <span title="java.lang.String(&quot;\012  &quot;)" class="string">&quot;\n  &quot;</span>, <span title="java.lang.String(&quot;...&quot;)" class="string">&quot;...&quot;</span>)
		<span class="keyword">def</span> <a title="()Option[String]" id="73487">doRun</a>() =
		{
			<a href="#73485" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#10486" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#68430" title="=&gt; sbt.ControlEvent.Value">Header</a>, <span title="java.lang.String(&quot;\012&quot;)" class="string">&quot;\n&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73231" title="=&gt; java.lang.String">headerStart</a>, <a href="#73231" title="=&gt; java.lang.String">headerStart</a>)
			<span class="keyword">try</span> { <a href="#73451" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#19075" title="=&gt; Option[String]">invoke</a> }
			<span class="keyword">catch</span> { <span title="Some[java.lang.String]" class="keyword">case</span> <a title="Exception" id="73498">e</a>: <a title="Exception" id="2076">Exception</a> =&gt; <a href="#73451" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#19067" title="=&gt; sbt.Project#ManagerType">manager</a>.<a href="../Project.scala.html#14612" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#19514" title="(=&gt; Throwable)Unit">trace</a>(<a href="#73498" title="Exception">e</a>); <span title="(java.lang.String)Some[java.lang.String]">Some</span>(<a href="#73498" title="Exception">e</a>.<a title="()java.lang.String" id="17620">toString</a>) }
			<span class="keyword">finally</span> { <a href="#73485" title="(sbt.ControlEvent.Value,String,String)Unit">banner</a>(<a href="../Logger.scala.html#10486" title="object sbt.ControlEvent">ControlEvent</a>.<a href="../Logger.scala.html#68432" title="=&gt; sbt.ControlEvent.Value">Finish</a>, <a href="#73233" title="=&gt; java.lang.String">headerEnd</a>, <a href="#73233" title="=&gt; java.lang.String">headerEnd</a>) }
		}
		
		<span title="Option[String]" class="keyword">if</span>(<a href="#73486" title="Boolean">buffered</a>)
			<a href="#73237" title="(sbt.impl.RunTask.Task,=&gt; Option[String])Option[String]">bufferLogging</a>(<a href="#73451" title="sbt.impl.RunTask.Task">action</a>, <a href="#73487" title="()Option[String]">doRun</a>())
		<span class="keyword">else</span>
			<a href="#73487" title="()Option[String]">doRun</a>()
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="[T](sbt.impl.RunTask.Task,=&gt; T)T" id="73237">bufferLogging</a>[<a title="&gt;: Nothing &lt;: Any" id="73239">T</a>](<a title="sbt.impl.RunTask.Task" id="73505">action</a>: <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>, <a title="=&gt; T" id="73506">f</a>: =&gt; T) =
		<a href="#73268" title="(sbt.Project)Option[sbt.BufferedLogger]">bufferedLogger</a>(<a href="#73505" title="sbt.impl.RunTask.Task">action</a>.<a href="../TaskManager.scala.html#19067" title="=&gt; sbt.Project#ManagerType">manager</a>) <span title="T" class="keyword">match</span>
		{
			<span title="T" class="keyword">case</span> <a id="1">Some</a>(<a title="sbt.BufferedLogger" id="73510">buffered</a>) =&gt; <a href="#73510" title="sbt.BufferedLogger">buffered</a>.<a href="../Logger.scala.html#67258" title="(=&gt; T)T">buffer</a> { <a href="#73506" title="=&gt; T">f</a> }
			<span title="T" class="keyword">case</span> <span title="object None">None</span> =&gt; <a href="#73506" title="=&gt; T">f</a>
		}
	
	<span class="comment">/* Most of the following is for implicitly adding dependencies (see the expand method)*/</span>
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.Project,Iterable[sbt.Project]]" id="73240">projectDependencyCache</a> = <a href="../wrap/Wrappers.scala.html#18022" title="sbt.wrap.MutableMapWrapper[sbt.Project,Iterable[sbt.Project]]">identityMap</a>[<a href="../Project.scala.html#7647" title="sbt.Project">Project</a>, <a title="Iterable[sbt.Project]" id="372">Iterable</a>[Project]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)Iterable[sbt.Project]" id="73242">dependencies</a>(<a title="sbt.Project" id="73513">project</a>: <a href="../Project.scala.html#7647" title="sbt.Project">Project</a>) = <a href="#73240" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.Project,Iterable[sbt.Project]]">projectDependencyCache</a>.<a href="../wrap/Wrappers.scala.html#29625" title="(sbt.Project,=&gt; Iterable[sbt.Project])Iterable[sbt.Project]">getOrElseUpdate</a>(<a href="#73513" title="sbt.Project">project</a>, <a href="#73513" title="sbt.Project">project</a>.<a href="../Dag.scala.html#14719" title="=&gt; List[sbt.Project]">topologicalSort</a>.<a title="(Int)List[sbt.Project]" id="17745">dropRight</a>(<span title="Int(1)" class="int">1</span>))

	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]" id="73243">expandedCache</a> = <a href="../wrap/Wrappers.scala.html#18022" title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]">identityMap</a>[<a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>, <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="73245">expanded</a>(<a title="sbt.impl.RunTask.Task" id="73515">task</a>: <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a> = <a href="#73243" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,sbt.impl.RunTask.Task]">expandedCache</a>.<a href="../wrap/Wrappers.scala.html#29625" title="(sbt.impl.RunTask.Task,=&gt; sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">getOrElseUpdate</a>(<a href="#73515" title="sbt.impl.RunTask.Task">task</a>, <a href="#73265" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expandImpl</a>(<a href="#73515" title="sbt.impl.RunTask.Task">task</a>))

	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]" id="73246">expandedTaskNameCache</a> = <a href="../wrap/Wrappers.scala.html#18022" title="sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]">identityMap</a>[<a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>, <span title="String">String</span>]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)String" id="73248">expandedTaskName</a>(<a title="sbt.impl.RunTask.Task" id="73426">task</a>: <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>) =
		<span title="String" class="keyword">if</span>(<a href="#73426" title="sbt.impl.RunTask.Task">task</a> <span title="(AnyRef)Boolean">==</span> <a href="#73256" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>)
			<a href="#73270" title="String">rootName</a>
		<span class="keyword">else</span>
			<a href="#73246" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]">expandedTaskNameCache</a>.<a href="../wrap/Wrappers.scala.html#29610" title="(sbt.impl.RunTask.Task,=&gt; String)String">getOrElse</a>(<a href="#73426" title="sbt.impl.RunTask.Task">task</a>, <a href="#73426" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#19068" title="=&gt; String">name</a>)

	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]" id="73249">nameToTaskCache</a> = <a href="../wrap/Wrappers.scala.html#18022" title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]">identityMap</a>[<a href="../Project.scala.html#7647" title="sbt.Project">Project</a>, <span title="scala.collection.Map[String,sbt.impl.RunTask.Task]">Map</span>[String, Task]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]" id="73251">nameToTaskMap</a>(<a title="sbt.Project" id="73517">project</a>: <a href="../Project.scala.html#7647" title="sbt.Project">Project</a>): <span title="scala.collection.Map[String,sbt.impl.RunTask.Task]">Map</span>[String, Task] = <a href="#73249" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[String,sbt.impl.RunTask.Task]]">nameToTaskCache</a>.<a href="../wrap/Wrappers.scala.html#29625" title="(sbt.Project,=&gt; scala.collection.Map[String,sbt.impl.RunTask.Task])scala.collection.Map[String,sbt.impl.RunTask.Task]">getOrElseUpdate</a>(<a href="#73517" title="sbt.Project">project</a>, <a href="#73517" title="sbt.Project">project</a>.<a href="../Project.scala.html#14624" title="=&gt; scala.collection.Map[String,project.Task]">tasks</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project,String)Option[sbt.impl.RunTask.Task]" id="73252">taskForName</a>(<a title="sbt.Project" id="73518">project</a>: <a href="../Project.scala.html#7647" title="sbt.Project">Project</a>, <a title="String" id="73519">name</a>: <span title="String">String</span>): <span title="Option[sbt.impl.RunTask.Task]">Option</span>[Task] = <a href="#73251" title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]">nameToTaskMap</a>(<a href="#73518" title="sbt.Project">project</a>).<span title="(String)Option[sbt.impl.RunTask.Task]">get</span>(<a href="#73519" title="String">name</a>)
	
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]" id="73253">taskNameCache</a> = <a href="../wrap/Wrappers.scala.html#18022" title="sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]">identityMap</a>[<a href="../Project.scala.html#7647" title="sbt.Project">Project</a>, <span title="scala.collection.Map[sbt.impl.RunTask.Task,String]">Map</span>[Task, String]]
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)Option[String]" id="73255">taskName</a>(<a title="sbt.impl.RunTask.Task" id="73520">task</a>: <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>) =
	{
		<span class="keyword">val</span> <a title="sbt.Project#ManagerType" id="73522">project</a> = <a href="#73520" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#19067" title="=&gt; sbt.Project#ManagerType">manager</a>
		<a href="#73253" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.Project,scala.collection.Map[sbt.impl.RunTask.Task,String]]">taskNameCache</a>.<a href="../wrap/Wrappers.scala.html#29625" title="(sbt.Project,=&gt; scala.collection.Map[sbt.impl.RunTask.Task,String])scala.collection.Map[sbt.impl.RunTask.Task,String]">getOrElseUpdate</a>(<a href="#73522" title="sbt.Project#ManagerType">project</a>, <a href="#73267" title="(sbt.Project)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]">taskNameMap</a>(<a href="#73522" title="sbt.Project#ManagerType">project</a>)).<span title="(sbt.impl.RunTask.Task)Option[String]">get</span>(<a href="#73520" title="sbt.impl.RunTask.Task">task</a>)
	}
	
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="sbt.impl.RunTask.Task" id="73256">expandedRoot</a> = <a href="#73264" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expand</a>(<a href="#73269" title="sbt.impl.RunTask.Task">root</a>)
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="List[sbt.Project#ManagedTask]" id="73258">allTasks</a> = <a href="#73256" title="=&gt; sbt.impl.RunTask.Task">expandedRoot</a>.<a href="../Dag.scala.html#14719" title="=&gt; List[sbt.Project#ManagedTask]">topologicalSort</a>
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="scala.collection.immutable.Set[sbt.Project#ManagerType]" id="73260">allProjects</a> = <a title="(sbt.Project#ManagerType*)scala.collection.immutable.Set[sbt.Project#ManagerType]" id="6083">Set</a>(<a href="#73258" title="=&gt; List[sbt.Project#ManagedTask]">allTasks</a>.<span title="((sbt.Project#ManagedTask) =&gt; sbt.Project#ManagerType)List[sbt.Project#ManagerType]">map</span>(<a href="#73385" title="sbt.Project#ManagedTask">_</a>.<a href="../TaskManager.scala.html#19067" title="=&gt; sbt.Project#ManagerType">manager</a>).<span title="=&gt; Seq[sbt.Project#ManagerType]">toSeq</span> : _*)
	<span class="keyword">private</span> <span class="keyword">val</span> <a title="List[sbt.BufferedLogger]" id="73262">bufferedLoggers</a> = <span title="List[sbt.BufferedLogger]" class="keyword">if</span>(<a href="#73225" title="=&gt; Boolean">parallel</a>) <a href="#73260" title="=&gt; scala.collection.immutable.Set[sbt.Project#ManagerType]">allProjects</a>.<span title="=&gt; List[sbt.Project#ManagerType]">toList</span>.<a title="((sbt.Project#ManagerType) =&gt; Iterable[sbt.BufferedLogger])List[sbt.BufferedLogger]" id="17773">flatMap</a>(<a href="#73268" title="(Option[sbt.BufferedLogger])Iterable[sbt.BufferedLogger]">bufferedLogger</a>) <span class="keyword">else</span> <span title="object Nil">Nil</span>
	
	<span class="comment">/** Adds implicit dependencies, which are tasks with the same name in the project dependencies
	* of the enclosing project of the task.*/</span>
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="73264">expand</a>(<a title="sbt.impl.RunTask.Task" id="73377">root</a>: <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a> = <a href="#73245" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expanded</a>(<a href="#73377" title="sbt.impl.RunTask.Task">root</a>)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task" id="73265">expandImpl</a>(<a title="sbt.impl.RunTask.Task" id="73516">task</a>: <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a>): <a href="../TaskManager.scala.html#14605" title="sbt.impl.RunTask.Task">Task</a> =
	{
		<span class="keyword">val</span> <a title="Option[String]" id="73532">nameOption</a> = <a href="#73255" title="(sbt.impl.RunTask.Task)Option[String]">taskName</a>(<a href="#73516" title="sbt.impl.RunTask.Task">task</a>)
		<span class="keyword">val</span> <a title="List[sbt.Project#ManagedTask]" id="73533">explicitDependencies</a> = <a href="#73516" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#19060" title="=&gt; List[sbt.Project#ManagedTask]">dependencies</a>
		<span class="keyword">val</span> <a title="Iterable[sbt.impl.RunTask.Task]" id="73534">implicitDependencies</a> = <a href="#73532" title="Option[String]">nameOption</a>.<span title="((String) =&gt; Iterable[sbt.impl.RunTask.Task])Option[Iterable[sbt.impl.RunTask.Task]]">map</span>(<a title="String" id="73547">name</a> =&gt; <a href="#73242" title="(sbt.Project)Iterable[sbt.Project]">dependencies</a>(<a href="#73516" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#19067" title="=&gt; sbt.Project#ManagerType">manager</a>).<a title="((sbt.Project) =&gt; Iterable[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]" id="16062">flatMap</a>(<a href="#73266" title="(Option[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]">noninteractiveTask</a>(<a href="#73547" title="String">name</a>)) ).<a title="(=&gt; Iterable[sbt.impl.RunTask.Task])Iterable[sbt.impl.RunTask.Task]" id="19015">getOrElse</a>(<span title="object Nil">Nil</span>)
		<span class="keyword">val</span> <a title="scala.collection.mutable.Set[sbt.Project#ManagedTask]" id="73535">allDependencies</a> = mutable.<a title="(sbt.Project#ManagedTask*)scala.collection.mutable.Set[sbt.Project#ManagedTask]" id="15534">HashSet</a>( (<a href="#73533" title="List[sbt.Project#ManagedTask]">explicitDependencies</a> <a title="(Iterable[sbt.Project#ManagedTask])List[sbt.Project#ManagedTask]" id="17731">++</a> <a href="#73534" title="Iterable[sbt.impl.RunTask.Task]">implicitDependencies</a>).<span title="=&gt; Seq[sbt.Project#ManagedTask]">toSeq</span>  : _* )
		<span class="keyword">val</span> <a title="sbt.Project#Task" id="73536">expandedTask</a> = <a href="#73516" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#19073" title="((List[_171.ManagedTask])_171.Task) forSome { val _171: sbt.Project }">setDependencies</a>(<a href="#73535" title="scala.collection.mutable.Set[sbt.Project#ManagedTask]">allDependencies</a>.<span title="=&gt; List[sbt.Project#ManagedTask]">toList</span>.<span title="((sbt.Project#ManagedTask) =&gt; sbt.impl.RunTask.Task)List[sbt.impl.RunTask.Task]">map</span>(<a href="#73245" title="(sbt.impl.RunTask.Task)sbt.impl.RunTask.Task">expanded</a>))
		<a href="#73532" title="Option[String]">nameOption</a>.<span title="((String) =&gt; Unit)Unit">foreach</span>(<a title="String" id="73580">name</a> =&gt; <a href="#73246" title="=&gt; sbt.wrap.MutableMapWrapper[sbt.impl.RunTask.Task,String]">expandedTaskNameCache</a>(<a href="#73536" title="sbt.Project#Task">expandedTask</a>) = <a href="#73580" title="String">name</a>)
		<a href="#73536" title="sbt.Project#Task">expandedTask</a>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(String)(sbt.Project)Option[sbt.impl.RunTask.Task]" id="73266">noninteractiveTask</a>(<a title="String" id="73551">name</a>: <span title="String">String</span>)(<a title="sbt.Project" id="73552">project</a>: <a href="../Project.scala.html#7647" title="sbt.Project">Project</a>): <span title="Option[sbt.impl.RunTask.Task]">Option</span>[Task] =
		<a href="#73252" title="(sbt.Project,String)Option[sbt.impl.RunTask.Task]">taskForName</a>(<a href="#73552" title="sbt.Project">project</a>, <a href="#73551" title="String">name</a>) <a title="((sbt.impl.RunTask.Task) =&gt; Option[sbt.impl.RunTask.Task])Option[sbt.impl.RunTask.Task]" id="19019">flatMap</a> { <a title="sbt.impl.RunTask.Task" id="73583">task</a> =&gt;
			<span title="Option[sbt.impl.RunTask.Task]" class="keyword">if</span>(<a href="#73583" title="sbt.impl.RunTask.Task">task</a>.<a href="../TaskManager.scala.html#19062" title="=&gt; Boolean">interactive</a>)
			{
				<a href="#73552" title="sbt.Project">project</a>.<a href="../Project.scala.html#14612" title="=&gt; sbt.Logger">log</a>.<a href="../Logger.scala.html#19516" title="(=&gt; String)Unit">debug</a>(<span title="java.lang.String(&quot;Not including task &quot;)" class="string">&quot;Not including task &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73551" title="String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; in project &quot;)" class="string">&quot; in project &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#73552" title="sbt.Project">project</a>.<a href="../Project.scala.html#14618" title="=&gt; String">name</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;: interactive tasks can only be run directly.&quot;)" class="string">&quot;: interactive tasks can only be run directly.&quot;</span>)
				<span title="object None">None</span>
			}
			<span class="keyword">else</span>
				<span title="(sbt.impl.RunTask.Task)Some[sbt.impl.RunTask.Task]">Some</span>(<a href="#73583" title="sbt.impl.RunTask.Task">task</a>)
		}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]" id="73267">taskNameMap</a>(<a title="sbt.Project" id="73525">project</a>: <a href="../Project.scala.html#7647" title="sbt.Project">Project</a>) = mutable.<a title="((sbt.impl.RunTask.Task, String)*)scala.collection.mutable.Map[sbt.impl.RunTask.Task,String]" id="15519">Map</a>(<a href="#73251" title="(sbt.Project)scala.collection.Map[String,sbt.impl.RunTask.Task]">nameToTaskMap</a>(<a href="#73525" title="sbt.Project">project</a>).<a title="(((String, sbt.impl.RunTask.Task)) =&gt; (sbt.impl.RunTask.Task, String))Iterable[(sbt.impl.RunTask.Task, String)]" id="16060">map</a>(<a href="#73531" title="(String, sbt.impl.RunTask.Task)">_</a>.<a title="=&gt; (sbt.impl.RunTask.Task, String)" id="17589">swap</a>).<a title="=&gt; Seq[(sbt.impl.RunTask.Task, String)]" id="16094">toSeq</a> : _*)
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(sbt.Project)Option[sbt.BufferedLogger]" id="73268">bufferedLogger</a>(<a title="sbt.Project" id="73394">project</a>: <a href="../Project.scala.html#7647" title="sbt.Project">Project</a>): <span title="Option[sbt.BufferedLogger]">Option</span>[BufferedLogger] =
		<a href="#73394" title="sbt.Project">project</a>.<a href="../Project.scala.html#14612" title="=&gt; sbt.Logger">log</a> <span title="Option[sbt.BufferedLogger]" class="keyword">match</span>
		{
			<span title="Some[sbt.BufferedLogger]" class="keyword">case</span> <a title="sbt.BufferedLogger" id="73586">buffered</a>: <a href="../Logger.scala.html#6441" title="sbt.BufferedLogger">BufferedLogger</a> =&gt; <span title="(sbt.BufferedLogger)Some[sbt.BufferedLogger]">Some</span>(<a href="#73586" title="sbt.BufferedLogger">buffered</a>)
			<span title="None.type" class="keyword">case</span> _ =&gt; <span title="object None">None</span>
		}
}
        </pre>
    </body>
</html>