<?xml version="1.0" encoding="utf-8"?>
			<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" ></meta>
        <title>sbt/DotGraph.scala</title>
        <script type="text/javascript" src="../jquery-all.js"></script>
        <script type="text/javascript" src="../linked.js"></script>
        <link rel="stylesheet" type="text/css" href="../style.css" title="Style"></link>
    </head>
    <body>
        <pre>
<span class="comment">/* sbt -- Simple Build Tool
 * Copyright 2008, 2009 Mark Harrah
 */</span>
<span class="keyword">package</span> sbt

<span class="keyword">import</span> java.io.{File, Writer}

<span class="keyword">object</span> <a title="object sbt.DotGraph" id="7813">DotGraph</a>
{
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(Iterable[java.io.File])(java.io.File) =&gt; String" id="29122">fToString</a>(<a title="Iterable[java.io.File]" id="29134">roots</a>: <span title="Iterable[java.io.File]">Iterable</span>[File]): (File =&gt; String) =
		(<a title="java.io.File" id="84180">x</a>: <span title="java.io.File">File</span>) =&gt; <a href="#29126" title="(Iterable[java.io.File],java.io.File)java.lang.String">sourceToString</a>(<a href="#29134" title="Iterable[java.io.File]">roots</a>, <a href="#84180" title="java.io.File">x</a>)
	<span class="keyword">def</span> <a title="(sbt.BasicCompileAnalysis,sbt.Path,Iterable[sbt.Path],sbt.Logger)Option[String]" id="29123">sources</a>(<a title="sbt.BasicCompileAnalysis" id="29128">analysis</a>: <a href="Analysis.scala.html#6885" title="sbt.BasicCompileAnalysis">BasicCompileAnalysis</a>, <a title="sbt.Path" id="29129">outputDirectory</a>: <a href="Path.scala.html#10152" title="sbt.Path">Path</a>, <a title="Iterable[sbt.Path]" id="29130">sourceRoots</a>: <span title="Iterable[sbt.Path]">Iterable</span>[Path], <a title="sbt.Logger" id="29131">log</a>: <a href="Logger.scala.html#11784" title="sbt.Logger">Logger</a>) =
	{
		<span class="keyword">val</span> <a title="(java.io.File) =&gt; String" id="29133">toString</a> = <a href="#29122" title="(Iterable[java.io.File])(java.io.File) =&gt; String">fToString</a>(<a href="Path.scala.html#10153" title="object sbt.Path">Path</a>.<a href="Path.scala.html#15378" title="(Iterable[sbt.Path])scala.collection.immutable.Set[java.io.File]">getFiles</a>(<a href="#29130" title="Iterable[sbt.Path]">sourceRoots</a>))
		<a href="#29125" title="(sbt.BasicCompileAnalysis,sbt.Path,(java.io.File) =&gt; String,(java.io.File) =&gt; String,sbt.Logger)Option[String]">apply</a>(<a href="#29128" title="sbt.BasicCompileAnalysis">analysis</a>, <a href="#29129" title="sbt.Path">outputDirectory</a>, <a href="#29133" title="(java.io.File) =&gt; String">toString</a>, <a href="#29133" title="(java.io.File) =&gt; String">toString</a>, <a href="#29131" title="sbt.Logger">log</a>)
	}
	<span class="keyword">def</span> <a title="(sbt.BasicCompileAnalysis,sbt.Path,Iterable[sbt.Path],sbt.Logger)Option[String]" id="29124">packages</a>(<a title="sbt.BasicCompileAnalysis" id="29337">analysis</a>: <a href="Analysis.scala.html#6885" title="sbt.BasicCompileAnalysis">BasicCompileAnalysis</a>, <a title="sbt.Path" id="29338">outputDirectory</a>: <a href="Path.scala.html#10152" title="sbt.Path">Path</a>, <a title="Iterable[sbt.Path]" id="29339">sourceRoots</a>: <span title="Iterable[sbt.Path]">Iterable</span>[Path], <a title="sbt.Logger" id="29340">log</a>: <a href="Logger.scala.html#11784" title="sbt.Logger">Logger</a>) =
	{
		<span class="keyword">val</span> <a title="(String) =&gt; java.lang.String" id="29342">packageOnly</a> = (<a title="String" id="29345">path</a>: <span title="String">String</span>) =&gt;
		{
			<span class="keyword">val</span> <a title="Int" id="29346">last</a> = <a href="#29345" title="String">path</a>.<a title="(Int)Int" id="5791">lastIndexOf</a>(<span title="object java.io.File">File</span>.<a title="implicit scala.Predef.char2int : (Char)Int" id="6292">separatorChar</a>)
			<span class="keyword">val</span> <a title="java.lang.String" id="29347">packagePath</a> = (<span title="java.lang.String" class="keyword">if</span>(<a href="#29346" title="Int">last</a> <a title="(Int)Boolean" id="3093">&gt;</a> <span title="Int(0)" class="int">0</span>) <a href="#29345" title="String">path</a>.<span title="(Int,Int)java.lang.String">substring</span>(<span title="Int(0)" class="int">0</span>, <a href="#29346" title="Int">last</a>) <span class="keyword">else</span> <a href="#29345" title="String">path</a>).<span title="()java.lang.String">trim</span>
			<span title="java.lang.String" class="keyword">if</span>(<a href="#29347" title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString">packagePath</a>.<span title="=&gt; Boolean">isEmpty</span>) <span title="java.lang.String(&quot;&quot;)" class="string">&quot;&quot;</span> <span class="keyword">else</span> <a href="#29347" title="java.lang.String">packagePath</a>.<a title="(Char,Char)java.lang.String" id="5803">replace</a>(<span title="object java.io.File">File</span>.<span title="Char">separatorChar</span>, <span title="Char('.')" class="char">'.'</span>)
		}
		<span class="keyword">val</span> <a title="(java.io.File) =&gt; java.lang.String" id="29343">toString</a> = <a href="#29342" title="(String) =&gt; java.lang.String">packageOnly</a> <a title="((java.io.File) =&gt; String)(java.io.File) =&gt; java.lang.String" id="16337">compose</a> <a href="#29122" title="(Iterable[java.io.File])(java.io.File) =&gt; String">fToString</a>(<a href="Path.scala.html#10153" title="object sbt.Path">Path</a>.<a href="Path.scala.html#15378" title="(Iterable[sbt.Path])scala.collection.immutable.Set[java.io.File]">getFiles</a>(<a href="#29339" title="Iterable[sbt.Path]">sourceRoots</a>))
		<a href="#29125" title="(sbt.BasicCompileAnalysis,sbt.Path,(java.io.File) =&gt; String,(java.io.File) =&gt; String,sbt.Logger)Option[String]">apply</a>(<a href="#29337" title="sbt.BasicCompileAnalysis">analysis</a>, <a href="#29338" title="sbt.Path">outputDirectory</a>, <a href="#29343" title="(java.io.File) =&gt; java.lang.String">toString</a>, <a href="#29343" title="(java.io.File) =&gt; java.lang.String">toString</a>, <a href="#29340" title="sbt.Logger">log</a>)
	}
	<span class="keyword">def</span> <a title="(sbt.BasicCompileAnalysis,sbt.Path,(java.io.File) =&gt; String,(java.io.File) =&gt; String,sbt.Logger)Option[String]" id="29125">apply</a>(<a title="sbt.BasicCompileAnalysis" id="29136">analysis</a>: <a href="Analysis.scala.html#6885" title="sbt.BasicCompileAnalysis">BasicCompileAnalysis</a>, <a title="sbt.Path" id="29137">outputDirectory</a>: <a href="Path.scala.html#10152" title="sbt.Path">Path</a>, <a title="(java.io.File) =&gt; String" id="29138">sourceToString</a>: File =&gt; String, <a title="(java.io.File) =&gt; String" id="29139">externalToString</a>: File =&gt; String, <a title="sbt.Logger" id="29140">log</a>: <a href="Logger.scala.html#11784" title="sbt.Logger">Logger</a>) =
	{
		<span class="keyword">val</span> <a title="java.io.File" id="29142">outputDir</a> = <a href="#29137" title="sbt.Path">outputDirectory</a>.<a href="Path.scala.html#17865" title="=&gt; java.io.File">asFile</a>
		
		<span class="keyword">def</span> <a title="[Key, Value](String,String,Iterable[(Key, scala.collection.Set[Value])],(Key) =&gt; String,(Value) =&gt; String)Option[String]" id="29143">generateGraph</a>[<a title="&gt;: Nothing &lt;: Any" id="29146">Key</a>, <a title="&gt;: Nothing &lt;: Any" id="29147">Value</a>](<a title="String" id="29149">fileName</a>: <span title="String">String</span>, <a title="String" id="29150">graphName</a>: <span title="String">String</span>, <a title="Iterable[(Key, scala.collection.Set[Value])]" id="29151">graph</a>: <span title="Iterable[(Key, scala.collection.Set[Value])]">Iterable</span>[(Key, scala.collection.Set[Value])],
			<a title="(Key) =&gt; String" id="29152">keyToString</a>: Key =&gt; String, <a title="(Value) =&gt; String" id="29153">valueToString</a>: Value =&gt; String) =
		{
			<span class="keyword">import</span> scala.collection.mutable.{HashMap, HashSet}
			<span class="keyword">val</span> <a title="scala.collection.mutable.HashMap[String,scala.collection.mutable.HashSet[String]]" id="29155">mappedGraph</a> = <span title="scala.collection.mutable.HashMap[String,scala.collection.mutable.HashSet[String]]" class="keyword">new</span> <a title="scala.collection.mutable.HashMap[String,scala.collection.mutable.HashSet[String]]" id="15716">HashMap</a>[String, HashSet[String]]
			<span class="keyword">for</span>( <a href="#29157" title="((((Key, scala.collection.Set[Value]), String)) =&gt; Unit)Unit" id="1327">(</a><a title="Key" id="29171">key</a>, <a title="scala.collection.Set[Value]" id="29172">values</a>) &lt;- <a href="#29151" title="Iterable[(Key, scala.collection.Set[Value])]">graph</a>; <a title="String" id="29173">keyString</a> = <a href="#29152" title="(Key)String">keyToString</a>(<a href="#29171" title="Key">key</a>); <a title="((Value) =&gt; Unit)Unit" id="29175">value</a> &lt;- <a href="#29172" title="scala.collection.Set[Value]">values</a>)
				<a href="#29155" title="scala.collection.mutable.HashMap[String,scala.collection.mutable.HashSet[String]]">mappedGraph</a>.<a title="(String,=&gt; scala.collection.mutable.HashSet[String])scala.collection.mutable.HashSet[String]" id="24193">getOrElseUpdate</a>(<a href="#29173" title="String">keyString</a>, <span title="scala.collection.mutable.HashSet[String]" class="keyword">new</span> <a title="scala.collection.mutable.HashSet[String]" id="15533">HashSet</a>[String]) <a title="(String)Unit" id="17898">+=</a> <a href="#29153" title="(Value)String">valueToString</a>(<a href="#29175" title="Value">value</a>)

			<a href="FileUtilities.scala.html#9046" title="object sbt.FileUtilities">FileUtilities</a>.<a href="FileUtilities.scala.html#15283" title="(java.io.File,sbt.Logger)((java.io.Writer) =&gt; Option[String])Option[String]">write</a>(<a title="(java.io.File,java.lang.String)java.io.File" id="16006" class="keyword">new</a> <span title="java.io.File">File</span>(<a href="#29142" title="java.io.File">outputDir</a>, <a href="#29149" title="String">fileName</a>), <a href="#29140" title="sbt.Logger">log</a>) { (<a title="java.io.Writer" id="29265">writer</a>: <a title="java.io.Writer" id="3755">Writer</a>) =&gt;
			
				<span class="keyword">def</span> <a title="(String)Unit" id="29266">writeLine</a>(<a title="String" id="29267">line</a>: <span title="String">String</span>) = <a href="FileUtilities.scala.html#9046" title="object sbt.FileUtilities">FileUtilities</a>.<a href="FileUtilities.scala.html#15323" title="(java.io.Writer,String)Unit">writeLine</a>(<a href="#29265" title="java.io.Writer">writer</a>, <a href="#29267" title="String">line</a>)
				<a href="#29266" title="(String)Unit">writeLine</a>(<span title="java.lang.String(&quot;digraph &quot;)" class="string">&quot;digraph &quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#29150" title="String">graphName</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot; {&quot;)" class="string">&quot; {&quot;</span>)
				<span class="keyword">for</span>( <a href="#29271" title="(((String, scala.collection.mutable.HashSet[String])) =&gt; Unit)Unit">(</a><a title="String" id="29276">dependsOn</a>, <a title="scala.collection.mutable.HashSet[String]" id="29277">dependants</a>) &lt;- <a href="#29155" title="scala.collection.mutable.HashMap[String,scala.collection.mutable.HashSet[String]]">mappedGraph</a>; <a title="((String) =&gt; Unit)Unit" id="29279">dependant</a> &lt;- <a href="#29277" title="scala.collection.mutable.HashSet[String]">dependants</a>)
				{
					<span title="Unit" class="keyword">if</span>(<a href="#29279" title="String">dependant</a> <a title="(AnyRef)Boolean" id="5738">!=</a> <a href="#29276" title="String">dependsOn</a> <span title="(Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#29276" title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString">dependsOn</a>.<span title="=&gt; Boolean">isEmpty</span> <span title="(Boolean)Boolean">&amp;&amp;</span> <span title="=&gt; Boolean">!</span><a href="#29279" title="implicit scala.Predef.stringWrapper : (String)scala.runtime.RichString">dependant</a>.<span title="=&gt; Boolean">isEmpty</span>)
						<a href="#29266" title="(String)Unit">writeLine</a>(<span title="java.lang.String(&quot;&quot;&quot;)" class="string">&quot;\&quot;&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#29279" title="String">dependant</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;&quot; -&gt; &quot;&quot;)" class="string">&quot;\&quot; -&gt; \&quot;&quot;</span> <span title="(Any)java.lang.String">+</span> <a href="#29276" title="String">dependsOn</a> <span title="(Any)java.lang.String">+</span> <span title="java.lang.String(&quot;&quot;&quot;)" class="string">&quot;\&quot;&quot;</span>)
				}
				<a href="#29266" title="(String)Unit">writeLine</a>(<span title="java.lang.String(&quot;}&quot;)" class="string">&quot;}&quot;</span>)
				<a title="object None" id="505">None</a>
			}
		}
		<span class="keyword">val</span> <a title="(sbt.Path) =&gt; String" id="29148">srcToString</a> = (<a title="sbt.Path" id="29296">p</a>: <a href="Path.scala.html#10152" title="sbt.Path">Path</a>) =&gt; <a href="#29138" title="(java.io.File)String">sourceToString</a>(<a href="#29296" title="sbt.Path">p</a>.<a href="Path.scala.html#17865" title="=&gt; java.io.File">asFile</a>)
		<a href="FileUtilities.scala.html#9046" title="object sbt.FileUtilities">FileUtilities</a>.<a href="FileUtilities.scala.html#15246" title="(java.io.File,sbt.Logger)Option[String]">createDirectory</a>(<a href="#29142" title="java.io.File">outputDir</a>, <a href="#29140" title="sbt.Logger">log</a>) <span title="(=&gt; Option[String])Option[String]">orElse</span>
		<a href="#29143" title="(String,String,Iterable[(sbt.Path, scala.collection.Set[sbt.Path])],(sbt.Path) =&gt; String,(sbt.Path) =&gt; String)Option[String]">generateGraph</a>(<a href="Analysis.scala.html#10780" title="object sbt.BasicAnalysis">BasicAnalysis</a>.<a href="Analysis.scala.html#26821" title="=&gt; java.lang.String">DependenciesFileName</a>, <span title="java.lang.String(&quot;dependencies&quot;)" class="string">&quot;dependencies&quot;</span>, <a href="#29136" title="sbt.BasicCompileAnalysis">analysis</a>.<a href="Analysis.scala.html#26867" title="=&gt; Iterable[(sbt.Path, scala.collection.Set[sbt.Path])]">allDependencies</a>,
			<a href="#29148" title="(sbt.Path) =&gt; String">srcToString</a>, <a href="#29148" title="(sbt.Path) =&gt; String">srcToString</a>) <span title="(=&gt; Option[String])Option[String]">orElse</span>
		<a href="#29143" title="(String,String,Iterable[(java.io.File, scala.collection.Set[sbt.Path])],(java.io.File) =&gt; String,(sbt.Path) =&gt; String)Option[String]">generateGraph</a>(<a href="Analysis.scala.html#10780" title="object sbt.BasicAnalysis">BasicAnalysis</a>.<a href="Analysis.scala.html#26823" title="=&gt; java.lang.String">ExternalDependenciesFileName</a>, <span title="java.lang.String(&quot;externalDependencies&quot;)" class="string">&quot;externalDependencies&quot;</span>, <a href="#29136" title="sbt.BasicCompileAnalysis">analysis</a>.<a href="Analysis.scala.html#26866" title="=&gt; Iterable[(java.io.File, scala.collection.Set[sbt.Path])]">allExternalDependencies</a>,
			<a href="#29139" title="(java.io.File) =&gt; String">externalToString</a>, <a href="#29148" title="(sbt.Path) =&gt; String">srcToString</a>)
	}
	<span class="keyword">def</span> <a title="(Iterable[java.io.File],java.io.File)java.lang.String" id="29126">sourceToString</a>(<a title="Iterable[java.io.File]" id="84181">roots</a>: <span title="Iterable[java.io.File]">Iterable</span>[File], <a title="java.io.File" id="84182">source</a>: <span title="java.io.File">File</span>) =
	{
		<span class="keyword">val</span> <a title="java.lang.String" id="84184">rawName</a> = <a href="#29127" title="(Iterable[java.io.File],java.io.File)String">relativized</a>(<a href="#84181" title="Iterable[java.io.File]">roots</a>, <a href="#84182" title="java.io.File">source</a>).<span title="()java.lang.String">trim</span>
		<span title="java.lang.String" class="keyword">if</span>(<a href="#84184" title="java.lang.String">rawName</a>.<a title="(java.lang.String)Boolean" id="5787">endsWith</a>(<span title="java.lang.String(&quot;.scala&quot;)" class="string">&quot;.scala&quot;</span>))
			<a href="#84184" title="java.lang.String">rawName</a>.<span title="(Int,Int)java.lang.String">substring</span>(<span title="Int(0)" class="int">0</span>, <a href="#84184" title="java.lang.String">rawName</a>.<span title="()Int">length</span> <a title="(Int)Int" id="3096">-</a> <span title="java.lang.String(&quot;.scala&quot;)" class="string">&quot;.scala&quot;</span>.<span title="()Int">length</span>)
		<span class="keyword">else</span>
			<a href="#84184" title="java.lang.String">rawName</a>
	}
	<span class="keyword">private</span> <span class="keyword">def</span> <a title="(Iterable[java.io.File],java.io.File)String" id="29127">relativized</a>(<a title="Iterable[java.io.File]" id="84185">roots</a>: <span title="Iterable[java.io.File]">Iterable</span>[File], <a title="java.io.File" id="84186">path</a>: <span title="java.io.File">File</span>): <span title="String">String</span> =
	{
		<span class="keyword">val</span> <a title="Iterable[String]" id="84209">relativized</a> = <a href="#84185" title="Iterable[java.io.File]">roots</a>.<a title="((java.io.File) =&gt; Iterable[String])Iterable[String]" id="16062">flatMap</a>(<a title="java.io.File" id="84213">root</a> =&gt; <a href="Path.scala.html#10153" title="object sbt.Path">Path</a>.<a href="Path.scala.html#15369" title="(Option[String])Iterable[String]" id="898">relativize</a>(<a href="#84213" title="java.io.File">root</a>, <a href="#84186" title="java.io.File">path</a>))
		<span class="keyword">val</span> <a title="Int" id="84210">shortest</a> = (Int.<span title="Int(2147483647)">MaxValue</span> <a href="#84235" title="(Int)((Int, String) =&gt; Int)Int" id="16081">/:</a> <a href="#84209" title="Iterable[String]">relativized</a>)(<a href="#84238" title="implicit scala.Predef.intWrapper : (Int)scala.runtime.RichInt" id="6218">_</a> <a title="(Int)Int" id="18605">min</a> <a href="#84239" title="String">_</a>.<span title="()Int">length</span>)
		<a href="#84209" title="Iterable[String]">relativized</a>.<a title="((String) =&gt; Boolean)Option[String]" id="16073">find</a>(<a href="#84245" title="String">_</a>.<span title="()Int">length</span> <a title="(Int)Boolean" id="3089">==</a> <a href="#84210" title="Int">shortest</a>).<a title="(=&gt; String)String" id="19015">getOrElse</a>(<a href="#84186" title="java.io.File">path</a>.<a title="()java.lang.String" id="16008">getName</a>)
	}
}
        </pre>
    </body>
</html>