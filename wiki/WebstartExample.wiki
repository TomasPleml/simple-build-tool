* Work in progress! *

{{{
import sbt._
// A project that defines a webstart application in the 'app' directory
// and a web project to serve it in the 'web' directory.
class WebstartTest(info: ProjectInfo) extends ParentProject(info)
{
  val app = project("app", "Webstart Test Application", new ApplicationProject(_))
  val web = project("web", "Webstart Test Server", new ServerProject(_), app)

  // The web project.  Running 'jetty-run' on this project will serve the
  // webstart application from http://localhost:8080 using jetty.
  class ServerProject(info: ProjectInfo) extends DefaultWebProject(info)
  {
    val jetty = "org.mortbay.jetty" % "jetty" % "6.1.14"
    // This is necessary since it is not currently possible to depend on actions in other projects.
    override def prepareWebappAction = task { app.act("package") } && super.prepareWebappAction
    // Include the webstart files directly in the web app root directory.
    override def extraWebappFiles = (app.webstartOutputDirectory ##) ** AllPassFilter
  }
  class ApplicationProject(info: ProjectInfo) extends DefaultWebstartProject(info)
  {
    import SignJar._
    // Difficulties with jarsigner currently, so signing is commented out:
    //override def webstartSignConfiguration = Some(SignConfiguration("user", storePassword("password") :: Nil))
    override def defaultJarBaseName = "webstart-test"
    //override def webstartPack200 = false // uncomment to disable pack200 compression
    //override def webstartGzip = false // uncomment to disable gzip compression, which is enabled by default

    def jnlpXML(libraries: Seq[WebstartJarResource]) =
      <jnlp spec="1.0+" codebase="http://localhost:8080/" href={defaultJarBaseName + ".jnlp"}>
        <information>
          <title>Webstart Test</title>
          <vendor>Vendor</vendor>
          <description>Webstart test</description>
          <offline-allowed />
        </information>
        <resources>
          <j2se version="1.5+" />
          { defaultElements(libraries) }
        </resources>
        <application-desc main-class="test.Main" />
      </jnlp>
  }
}
}}}